GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 1


   1               		.file	"main.c"
   2               	__SREG__ = 0x3f
   3               	__SP_H__ = 0x3e
   4               	__SP_L__ = 0x3d
   5               	__tmp_reg__ = 0
   6               	__zero_reg__ = 1
   7               		.global __do_copy_data
   8               		.global __do_clear_bss
   9               		.stabs	"/Users/meh/_avrProjects/LCDdirectLVDS/61-moreColors/",100,0,2,.Ltext0
  10               		.stabs	"main.c",100,0,2,.Ltext0
  11               		.text
  12               	.Ltext0:
  13               		.stabs	"gcc2_compiled.",60,0,0,0
  14               		.stabs	"int:t(0,1)=r(0,1);-32768;32767;",128,0,1,0
  15               		.stabs	"char:t(0,2)=@s8;r(0,2);0;255;",128,0,1,0
  16               		.stabs	"long int:t(0,3)=@s32;r(0,3);020000000000;017777777777;",128,0,1,0
  17               		.stabs	"unsigned int:t(0,4)=r(0,4);0;0177777;",128,0,1,0
  18               		.stabs	"long unsigned int:t(0,5)=@s32;r(0,5);0;037777777777;",128,0,1,0
  19               		.stabs	"long long int:t(0,6)=@s64;r(0,6);01000000000000000000000;0777777777777777777777;",128,0,1,
  20               		.stabs	"long long unsigned int:t(0,7)=@s64;r(0,7);0;01777777777777777777777;",128,0,1,0
  21               		.stabs	"short int:t(0,8)=r(0,8);-32768;32767;",128,0,1,0
  22               		.stabs	"short unsigned int:t(0,9)=r(0,9);0;0177777;",128,0,1,0
  23               		.stabs	"signed char:t(0,10)=@s8;r(0,10);-128;127;",128,0,1,0
  24               		.stabs	"unsigned char:t(0,11)=@s8;r(0,11);0;255;",128,0,1,0
  25               		.stabs	"float:t(0,12)=r(0,1);4;0;",128,0,1,0
  26               		.stabs	"double:t(0,13)=r(0,1);4;0;",128,0,1,0
  27               		.stabs	"long double:t(0,14)=r(0,1);4;0;",128,0,1,0
  28               		.stabs	"void:t(0,15)=(0,15)",128,0,1,0
  29               		.stabs	"projInfo.h",130,0,0,0
  30               		.stabs	"/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/inttypes.h",130,0,0,0
  31               		.stabs	"/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/stdint.h",130,0,0,0
  32               		.stabs	"int8_t:t(3,1)=(0,10)",128,0,121,0
  33               		.stabs	"uint8_t:t(3,2)=(0,11)",128,0,122,0
  34               		.stabs	"int16_t:t(3,3)=(0,1)",128,0,123,0
  35               		.stabs	"uint16_t:t(3,4)=(0,4)",128,0,124,0
  36               		.stabs	"int32_t:t(3,5)=(0,3)",128,0,125,0
  37               		.stabs	"uint32_t:t(3,6)=(0,5)",128,0,126,0
  38               		.stabs	"int64_t:t(3,7)=(0,6)",128,0,128,0
  39               		.stabs	"uint64_t:t(3,8)=(0,7)",128,0,129,0
  40               		.stabs	"intptr_t:t(3,9)=(3,3)",128,0,142,0
  41               		.stabs	"uintptr_t:t(3,10)=(3,4)",128,0,147,0
  42               		.stabs	"int_least8_t:t(3,11)=(3,1)",128,0,159,0
  43               		.stabs	"uint_least8_t:t(3,12)=(3,2)",128,0,164,0
  44               		.stabs	"int_least16_t:t(3,13)=(3,3)",128,0,169,0
  45               		.stabs	"uint_least16_t:t(3,14)=(3,4)",128,0,174,0
  46               		.stabs	"int_least32_t:t(3,15)=(3,5)",128,0,179,0
  47               		.stabs	"uint_least32_t:t(3,16)=(3,6)",128,0,184,0
  48               		.stabs	"int_least64_t:t(3,17)=(3,7)",128,0,192,0
  49               		.stabs	"uint_least64_t:t(3,18)=(3,8)",128,0,199,0
  50               		.stabs	"int_fast8_t:t(3,19)=(3,1)",128,0,213,0
  51               		.stabs	"uint_fast8_t:t(3,20)=(3,2)",128,0,218,0
  52               		.stabs	"int_fast16_t:t(3,21)=(3,3)",128,0,223,0
  53               		.stabs	"uint_fast16_t:t(3,22)=(3,4)",128,0,228,0
  54               		.stabs	"int_fast32_t:t(3,23)=(3,5)",128,0,233,0
  55               		.stabs	"uint_fast32_t:t(3,24)=(3,6)",128,0,238,0
  56               		.stabs	"int_fast64_t:t(3,25)=(3,7)",128,0,246,0
  57               		.stabs	"uint_fast64_t:t(3,26)=(3,8)",128,0,253,0
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 2


  58               		.stabs	"intmax_t:t(3,27)=(3,7)",128,0,273,0
  59               		.stabs	"uintmax_t:t(3,28)=(3,8)",128,0,278,0
  60               		.stabn	162,0,0,0
  61               		.stabs	"int_farptr_t:t(2,1)=(3,5)",128,0,77,0
  62               		.stabs	"uint_farptr_t:t(2,2)=(3,6)",128,0,81,0
  63               		.stabn	162,0,0,0
  64               		.stabn	162,0,0,0
  65               		.stabs	"main.h",130,0,0,0
  66               		.stabs	"/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/avr/io.h",130,0,0,0
  67               		.stabs	"/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/avr/fuse.h",130,0,0,0
  68               		.stabs	"__fuse_t:t(6,1)=(6,2)=s3low:(0,11),0,8;high:(0,11),8,8;extended:(0,11),16,8;;",128,0,244,0
  69               		.stabn	162,0,0,0
  70               		.stabn	162,0,0,0
  71               		.stabs	"/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/stdlib.h",130,0,0,0
  72               		.stabs	"/usr/local/lib/gcc/avr/4.4.5/include/stddef.h",130,0,0,0
  73               		.stabs	"size_t:t(8,1)=(0,4)",128,0,211,0
  74               		.stabs	"wchar_t:t(8,2)=(0,1)",128,0,323,0
  75               		.stabn	162,0,0,0
  76               		.stabs	"div_t:t(7,1)=(7,2)=s4quot:(0,1),0,16;rem:(0,1),16,16;;",128,0,71,0
  77               		.stabs	"ldiv_t:t(7,3)=(7,4)=s8quot:(0,3),0,32;rem:(0,3),32,32;;",128,0,77,0
  78               		.stabs	"__compar_fn_t:t(7,5)=(7,6)=*(7,7)=f(0,1)",128,0,80,0
  79               		.stabn	162,0,0,0
  80               		.stabs	"_commonCode_localized/heartbeat/1.21/heartbeat.h",130,0,0,0
  81               		.stabs	"./_commonCode_localized/hfModulation/1.00/hfModulation.h",130,0,0,0
  82               		.stabs	"hfm_t:t(10,1)=(10,2)=B(10,3)=s4desiredSum:(3,3),0,16;maxPower:(3,2),16,8;power:(3,2),24,8;
  83               		.stabn	162,0,0,0
  84               		.stabn	162,0,0,0
  85               		.stabn	162,0,0,0
  86               		.stabs	"/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/avr/pgmspace.h",130,0,0,0
  87               		.stabs	"prog_void:t(11,1)=(11,2)=(11,2)",128,0,217,0
  88               		.stabs	"prog_char:t(11,3)=(11,4)=@s8;r(11,4);0;255;",128,0,218,0
  89               		.stabs	"prog_uchar:t(11,5)=(11,6)=@s8;r(11,6);0;255;",128,0,219,0
  90               		.stabs	"prog_int8_t:t(11,7)=(11,8)=(0,10)",128,0,221,0
  91               		.stabs	"prog_uint8_t:t(11,9)=(11,10)=(0,11)",128,0,222,0
  92               		.stabs	"prog_int16_t:t(11,11)=(11,12)=(0,1)",128,0,223,0
  93               		.stabs	"prog_uint16_t:t(11,13)=(11,14)=(0,4)",128,0,224,0
  94               		.stabs	"prog_int32_t:t(11,15)=(11,16)=(0,3)",128,0,225,0
  95               		.stabs	"prog_uint32_t:t(11,17)=(11,18)=(0,5)",128,0,226,0
  96               		.stabs	"prog_int64_t:t(11,19)=(11,20)=(0,6)",128,0,228,0
  97               		.stabs	"prog_uint64_t:t(11,21)=(11,22)=(0,7)",128,0,229,0
  98               		.stabn	162,0,0,0
  99               		.stabs	"_commonCode_localized/sineTable/0.99/sineTable.h",130,0,0,0
 100               		.stabs	"theta_t:t(12,1)=(3,3)",128,0,69,0
 101               		.stabs	"sine_t:t(12,2)=(3,3)",128,0,96,0
 102               		.stabs	"mult_t:t(12,3)=(3,5)",128,0,99,0
 103               		.stabs	"axis_t:t(12,4)=(3,5)",128,0,114,0
 104               		.stabn	162,0,0,0
 105               		.stabs	"rowSegBuffer.h",130,0,0,0
 106               		.stabs	"_NONAME_:T(13,1)=s2red_length:(3,2),0,8;green_blue:(3,2),8,8;;",128,0,0,0
 107               		.stabs	"seg_t:t(13,2)=(13,1)",128,0,128,0
 108               		.stabn	162,0,0,0
 109               		.stabs	"fb_to_rb:F(3,2)",36,0,85,fb_to_rb
 110               		.stabs	"fbColor:P(3,2)",64,0,85,24
 111               	.global	fb_to_rb
 112               		.type	fb_to_rb, @function
 113               	fb_to_rb:
 114               		.stabd	46,0,0
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 3


 115               		.stabs	"rowBuffer.c",132,0,0,.Ltext1
 116               	.Ltext1:
   1:rowBuffer.c   **** // RowBuffer BETTER TITLED: "RowSettingsBuffer"
   2:rowBuffer.c   **** //    An entire row is calculated and stored in the rowbuffer
   3:rowBuffer.c   **** //    before each line is displayed.
   4:rowBuffer.c   **** //    (There is not nearly enough memory for an entire frameBuffer)
   5:rowBuffer.c   **** //
   6:rowBuffer.c   **** //    A single byte is used for each drawable pixel in the row
   7:rowBuffer.c   **** //    this byte is actually a bit-mask of the OCR/DT values
   8:rowBuffer.c   **** //    so it's more of a settings-buffer
   9:rowBuffer.c   **** //    
  10:rowBuffer.c   **** //    Processing each byte and writing registers takes 14 clock cycles
  11:rowBuffer.c   **** //     so at full-speed LVDS (1 pixel per 7/8ths clock cycle)
  12:rowBuffer.c   **** //     then each drawable pixel is 16 LCD pixels wide
  13:rowBuffer.c   **** //     for a maximum resolution of 64 drawable pixels across
  14:rowBuffer.c   **** //     (thus, the row-settings-buffer is 64Bytes)
  15:rowBuffer.c   **** //    (Were the bytes not packed, and we used three bytes per drawable
  16:rowBuffer.c   **** //     pixel, each readFromSRAM*3+loadToRegister*3 pixel would be 
  17:rowBuffer.c   **** //     9 cycles... for ~100 pixels and ~300Bytes. Would it really be worth
  18:rowBuffer.c   **** //     3 times the memory for 1/3 more pixels? Probably not...
  19:rowBuffer.c   **** //     See RowSegmentBuffer for higher resolution...)
  20:rowBuffer.c   **** //
  21:rowBuffer.c   **** //   Red: (+OC1D => RX0+)
  22:rowBuffer.c   **** //    Off (0/63): OCR1D = 0
  23:rowBuffer.c   **** //    35/63:      OCR1D = 3
  24:rowBuffer.c   **** //    51/63:      OCR1D = 4   (FOUR_SHADES only)
  25:rowBuffer.c   **** //    63/63:      OCR1D >= 6
  26:rowBuffer.c   **** //   Green: (/OC1B => RX1-)          (B1,0 Active, as well as G2,1)
  27:rowBuffer.c   **** //    Off (6/63): DTL1 = 0
  28:rowBuffer.c   **** //    38-39/63:      DTL1 = 1
  29:rowBuffer.c   **** //    54-55/63:      DTL1 = 2 (FOUR_SHADES only)
  30:rowBuffer.c   **** //    62-63/63:      DTL1 = 3
  31:rowBuffer.c   **** //   Blue: (+OC1A => RX2+)               (B3,2 Active from here down)
  32:rowBuffer.c   **** //    Off (15/63):  OCR1A=4
  33:rowBuffer.c   **** //    47/63:        OCR1A=5
  34:rowBuffer.c   **** //    63/63:        OCR1A=6
  35:rowBuffer.c   **** //
  36:rowBuffer.c   **** //  For faster pixels: these values could be stored in a settingsBuffer
  37:rowBuffer.c   **** //  (instead of a frame-buffer based on color values)
  38:rowBuffer.c   **** //  we have: 
  39:rowBuffer.c   **** //                             0    1    2    3
  40:rowBuffer.c   **** //                 ColorVal:  00   01   10   11
  41:rowBuffer.c   **** //     Red (OCR1D): 0,3,4,6  000, 011, 100, 110
  42:rowBuffer.c   **** //   Green (DTL1):  0,1,2,3  000, 001, 010, 011
  43:rowBuffer.c   **** //    Blue (OCR1A): 4,5,6    100, 101, 110, 110
  44:rowBuffer.c   **** //           (I guess it could be noted that Blue's bit2 is always 1)
  45:rowBuffer.c   **** //           (also: OCR1A = 7 is totally acceptable, 
  46:rowBuffer.c   **** //                  so blueOCR=0x4|blueColor)
  47:rowBuffer.c   **** //           ( Similar can be said for Red... 7 is acceptable)
  48:rowBuffer.c   **** //  For memory space, we could fit these values directly in a single byte
  49:rowBuffer.c   **** //    Red Mask: 0x07
  50:rowBuffer.c   **** //  Green Mask: 0x14
  51:rowBuffer.c   **** //   Blue Mask: 0x60
  52:rowBuffer.c   **** //
  53:rowBuffer.c   **** //  Options: mask and shift, no extra memory
  54:rowBuffer.c   **** //           andi for red
  55:rowBuffer.c   **** //           andi for green + 3 shifts
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 4


  56:rowBuffer.c   **** //           5 shifts for blue
  57:rowBuffer.c   **** //           ... 10 cycles (12 pixels)
  58:rowBuffer.c   **** //           If green is the low two bits:
  59:rowBuffer.c   **** //           andi for green
  60:rowBuffer.c   **** //           andi for red + 2 shifts
  61:rowBuffer.c   **** //           5 shifts for blue
  62:rowBuffer.c   **** //           ... 9 cycles (11 pixels)
  63:rowBuffer.c   **** //          + 3 register writes (3 cycles) = 12cycles
  64:rowBuffer.c   **** //          + 1 SRAM read (2 cycles) = 14 cycles (16 pixels)
  65:rowBuffer.c   **** //           ALSO: 5 shifts TOTAL, usable?
  66:rowBuffer.c   **** //         (This may be outdated... and doesn't take into account
  67:rowBuffer.c   **** //          mov instructions... so see the code instead of believing this)
  68:rowBuffer.c   **** //         BUT:
  69:rowBuffer.c   **** //          64 pixels across * 64 pixels down is 4096 bytes
  70:rowBuffer.c   **** //          WAY more than my RAM
  71:rowBuffer.c   **** //          So either way we need to precalculate each row before
  72:rowBuffer.c   **** //          displaying it
  73:rowBuffer.c   **** //          Could be as simple as loading direct from program memory
  74:rowBuffer.c   **** 
  75:rowBuffer.c   **** 
  76:rowBuffer.c   **** 
  77:rowBuffer.c   **** #define LOADROW	TRUE
  78:rowBuffer.c   **** 
  79:rowBuffer.c   **** #define RB_WIDTH 64 //100
  80:rowBuffer.c   **** #define RB_HEIGHT 48
  81:rowBuffer.c   **** uint8_t rowBuffer[RB_WIDTH];
  82:rowBuffer.c   **** 
  83:rowBuffer.c   **** 
  84:rowBuffer.c   **** //Convert from a frameBuffer color to a rowBuffer setting value...
  85:rowBuffer.c   **** uint8_t fb_to_rb(uint8_t fbColor)
  86:rowBuffer.c   **** {
 117               		.stabn	68,0,86,.LM0-.LFBB1
 118               	.LM0:
 119               	.LFBB1:
 120               	/* prologue: function */
 121               	/* frame size = 0 */
  87:rowBuffer.c   ****    uint8_t rb = 0;
  88:rowBuffer.c   **** 
  89:rowBuffer.c   ****    //rb bit: 7 6 5 4 3 2 1 0
  90:rowBuffer.c   ****    //        \_ _/ \_ _/ \ /
  91:rowBuffer.c   ****    //          V     V    V
  92:rowBuffer.c   ****    //          |     |    Green Setting
  93:rowBuffer.c   ****    //          |     Red Setting
  94:rowBuffer.c   ****    //          Blue Setting
  95:rowBuffer.c   **** 
  96:rowBuffer.c   ****    // Frame Buffer color/shade values:
  97:rowBuffer.c   ****    //fb bit: 7 6 5 4 3 2 1 0
  98:rowBuffer.c   ****    //        \ / \ / \ / \ /
  99:rowBuffer.c   ****    //         V   V   V   V
 100:rowBuffer.c   ****    //         |   |   |   Red Value (0-3)
 101:rowBuffer.c   ****    //         |   |   Green Value (0-3)
 102:rowBuffer.c   ****    //         |   Blue Value (0-3)
 103:rowBuffer.c   ****    //         Alpha... only partially implemented
 104:rowBuffer.c   **** 
 105:rowBuffer.c   **** #warning "This isn't at all optimized..."
 106:rowBuffer.c   ****    // Blue setting = Blue Value | 0x04
 107:rowBuffer.c   ****    uint8_t blueValue = (fbColor & 0x30) >> 4;
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 5


 122               		.stabn	68,0,107,.LM1-.LFBB1
 123               	.LM1:
 124 0000 682F      		mov r22,r24
 125 0002 70E0      		ldi r23,lo8(0)
 108:rowBuffer.c   ****    rb = (blueValue << 5) | 0x80;
 109:rowBuffer.c   **** 
 110:rowBuffer.c   ****    // Red setting = redVal << 1 | redVal & 0x01
 111:rowBuffer.c   ****    uint8_t redValue = (fbColor & 0x03);
 112:rowBuffer.c   ****    rb |= ((redValue << 1) | (redValue & 0x01)) << 2;
 126               		.stabn	68,0,112,.LM2-.LFBB1
 127               	.LM2:
 128 0004 8370      		andi r24,lo8(3)
 129 0006 90E0      		ldi r25,lo8(0)
 130 0008 9C01      		movw r18,r24
 131 000a 2170      		andi r18,lo8(1)
 132 000c 3070      		andi r19,hi8(1)
 133 000e 880F      		lsl r24
 134 0010 991F      		rol r25
 135 0012 282B      		or r18,r24
 136 0014 392B      		or r19,r25
 137 0016 220F      		lsl r18
 138 0018 331F      		rol r19
 139 001a 220F      		lsl r18
 140 001c 331F      		rol r19
 141 001e 2068      		ori r18,lo8(-128)
 142 0020 AB01      		movw r20,r22
 143 0022 4073      		andi r20,lo8(48)
 144 0024 5070      		andi r21,hi8(48)
 145 0026 440F      		lsl r20
 146 0028 551F      		rol r21
 147 002a 242B      		or r18,r20
 148 002c CB01      		movw r24,r22
 149 002e 8C70      		andi r24,lo8(12)
 150 0030 9070      		andi r25,hi8(12)
 151 0032 9595      		asr r25
 152 0034 8795      		ror r24
 153 0036 9595      		asr r25
 154 0038 8795      		ror r24
 113:rowBuffer.c   **** 
 114:rowBuffer.c   ****    // Green Setting = Green Value...
 115:rowBuffer.c   ****    uint8_t greenValue = (fbColor & 0x0C) >> 2;
 116:rowBuffer.c   ****    rb |= greenValue;
 117:rowBuffer.c   **** 
 118:rowBuffer.c   ****    return rb;
 119:rowBuffer.c   **** }
 155               		.stabn	68,0,119,.LM3-.LFBB1
 156               	.LM3:
 157 003a 822B      		or r24,r18
 158               	/* epilogue start */
 159 003c 0895      		ret
 160               		.size	fb_to_rb, .-fb_to_rb
 161               		.stabs	"rb:r(3,2)",64,0,87,18
 162               		.stabn	192,0,0,.LFBB1-.LFBB1
 163               		.stabn	224,0,0,.Lscope1-.LFBB1
 164               	.Lscope1:
 165               		.stabs	"",36,0,0,.Lscope1-.LFBB1
 166               		.stabd	78,0,0
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 6


 167               		.stabs	"getTetBrick:F(3,2)",36,0,395,getTetBrick
 168               		.stabs	"row:P(3,2)",64,0,395,24
 169               		.stabs	"col:P(3,2)",64,0,395,22
 170               	.global	getTetBrick
 171               		.type	getTetBrick, @function
 172               	getTetBrick:
 173               		.stabd	46,0,0
 174               		.stabs	"tetStuff.c",132,0,0,.Ltext2
 175               	.Ltext2:
   1:tetStuff.c    **** //YEP. In a previous version (long before the row-seg-buffer)
   2:tetStuff.c    **** // Tetris was dang-near completion...
   3:tetStuff.c    **** // each block was a single drawable pixel
   4:tetStuff.c    **** // so it was pretty durn ugly.
   5:tetStuff.c    **** // But the refresh-rate was fast-enough at the time and the pixels were
   6:tetStuff.c    **** //  large-enough to make it playable
   7:tetStuff.c    **** // It was, in fact, my lifelong-goal to write Tetris... Ever since I
   8:tetStuff.c    **** // started "coding" in HyperCard.
   9:tetStuff.c    **** // Maybe something groovy could be done with low-refresh-rates...
  10:tetStuff.c    **** // "PredictaTris"... where hand-eye-coordination is handy, it doesn't
  11:tetStuff.c    **** // require much in the way of memory... Could be the same game, the same
  12:tetStuff.c    **** // speeds... just that the screen updates once a second, so you have to 
  13:tetStuff.c    **** // remember your moves and plan 'em out... crazy.
  14:tetStuff.c    **** 
  15:tetStuff.c    **** 
  16:tetStuff.c    **** #if (TRUE)
  17:tetStuff.c    **** 
  18:tetStuff.c    **** //in main...
  19:tetStuff.c    **** uint8_t fb_to_rb(uint8_t fbColor);
  20:tetStuff.c    **** 
  21:tetStuff.c    **** // Tetris:
  22:tetStuff.c    **** // This is the game-board, NOT the number of pixels used (including the
  23:tetStuff.c    **** // border and title)
  24:tetStuff.c    **** // 10 across
  25:tetStuff.c    **** // 18 up
  26:tetStuff.c    **** // 7 pieces (colors = 3 bits each)
  27:tetStuff.c    **** // Using 4 bits, for easy-access: 90 bytes
  28:tetStuff.c    **** // Using 3 bits: 67.5 bytes
  29:tetStuff.c    **** // How about a happy-medium... use 32-bits for a row...
  30:tetStuff.c    **** #define TET_HEIGHT	18
  31:tetStuff.c    **** #define TET_WIDTH		10
  32:tetStuff.c    **** #define TET_TOP_ROW  (0)
  33:tetStuff.c    **** 
  34:tetStuff.c    **** extern uint16_t pgm_tetPiece[7][4];
  35:tetStuff.c    **** #define bin4x4(b15,b14,b13,b12,\
  36:tetStuff.c    **** 		         b11,b10, b9, b8,\
  37:tetStuff.c    **** 		          b7, b6, b5, b4,\
  38:tetStuff.c    ****                 b3, b2, b1, b0)\
  39:tetStuff.c    ****          ((bin(b15,b14,b13,b12,b11,b10, b9, b8) << 8) | \
  40:tetStuff.c    **** 			          (bin( b7, b6, b5, b4, b3, b2, b1, b0)))
  41:tetStuff.c    **** 
  42:tetStuff.c    **** #define getTetPieceBrick(piece, orientation, row, col) \
  43:tetStuff.c    **** 	   getbit((row*4+col), pgm_getTetPiece(piece,orientation))
  44:tetStuff.c    **** 
  45:tetStuff.c    **** #define pgm_getTetPiece(piece,orientation) \
  46:tetStuff.c    **** 	   ((uint16_t)pgm_read_word(&(pgm_tetPiece[piece][orientation])))
  47:tetStuff.c    **** 
  48:tetStuff.c    **** uint8_t getTetBrick(uint8_t row, uint8_t col);
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 7


  49:tetStuff.c    **** void setTetBrick(uint8_t row, uint8_t col, uint8_t val);
  50:tetStuff.c    **** uint8_t tetBrick_to_fb(uint8_t tetBrick);
  51:tetStuff.c    **** 	
  52:tetStuff.c    **** //For now, let's just test that it works...
  53:tetStuff.c    **** // (This could be implemented with bitfields?)
  54:tetStuff.c    **** uint32_t tetRow[TET_HEIGHT];
  55:tetStuff.c    **** 
  56:tetStuff.c    **** void tetInit(uint8_t filledRows)
  57:tetStuff.c    **** {
  58:tetStuff.c    **** 	uint8_t row;
  59:tetStuff.c    **** 
  60:tetStuff.c    **** 	//Clear the board...
  61:tetStuff.c    **** 	for(row=0; row<TET_HEIGHT; row++)
  62:tetStuff.c    **** 		tetRow[row]=0;
  63:tetStuff.c    **** #if (TRUE) //Load random-ish "bricks" for testing...
  64:tetStuff.c    **** 	uint8_t col;
  65:tetStuff.c    **** 	//Now, leaving the first several rows blank for piece-testing...
  66:tetStuff.c    **** 	for(row=TET_HEIGHT-filledRows; row<TET_HEIGHT; row++)
  67:tetStuff.c    **** 		for(col=0; col<TET_WIDTH; col++)
  68:tetStuff.c    **** 			setTetBrick(row, col, (row+col)&0x07);
  69:tetStuff.c    **** 
  70:tetStuff.c    **** #endif
  71:tetStuff.c    **** #if (FALSE) //Just throw some random pieces in for testing... Dun Woik
  72:tetStuff.c    **** 	row = 0;
  73:tetStuff.c    **** 	uint8_t col;
  74:tetStuff.c    **** 	uint8_t piece = 0;
  75:tetStuff.c    **** 	uint8_t pieceRow;
  76:tetStuff.c    **** 
  77:tetStuff.c    **** 	for(col=0; col<TET_WIDTH; col++)
  78:tetStuff.c    **** 	{
  79:tetStuff.c    **** 		piece = col/4;
  80:tetStuff.c    **** 
  81:tetStuff.c    **** 		for(pieceRow=0; pieceRow<4; pieceRow++)
  82:tetStuff.c    **** 			setTetBrick(pieceRow + row, col, (row+col) & 0x07);
  83:tetStuff.c    **** 				  	//(getTetPieceBrick(piece,0,pieceRow,col)) ? piece : 0);
  84:tetStuff.c    **** 
  85:tetStuff.c    **** 		row+=4;
  86:tetStuff.c    **** 
  87:tetStuff.c    **** 	}
  88:tetStuff.c    **** #endif
  89:tetStuff.c    **** }
  90:tetStuff.c    **** 
  91:tetStuff.c    **** 
  92:tetStuff.c    **** //Also determines color (pieceNum+1)...
  93:tetStuff.c    **** uint8_t pieceNum = 0;
  94:tetStuff.c    **** uint8_t pieceOrientation = 0;
  95:tetStuff.c    **** //Upper-Left corner
  96:tetStuff.c    **** uint8_t pieceTopRow = 0;
  97:tetStuff.c    **** uint8_t pieceLeftCol = 0;
  98:tetStuff.c    **** #define PIECE_HEIGHT 4
  99:tetStuff.c    **** #define PIECE_WIDTH	4
 100:tetStuff.c    **** #define NUM_PIECES	7
 101:tetStuff.c    **** #define PIECE_STARTCOL 3
 102:tetStuff.c    **** #define PIECE_STARTROW 0
 103:tetStuff.c    **** 
 104:tetStuff.c    **** 
 105:tetStuff.c    **** static __inline__ \
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 8


 106:tetStuff.c    **** void tet_drawRow(uint8_t rowNum, uint8_t rowBuffer[]) \
 107:tetStuff.c    **** 	  __attribute__((__always_inline__));
 108:tetStuff.c    **** //This assumes rowBuffer[] points to the first column we should draw
 109:tetStuff.c    **** // it could be called as, e.g. tet_drawRow(rbRowNum, &RealRowBuffer[5])
 110:tetStuff.c    **** // to shift it right five pixels...
 111:tetStuff.c    **** // rowNum corresponds to the row in drawable pixels
 112:tetStuff.c    **** // (though this may change later... for, e.g. high vertical resolution)
 113:tetStuff.c    **** // (e.g. for brick separators...)
 114:tetStuff.c    **** void tet_drawRow(uint8_t rowNum, uint8_t rowBuffer[])
 115:tetStuff.c    **** {
 116:tetStuff.c    **** 	uint8_t i; 
 117:tetStuff.c    **** 
 118:tetStuff.c    **** 	if( (rowNum >= TET_TOP_ROW) &&
 119:tetStuff.c    **** 		 (rowNum < TET_TOP_ROW+TET_HEIGHT) )
 120:tetStuff.c    **** 	{
 121:tetStuff.c    **** 		//left border:
 122:tetStuff.c    **** 		rowBuffer[0]=fb_to_rb(_W);
 123:tetStuff.c    **** 
 124:tetStuff.c    **** 		//Draw active (and inactive) bricks
 125:tetStuff.c    **** 		for(i=1; i<=TET_WIDTH; i++)
 126:tetStuff.c    **** 		{
 127:tetStuff.c    **** 			rowBuffer[i]=
 128:tetStuff.c    **** 				fb_to_rb(tetBrick_to_fb(
 129:tetStuff.c    **** 							getTetBrick(rowNum-TET_TOP_ROW,i-1)));
 130:tetStuff.c    **** 		}
 131:tetStuff.c    **** 
 132:tetStuff.c    **** 		//right border:
 133:tetStuff.c    **** 		rowBuffer[i]=fb_to_rb(_W);
 134:tetStuff.c    **** 
 135:tetStuff.c    **** 		//SEE NOTE in main.c re: _b and _c -> _W syncing...
 136:tetStuff.c    **** 	}
 137:tetStuff.c    **** 	//bottom border:
 138:tetStuff.c    **** 	else if(rowNum == TET_TOP_ROW+TET_HEIGHT)
 139:tetStuff.c    **** 		for(i=0; i<=TET_WIDTH+1; i++)
 140:tetStuff.c    **** 			rowBuffer[i]=fb_to_rb(_W);
 141:tetStuff.c    **** //	else
 142:tetStuff.c    **** //		return;
 143:tetStuff.c    **** 
 144:tetStuff.c    **** 
 145:tetStuff.c    **** 	//Active (falling) piece:
 146:tetStuff.c    **** 
 147:tetStuff.c    **** 	if((rowNum >= pieceTopRow) &&
 148:tetStuff.c    **** 		(rowNum < pieceTopRow+PIECE_HEIGHT) )
 149:tetStuff.c    **** 	{
 150:tetStuff.c    **** 		uint8_t pieceRowNum = rowNum - pieceTopRow;
 151:tetStuff.c    **** 
 152:tetStuff.c    **** 		for(i=0; i<PIECE_WIDTH; i++)
 153:tetStuff.c    **** 		{
 154:tetStuff.c    **** 			uint8_t pieceBrick = 
 155:tetStuff.c    **** 					getTetPieceBrick(pieceNum, pieceOrientation, 
 156:tetStuff.c    **** 										  pieceRowNum, i);
 157:tetStuff.c    **** 
 158:tetStuff.c    **** 			//Only draw piece pixels (not black/empty pixels)
 159:tetStuff.c    **** 			// (we don't want to overwrite nearby bricks)
 160:tetStuff.c    **** 			if(pieceBrick)
 161:tetStuff.c    **** 			//+1 for the left border...
 162:tetStuff.c    **** 				rowBuffer[i+1+pieceLeftCol] =
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 9


 163:tetStuff.c    **** 						fb_to_rb(tetBrick_to_fb(pieceNum+1));
 164:tetStuff.c    **** 		}
 165:tetStuff.c    **** 	}
 166:tetStuff.c    **** 
 167:tetStuff.c    **** 
 168:tetStuff.c    **** 
 169:tetStuff.c    **** 
 170:tetStuff.c    **** 	//Draw "TETRIS" vertically...
 171:tetStuff.c    **** #define CHARACTER_START_COL   14 //FB_WIDTH
 172:tetStuff.c    ****    //i=FB_WIDTH;
 173:tetStuff.c    ****    i=CHARACTER_START_COL;
 174:tetStuff.c    **** 
 175:tetStuff.c    ****    uint8_t charRow;
 176:tetStuff.c    ****    uint8_t color;
 177:tetStuff.c    ****    char character;
 178:tetStuff.c    ****    switch(rowNum/8)
 179:tetStuff.c    ****    {
 180:tetStuff.c    ****          case 0:
 181:tetStuff.c    ****             //charRow = getCharRow('T', rowNum%8);
 182:tetStuff.c    ****             character = 'T';
 183:tetStuff.c    ****             color = _R;
 184:tetStuff.c    ****             break;
 185:tetStuff.c    ****          case 1:
 186:tetStuff.c    ****             //charRow = getCharRow('E', rowNum%8);
 187:tetStuff.c    ****             character = 'E';
 188:tetStuff.c    ****             color = _O;
 189:tetStuff.c    ****             break;
 190:tetStuff.c    ****          case 2:
 191:tetStuff.c    ****             //charRow = getCharRow('T', rowNum%8);
 192:tetStuff.c    ****             character = 'T';
 193:tetStuff.c    ****             color = _Y;
 194:tetStuff.c    ****             break;
 195:tetStuff.c    ****          case 3:
 196:tetStuff.c    ****             { 
 197:tetStuff.c    ****                uint8_t z, temp;
 198:tetStuff.c    ****                
 199:tetStuff.c    ****                //Reverse the "R" to make it look Russian
 200:tetStuff.c    ****                // And shift it one left...
 201:tetStuff.c    ****                temp = getCharRow('R', rowNum%8);
 202:tetStuff.c    ****                
 203:tetStuff.c    ****                for(z=0; z<8; z++)
 204:tetStuff.c    ****                {
 205:tetStuff.c    ****                   writebit(7-z, charRow, getbit(z,temp));
 206:tetStuff.c    ****                }  
 207:tetStuff.c    ****                //Characters are reversed... bit 0 is far-left
 208:tetStuff.c    ****                //So to shift a character left, I must shift its bits right
 209:tetStuff.c    ****                // (right?)
 210:tetStuff.c    ****                charRow >>= 1;
 211:tetStuff.c    ****                color = _G; 
 212:tetStuff.c    ****             }  
 213:tetStuff.c    ****             break;
 214:tetStuff.c    ****          case 4:
 215:tetStuff.c    ****             //charRow = getCharRow('I', rowNum%8);
 216:tetStuff.c    ****             character = 'I';
 217:tetStuff.c    ****             color = _C; 
 218:tetStuff.c    ****             break;
 219:tetStuff.c    ****          case 5:
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 10


 220:tetStuff.c    ****             //charRow = getCharRow('S', rowNum%8);
 221:tetStuff.c    ****             character = 'S';
 222:tetStuff.c    ****             color = _B; 
 223:tetStuff.c    ****             break;
 224:tetStuff.c    ****          default:
 225:tetStuff.c    ****             character = ' ';
 226:tetStuff.c    ****             //charRow = 0;
 227:tetStuff.c    ****             break;
 228:tetStuff.c    ****    }     
 229:tetStuff.c    **** 
 230:tetStuff.c    **** 	//Load charRow for all cases except the backwards "R"
 231:tetStuff.c    **** 	// which is handled above...      
 232:tetStuff.c    ****    if(rowNum/8 != 3)
 233:tetStuff.c    ****          charRow = getCharRow(character, rowNum%8);
 234:tetStuff.c    **** 
 235:tetStuff.c    ****    i++;
 236:tetStuff.c    **** 
 237:tetStuff.c    ****    uint8_t j;
 238:tetStuff.c    ****    for(j=0; j<8; j++)
 239:tetStuff.c    ****          if(getbit(j, charRow))
 240:tetStuff.c    ****             //frameBuffer[rowNum][j+i+1] = 0x25;
 241:tetStuff.c    ****             rowBuffer[j+i] = fb_to_rb(color); //0x25);
 242:tetStuff.c    ****          else
 243:tetStuff.c    ****             //frameBuffer[rowNum][j+i+1] = 0x01;
 244:tetStuff.c    ****             rowBuffer[j+i] = fb_to_rb(0x00);
 245:tetStuff.c    **** 
 246:tetStuff.c    **** 
 247:tetStuff.c    **** }
 248:tetStuff.c    **** 
 249:tetStuff.c    **** void tetUpdate(void)
 250:tetStuff.c    **** {
 251:tetStuff.c    **** 	//For now, we're just experimenting with the different pieces/
 252:tetStuff.c    **** 	// orientations/positions...	
 253:tetStuff.c    **** 	static uint8_t callCount = 0;
 254:tetStuff.c    **** 	static uint8_t newPieceHitCount=0;
 255:tetStuff.c    **** 
 256:tetStuff.c    **** 	uint8_t new_pieceOrientation;
 257:tetStuff.c    **** 	uint8_t new_pieceTopRow;
 258:tetStuff.c    **** 	uint8_t new_pieceLeftCol;
 259:tetStuff.c    **** //	uint8_t new_pieceNum;
 260:tetStuff.c    **** 
 261:tetStuff.c    **** 	uint8_t pieceRow;
 262:tetStuff.c    **** 	uint8_t pieceCol;
 263:tetStuff.c    **** 
 264:tetStuff.c    **** 	uint8_t noChange = FALSE;
 265:tetStuff.c    **** 	uint8_t settle = FALSE;
 266:tetStuff.c    **** 
 267:tetStuff.c    **** 	if(newPieceHitCount == 5)
 268:tetStuff.c    **** 	{
 269:tetStuff.c    **** 		newPieceHitCount = 0;
 270:tetStuff.c    **** 		tetInit(0);
 271:tetStuff.c    **** 	}
 272:tetStuff.c    **** 
 273:tetStuff.c    **** 	new_pieceOrientation = pieceOrientation;
 274:tetStuff.c    **** 	new_pieceLeftCol = pieceLeftCol;
 275:tetStuff.c    **** 	new_pieceTopRow = pieceTopRow;
 276:tetStuff.c    **** 
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 11


 277:tetStuff.c    **** 	if(callCount%4 == 2)
 278:tetStuff.c    ****    {
 279:tetStuff.c    **** 		new_pieceOrientation=pieceOrientation+1;
 280:tetStuff.c    ****       if (new_pieceOrientation==4)
 281:tetStuff.c    **** 			new_pieceOrientation=0;
 282:tetStuff.c    **** 	}
 283:tetStuff.c    **** 
 284:tetStuff.c    ****       if(callCount%4==0)
 285:tetStuff.c    ****       {  
 286:tetStuff.c    ****          new_pieceLeftCol=pieceLeftCol+1;
 287:tetStuff.c    **** 		}
 288:tetStuff.c    **** 
 289:tetStuff.c    **** 		if(callCount%4==3)
 290:tetStuff.c    **** 		{
 291:tetStuff.c    **** 			new_pieceTopRow=pieceTopRow+1;
 292:tetStuff.c    ****       }
 293:tetStuff.c    **** 
 294:tetStuff.c    **** 	callCount++;
 295:tetStuff.c    **** 
 296:tetStuff.c    **** 
 297:tetStuff.c    **** 
 298:tetStuff.c    **** 
 299:tetStuff.c    **** 
 300:tetStuff.c    **** 	//Check for collision in the new piece position/orientation...
 301:tetStuff.c    **** 	//Starting from the bottom... (intentional wraparound)
 302:tetStuff.c    **** 	for(pieceRow = 3; (pieceRow < 128) && !settle && !noChange; pieceRow--)
 303:tetStuff.c    **** 		for(pieceCol = 0; pieceCol < 4; pieceCol++)
 304:tetStuff.c    **** 		{
 305:tetStuff.c    **** 			//This isn't particularly efficient...
 306:tetStuff.c    **** 			// rereading each time...
 307:tetStuff.c    **** 			uint8_t pieceBrick =
 308:tetStuff.c    **** 						getTetPieceBrick(pieceNum, new_pieceOrientation,
 309:tetStuff.c    **** 											  pieceRow, pieceCol);
 310:tetStuff.c    **** 
 311:tetStuff.c    **** 			uint8_t boardRow = new_pieceTopRow + pieceRow;
 312:tetStuff.c    **** 
 313:tetStuff.c    **** 			uint8_t boardCol = new_pieceLeftCol + pieceCol;
 314:tetStuff.c    **** 
 315:tetStuff.c    **** 			uint8_t boardBrick = getTetBrick(boardRow, boardCol);
 316:tetStuff.c    **** 
 317:tetStuff.c    **** 
 318:tetStuff.c    **** 			if(pieceBrick)
 319:tetStuff.c    **** 			{
 320:tetStuff.c    **** 				if(boardRow >= TET_HEIGHT)
 321:tetStuff.c    **** 				{
 322:tetStuff.c    **** 					noChange = TRUE;
 323:tetStuff.c    **** 					settle = TRUE;
 324:tetStuff.c    **** 					break;
 325:tetStuff.c    **** 				}
 326:tetStuff.c    **** 
 327:tetStuff.c    **** 				//There's some plausibility for some oddities here...
 328:tetStuff.c    **** 				// revisit 41-15.zip
 329:tetStuff.c    **** 				if(boardCol >= TET_WIDTH)
 330:tetStuff.c    **** 				{
 331:tetStuff.c    **** 				   noChange = TRUE;
 332:tetStuff.c    **** 				   break;
 333:tetStuff.c    **** 				}
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 12


 334:tetStuff.c    **** 
 335:tetStuff.c    **** 
 336:tetStuff.c    **** 				if(boardBrick)
 337:tetStuff.c    **** 				{
 338:tetStuff.c    **** 					//Must be a settle...
 339:tetStuff.c    **** 					if((new_pieceOrientation == pieceOrientation) &&
 340:tetStuff.c    **** 						(new_pieceLeftCol == pieceLeftCol))
 341:tetStuff.c    **** 						settle = TRUE;
 342:tetStuff.c    **** 
 343:tetStuff.c    **** 					noChange = TRUE;
 344:tetStuff.c    **** 					break;
 345:tetStuff.c    **** 				}
 346:tetStuff.c    **** 			}
 347:tetStuff.c    **** 		}
 348:tetStuff.c    **** 
 349:tetStuff.c    **** 
 350:tetStuff.c    **** 
 351:tetStuff.c    **** 
 352:tetStuff.c    **** 
 353:tetStuff.c    **** 	if(!noChange)
 354:tetStuff.c    **** 	{
 355:tetStuff.c    **** 		pieceOrientation = new_pieceOrientation;
 356:tetStuff.c    **** 		pieceLeftCol = new_pieceLeftCol;
 357:tetStuff.c    **** 		pieceTopRow = new_pieceTopRow;
 358:tetStuff.c    **** 	}
 359:tetStuff.c    **** 
 360:tetStuff.c    **** 	if(settle)
 361:tetStuff.c    **** 	{
 362:tetStuff.c    **** 		// Check if we've hit on a new piece...
 363:tetStuff.c    **** 		if((pieceTopRow == PIECE_STARTROW) &&
 364:tetStuff.c    **** 		   (pieceLeftCol == PIECE_STARTCOL) &&
 365:tetStuff.c    **** 		   (pieceOrientation == 0))
 366:tetStuff.c    **** 		   newPieceHitCount++;
 367:tetStuff.c    **** 
 368:tetStuff.c    **** 
 369:tetStuff.c    **** 		//Load the piece into the board...
 370:tetStuff.c    **** 		for(pieceRow = 0; pieceRow < 4; pieceRow++)
 371:tetStuff.c    **** 			for(pieceCol = 0; pieceCol < 4; pieceCol++)
 372:tetStuff.c    **** 			{
 373:tetStuff.c    **** 				if(getTetPieceBrick(pieceNum, pieceOrientation,
 374:tetStuff.c    **** 										  pieceRow, pieceCol))
 375:tetStuff.c    **** 				setTetBrick(pieceTopRow+pieceRow,
 376:tetStuff.c    **** 								pieceLeftCol+pieceCol,
 377:tetStuff.c    **** 								pieceNum+1);
 378:tetStuff.c    **** 			}
 379:tetStuff.c    **** 
 380:tetStuff.c    **** 
 381:tetStuff.c    **** 		//Load a new piece...
 382:tetStuff.c    **** 		pieceNum++;
 383:tetStuff.c    **** 		if(pieceNum==NUM_PIECES)
 384:tetStuff.c    **** 			pieceNum = 0;
 385:tetStuff.c    **** 		pieceLeftCol = PIECE_STARTCOL;
 386:tetStuff.c    **** 		pieceTopRow = PIECE_STARTROW;
 387:tetStuff.c    **** 		pieceOrientation = 0;
 388:tetStuff.c    **** 	}
 389:tetStuff.c    **** 
 390:tetStuff.c    **** }
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 13


 391:tetStuff.c    **** 
 392:tetStuff.c    **** //returns a 3-bit value
 393:tetStuff.c    **** // 0 corresponds to no brick
 394:tetStuff.c    **** // 1-7 corresponds to the type of piece the brick came from...
 395:tetStuff.c    **** uint8_t getTetBrick(uint8_t row, uint8_t col)
 396:tetStuff.c    **** {
 176               		.stabn	68,0,396,.LM4-.LFBB2
 177               	.LM4:
 178               	.LFBB2:
 179               	/* prologue: function */
 180               	/* frame size = 0 */
 181               		.stabn	68,0,396,.LM5-.LFBB2
 182               	.LM5:
 183 003e E82F      		mov r30,r24
 184 0040 F0E0      		ldi r31,lo8(0)
 185 0042 EE0F      		lsl r30
 186 0044 FF1F      		rol r31
 187 0046 EE0F      		lsl r30
 188 0048 FF1F      		rol r31
 189 004a E050      		subi r30,lo8(-(tetRow))
 190 004c F040      		sbci r31,hi8(-(tetRow))
 191 004e 862F      		mov r24,r22
 192 0050 90E0      		ldi r25,lo8(0)
 193 0052 63E0      		ldi r22,lo8(3)
 194 0054 70E0      		ldi r23,hi8(3)
 195 0056 00D0      		rcall __mulhi3
 196 0058 2081      		ld r18,Z
 197 005a 3181      		ldd r19,Z+1
 198 005c 4281      		ldd r20,Z+2
 199 005e 5381      		ldd r21,Z+3
 200 0060 00C0      		rjmp 2f
 201 0062 5695      	1:	lsr r21
 202 0064 4795      		ror r20
 203 0066 3795      		ror r19
 204 0068 2795      		ror r18
 205 006a 8A95      	2:	dec r24
 206 006c 02F4      		brpl 1b
 397:tetStuff.c    **** 	//uint8_t tetCol = col*3;
 398:tetStuff.c    **** //	uint8_t tetMask = '\007';
 399:tetStuff.c    **** 	
 400:tetStuff.c    **** 	return ((uint8_t)(tetRow[row] >> (3*col))) & '\007';
 401:tetStuff.c    **** 
 402:tetStuff.c    **** }
 207               		.stabn	68,0,402,.LM6-.LFBB2
 208               	.LM6:
 209 006e 822F      		mov r24,r18
 210 0070 8770      		andi r24,lo8(7)
 211               	/* epilogue start */
 212 0072 0895      		ret
 213               		.size	getTetBrick, .-getTetBrick
 214               	.Lscope2:
 215               		.stabs	"",36,0,0,.Lscope2-.LFBB2
 216               		.stabd	78,0,0
 217               		.stabs	"setTetBrick:F(0,15)",36,0,408,setTetBrick
 218               		.stabs	"row:P(3,2)",64,0,408,24
 219               		.stabs	"col:P(3,2)",64,0,408,22
 220               		.stabs	"val:P(3,2)",64,0,408,20
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 14


 221               	.global	setTetBrick
 222               		.type	setTetBrick, @function
 223               	setTetBrick:
 224               		.stabd	46,0,0
 403:tetStuff.c    **** 
 404:tetStuff.c    **** 
 405:tetStuff.c    **** //val should only be 0-7
 406:tetStuff.c    **** // 0 corresponds to no brick
 407:tetStuff.c    **** // 1-7 corresponds to the type of piece the brick came from...
 408:tetStuff.c    **** void setTetBrick(uint8_t row, uint8_t col, uint8_t val)
 409:tetStuff.c    **** {
 225               		.stabn	68,0,409,.LM7-.LFBB3
 226               	.LM7:
 227               	.LFBB3:
 228 0074 0F93      		push r16
 229 0076 1F93      		push r17
 230               	/* prologue: function */
 231               	/* frame size = 0 */
 410:tetStuff.c    **** 	//Clear the old value...
 411:tetStuff.c    **** 	tetRow[row] &= ~(((uint32_t)'\007')<<(3*col));
 232               		.stabn	68,0,411,.LM8-.LFBB3
 233               	.LM8:
 234 0078 E82F      		mov r30,r24
 235 007a F0E0      		ldi r31,lo8(0)
 236 007c 862F      		mov r24,r22
 237 007e 90E0      		ldi r25,lo8(0)
 238 0080 63E0      		ldi r22,lo8(3)
 239 0082 70E0      		ldi r23,hi8(3)
 240 0084 00D0      		rcall __mulhi3
 241 0086 A82F      		mov r26,r24
 412:tetStuff.c    **** 	//Write the new value...
 413:tetStuff.c    **** 	tetRow[row] |= (((uint32_t)val)<<(3*col));
 242               		.stabn	68,0,413,.LM9-.LFBB3
 243               	.LM9:
 244 0088 EE0F      		lsl r30
 245 008a FF1F      		rol r31
 246 008c EE0F      		lsl r30
 247 008e FF1F      		rol r31
 248 0090 E050      		subi r30,lo8(-(tetRow))
 249 0092 F040      		sbci r31,hi8(-(tetRow))
 250 0094 67E0      		ldi r22,lo8(7)
 251 0096 70E0      		ldi r23,hi8(7)
 252 0098 80E0      		ldi r24,hlo8(7)
 253 009a 90E0      		ldi r25,hhi8(7)
 254 009c 0A2E      		mov r0,r26
 255 009e 00C0      		rjmp 2f
 256 00a0 660F      	1:	lsl r22
 257 00a2 771F      		rol r23
 258 00a4 881F      		rol r24
 259 00a6 991F      		rol r25
 260 00a8 0A94      	2:	dec r0
 261 00aa 02F4      		brpl 1b
 262 00ac 6095      		com r22
 263 00ae 7095      		com r23
 264 00b0 8095      		com r24
 265 00b2 9095      		com r25
 266 00b4 0081      		ld r16,Z
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 15


 267 00b6 1181      		ldd r17,Z+1
 268 00b8 2281      		ldd r18,Z+2
 269 00ba 3381      		ldd r19,Z+3
 270 00bc 6023      		and r22,r16
 271 00be 7123      		and r23,r17
 272 00c0 8223      		and r24,r18
 273 00c2 9323      		and r25,r19
 274 00c4 242F      		mov r18,r20
 275 00c6 30E0      		ldi r19,lo8(0)
 276 00c8 40E0      		ldi r20,lo8(0)
 277 00ca 50E0      		ldi r21,hi8(0)
 278 00cc 00C0      		rjmp 2f
 279 00ce 220F      	1:	lsl r18
 280 00d0 331F      		rol r19
 281 00d2 441F      		rol r20
 282 00d4 551F      		rol r21
 283 00d6 AA95      	2:	dec r26
 284 00d8 02F4      		brpl 1b
 285 00da 622B      		or r22,r18
 286 00dc 732B      		or r23,r19
 287 00de 842B      		or r24,r20
 288 00e0 952B      		or r25,r21
 289 00e2 6083      		st Z,r22
 290 00e4 7183      		std Z+1,r23
 291 00e6 8283      		std Z+2,r24
 292 00e8 9383      		std Z+3,r25
 293               	/* epilogue start */
 414:tetStuff.c    **** }
 294               		.stabn	68,0,414,.LM10-.LFBB3
 295               	.LM10:
 296 00ea 1F91      		pop r17
 297 00ec 0F91      		pop r16
 298 00ee 0895      		ret
 299               		.size	setTetBrick, .-setTetBrick
 300               	.Lscope3:
 301               		.stabs	"",36,0,0,.Lscope3-.LFBB3
 302               		.stabd	78,0,0
 303               		.stabs	"tetInit:F(0,15)",36,0,56,tetInit
 304               		.stabs	"filledRows:P(3,2)",64,0,56,24
 305               	.global	tetInit
 306               		.type	tetInit, @function
 307               	tetInit:
 308               		.stabd	46,0,0
  57:tetStuff.c    **** {
 309               		.stabn	68,0,57,.LM11-.LFBB4
 310               	.LM11:
 311               	.LFBB4:
 312 00f0 0F93      		push r16
 313 00f2 1F93      		push r17
 314               	/* prologue: function */
 315               	/* frame size = 0 */
  57:tetStuff.c    **** {
 316               		.stabn	68,0,57,.LM12-.LFBB4
 317               	.LM12:
 318 00f4 E0E0      		ldi r30,lo8(tetRow)
 319 00f6 F0E0      		ldi r31,hi8(tetRow)
 320               	.L8:
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 16


  62:tetStuff.c    **** 		tetRow[row]=0;
 321               		.stabn	68,0,62,.LM13-.LFBB4
 322               	.LM13:
 323 00f8 1192      		st Z+,__zero_reg__
 324 00fa 1192      		st Z+,__zero_reg__
 325 00fc 1192      		st Z+,__zero_reg__
 326 00fe 1192      		st Z+,__zero_reg__
  61:tetStuff.c    **** 	for(row=0; row<TET_HEIGHT; row++)
 327               		.stabn	68,0,61,.LM14-.LFBB4
 328               	.LM14:
 329 0100 90E0      		ldi r25,hi8(tetRow+72)
 330 0102 E030      		cpi r30,lo8(tetRow+72)
 331 0104 F907      		cpc r31,r25
 332 0106 01F4      		brne .L8
  66:tetStuff.c    **** 	for(row=TET_HEIGHT-filledRows; row<TET_HEIGHT; row++)
 333               		.stabn	68,0,66,.LM15-.LFBB4
 334               	.LM15:
 335 0108 12E1      		ldi r17,lo8(18)
 336 010a 181B      		sub r17,r24
 337 010c 00C0      		rjmp .L9
 338               	.L11:
 339 010e 00E0      		ldi r16,lo8(0)
 340               	.L10:
  68:tetStuff.c    **** 			setTetBrick(row, col, (row+col)&0x07);
 341               		.stabn	68,0,68,.LM16-.LFBB4
 342               	.LM16:
 343 0110 402F      		mov r20,r16
 344 0112 410F      		add r20,r17
 345 0114 4770      		andi r20,lo8(7)
 346 0116 812F      		mov r24,r17
 347 0118 602F      		mov r22,r16
 348 011a 00D0      		rcall setTetBrick
  67:tetStuff.c    **** 		for(col=0; col<TET_WIDTH; col++)
 349               		.stabn	68,0,67,.LM17-.LFBB4
 350               	.LM17:
 351 011c 0F5F      		subi r16,lo8(-(1))
 352 011e 0A30      		cpi r16,lo8(10)
 353 0120 01F4      		brne .L10
  66:tetStuff.c    **** 	for(row=TET_HEIGHT-filledRows; row<TET_HEIGHT; row++)
 354               		.stabn	68,0,66,.LM18-.LFBB4
 355               	.LM18:
 356 0122 1F5F      		subi r17,lo8(-(1))
 357               	.L9:
 358 0124 1231      		cpi r17,lo8(18)
 359 0126 00F0      		brlo .L11
 360               	/* epilogue start */
  89:tetStuff.c    **** }
 361               		.stabn	68,0,89,.LM19-.LFBB4
 362               	.LM19:
 363 0128 1F91      		pop r17
 364 012a 0F91      		pop r16
 365 012c 0895      		ret
 366               		.size	tetInit, .-tetInit
 367               		.stabs	"row:r(3,2)",64,0,58,17
 368               		.stabs	"col:r(3,2)",64,0,64,16
 369               		.stabn	192,0,0,.LFBB4-.LFBB4
 370               		.stabn	224,0,0,.Lscope4-.LFBB4
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 17


 371               	.Lscope4:
 372               		.stabs	"",36,0,0,.Lscope4-.LFBB4
 373               		.stabd	78,0,0
 374               		.stabs	"tetUpdate:F(0,15)",36,0,249,tetUpdate
 375               	.global	tetUpdate
 376               		.type	tetUpdate, @function
 377               	tetUpdate:
 378               		.stabd	46,0,0
 250:tetStuff.c    **** {
 379               		.stabn	68,0,250,.LM20-.LFBB5
 380               	.LM20:
 381               	.LFBB5:
 382 012e 2F92      		push r2
 383 0130 3F92      		push r3
 384 0132 4F92      		push r4
 385 0134 5F92      		push r5
 386 0136 6F92      		push r6
 387 0138 7F92      		push r7
 388 013a 8F92      		push r8
 389 013c 9F92      		push r9
 390 013e AF92      		push r10
 391 0140 BF92      		push r11
 392 0142 CF92      		push r12
 393 0144 DF92      		push r13
 394 0146 EF92      		push r14
 395 0148 FF92      		push r15
 396 014a 0F93      		push r16
 397 014c 1F93      		push r17
 398 014e DF93      		push r29
 399 0150 CF93      		push r28
 400 0152 00D0      		rcall .
 401 0154 CDB7      		in r28,__SP_L__
 402 0156 DEB7      		in r29,__SP_H__
 403               	/* prologue: function */
 404               	/* frame size = 2 */
 267:tetStuff.c    **** 	if(newPieceHitCount == 5)
 405               		.stabn	68,0,267,.LM21-.LFBB5
 406               	.LM21:
 407 0158 8091 0000 		lds r24,newPieceHitCount.1888
 408 015c 8530      		cpi r24,lo8(5)
 409 015e 01F4      		brne .L17
 269:tetStuff.c    **** 		newPieceHitCount = 0;
 410               		.stabn	68,0,269,.LM22-.LFBB5
 411               	.LM22:
 412 0160 1092 0000 		sts newPieceHitCount.1888,__zero_reg__
 270:tetStuff.c    **** 		tetInit(0);
 413               		.stabn	68,0,270,.LM23-.LFBB5
 414               	.LM23:
 415 0164 80E0      		ldi r24,lo8(0)
 416 0166 00D0      		rcall tetInit
 417               	.L17:
 273:tetStuff.c    **** 	new_pieceOrientation = pieceOrientation;
 418               		.stabn	68,0,273,.LM24-.LFBB5
 419               	.LM24:
 420 0168 3090 0000 		lds r3,pieceOrientation
 274:tetStuff.c    **** 	new_pieceLeftCol = pieceLeftCol;
 421               		.stabn	68,0,274,.LM25-.LFBB5
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 18


 422               	.LM25:
 423 016c 4091 0000 		lds r20,pieceLeftCol
 275:tetStuff.c    **** 	new_pieceTopRow = pieceTopRow;
 424               		.stabn	68,0,275,.LM26-.LFBB5
 425               	.LM26:
 426 0170 2090 0000 		lds r2,pieceTopRow
 277:tetStuff.c    **** 	if(callCount%4 == 2)
 427               		.stabn	68,0,277,.LM27-.LFBB5
 428               	.LM27:
 429 0174 5091 0000 		lds r21,callCount.1887
 430 0178 852F      		mov r24,r21
 431 017a 90E0      		ldi r25,lo8(0)
 432 017c 8370      		andi r24,lo8(3)
 433 017e 9070      		andi r25,hi8(3)
 434 0180 8230      		cpi r24,2
 435 0182 9105      		cpc r25,__zero_reg__
 436 0184 01F4      		brne .L18
 279:tetStuff.c    **** 		new_pieceOrientation=pieceOrientation+1;
 437               		.stabn	68,0,279,.LM28-.LFBB5
 438               	.LM28:
 439 0186 232D      		mov r18,r3
 440 0188 2F5F      		subi r18,lo8(-(1))
 280:tetStuff.c    ****       if (new_pieceOrientation==4)
 441               		.stabn	68,0,280,.LM29-.LFBB5
 442               	.LM29:
 443 018a 2430      		cpi r18,lo8(4)
 444 018c 01F0      		breq .+2
 445 018e 00C0      		rjmp .L20
 446 0190 00C0      		rjmp .L50
 447               	.L18:
 284:tetStuff.c    ****       if(callCount%4==0)
 448               		.stabn	68,0,284,.LM30-.LFBB5
 449               	.LM30:
 450 0192 0097      		sbiw r24,0
 451 0194 01F4      		brne .L21
 286:tetStuff.c    ****          new_pieceLeftCol=pieceLeftCol+1;
 452               		.stabn	68,0,286,.LM31-.LFBB5
 453               	.LM31:
 454 0196 342F      		mov r19,r20
 455 0198 3F5F      		subi r19,lo8(-(1))
 456 019a 00C0      		rjmp .L45
 457               	.L21:
 289:tetStuff.c    **** 		if(callCount%4==3)
 458               		.stabn	68,0,289,.LM32-.LFBB5
 459               	.LM32:
 460 019c 8330      		cpi r24,3
 461 019e 9105      		cpc r25,__zero_reg__
 462 01a0 01F4      		brne .L47
 291:tetStuff.c    **** 			new_pieceTopRow=pieceTopRow+1;
 463               		.stabn	68,0,291,.LM33-.LFBB5
 464               	.LM33:
 465 01a2 2394      		inc r2
 466               	.L47:
 467 01a4 342F      		mov r19,r20
 468               	.L45:
 469 01a6 232D      		mov r18,r3
 470               	.L22:
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 19


 294:tetStuff.c    **** 	callCount++;
 471               		.stabn	68,0,294,.LM34-.LFBB5
 472               	.LM34:
 473 01a8 5F5F      		subi r21,lo8(-(1))
 474 01aa 5093 0000 		sts callCount.1887,r21
 475               	.LBB107:
 476               	.LBB108:
 308:tetStuff.c    **** 						getTetPieceBrick(pieceNum, new_pieceOrientation,
 477               		.stabn	68,0,308,.LM35-.LFBB5
 478               	.LM35:
 479 01ae 8091 0000 		lds r24,pieceNum
 480 01b2 90E0      		ldi r25,lo8(0)
 481 01b4 880F      		lsl r24
 482 01b6 991F      		rol r25
 483 01b8 880F      		lsl r24
 484 01ba 991F      		rol r25
 485 01bc 820F      		add r24,r18
 486 01be 911D      		adc r25,__zero_reg__
 487 01c0 880F      		lsl r24
 488 01c2 991F      		rol r25
 489 01c4 8050      		subi r24,lo8(-(pgm_tetPiece))
 490 01c6 9040      		sbci r25,hi8(-(pgm_tetPiece))
 491 01c8 122D      		mov r17,r2
 492 01ca 1D5F      		subi r17,lo8(-(3))
 493 01cc A0E0      		ldi r26,lo8(0)
 494 01ce B3E0      		ldi r27,lo8(3)
 495 01d0 FC01      		movw r30,r24
 496               	/* #APP */
 497               	 ;  308 "tetStuff.c" 1
 498 01d2 C590      		lpm r12, Z+
 499 01d4 D490      		lpm r13, Z
 500               		
 501               	 ;  0 "" 2
 502               	/* #NOAPP */
 503 01d6 00C0      		rjmp .L24
 504               	.L28:
 505               	.LBE108:
 318:tetStuff.c    **** 			if(pieceBrick)
 506               		.stabn	68,0,318,.LM36-.LFBB5
 507               	.LM36:
 508 01d8 CF01      		movw r24,r30
 509 01da 8E0D      		add r24,r14
 510 01dc 9F1D      		adc r25,r15
 511 01de 2601      		movw r4,r12
 512 01e0 00C0      		rjmp 2f
 513 01e2 5694      	1:	lsr r5
 514 01e4 4794      		ror r4
 515 01e6 8A95      	2:	dec r24
 516 01e8 02F4      		brpl 1b
 517 01ea 40FE      		sbrs r4,0
 518 01ec 00C0      		rjmp .L25
 320:tetStuff.c    **** 				if(boardRow >= TET_HEIGHT)
 519               		.stabn	68,0,320,.LM37-.LFBB5
 520               	.LM37:
 521 01ee 1231      		cpi r17,lo8(18)
 522 01f0 00F4      		brsh .L26
 329:tetStuff.c    **** 				if(boardCol >= TET_WIDTH)
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 20


 523               		.stabn	68,0,329,.LM38-.LFBB5
 524               	.LM38:
 525 01f2 0A30      		cpi r16,lo8(10)
 526 01f4 00F4      		brsh .L27
 336:tetStuff.c    **** 				if(boardBrick)
 527               		.stabn	68,0,336,.LM39-.LFBB5
 528               	.LM39:
 529 01f6 802F      		mov r24,r16
 530 01f8 90E0      		ldi r25,lo8(0)
 531 01fa 63E0      		ldi r22,lo8(3)
 532 01fc 70E0      		ldi r23,hi8(3)
 533 01fe 00D0      		rcall __mulhi3
 534 0200 2401      		movw r4,r8
 535 0202 3501      		movw r6,r10
 536 0204 00C0      		rjmp 2f
 537 0206 7694      	1:	lsr r7
 538 0208 6794      		ror r6
 539 020a 5794      		ror r5
 540 020c 4794      		ror r4
 541 020e 8A95      	2:	dec r24
 542 0210 02F4      		brpl 1b
 543 0212 842D      		mov r24,r4
 544 0214 8770      		andi r24,lo8(7)
 545 0216 01F0      		breq .L25
 339:tetStuff.c    **** 					if((new_pieceOrientation == pieceOrientation) &&
 546               		.stabn	68,0,339,.LM40-.LFBB5
 547               	.LM40:
 548 0218 2315      		cp r18,r3
 549 021a 01F4      		brne .L27
 550 021c 3417      		cp r19,r20
 551 021e 01F4      		brne .L27
 552 0220 00C0      		rjmp .L26
 553               	.L25:
 554 0222 3196      		adiw r30,1
 555 0224 0F5F      		subi r16,lo8(-(1))
 556               	.LBE107:
 303:tetStuff.c    **** 		for(pieceCol = 0; pieceCol < 4; pieceCol++)
 557               		.stabn	68,0,303,.LM41-.LFBB5
 558               	.LM41:
 559 0226 E430      		cpi r30,4
 560 0228 F105      		cpc r31,__zero_reg__
 561 022a 01F4      		brne .L28
 562 022c 80E0      		ldi r24,lo8(0)
 563 022e 00C0      		rjmp .L29
 564               	.L26:
 565 0230 81E0      		ldi r24,lo8(1)
 566 0232 00C0      		rjmp .L46
 567               	.L27:
 568 0234 80E0      		ldi r24,lo8(0)
 569               	.L46:
 570 0236 A1E0      		ldi r26,lo8(1)
 571               	.L29:
 302:tetStuff.c    **** 	for(pieceRow = 3; (pieceRow < 128) && !settle && !noChange; pieceRow--)
 572               		.stabn	68,0,302,.LM42-.LFBB5
 573               	.LM42:
 574 0238 B150      		subi r27,lo8(-(-1))
 575 023a 1150      		subi r17,lo8(-(-1))
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 21


 576 023c BF3F      		cpi r27,lo8(-1)
 577 023e 01F0      		breq .L30
 578 0240 8823      		tst r24
 579 0242 01F4      		brne .L30
 580               	.L24:
 581 0244 AA23      		tst r26
 582 0246 01F0      		breq .+2
 583 0248 00C0      		rjmp .L39
 584               	.LBB111:
 308:tetStuff.c    **** 						getTetPieceBrick(pieceNum, new_pieceOrientation,
 585               		.stabn	68,0,308,.LM43-.LFBB5
 586               	.LM43:
 587 024a EB2E      		mov r14,r27
 588 024c FF24      		clr r15
 589 024e EE0C      		lsl r14
 590 0250 FF1C      		rol r15
 591 0252 EE0C      		lsl r14
 592 0254 FF1C      		rol r15
 593               	.LBB109:
 594               	.LBB110:
 400:tetStuff.c    **** 	return ((uint8_t)(tetRow[row] >> (3*col))) & '\007';
 595               		.stabn	68,0,400,.LM44-.LFBB5
 596               	.LM44:
 597 0256 E12F      		mov r30,r17
 598 0258 F0E0      		ldi r31,lo8(0)
 599 025a EE0F      		lsl r30
 600 025c FF1F      		rol r31
 601 025e EE0F      		lsl r30
 602 0260 FF1F      		rol r31
 603 0262 E050      		subi r30,lo8(-(tetRow))
 604 0264 F040      		sbci r31,hi8(-(tetRow))
 605 0266 8080      		ld r8,Z
 606 0268 9180      		ldd r9,Z+1
 607 026a A280      		ldd r10,Z+2
 608 026c B380      		ldd r11,Z+3
 609 026e 032F      		mov r16,r19
 610 0270 E0E0      		ldi r30,lo8(0)
 611 0272 F0E0      		ldi r31,hi8(0)
 612 0274 00C0      		rjmp .L28
 613               	.L30:
 614               	.LBE110:
 615               	.LBE109:
 616               	.LBE111:
 353:tetStuff.c    **** 	if(!noChange)
 617               		.stabn	68,0,353,.LM45-.LFBB5
 618               	.LM45:
 619 0276 AA23      		tst r26
 620 0278 01F4      		brne .L32
 355:tetStuff.c    **** 		pieceOrientation = new_pieceOrientation;
 621               		.stabn	68,0,355,.LM46-.LFBB5
 622               	.LM46:
 623 027a 2093 0000 		sts pieceOrientation,r18
 356:tetStuff.c    **** 		pieceLeftCol = new_pieceLeftCol;
 624               		.stabn	68,0,356,.LM47-.LFBB5
 625               	.LM47:
 626 027e 3093 0000 		sts pieceLeftCol,r19
 357:tetStuff.c    **** 		pieceTopRow = new_pieceTopRow;
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 22


 627               		.stabn	68,0,357,.LM48-.LFBB5
 628               	.LM48:
 629 0282 2092 0000 		sts pieceTopRow,r2
 630               	.L32:
 360:tetStuff.c    **** 	if(settle)
 631               		.stabn	68,0,360,.LM49-.LFBB5
 632               	.LM49:
 633 0286 8823      		tst r24
 634 0288 01F4      		brne .+2
 635 028a 00C0      		rjmp .L39
 363:tetStuff.c    **** 		if((pieceTopRow == PIECE_STARTROW) &&
 636               		.stabn	68,0,363,.LM50-.LFBB5
 637               	.LM50:
 638 028c 8091 0000 		lds r24,pieceTopRow
 639 0290 8823      		tst r24
 640 0292 01F0      		breq .+2
 641 0294 00C0      		rjmp .L33
 642 0296 8091 0000 		lds r24,pieceLeftCol
 643 029a 8330      		cpi r24,lo8(3)
 644 029c 01F0      		breq .+2
 645 029e 00C0      		rjmp .L33
 646 02a0 8091 0000 		lds r24,pieceOrientation
 647 02a4 8823      		tst r24
 648 02a6 01F0      		breq .+2
 649 02a8 00C0      		rjmp .L33
 366:tetStuff.c    **** 		   newPieceHitCount++;
 650               		.stabn	68,0,366,.LM51-.LFBB5
 651               	.LM51:
 652 02aa 8091 0000 		lds r24,newPieceHitCount.1888
 653 02ae 8F5F      		subi r24,lo8(-(1))
 654 02b0 8093 0000 		sts newPieceHitCount.1888,r24
 655 02b4 00C0      		rjmp .L33
 656               	.L36:
 657               	.LBB112:
 373:tetStuff.c    **** 				if(getTetPieceBrick(pieceNum, pieceOrientation,
 658               		.stabn	68,0,373,.LM52-.LFBB5
 659               	.LM52:
 660 02b6 4091 0000 		lds r20,pieceNum
 661 02ba E42F      		mov r30,r20
 662 02bc F0E0      		ldi r31,lo8(0)
 663 02be EE0F      		lsl r30
 664 02c0 FF1F      		rol r31
 665 02c2 EE0F      		lsl r30
 666 02c4 FF1F      		rol r31
 667 02c6 8091 0000 		lds r24,pieceOrientation
 668 02ca E80F      		add r30,r24
 669 02cc F11D      		adc r31,__zero_reg__
 670 02ce EE0F      		lsl r30
 671 02d0 FF1F      		rol r31
 672 02d2 E050      		subi r30,lo8(-(pgm_tetPiece))
 673 02d4 F040      		sbci r31,hi8(-(pgm_tetPiece))
 674               	/* #APP */
 675               	 ;  373 "tetStuff.c" 1
 676 02d6 8591      		lpm r24, Z+
 677 02d8 9491      		lpm r25, Z
 678               		
 679               	 ;  0 "" 2
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 23


 680               	/* #NOAPP */
 681               	.LBE112:
 682 02da B701      		movw r22,r14
 683 02dc 620F      		add r22,r18
 684 02de 731F      		adc r23,r19
 685 02e0 00C0      		rjmp 2f
 686 02e2 9695      	1:	lsr r25
 687 02e4 8795      		ror r24
 688 02e6 6A95      	2:	dec r22
 689 02e8 02F4      		brpl 1b
 690 02ea 80FF      		sbrs r24,0
 691 02ec 00C0      		rjmp .L35
 375:tetStuff.c    **** 				setTetBrick(pieceTopRow+pieceRow,
 692               		.stabn	68,0,375,.LM53-.LFBB5
 693               	.LM53:
 694 02ee 8091 0000 		lds r24,pieceTopRow
 695 02f2 6091 0000 		lds r22,pieceLeftCol
 696 02f6 6E0D      		add r22,r14
 697 02f8 4F5F      		subi r20,lo8(-(1))
 698 02fa 810F      		add r24,r17
 699 02fc 2983      		std Y+1,r18
 700 02fe 3A83      		std Y+2,r19
 701 0300 00D0      		rcall setTetBrick
 702 0302 3A81      		ldd r19,Y+2
 703 0304 2981      		ldd r18,Y+1
 704               	.L35:
 705 0306 0894      		sec
 706 0308 E11C      		adc r14,__zero_reg__
 707 030a F11C      		adc r15,__zero_reg__
 371:tetStuff.c    **** 			for(pieceCol = 0; pieceCol < 4; pieceCol++)
 708               		.stabn	68,0,371,.LM54-.LFBB5
 709               	.LM54:
 710 030c 64E0      		ldi r22,lo8(4)
 711 030e E616      		cp r14,r22
 712 0310 F104      		cpc r15,__zero_reg__
 713 0312 01F4      		brne .L36
 370:tetStuff.c    **** 		for(pieceRow = 0; pieceRow < 4; pieceRow++)
 714               		.stabn	68,0,370,.LM55-.LFBB5
 715               	.LM55:
 716 0314 1F5F      		subi r17,lo8(-(1))
 717 0316 2C5F      		subi r18,lo8(-(4))
 718 0318 3F4F      		sbci r19,hi8(-(4))
 719 031a 1430      		cpi r17,lo8(4)
 720 031c 01F4      		brne .L40
 721 031e 00C0      		rjmp .L51
 722               	.L33:
 723 0320 20E0      		ldi r18,lo8(0)
 724 0322 30E0      		ldi r19,hi8(0)
 725 0324 10E0      		ldi r17,lo8(0)
 726               	.L40:
 727 0326 EE24      		clr r14
 728 0328 FF24      		clr r15
 729 032a 00C0      		rjmp .L36
 730               	.L51:
 382:tetStuff.c    **** 		pieceNum++;
 731               		.stabn	68,0,382,.LM56-.LFBB5
 732               	.LM56:
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 24


 733 032c 8091 0000 		lds r24,pieceNum
 734 0330 8F5F      		subi r24,lo8(-(1))
 735 0332 8093 0000 		sts pieceNum,r24
 383:tetStuff.c    **** 		if(pieceNum==NUM_PIECES)
 736               		.stabn	68,0,383,.LM57-.LFBB5
 737               	.LM57:
 738 0336 8730      		cpi r24,lo8(7)
 739 0338 01F4      		brne .L38
 384:tetStuff.c    **** 			pieceNum = 0;
 740               		.stabn	68,0,384,.LM58-.LFBB5
 741               	.LM58:
 742 033a 1092 0000 		sts pieceNum,__zero_reg__
 743               	.L38:
 385:tetStuff.c    **** 		pieceLeftCol = PIECE_STARTCOL;
 744               		.stabn	68,0,385,.LM59-.LFBB5
 745               	.LM59:
 746 033e 83E0      		ldi r24,lo8(3)
 747 0340 8093 0000 		sts pieceLeftCol,r24
 386:tetStuff.c    **** 		pieceTopRow = PIECE_STARTROW;
 748               		.stabn	68,0,386,.LM60-.LFBB5
 749               	.LM60:
 750 0344 1092 0000 		sts pieceTopRow,__zero_reg__
 387:tetStuff.c    **** 		pieceOrientation = 0;
 751               		.stabn	68,0,387,.LM61-.LFBB5
 752               	.LM61:
 753 0348 1092 0000 		sts pieceOrientation,__zero_reg__
 754 034c 00C0      		rjmp .L39
 755               	.L50:
 390:tetStuff.c    **** }
 756               		.stabn	68,0,390,.LM62-.LFBB5
 757               	.LM62:
 758 034e 20E0      		ldi r18,lo8(0)
 759               	.L20:
 760 0350 342F      		mov r19,r20
 761 0352 00C0      		rjmp .L22
 762               	.L39:
 763               	/* epilogue start */
 764 0354 0F90      		pop __tmp_reg__
 765 0356 0F90      		pop __tmp_reg__
 766 0358 CF91      		pop r28
 767 035a DF91      		pop r29
 768 035c 1F91      		pop r17
 769 035e 0F91      		pop r16
 770 0360 FF90      		pop r15
 771 0362 EF90      		pop r14
 772 0364 DF90      		pop r13
 773 0366 CF90      		pop r12
 774 0368 BF90      		pop r11
 775 036a AF90      		pop r10
 776 036c 9F90      		pop r9
 777 036e 8F90      		pop r8
 778 0370 7F90      		pop r7
 779 0372 6F90      		pop r6
 780 0374 5F90      		pop r5
 781 0376 4F90      		pop r4
 782 0378 3F90      		pop r3
 783 037a 2F90      		pop r2
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 25


 784 037c 0895      		ret
 785               		.size	tetUpdate, .-tetUpdate
 786               		.stabs	"callCount:V(3,2)",38,0,253,callCount.1887
 787               		.stabs	"newPieceHitCount:V(3,2)",38,0,254,newPieceHitCount.1888
 788               		.stabs	"new_pieceOrientation:r(3,2)",64,0,256,3
 789               		.stabs	"new_pieceTopRow:r(3,2)",64,0,257,2
 790               		.stabs	"new_pieceLeftCol:r(3,2)",64,0,258,20
 791               		.stabs	"pieceRow:r(3,2)",64,0,261,27
 792               		.stabs	"pieceCol:r(3,2)",64,0,262,21
 793               		.stabs	"noChange:r(3,2)",64,0,264,26
 794               		.stabs	"settle:r(3,2)",64,0,265,24
 795               		.stabn	192,0,0,.LFBB5-.LFBB5
 796               		.stabs	"__addr16:r(3,4)",64,0,308,24
 797               		.stabn	192,0,0,.LBB108-.LFBB5
 798               		.stabn	224,0,0,.LBE108-.LFBB5
 799               		.stabs	"__addr16:r(3,4)",64,0,373,30
 800               		.stabn	192,0,0,.LBB112-.LFBB5
 801               		.stabn	224,0,0,.LBE112-.LFBB5
 802               		.stabn	224,0,0,.Lscope5-.LFBB5
 803               	.Lscope5:
 804               		.stabs	"",36,0,0,.Lscope5-.LFBB5
 805               		.stabd	78,0,0
 806               		.stabs	"tetBrick_to_fb:F(3,2)",36,0,418,tetBrick_to_fb
 807               		.stabs	"tetBrick:P(3,2)",64,0,418,24
 808               	.global	tetBrick_to_fb
 809               		.type	tetBrick_to_fb, @function
 810               	tetBrick_to_fb:
 811               		.stabd	46,0,0
 415:tetStuff.c    **** 
 416:tetStuff.c    **** uint8_t tetColorScheme = 0;
 417:tetStuff.c    **** 
 418:tetStuff.c    **** uint8_t tetBrick_to_fb(uint8_t tetBrick)
 419:tetStuff.c    **** {
 812               		.stabn	68,0,419,.LM63-.LFBB6
 813               	.LM63:
 814               	.LFBB6:
 815               	/* prologue: function */
 816               	/* frame size = 0 */
 420:tetStuff.c    **** 	if(!tetBrick)
 817               		.stabn	68,0,420,.LM64-.LFBB6
 818               	.LM64:
 819 037e 8823      		tst r24
 820 0380 01F0      		breq .L54
 421:tetStuff.c    **** 		return 0;
 422:tetStuff.c    **** 
 423:tetStuff.c    **** 	switch(tetColorScheme)
 821               		.stabn	68,0,423,.LM65-.LFBB6
 822               	.LM65:
 823 0382 9091 0000 		lds r25,tetColorScheme
 824 0386 8150      		subi r24,lo8(-(-1))
 825 0388 9230      		cpi r25,lo8(2)
 826 038a 00F4      		brsh .L55
 827               		.stabs	"main.c",132,0,0,.Ltext3
 828               	.Ltext3:
   1:main.c        **** #include "projInfo.h"   //Don't include in main.h 'cause that's included in other .c's?
   2:main.c        **** #include "main.h"
   3:main.c        **** #include <util/delay.h> //For delay_us in pll_enable
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 26


   4:main.c        **** #include <avr/pgmspace.h>
   5:main.c        **** #include _TIMERCOMMON_HEADER_
   6:main.c        **** //#include "../../../_commonCode/charBitmap/0.10/charBitmap.h"
   7:main.c        **** #include _CHARBITMAP_HEADER_
   8:main.c        **** #include "fbColors.h"
   9:main.c        **** 
  10:main.c        **** #include _SINETABLE_HEADER_
  11:main.c        **** 
  12:main.c        **** 
  13:main.c        **** 
  14:main.c        **** #include "mainConfig.h"
  15:main.c        **** 
  16:main.c        **** 
  17:main.c        **** #include "delayCyc.h"
  18:main.c        **** 
  19:main.c        **** #if (defined(ROW_SEG_BUFFER) && ROW_SEG_BUFFER)
  20:main.c        **** 	 #include "rowSegBuffer.h"
  21:main.c        **** #endif
  22:main.c        **** 
  23:main.c        **** //Nope, can't be removed yet...
  24:main.c        **** //#define ROW_BUFFER FALSE
  25:main.c        **** //#define LOADROW TRUE
  26:main.c        **** #if (defined(ROW_BUFFER) && ROW_BUFFER)
  27:main.c        ****  #include "rowBuffer.c"
  28:main.c        **** #endif
  29:main.c        **** 
  30:main.c        **** #if (defined(SEG_TET) && SEG_TET)
  31:main.c        ****  #include "tetStuff.c"
  32:main.c        **** #endif
  33:main.c        **** 
  34:main.c        **** 
  35:main.c        **** 
  36:main.c        **** 
  37:main.c        **** // a/o v59:
  38:main.c        **** //PSEGS are the "pixel segments" addressable in RowSegmentBuffer
  39:main.c        **** // e.g. one could load a single row-segment NUM_PSEGS long, and it would 
  40:main.c        **** // reach from one edge of the screen to the other
  41:main.c        **** // or any number <=NUM_SEGMENTS of row segments whose lengths all add up to
  42:main.c        **** // <=NUM_PSEGS. (It's possible to extend beyond NUM_PSEGS, which would draw
  43:main.c        **** // beyond the edge of the screen, but it may affect the screen's ability 
  44:main.c        **** // to sync properly)
  45:main.c        **** // This value isn't exactly adjustable, it's a characteristic of the
  46:main.c        **** // ratio of the pixel-clock and the system-clock, along with the number of
  47:main.c        **** // system clock cycles used to draw each pixel.
  48:main.c        **** // This value was determined by experimentation with the very specific 
  49:main.c        **** // configuration currently in use, though it could probably be calculated 
  50:main.c        **** // from other #defines elsewhere.
  51:main.c        **** // (and probably *should* be, at some point, especially with 
  52:main.c        **** //  experimentations with PLLSYSCLK, LVDS_PRESCALER, SLOW_LVDS, etc...)
  53:main.c        **** // For now, changing this doesn't really do anything except scale some 
  54:main.c        **** // drawings horizontally (E.G. SEG_RACER)
  55:main.c        **** //These notes were determined long ago when developing SEG_RACER:
  56:main.c        **** // Wasn't sure where 357 came from... and now I'm wondering where the
  57:main.c        **** // notes I wrote regarding it disappeared to...
  58:main.c        **** // Anyhow, from line 72, if ROW_SEG_BUFFER && !LVDS_PRESCALER
  59:main.c        **** // "ROW_SEG_BUFFER uses 20cyc/pixel" (doesn't match the math I've 
  60:main.c        **** // elsewhere) 1024/20*7 = 358.4... so maybe that's something to do with it
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 27


  61:main.c        **** // TODO: If it was 21cyc/pixel, wouldn't we have perfect alignment with
  62:main.c        **** //       color-transitions and segment widths?
  63:main.c        **** //#define NUM_PSEGS	(1024/3+16) //357
  64:main.c        **** #define NUM_PSEGS (1024/3+16)
  65:main.c        **** 
  66:main.c        **** 
  67:main.c        **** #include "delayCyc.c"
  68:main.c        **** #include "lcdDefines.h"
  69:main.c        **** //Yes, I know #including C files is bad-practice...
  70:main.c        **** // and yes, this has to be here... for now.
  71:main.c        **** #if(defined(SEG_RACER) && SEG_RACER)
  72:main.c        ****  #include "seg_racer.c"
  73:main.c        **** #endif
  74:main.c        **** 
  75:main.c        **** 
  76:main.c        **** 
  77:main.c        **** 
  78:main.c        **** 
  79:main.c        **** // a/o v60, this note is OLD, and actually is the whole point behind
  80:main.c        **** // ROW_SEG_BUFFER's current implementation.
  81:main.c        **** // TODO: Between OSCCAL_VAL and FRAME_UPDATE_DELAY
  82:main.c        **** //  it seems the speed (at least for the LTN) isn't so important after all
  83:main.c        **** //  This could be used to my advantage...
  84:main.c        **** //  Maybe bump OSCCAL_VAL all the way up, but use a slower "bit-rate"
  85:main.c        **** //  Thus, pixels could be skinnier, thus higher-resolution.
  86:main.c        **** //   Or more instructions could be used for the same resolution
  87:main.c        **** //   allowing, e.g. sprites from program-memory, without necessitating a
  88:main.c        **** //   large (or any?) frame-buffer...
  89:main.c        **** 
  90:main.c        **** 
  91:main.c        **** //This used to be handled by TOOFAST_TEST, but now can be configured here
  92:main.c        **** // 0xff sets the processor to run as fast as possible 
  93:main.c        **** //  (~16MHz? ~128MHz bit-rate)
  94:main.c        **** // 0x00 sets it as slow as possible (~4MHz, ~32MHz bit-rate)
  95:main.c        **** //  good for testing whether odd colors
  96:main.c        **** //  or bad syncing is due to bits being shifted, etc. 
  97:main.c        **** //  Maybe due to slow "LVDS" conversion chips, or whatnot.
  98:main.c        **** //   This seems to be the case right now... 0xff: black is appearing green
  99:main.c        **** //   There should be *some* green in it, but not this much.
 100:main.c        **** //   Likely due to different propagation delays between my under-driven
 101:main.c        **** //    74LS86's (running red and green), from 3.3V!
 102:main.c        **** //    and the happier and newer 74AHC XOR and OR currently driving the
 103:main.c        **** //    clock and DVH/Blue signals
 104:main.c        **** //  Highly dependent on the screen itself, some may not run at all with
 105:main.c        **** //  such slow bitrates... heck, some may not run at all even at the fastest
 106:main.c        **** // If SLOW_EVERYTHING_TEST is true, this value is overridden
 107:main.c        **** // LTN last used 0x20
 108:main.c        **** // a/o v59:
 109:main.c        **** // 0xD8 is the lowest value that syncs reliably, a few glitches from time
 110:main.c        **** // to time.
 111:main.c        **** // The effect of lower values isn't *quite* what I was expecting, but
 112:main.c        **** // definitely suggests that using ROW_SEG_BUFFER at this bit/refresh-rate
 113:main.c        **** // is dang-near right at the minimum required for this display.
 114:main.c        **** // This might be why the other (same model) display didn't work, but its
 115:main.c        **** // flakeyness at 0xff appeared different than this one's at lower OSCCALs
 116:main.c        **** // --Later note... actually retrying the "flakey" display with the same
 117:main.c        **** //   configuration. Actually, yes, the problem looks dang-near identical to
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 28


 118:main.c        **** //   the "reliable" display's being run at OSCCAL_VALs lower than 0xD8
 119:main.c        **** //   Both displays are of the same manufacturer/model.
 120:main.c        **** //    "reliable" has the chip: LXD91810 VS252AG
 121:main.c        **** //    "flakey"   has the chip: LXD91810 VS242AC
 122:main.c        **** //   The only bit I don't get is that I'm dang-near certain I had both
 123:main.c        **** //   displays working at one point, and from the same code...
 124:main.c        **** //   but this OSCCAL value is the maximum, and the only other way to speed
 125:main.c        **** //   up the bit-rate changes the resolution; which I haven't done
 126:main.c        **** //   for quite some time.
 127:main.c        **** //   Also different about this test than when I originally determined it
 128:main.c        **** //   "flakey": I've since switched the 74LS00 and LS32 out for LS86's
 129:main.c        **** //   (These are wired such that one chip is responsible for the + side of
 130:main.c        **** //    every LVDS signal, and one chip is responsible for the - side.
 131:main.c        **** //    The best-practice, probably, would be to have the + and - sides of
 132:main.c        **** //    an LVDS signal on the same chip. It's also plausible that my test was
 133:main.c        **** //    so long ago that it was on the old board which had this configuration
 134:main.c        **** //    but I doubt that, since that board was so hokily-implemented (with
 135:main.c        **** //    chip-clips and grabbers all over the place) that I can't imagine it
 136:main.c        **** //    was ever running again after all those months of disuse. Though...
 137:main.c        **** //    if that *was* the case... it could also be that I'm using a different
 138:main.c        **** //    ATtiny861... in which case, maybe the RC oscillator and/or PLL aren't
 139:main.c        **** //    capable of running as fast... 
 140:main.c        **** //    Not that I have a ton of these things lying around (three total, in
 141:main.c        **** //    various projects already)
 142:main.c        **** //    BUT the end-result may be that I just happen to have the one display
 143:main.c        **** //    and ATtiny861 on the planet that will work together. That'd be lame.)
 144:main.c        **** #define OSCCAL_VAL	0xff//0xDB//0xDC//0xE0//0//0xff//0x20//0xff //0x00
 145:main.c        **** 
 146:main.c        **** 
 147:main.c        **** 
 148:main.c        **** 
 149:main.c        **** 
 150:main.c        **** //a/o v60: These are old experiments...
 151:main.c        **** // they *are useful* for testing new displays...
 152:main.c        **** // but I can't recall off-hand how to use them instead of (or with?)
 153:main.c        **** // rowSegBuffer...
 154:main.c        **** // They're defined and better-described in lcdStuff.c...
 155:main.c        **** //These three are mutually-exclusive (BLUE_VERT_BAR overrides DE_BLUE)
 156:main.c        **** // (BLUE_DIAG_BAR overrides both...)
 157:main.c        **** //#define BLUE_DIAG_BAR TRUE
 158:main.c        **** //A single black bar, followed by a single blue bar... ~1/3 and 2/3's width
 159:main.c        **** //#define BLUE_VERT_BAR TRUE
 160:main.c        **** //#define DE_BLUE TRUE
 161:main.c        **** // OLD NOTE:
 162:main.c        **** // NONE SELECTED DOESN'T SYNC!!! DE not detected???
 163:main.c        **** 
 164:main.c        **** 
 165:main.c        **** 
 166:main.c        **** // Default is drawPix, from program memory...
 167:main.c        **** // a/o v60: drawPix() has since become the de-facto function for drawing
 168:main.c        **** // a row of pixels, regardless of the method.
 169:main.c        **** // It's defined as necessary...
 170:main.c        **** 
 171:main.c        **** 
 172:main.c        **** 
 173:main.c        **** //This is where COLOR_BAR_SCROLL and PIXEL_SCROLL were, in part.
 174:main.c        **** 
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 29


 175:main.c        **** 
 176:main.c        **** 
 177:main.c        **** 
 178:main.c        **** 
 179:main.c        **** #include "pll.c"
 180:main.c        **** 
 181:main.c        **** #include "lvds.c"
 182:main.c        **** 
 183:main.c        **** 
 184:main.c        **** 
 185:main.c        **** 
 186:main.c        **** static __inline__ \
 187:main.c        **** void loadRow(uint16_t rowNum) \
 188:main.c        **** 	__attribute__((__always_inline__));
 189:main.c        **** 
 190:main.c        **** 
 191:main.c        **** #include _LCDSTUFF_CFILE_
 192:main.c        **** //#include "../../../_commonCode/lcdStuff/0.50ncf/lcdStuff.c"
 193:main.c        **** 
 194:main.c        **** 
 195:main.c        **** 
 196:main.c        **** 
 197:main.c        **** //Nearly everything display-related happens in this interrupt
 198:main.c        **** // It even calls the functions that load (and calculate!) the data for the
 199:main.c        **** // next row.
 200:main.c        **** // So basically, the entire project is running via timer-interrupt.
 201:main.c        **** SIGNAL(TIMER0_COMPA_vect)
 202:main.c        **** {
 203:main.c        **** 	static uint8_t frameCount = 0;
 204:main.c        **** 
 205:main.c        **** 	//Could insert a delay of sorts for scopability...
 206:main.c        **** 	// (otherwise there's not much guarantee that register-assignments
 207:main.c        **** 	//  later will align with the LVDS frame... though ALIGN should help)
 208:main.c        **** 	// see scopeHsync.c
 209:main.c        **** 
 210:main.c        **** 
 211:main.c        **** 	if(updateLCD())
 212:main.c        **** 	{
 213:main.c        **** 		frameCount++;
 214:main.c        **** 		//updateLCD() returns TRUE when the frame is complete
 215:main.c        **** 		// which can be used for whatever purposes 
 216:main.c        **** 		// (e.g. FRAME_COUNT_TO_DELAY)
 217:main.c        **** 	}
 218:main.c        **** 
 219:main.c        **** #if(defined(LOADROW) && LOADROW)
 220:main.c        **** 	//Load the next row into the row(seg)buffer
 221:main.c        **** 	//data is enabled after T_VD+T_Vlow...
 222:main.c        **** 	//a/o v60: Rereading this is confusing...
 223:main.c        **** 	// Basically, there's no reason to call loadRow for display-lines
 224:main.c        **** 	// which don't display data (e.g. V-Sync)
 225:main.c        **** 	if((hsyncCount >= T_VD+T_Vlow) && (hsyncCount < T_VD+T_Vlow+V_COUNT))
 226:main.c        **** 		loadRow(hsyncCount - (T_VD+T_Vlow));
 227:main.c        **** #endif
 228:main.c        **** 	// a/o v60: This is a funny old note... I can't recall a time when
 229:main.c        **** 	// loadRow was written, then removed, then added again. Weird:
 230:main.c        **** 	// Here is where loadRow used to be called
 231:main.c        **** 	// it has been moved to oldNotes.txt, but it would make more sense
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 30


 232:main.c        **** 	// to look at LCDdirectLVDS <25 or LCDdirect
 233:main.c        **** 	// loadRow used the time between DE inactive and the next Hsync
 234:main.c        **** 	// to load a row to a row-buffer (as opposed to a frame-buffer)
 235:main.c        **** 	// thus, DE could gain more pixels because there would be fewer
 236:main.c        **** 	// calculations to determine the memory location to write from
 237:main.c        **** 	// This effect has since been minimized
 238:main.c        **** 	// BUT loadRow might be necessary for program-memory-based images...
 239:main.c        **** }
 240:main.c        **** 
 241:main.c        **** 
 242:main.c        **** 
 243:main.c        **** #if(defined(SEG_HFM) && SEG_HFM)
 244:main.c        **** 	#include "seg_hfm.c"
 245:main.c        **** #endif
 246:main.c        **** 
 247:main.c        **** #if(defined(SEG_QUESTION) && SEG_QUESTION)
 248:main.c        **** 	#include "seg_question.c"
 249:main.c        **** #endif
 250:main.c        **** 
 251:main.c        **** #if(defined(SEG_SINE) && SEG_SINE)
 252:main.c        **** 	#include "seg_sine.c"
 253:main.c        **** #endif
 254:main.c        **** 
 255:main.c        **** #if(defined(LOADROW) && LOADROW)
 256:main.c        **** // whatever this means... it's OLD.
 257:main.c        **** //#warning "loadRow is currently in an intermediate phase..."
 258:main.c        **** void loadRow(uint16_t rowNum)
 259:main.c        **** {
 260:main.c        **** 
 261:main.c        **** 
 262:main.c        **** #if(defined(ROW_SEG_BUFFER) && ROW_SEG_BUFFER)
 263:main.c        ****  #if (defined(SEG_RACER) && SEG_RACER)
 264:main.c        **** 	racer_loadRow(rowNum);
 265:main.c        ****  #elif (defined(SEG_HFM) && SEG_HFM)
 266:main.c        ****  	segHFM_loadRow(rowNum);
 267:main.c        ****  #elif (defined(SEG_QUESTION) && SEG_QUESTION)
 268:main.c        ****  	segQuestion_loadRow(rowNum);
 269:main.c        ****  #elif (defined(SEG_SINE) && SEG_SINE)
 270:main.c        ****  	segSine_loadRow(rowNum);
 271:main.c        ****  #elif (defined(SEG_LINE) && SEG_LINE)
 272:main.c        **** 	//Left here for an example...
 273:main.c        **** 	// Draws a diagonal line 
 274:main.c        **** 	//OLD NOTE:
 275:main.c        **** 	//syncing issues due to recursion overflowing the stack???
 276:main.c        **** 	// Apparently was
 277:main.c        **** 	   
 278:main.c        **** 	//Isn't BLAH = 1 necessary so we don't get a row with no data?
 279:main.c        **** 	// *looks* like it's working, but I dunno...
 280:main.c        **** 	#define BLAH 0
 281:main.c        **** 
 282:main.c        **** 	segClear();
 283:main.c        **** 	newSeg(3,0x06, (6<<4) | 3);									//W
 284:main.c        **** 	newSeg((rowNum&0xff) | BLAH, 0x06, (4<<4) | 0);				//R
 285:main.c        **** 	newSeg(1,0x06, (6<<4) | 3);									//W
 286:main.c        **** 	newSeg((255-(rowNum&0xff)) | BLAH, 0x06, (4<<4) | 0 );	//R
 287:main.c        **** 	newSeg(3,0x06, (6<<4) | 3);									//W
 288:main.c        **** 	segTerminate();
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 31


 289:main.c        **** 
 290:main.c        ****  #elif (defined(SEG_TET) && SEG_TET)
 291:main.c        **** 	//This isn't particularly functional, anymore
 292:main.c        **** 	// it used to be an intermediate stage between rowBuffer and 
 293:main.c        **** 	//  rowSegBuffer... Left here for an example of how it could be done...
 294:main.c        ****   #if(!defined(SEG_STRETCH))
 295:main.c        **** 	#define SEG_STRETCH 5 //(((NUM_PSEGS-6)+RB_WIDTH-1)/RB_WIDTH)
 296:main.c        ****   #endif
 297:main.c        **** 	//3-5 = white + cyan
 298:main.c        **** 	//6 = letters alternating with above
 299:main.c        **** 	//7-9 = ditto, stretched
 300:main.c        **** 
 301:main.c        **** #define TET_VSTRETCH	16
 302:main.c        **** 	if(rowNum == 0)
 303:main.c        **** 	{
 304:main.c        **** 		//Probably not best to put this here, as we're still in the interrupt
 305:main.c        **** 		// extra-long calculations might cause syncing issues with displays
 306:main.c        **** 		// that require rows to be a constant time
 307:main.c        **** 		tetUpdate();
 308:main.c        **** 	}
 309:main.c        **** 	if(rowNum % TET_VSTRETCH == 0)
 310:main.c        **** 	{
 311:main.c        **** 		uint8_t i;
 312:main.c        **** 		for(i=0; i<RB_WIDTH; i++)
 313:main.c        **** 			rowBuffer[i] = fb_to_rb(_K);
 314:main.c        **** 		//	rowBuffer[i] = fb_to_rb((i+rowNum/TET_VSTRETCH)&0x3f);
 315:main.c        **** 		
 316:main.c        **** 		tet_drawRow(rowNum/TET_VSTRETCH, rowBuffer);
 317:main.c        **** 	}
 318:main.c        **** 	segClear();
 319:main.c        **** 
 320:main.c        **** 	//Good for syncing to have white on both borders...
 321:main.c        **** 	newSeg(3, 0x06, (6<<4) | 3);
 322:main.c        **** 	
 323:main.c        **** 	uint16_t i;
 324:main.c        **** 	//TET_OVERLAY alternates rows between the TETRIS board and
 325:main.c        **** 	// an rgb "gradient" The only purpose is to test the idea of
 326:main.c        **** 	// using the high vertical-resolution to essentially increase the
 327:main.c        **** 	// number of colors available to a low-resolution image
 328:main.c        **** 	// sort of like "dithering" in the ol' days of 256 colors in Windows
 329:main.c        **** 	// but easy to implement in this case with very little overhead 
 330:main.c        **** 	// row-by-row
 331:main.c        **** 	// The effect, from a ways back, looks like the colors are blended
 332:main.c        **** 	// (like the Text and Game-board are translucent)
 333:main.c        **** #define TET_OVERLAY TRUE
 334:main.c        **** 
 335:main.c        **** 	//TET_GRADIENT takes that a step further and attempts to create a
 336:main.c        **** 	// gradient between each color in that rgb-gradient.
 337:main.c        **** 	// It's not as pretty as I'd hoped... though it makes sense...
 338:main.c        **** 	// first we're alternating between TET's color and the background color
 339:main.c        **** 	// then the background color is (roughly) alternating between a couple
 340:main.c        **** 	// colors, several rows between...
 341:main.c        **** 	// so if a color is stretched 16 rows vertically, that only leaves 8
 342:main.c        **** 	// rows for the color-gradient... might work better over more gradual
 343:main.c        **** 	// color-changes
 344:main.c        **** #define TET_GRADIENT TRUE
 345:main.c        **** 
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 32


 346:main.c        **** #if (defined(TET_OVERLAY) && TET_OVERLAY)
 347:main.c        **** 	if(rowNum & 0x01)
 348:main.c        **** 	{
 349:main.c        **** #endif
 350:main.c        **** 	for(i=0; i<RB_WIDTH; i++)
 351:main.c        **** 	{
 352:main.c        **** 		//i+1 because we don't want to overwrite the white border...
 353:main.c        **** 		rbpix_to_seg(rowBuffer[i], i+1, SEG_STRETCH);
 354:main.c        **** 	}
 355:main.c        **** 
 356:main.c        **** #if (defined(TET_OVERLAY) && TET_OVERLAY)
 357:main.c        **** 	}
 358:main.c        **** 	else
 359:main.c        **** 	{
 360:main.c        **** 		#define ROWS_PER 64//(V_COUNT/NUM_COLORS)
 361:main.c        **** 
 362:main.c        **** 		uint8_t fbColor;
 363:main.c        **** 
 364:main.c        **** #if (defined(TET_GRADIENT) && TET_GRADIENT)
 365:main.c        **** 		static hfm_t hfmGradient;
 366:main.c        **** 		if(rowNum%ROWS_PER == 0)
 367:main.c        **** 			hfm_setup(&hfmGradient, 0, ROWS_PER/2-4);
 368:main.c        **** 
 369:main.c        **** 		//It's worth it to experiment with changing the range of the 
 370:main.c        **** 		// hfmGradient, ('-4' above and '+4' below).
 371:main.c        **** 		// to try to avoid one or two stray spikes
 372:main.c        **** 		// (e.g. power = 1, maxPower = 15, there'll be one bright row
 373:main.c        **** 		//  and 14 dark, it sticks out like a sore-thumb)
 374:main.c        **** 		//  These values are experimental, and entirely dependent on the
 375:main.c        **** 		//  values used...
 376:main.c        **** 
 377:main.c        **** 		hfm_setPower(&hfmGradient, (rowNum/2)%(ROWS_PER/2)+4);
 378:main.c        **** 
 379:main.c        **** 		if(hfm_nextOutput(&hfmGradient))
 380:main.c        **** 			fbColor = rgbGradient(ROWS_PER-1 - rowNum/(ROWS_PER)+16-1);
 381:main.c        **** 		else
 382:main.c        **** #endif
 383:main.c        **** 			fbColor = rgbGradient(ROWS_PER-1 - rowNum/(ROWS_PER)+16);
 384:main.c        **** 
 385:main.c        **** 		addSegfb(RB_WIDTH*SEG_STRETCH, (fbColor));
 386:main.c        **** 		//newSeg(SEG_STRETCH, fb_to_seg((rowNum*64/768)&0x3f));
 387:main.c        **** 
 388:main.c        **** 	}
 389:main.c        **** #endif
 390:main.c        **** 	//white...
 391:main.c        **** 	newSeg(3, 0x06, (6<<4) | 3);
 392:main.c        **** 	segTerminate();
 393:main.c        ****  #elif (defined(SEG_GRADIENT) && SEG_GRADIENT)
 394:main.c        **** 	static hfm_t hfmGradient;
 395:main.c        **** #define ROWS_PER	(255)	//(V_COUNT/3) == 256
 396:main.c        **** 
 397:main.c        **** 	if(rowNum%ROWS_PER == 0)
 398:main.c        **** 		hfm_setup(&hfmGradient, 0, ROWS_PER);
 399:main.c        **** 
 400:main.c        **** 	uint8_t color;
 401:main.c        **** 
 402:main.c        **** 	uint16_t power;
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 33


 403:main.c        **** 
 404:main.c        **** 	if(rowNum < ROWS_PER/16)
 405:main.c        **** 		rowNum = 0;
 406:main.c        **** 	else
 407:main.c        **** 		rowNum -= ROWS_PER/16;
 408:main.c        **** 
 409:main.c        **** 	//Since there are four shades, there will be three gradients...
 410:main.c        **** 	if(rowNum < ROWS_PER)
 411:main.c        **** 	{
 412:main.c        **** 		//The ROWS_PER/16 stuff is to help alleviate sharp color-spikes
 413:main.c        **** 		// which occur early-on... see the explanation in SEG_TET.
 414:main.c        **** 		color = 0;
 415:main.c        **** 		//hfm_setPower(&hfmGradient, 
 416:main.c        **** 		power = (rowNum); // + ROWS_PER/16);
 417:main.c        **** 	}
 418:main.c        **** 	else if(rowNum < ROWS_PER*2)
 419:main.c        **** 	{
 420:main.c        **** 		color = 1;
 421:main.c        **** 		//hfm_setPower(&hfmGradient, 
 422:main.c        **** 		power = rowNum-(ROWS_PER); // + ROWS_PER/16;
 423:main.c        **** 	}
 424:main.c        **** 	else
 425:main.c        **** 	{
 426:main.c        **** 		color = 2;
 427:main.c        **** 		//hfm_setPower(&hfmGradient, 
 428:main.c        **** 		power = rowNum-(ROWS_PER*2); // + ROWS_PER/16;
 429:main.c        **** 	}
 430:main.c        **** 
 431:main.c        **** 
 432:main.c        **** 	if(power < ROWS_PER/16)
 433:main.c        **** 		power = 0;
 434:main.c        **** 
 435:main.c        **** 	hfm_setPower(&hfmGradient, (power <= 255) ? power : 255);
 436:main.c        **** 
 437:main.c        **** 	if(hfm_nextOutput(&hfmGradient))
 438:main.c        **** 		color++;
 439:main.c        **** 
 440:main.c        **** 	color |= color<<2 | color<<4;
 441:main.c        **** 
 442:main.c        **** 	segClear();
 443:main.c        **** 	addSegfb(3, _W);
 444:main.c        **** 	addSegfb(NUM_PSEGS-6, color); 
 445:main.c        **** 	addSegfb(3, _W);
 446:main.c        **** 	segTerminate();
 447:main.c        **** 
 448:main.c        ****  #else
 449:main.c        **** 	#error "Gotta select a SEG_... option, or create your own"
 450:main.c        ****  #endif //SEG_ selection
 451:main.c        **** #endif //ROW_SEG_BUFFER
 452:main.c        **** }
 453:main.c        **** #endif //LOAD_ROW
 454:main.c        **** 
 455:main.c        **** #include "timer0Stuff.c"
 456:main.c        **** 
 457:main.c        **** 
 458:main.c        **** 
 459:main.c        **** #if (defined(ROW_SEG_BUFFER) && ROW_SEG_BUFFER)
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 34


 460:main.c        **** void drawPix(uint8_t rowNum)
 461:main.c        **** {
 462:main.c        **** 	//Note that rowNum isn't really used here...
 463:main.c        **** 	// and it's only a uint8_t!
 464:main.c        **** 	rsb_drawPix(rowNum);
 465:main.c        **** }
 466:main.c        **** #else
 467:main.c        **** #include "nonRSB_drawPix.c"
 468:main.c        **** void drawPix(uint8_t rowNum)
 469:main.c        **** {
 470:main.c        **** 	//This hasn't been used in quite some time... 
 471:main.c        **** 	// it may not work at all anymore.
 472:main.c        **** 	nonRSB_drawPix();
 473:main.c        **** }
 474:main.c        **** #endif
 475:main.c        **** 
 476:main.c        **** 
 477:main.c        **** 
 478:main.c        **** int main(void)
 479:main.c        **** {
 480:main.c        **** 
 481:main.c        **** #if(defined(SEG_RACER) && SEG_RACER)
 482:main.c        **** 	racer_init();
 483:main.c        **** #endif
 484:main.c        **** 
 485:main.c        **** #if(defined(SEG_TET) && SEG_TET)
 486:main.c        **** 	tetInit(3);
 487:main.c        **** #endif
 488:main.c        **** 	init_timer0Hsync();
 489:main.c        **** 
 490:main.c        **** 	//This starts pretty late... watch out for WDT
 491:main.c        **** 	init_heartBeat();
 492:main.c        **** 
 493:main.c        **** 	setHeartRate(0);
 494:main.c        **** 
 495:main.c        **** 	lvds_timerInit();
 496:main.c        **** 
 497:main.c        **** 
 498:main.c        **** 	// MUCH Of this is outside the screen...
 499:main.c        **** 
 500:main.c        **** 
 501:main.c        **** 	uint8_t imageNum = 0;
 502:main.c        **** 	uint8_t colorShift = 0;
 503:main.c        **** 	while(1)
 504:main.c        **** 	{
 505:main.c        **** 		heartUpdate();
 506:main.c        **** 	}
 507:main.c        **** 
 508:main.c        **** }
 509:main.c        **** 
 510:main.c        **** #include "rowSegBuffer.c"
 511:main.c        **** ...
 829               		.stabn	68,0,511,.LM66-.LFBB6
 830               	.LM66:
 831 038c 8730      		cpi r24,lo8(7)
 832 038e 00F4      		brsh .L57
 833 0390 E82F      		mov r30,r24
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 35


 834 0392 F0E0      		ldi r31,lo8(0)
 835 0394 E050      		subi r30,lo8(-(CSWTCH.52))
 836 0396 F040      		sbci r31,hi8(-(CSWTCH.52))
 837 0398 00C0      		rjmp .L59
 838               	.L55:
 839 039a 8730      		cpi r24,lo8(7)
 840 039c 00F4      		brsh .L57
 841 039e E82F      		mov r30,r24
 842 03a0 F0E0      		ldi r31,lo8(0)
 843 03a2 E050      		subi r30,lo8(-(CSWTCH.55))
 844 03a4 F040      		sbci r31,hi8(-(CSWTCH.55))
 845               	.L59:
 846 03a6 8081      		ld r24,Z
 847 03a8 0895      		ret
 848               	.L57:
 849 03aa 8FE3      		ldi r24,lo8(63)
 850               	.L54:
 851               		.stabs	"tetStuff.c",132,0,0,.Ltext4
 852               	.Ltext4:
 424:tetStuff.c    **** 	{
 425:tetStuff.c    **** 		case 0:
 426:tetStuff.c    **** 		case 1:
 427:tetStuff.c    **** 			switch(tetBrick)
 428:tetStuff.c    **** 			{
 429:tetStuff.c    **** 				case 1:
 430:tetStuff.c    **** 					return _R;
 431:tetStuff.c    **** 				case 2:
 432:tetStuff.c    **** 					return _O;
 433:tetStuff.c    **** 				case 3:
 434:tetStuff.c    **** 					return _Y;
 435:tetStuff.c    **** 				case 4:
 436:tetStuff.c    **** 					return _G;
 437:tetStuff.c    **** 				case 5:
 438:tetStuff.c    **** 					return _C;
 439:tetStuff.c    **** 				case 6:
 440:tetStuff.c    **** 					return _B;
 441:tetStuff.c    **** 				case 7:
 442:tetStuff.c    **** 					return _M;
 443:tetStuff.c    **** 				default:	//WTF???
 444:tetStuff.c    **** 					return _W;
 445:tetStuff.c    **** 			}
 446:tetStuff.c    **** 			break;
 447:tetStuff.c    **** 		default: //Shouldn't happen...
 448:tetStuff.c    **** 			// was case1 but these colors are ugly
 449:tetStuff.c    **** 			// and cause syncing problems...
 450:tetStuff.c    **** 			switch(tetBrick)
 451:tetStuff.c    **** 			{
 452:tetStuff.c    **** 				case 1:
 453:tetStuff.c    **** 					return _r;
 454:tetStuff.c    **** 				case 2:
 455:tetStuff.c    **** 					return _g;
 456:tetStuff.c    **** 				case 3:
 457:tetStuff.c    **** 					return _b;
 458:tetStuff.c    **** 				case 4:
 459:tetStuff.c    **** 					return _c;
 460:tetStuff.c    **** 				case 5:
 461:tetStuff.c    **** 					return _m;
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 36


 462:tetStuff.c    **** 				case 6:
 463:tetStuff.c    **** 					return _y;
 464:tetStuff.c    **** 				case 7:
 465:tetStuff.c    **** 					return _k;
 466:tetStuff.c    **** 				default:	//WTF
 467:tetStuff.c    **** 					return _W;
 468:tetStuff.c    **** 			}
 469:tetStuff.c    **** //		default:
 470:tetStuff.c    **** //			return 0;
 471:tetStuff.c    **** 	}
 472:tetStuff.c    **** 
 473:tetStuff.c    **** }
 853               		.stabn	68,0,473,.LM67-.LFBB6
 854               	.LM67:
 855 03ac 0895      		ret
 856               		.size	tetBrick_to_fb, .-tetBrick_to_fb
 857               	.Lscope6:
 858               		.stabs	"",36,0,0,.Lscope6-.LFBB6
 859               		.stabd	78,0,0
 860               		.stabs	"pll_enable:F(0,15)",36,0,1,pll_enable
 861               	.global	pll_enable
 862               		.type	pll_enable, @function
 863               	pll_enable:
 864               		.stabd	46,0,0
 865               		.stabs	"pll.c",132,0,0,.Ltext5
 866               	.Ltext5:
   1:pll.c         **** void pll_enable(void)
   2:pll.c         **** {
 867               		.stabn	68,0,2,.LM68-.LFBB7
 868               	.LM68:
 869               	.LFBB7:
 870               	/* prologue: function */
 871               	/* frame size = 0 */
   3:pll.c         ****    //Stolen from threePinIDer109t:
   4:pll.c         **** 
   5:pll.c         ****    //Set Timer1 to use the "asynchronous clock source" (PLL at 64MHz)
   6:pll.c         ****    // With phase-correct PWM (256 steps up, then back down) and CLKDIV1
   7:pll.c         ****    // this is 64MHz/512=125kHz
   8:pll.c         ****    // The benefit of such high PWM frequency is the low RC values necessary
   9:pll.c         ****    //  for filtering to DC.
  10:pll.c         ****    // "To change Timer/Counter1 to the async mode follow this procedure"
  11:pll.c         ****    // 1: Enable the PLL
  12:pll.c         ****    setbit(PLLE, PLLCSR);
 872               		.stabn	68,0,12,.LM69-.LFBB7
 873               	.LM69:
 874 03ae 89B5      		in r24,73-0x20
 875 03b0 8260      		ori r24,lo8(2)
 876 03b2 89BD      		out 73-0x20,r24
 877               	.LBB113:
 878               	.LBB114:
 879               	.LBB115:
 880               	.LBB116:
 881               	.LBB117:
 882               	.LBB118:
 883               		.stabs	"/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h",132,0,0,.Ltext6
 884               	.Ltext6:
   1:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** /* Copyright (c) 2002, Marek Michalkiewicz
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 37


   2:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****    Copyright (c) 2007 Joerg Wunsch
   3:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****    All rights reserved.
   4:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
   5:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****    Redistribution and use in source and binary forms, with or without
   6:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****    modification, are permitted provided that the following conditions are met:
   7:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
   8:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****    * Redistributions of source code must retain the above copyright
   9:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****      notice, this list of conditions and the following disclaimer.
  10:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
  11:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****    * Redistributions in binary form must reproduce the above copyright
  12:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****      notice, this list of conditions and the following disclaimer in
  13:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****      the documentation and/or other materials provided with the
  14:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****      distribution.
  15:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
  16:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****    * Neither the name of the copyright holders nor the names of
  17:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****      contributors may be used to endorse or promote products derived
  18:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****      from this software without specific prior written permission.
  19:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
  20:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  21:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****   AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  22:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****   IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  23:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****   ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
  24:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****   LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
  25:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****   CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
  26:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****   SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
  27:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****   INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
  28:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****   CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
  29:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****   ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
  30:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****   POSSIBILITY OF SUCH DAMAGE. */
  31:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
  32:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** /* $Id: delay_basic.h 2143 2010-06-08 21:19:51Z joerg_wunsch $ */
  33:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
  34:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** #ifndef _UTIL_DELAY_BASIC_H_
  35:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** #define _UTIL_DELAY_BASIC_H_ 1
  36:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
  37:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** #include <inttypes.h>
  38:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
  39:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** #if !defined(__DOXYGEN__)
  40:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** static inline void _delay_loop_1(uint8_t __count) __attribute__((always_inline));
  41:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** static inline void _delay_loop_2(uint16_t __count) __attribute__((always_inline));
  42:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** #endif
  43:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
  44:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** /** \file */
  45:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** /** \defgroup util_delay_basic <util/delay_basic.h>: Basic busy-wait delay loops
  46:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     \code
  47:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     #include <util/delay_basic.h>
  48:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     \endcode
  49:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
  50:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     The functions in this header file implement simple delay loops
  51:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     that perform a busy-waiting.  They are typically used to
  52:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     facilitate short delays in the program execution.  They are
  53:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     implemented as count-down loops with a well-known CPU cycle
  54:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     count per loop iteration.  As such, no other processing can
  55:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     occur simultaneously.  It should be kept in mind that the
  56:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     functions described here do not disable interrupts.
  57:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
  58:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     In general, for long delays, the use of hardware timers is
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 38


  59:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     much preferrable, as they free the CPU, and allow for
  60:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     concurrent processing of other events while the timer is
  61:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     running.  However, in particular for very short delays, the
  62:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     overhead of setting up a hardware timer is too much compared
  63:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     to the overall delay time.
  64:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
  65:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     Two inline functions are provided for the actual delay algorithms.
  66:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
  67:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** */
  68:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
  69:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** /** \ingroup util_delay_basic
  70:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
  71:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     Delay loop using an 8-bit counter \c __count, so up to 256
  72:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     iterations are possible.  (The value 256 would have to be passed
  73:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     as 0.)  The loop executes three CPU cycles per iteration, not
  74:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     including the overhead the compiler needs to setup the counter
  75:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     register.
  76:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
  77:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     Thus, at a CPU speed of 1 MHz, delays of up to 768 microseconds
  78:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     can be achieved.
  79:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** */
  80:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** void
  81:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** _delay_loop_1(uint8_t __count)
  82:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** {
  83:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 	__asm__ volatile (
  84:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 		"1: dec %0" "\n\t"
  85:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 		"brne 1b"
  86:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 		: "=r" (__count)
  87:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 		: "0" (__count)
  88:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 	);
  89:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** }
  90:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
  91:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** /** \ingroup util_delay_basic
  92:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
  93:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     Delay loop using a 16-bit counter \c __count, so up to 65536
  94:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     iterations are possible.  (The value 65536 would have to be
  95:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     passed as 0.)  The loop executes four CPU cycles per iteration,
  96:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     not including the overhead the compiler requires to setup the
  97:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     counter register pair.
  98:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 
  99:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     Thus, at a CPU speed of 1 MHz, delays of up to about 262.1
 100:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****     milliseconds can be achieved.
 101:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h ****  */
 102:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** void
 103:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** _delay_loop_2(uint16_t __count)
 104:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** {
 105:/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h **** 	__asm__ volatile (
 885               		.stabn	68,0,105,.LM70-.LFBB7
 886               	.LM70:
 887 03b4 80E9      		ldi r24,lo8(400)
 888 03b6 91E0      		ldi r25,hi8(400)
 889               	/* #APP */
 890               	 ;  105 "/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h" 1
 891 03b8 0197      		1: sbiw r24,1
 892 03ba 01F4      		brne 1b
 893               	 ;  0 "" 2
 894               	/* #NOAPP */
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 39


 895 03bc 00C0      		rjmp .L61
 896               	.L62:
 897               	.LBE118:
 898               	.LBE117:
 899               	.LBE116:
 900               	.LBE115:
 901               	.LBE114:
 902               	.LBE113:
 903               		.stabs	"pll.c",132,0,0,.Ltext7
 904               	.Ltext7:
  13:pll.c         ****    // 2: Wait 100us for the PLL to stabilize
  14:pll.c         ****    // (can't use dmsWait since the timer updating the dmsCount hasn't yet been started!)
  15:pll.c         ****    _delay_us(100);
  16:pll.c         **** //   dmsWait(1);
  17:pll.c         ****    // 3: Poll PLOCK until it is set...
  18:pll.c         ****    while(!getbit(PLOCK, PLLCSR))
  19:pll.c         ****    {
  20:pll.c         ****       asm("nop");
 905               		.stabn	68,0,20,.LM71-.LFBB7
 906               	.LM71:
 907               	/* #APP */
 908               	 ;  20 "pll.c" 1
 909 03be 0000      		nop
 910               	 ;  0 "" 2
 911               	/* #NOAPP */
 912               	.L61:
  18:pll.c         ****    while(!getbit(PLOCK, PLLCSR))
 913               		.stabn	68,0,18,.LM72-.LFBB7
 914               	.LM72:
 915 03c0 09B4      		in __tmp_reg__,73-0x20
 916 03c2 00FE      		sbrs __tmp_reg__,0
 917 03c4 00C0      		rjmp .L62
  21:pll.c         ****    }
  22:pll.c         ****    // 4: Set the PCKE bit to enable async mode
  23:pll.c         ****    setbit(PCKE, PLLCSR);
 918               		.stabn	68,0,23,.LM73-.LFBB7
 919               	.LM73:
 920 03c6 89B5      		in r24,73-0x20
 921 03c8 8460      		ori r24,lo8(4)
 922 03ca 89BD      		out 73-0x20,r24
 923               	/* epilogue start */
  24:pll.c         **** 
  25:pll.c         **** }
 924               		.stabn	68,0,25,.LM74-.LFBB7
 925               	.LM74:
 926 03cc 0895      		ret
 927               		.size	pll_enable, .-pll_enable
 928               		.stabs	"__count:r(3,4)",64,0,138,24
 929               		.stabn	192,0,0,.LBB117-.LFBB7
 930               		.stabn	224,0,0,.LBE117-.LFBB7
 931               	.Lscope7:
 932               		.stabs	"",36,0,0,.Lscope7-.LFBB7
 933               		.stabd	78,0,0
 934               		.stabs	"lvds_timerInit:F(0,15)",36,0,968,lvds_timerInit
 935               	.global	lvds_timerInit
 936               		.type	lvds_timerInit, @function
 937               	lvds_timerInit:
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 40


 938               		.stabd	46,0,0
 939               		.stabs	"lvds.c",132,0,0,.Ltext8
 940               	.Ltext8:
   1:lvds.c        **** 
   2:lvds.c        **** /*
   3:lvds.c        **** This is an old note from main() upon init...
   4:lvds.c        **** And, actually, the Timer0 stuff may not be related to the comment.
   5:lvds.c        ****   I have no idea how it functioned, it seems the rest was deleted.
   6:lvds.c        ****    //For synchronizing timer1 settings (to avoid glitches)
   7:lvds.c        ****    // count the number of CPU cycles...
   8:lvds.c        ****    // depending on how many cycles it takes to start this and whatnot, 
   9:lvds.c        ****    // there may be an offset. But the jist is we know every 7 cycles
  10:lvds.c        ****    // the timer1 reset is synchronized with the CPU instructions...
  11:lvds.c        **** // OCR0A = 6;
  12:lvds.c        **** // timer_setWGM(0, WGM_CLR_ON_COMPARE);
  13:lvds.c        **** // timer_selectDivisor(0, CLKDIV1);
  14:lvds.c        **** */
  15:lvds.c        **** 
  16:lvds.c        **** 
  17:lvds.c        **** 
  18:lvds.c        **** //For Red and Green (NOT Blue) This enables four shades, instead of three
  19:lvds.c        **** // (including black)
  20:lvds.c        **** // Doing so increases pixel-processing time, thus the pixel-widths
  21:lvds.c        **** // (thus decreasing resolution)
  22:lvds.c        **** // each color takes 9 cycles to process in three-shade mode
  23:lvds.c        **** // or 12 cycles for red and green, plus 9 for blue in four-shade mode
  24:lvds.c        **** // a/o v59: I don't think this does anything in ROW_SEG_BUFFER
  25:lvds.c        **** #define FOUR_SHADES TRUE
  26:lvds.c        **** 
  27:lvds.c        **** 
  28:lvds.c        **** //a/o v60
  29:lvds.c        **** //I can't find this anywhere else... Might not be looking hard enough
  30:lvds.c        **** #define	NUM_COLORS	48
  31:lvds.c        **** 
  32:lvds.c        **** 
  33:lvds.c        **** 
  34:lvds.c        **** 
  35:lvds.c        **** //a/o v60: These are old notes, as well...
  36:lvds.c        **** // As I recall, there was some issue with DC signals on the LVDS lines.
  37:lvds.c        **** // I think this was when I was attempting to use AC-Coupling (long before
  38:lvds.c        **** // the 74LS86 was deemed functional)
  39:lvds.c        **** // and probably has no relevence now.
  40:lvds.c        **** //DC_DE is only used in drawPix...
  41:lvds.c        **** //#define DC_DE_DISABLE TRUE
  42:lvds.c        **** //This should remove DC from Vsync, etc...
  43:lvds.c        **** // Currently only implemented with FULL_INIT_TESTS below...
  44:lvds.c        **** //#define REMOVE_DC TRUE
  45:lvds.c        **** 
  46:lvds.c        **** //There are two methods for configuring the PWM channels to output
  47:lvds.c        **** // pseudo-serial data for changes between timing modes... 
  48:lvds.c        **** // (e.g. Horizontal Front Porch -> Hsync -> Back Porch -> Data Enabled)
  49:lvds.c        **** // * Write all the necessary/related registers upon each transition
  50:lvds.c        **** //		Leads to redundancy, as many of the registers are already properly
  51:lvds.c        **** //    configured from the last transition.
  52:lvds.c        **** // * Write only the changed registers
  53:lvds.c        **** //    (As I recall, it was possible to have only a single register-change
  54:lvds.c        **** //     on most, if not all, transitions...)
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 41


  55:lvds.c        **** //
  56:lvds.c        **** // The benefit of the latter being: Since the pixel-clock is generally
  57:lvds.c        **** // faster than the processor-clock, or at least not-aligned, reducing the
  58:lvds.c        **** // number of instructions to *one* would allow for glitchless transitions
  59:lvds.c        **** // in the actual PWM signal... guaranteeing that at least the data being
  60:lvds.c        **** // transmitted would conform to FPD-Link compatible signals...
  61:lvds.c        **** //  (no glitches that might, e.g. cause a couple serial-frames to send both
  62:lvds.c        **** //   Data Enable *and* VSync active at the same time. Or, e.g. to send a
  63:lvds.c        **** //   serial-frame which indicates an H-sync while transitioning between
  64:lvds.c        **** //   the H-Back-Porch and Data-Enable)
  65:lvds.c        **** //   Since the only display I've gotten working via LVDS, so far, is 
  66:lvds.c        **** //    DE-Only, these tests and the importance of these glitches will
  67:lvds.c        **** //    probably have to be revisited when working with a display that pays
  68:lvds.c        **** //    attention to the Hsync and Vsync signals.
  69:lvds.c        **** // FULL_INIT_TESTS uses the first option, which guarantees that if I missed
  70:lvds.c        **** // some register-transition (while coding), that at least it *should* send
  71:lvds.c        **** //  the proper signals (after the transition).
  72:lvds.c        **** //  (The transition-time may, of course, lead to incompatible signals)
  73:lvds.c        **** // So, it's mostly for testing, and should be removed if possible.
  74:lvds.c        **** //#define FULL_INIT_TESTS TRUE
  75:lvds.c        **** 
  76:lvds.c        **** //This should just reduce the number of instructions which actually get
  77:lvds.c        **** // executed, since Hsync doesn't need to be sent, etc.
  78:lvds.c        **** // Actually, I'm working with a DE-Only display right now, and this is NOT
  79:lvds.c        **** // set to TRUE... I haven't tested it with this TRUE
  80:lvds.c        **** //#define DE_ONLY_DISPLAY  TRUE
  81:lvds.c        **** 
  82:lvds.c        **** 
  83:lvds.c        **** 
  84:lvds.c        **** //PWM Timing:
  85:lvds.c        **** // (ATTiny861, Timer1, FastPWM, PWM1X;
  86:lvds.c        **** //  a/o LCDdirectLVDS1_5_PWMtimingTests):
  87:lvds.c        **** //
  88:lvds.c        **** //  PWM output on OC1A
  89:lvds.c        **** //    if OCR1A = 0, OC1A remains constant High
  90:lvds.c        **** //       OCR1A = 1, OC1A is low for 2 counts
  91:lvds.c        **** //       OCR1A = 2, OC1A is low for 3 counts
  92:lvds.c        **** //       OCR1A = 3, OC1A is low for 4 counts
  93:lvds.c        **** //       OCR1A = OCR1C, OC1A remains constant Low
  94:lvds.c        **** //
  95:lvds.c        **** //    THUS:
  96:lvds.c        **** //       compare-match occurs when TCNT changes AWAY from match
  97:lvds.c        **** //         (assuming TCNT starts at 0 for one pulse, 1 for one pulse...)
  98:lvds.c        **** //       TOP (OCR1C) is included in the count...
  99:lvds.c        **** //       There is no single-count pulse-width
 100:lvds.c        **** //         (Though, it seems dead-time could simulate it...)
 101:lvds.c        **** //         (set a deadtime of 1 on the BOTTOM edge and OCR1A)
 102:lvds.c        **** //         (but then there's no high for only one clock)
 103:lvds.c        **** 
 104:lvds.c        **** 
 105:lvds.c        **** 
 106:lvds.c        **** // Rather than *possibly* mess with timing (on other displays?)
 107:lvds.c        **** // Also for testing...
 108:lvds.c        **** //#define DT0_BLUES_ONLY   TRUE
 109:lvds.c        **** 
 110:lvds.c        **** //A/O v13: Using the Samsung LTN display, instead of the IDTech IAXG
 111:lvds.c        **** // LTN appears to be content with my pseudo-LVDS scheme.
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 42


 112:lvds.c        **** // IAXG has never unblanked
 113:lvds.c        **** //      Even though suitable timings were found with SwitchResX
 114:lvds.c        **** //      Maybe due to psuedo-LVDS
 115:lvds.c        **** //            slight timing issues // It probably doesn't work with all cases...
 116:lvds.c        **** // Definitely with drawPix/Images...(RC oscillator variances?)
 117:lvds.c        **** //            glitches when switching LVDS states 
 118:lvds.c        **** //                 (thought I had that figured out, originally)
 119:lvds.c        **** //      The fact the LTN appears to recognize the signalling suggests the
 120:lvds.c        **** //      IAXG would be worth further exploration...
 121:lvds.c        **** //         Unfortunately, the CCFT blew out my inverter
 122:lvds.c        **** //                        And I must have put it back together incorrectly
 123:lvds.c        **** //                        (backlight filters out of order or flipped?)
 124:lvds.c        **** //                        (which actually makes for some very interesting
 125:lvds.c        **** //                         visuals, but hard to develop with)
 126:lvds.c        **** //      IAXG: uses DE, V, and H
 127:lvds.c        **** //             At low pixel-clock DE is active for fewer pixels...
 128:lvds.c        **** //              Last Tested: 680 was full-screen
 129:lvds.c        **** //             Nice because it increases the frame-rate!
 130:lvds.c        **** //      LTN:  uses DE only
 131:lvds.c        **** 
 132:lvds.c        **** 
 133:lvds.c        **** // The idea is to use FastPWM with the PLL to implement 64-85Mbits/sec
 134:lvds.c        **** //  (the PLL on the Tiny861 supposedly maxes out at 85MHz)
 135:lvds.c        **** //  (Though I am currently running with OSCAL set to the highest frequency
 136:lvds.c        **** //   and the PLL seems to be syncing at about 128MHz)
 137:lvds.c        **** 
 138:lvds.c        **** 
 139:lvds.c        **** // Wiring:
 140:lvds.c        **** //   Many iterations of AVR->Differential "LVDS" circuitry resulted in the
 141:lvds.c        **** //   simplest of all:
 142:lvds.c        **** //
 143:lvds.c        **** //   Believe it or not, the XOR is a standard TTL LS-series XOR: 74LS86
 144:lvds.c        **** //     Specifically: TI SN74LS86N from 1980 (the only XOR in my collection)
 145:lvds.c        **** //   It's spec'd to run from 4.5-5.5V, and its propagatio delays and slew
 146:lvds.c        **** //     rates aren't really spec'd to be good enough for 128MHz pixel clock
 147:lvds.c        **** //     yet it's working...
 148:lvds.c        **** //   Further, the output voltages are right in the LVDS range,
 149:lvds.c        **** //     IIRC (last I 'scoped) around 1.5V High and 1.0V Low
 150:lvds.c        **** //      (Don't forget the LCD has a 100ohm resistor between
 151:lvds.c        **** //         RXinN/clk+ and RXinN/clk-)
 152:lvds.c        **** //   Most signals are connected as shown (RXin0, RXin2, RXclk)
 153:lvds.c        **** //   Green is the only one which has RXin1- and RXin1+ swapped
 154:lvds.c        **** //     since it is on the /OC1B (inverted) output
 155:lvds.c        **** //   Green may benefit from a pull-up resistor on /OC1B
 156:lvds.c        **** //     there was some weird noise appearing like a floating-input
 157:lvds.c        **** //     when the full frame was not filled with pixels
 158:lvds.c        **** //     (but it should've waited to disable /OC1B until *after* the delays,
 159:lvds.c        **** //      etc. So I'm not sure what it was)
 160:lvds.c        **** //
 161:lvds.c        **** //   It's probably best to use two XORs from the same chip for a single
 162:lvds.c        **** //    LVDS channel, since different chips may have slightly different
 163:lvds.c        **** //    characteristics. 
 164:lvds.c        **** //
 165:lvds.c        **** //   The entire circuit, thus, requires TWO 74LS86's 
 166:lvds.c        **** //    (four XORs apiece, two per LVDS channel, 8-total)
 167:lvds.c        **** //
 168:lvds.c        **** //
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 43


 169:lvds.c        **** //              VCC3V3   VCC3V3
 170:lvds.c        **** //                |        |
 171:lvds.c        **** //                +---\ \-_
 172:lvds.c        **** //                     | |    -
 173:lvds.c        **** //                     | | XOR   >------> RXinN/clk-
 174:lvds.c        **** //   AVR               | |    _-
 175:lvds.c        **** //   OC1x >----+------/ /___-
 176:lvds.c        **** //   output    |
 177:lvds.c        **** //             |   
 178:lvds.c        **** //             |      
 179:lvds.c        **** //             `------\ \-_
 180:lvds.c        **** //                     | |    -
 181:lvds.c        **** //                     | | XOR   >------> RXinN/clk+
 182:lvds.c        **** //                     | |    _-
 183:lvds.c        **** //                +---/ /___-
 184:lvds.c        **** //                |        |
 185:lvds.c        **** //               GND      GND
 186:lvds.c        **** //
 187:lvds.c        **** //  
 188:lvds.c        **** //  Also used: The TTL 74AHC series...
 189:lvds.c        **** //    I found some one-gang 74AHC1G32 and 74AHC1G86's on an old iBook
 190:lvds.c        **** //     motherboard. (An OR and an XOR, respectively). These are spec'd for
 191:lvds.c        **** //     3.3V operation, and faster. The output voltages appear OK for LVDS
 192:lvds.c        **** //     (with a 100ohm load in the LCD)
 193:lvds.c        **** //
 194:lvds.c        **** //  NOTE: Since I only had enough of these 1-gang devices for two LVDS
 195:lvds.c        **** //     channels, I had to implement Red and Green with the LS 
 196:lvds.c        **** //     before switching all channels to the LS... Using different chips
 197:lvds.c        **** //     (specifically, different TYPES of chips) for different channels
 198:lvds.c        **** //     caused timing issues: Since the AHC is faster, the clock and Blue
 199:lvds.c        **** //     signals are synchronized, but the red and green signals were shifted
 200:lvds.c        **** //     a bit or two (resulting in "Black" appearing green, of course
 201:lvds.c        **** //     true black isn't really possible with my timing scheme... see below)
 202:lvds.c        **** //
 203:lvds.c        **** //  For other circuits attempted, see oldNotes.txt
 204:lvds.c        **** //     (and boy there were many, involving voltage dividers, AC coupling,
 205:lvds.c        **** //      reference voltages, BJT differential amplifiers... I doubt I 
 206:lvds.c        **** //      documented them all, or even most. Whoda thunk the simplest, 
 207:lvds.c        **** //      especially under- AND over-spec'd--timing, supply voltage, and
 208:lvds.c        **** //      output voltage--would be the one...?)
 209:lvds.c        **** //
 210:lvds.c        **** // LVDS/FPD-Link timing:
 211:lvds.c        **** 
 212:lvds.c        **** //            |<--- (LCDdirectLVDS: "pixel") --->|
 213:lvds.c        **** //  Timer1:   |<-- One Timer1 Cycle (OCR1C=6) -->|
 214:lvds.c        **** //  TCNT:     |  0   1    2    3    4    5    6  |  0   1    2    3    
 215:lvds.c        **** //            |____.____.____.____               |____.____.____.____
 216:lvds.c        **** //  RXclk+:   /         |         \    .    .    /         |         \ //
 217:lvds.c        **** //            |         |            |         |
 218:lvds.c        **** // One Pixel: |         |<--- One FPD-Link Pixel Cycle --->|
 219:lvds.c        **** //            |                                  |
 220:lvds.c        **** // "Blue/DVH" |____ ____v____ ____ ____v____ ____|____ ____
 221:lvds.c        **** //  RXin2:    X B3 X B2 X DE X /V X /H X B5 X B4 X B3 X B2 X ...
 222:lvds.c        **** //            | ^  ^ | 
 223:lvds.c        **** //            |         |<--Not Blue-->|         |
 224:lvds.c        **** //            |                                  |
 225:lvds.c        **** // "Green"    |____ ____v____ ____v____ ____ ____|____ ____
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 44


 226:lvds.c        **** //  RXin1:    X G2 X G1 X B1 X B0 X G5 X G4 X G3 X G2 X G1 X ...
 227:lvds.c        **** //            | ^ ^  |  
 228:lvds.c        **** //            |         |<------->|-Not Green    |
 229:lvds.c        **** //
 230:lvds.c        **** // "Red"      |____ ____v____v____ ____ ____ ____|____ ____
 231:lvds.c        **** //  RXin0:    X R1 X R0 X G0 X R5 X R4 X R3 X R2 X R1 X R0 X ...
 232:lvds.c        **** //            | ^^     
 233:lvds.c        **** //            |         |<-->|-Not Red
 234:lvds.c        **** //
 235:lvds.c        **** //   Of course: The Not Green/Red bits above are low-bits and
 236:lvds.c        **** //              basically have little/no visible effect
 237:lvds.c        **** //
 238:lvds.c        **** //
 239:lvds.c        **** // Ponderings on using /OC1x's and OC1D for other colors...
 240:lvds.c        **** //    /OC1D could easily be used for another color, unaffected by others
 241:lvds.c        **** //          since DT1(L) and OCR1D are unused
 242:lvds.c        **** //
 243:lvds.c        **** // DE:   Blue Values
 244:lvds.c        **** //       -----------
 245:lvds.c        **** //       OCR1A=4,5,6   (OCR1A=6, Full-Blue would force /OC1A low,
 246:lvds.c        **** //       DT1(H)=0,1,2                      e.g. Green=Full-Green or Off)
 247:lvds.c        **** //                      Also: OCR1A=4,5 would affect Green
 248:lvds.c        **** //                            (DT1(L) is from this edge...)
 249:lvds.c        **** //                            DT1(H) also affects complementary OC1D
 250:lvds.c        **** //
 251:lvds.c        **** // CLK:  OCR1B=3       CLOCK can NOT be complementary-output mode
 252:lvds.c        **** //                                   (/OC1B unusuable)
 253:lvds.c        **** //                                   otherwise, DT1 would affect clock
 254:lvds.c        **** //
 255:lvds.c        **** //
 256:lvds.c        **** // CLOCK_INSENSITIVITY_TESTING:
 257:lvds.c        **** //   (a/o 56-36-3ish, no longer testable)
 258:lvds.c        **** //    Testing of DE/Blue's DeadTime values on Clocking...
 259:lvds.c        **** //       Image-shift (not sure why, more calculations? Not *that* many!)
 260:lvds.c        **** //       Blue now has only two shades besides black
 261:lvds.c        **** //         ~66% and 100%
 262:lvds.c        **** //       Now each blue pixel (the ones appearing black)
 263:lvds.c        **** //         is bordered by a blue line...
 264:lvds.c        **** //    All doable. Would have preferred 3 shades besides black,
 265:lvds.c        **** //       but two isn't bad.
 266:lvds.c        **** //
 267:lvds.c        **** //  New Idea: Since CLOCK can be used with DT1H (during DE)
 268:lvds.c        **** //    DE/Blue DT values are 0, 1, or 2 (D0, D1, D2)
 269:lvds.c        **** //     Dn corresponds to the low-to-high dead-timer value
 270:lvds.c        **** //                   (aka counter-reset delay, on OCR1x)
 271:lvds.c        **** //     dn corresponds to the high-to-low dead-timer value
 272:lvds.c        **** //                   (aka OCR match delay, on /OCR1x)
 273:lvds.c        **** //     Cn corresponds to OCR1x=n
 274:lvds.c        **** //
 275:lvds.c        **** // This was easier to comprehend in v<26... now it's more informative
 276:lvds.c        **** //   but harder to view...
 277:lvds.c        **** //                          OCR1B = 3
 278:lvds.c        **** //  TCNT:     |  0   1    2    3  | 4    5    6
 279:lvds.c        **** //
 280:lvds.c        **** //  CLKideal: /\______________/
 281:lvds.c        **** //
 282:lvds.c        **** //            |____ ____ ____.____v              |
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 45


 283:lvds.c        **** //  CLK:   D0>/ D1>/ D2>/         \    .    .    /
 284:lvds.c        **** //  OC1B      |           |  |
 285:lvds.c        **** //            |                   |
 286:lvds.c        **** //            | G2   G1   B1   B0 | G5   G4   G3
 287:lvds.c        **** //  Green:    |                   |____ ____ ____
 288:lvds.c        **** //  /OC1B     \    .    .    . d0>/ d1>/ d2>/ d3?\  //
 289:lvds.c        **** //            |      
 290:lvds.c        **** //            |
 291:lvds.c        **** //            | R1   R0   G0   R5   R4   R3   R2
 292:lvds.c        **** //  Red:      |____ ____ ____ ____ ____ ____ ____
 293:lvds.c        **** //  OC1D   D0>/ D1>/ D2>/ C2>\ C3>\ C4>\ C5>\ C6...
 294:lvds.c        **** //                       
 295:lvds.c        **** //             ____ ____ ____ ____ ____ ____ ____
 296:lvds.c        **** //  /OC1D     \ ^OCR1D>=6^ L>/  M>/  N>/  O>/ P?>...
 297:lvds.c        **** //                   
 298:lvds.c        **** //
 299:lvds.c        **** //              B3   B2   DE   /V   /H   B5   B4
 300:lvds.c        **** // "Blue/DVH" |____ ____ ____.____.____ ____ ____
 301:lvds.c        **** //  OC1A:  D0>/ D1>/ D2>/           C4>\ C5>\ C6...
 302:lvds.c        **** //            |                  
 303:lvds.c        **** //             ____ ____ ____ ____ ____ ____ ____
 304:lvds.c        **** //  /OC1A:    \  ^^^--OCR1A>=6--^^^  X>/  Y>/ Z?>\  //
 305:lvds.c        **** //  (usable?)        
 306:lvds.c        **** //                 X: OCR1A=4, DTL=0
 307:lvds.c        **** //                 Y: OCR1A=4, DTL=1; OCR1A=5, DTL=0
 308:lvds.c        **** //                 Z: OCR1A=4, DTL=2; OCR1A=5, DTL=1; OCR1A>=6
 309:lvds.c        **** 
 310:lvds.c        **** //I've looked it over extensively, albiet exhaustedly, and it seems
 311:lvds.c        **** // there's only one way to do this. Unfortunately, DTH=1,2 *does* affect
 312:lvds.c        **** // the clocking. Everything displays properly, but the lighter shades of 
 313:lvds.c        **** // blue enabled by DTH=1,2 don't display at all (or dang-near black)
 314:lvds.c        **** // So there's really no benefit to using DTH=1,2 during DE for blues...
 315:lvds.c        **** // That gives two (similar) shades of bright blue 63/63 and 47/63
 316:lvds.c        **** // *'d are arbitrarily chosen for implementation
 317:lvds.c        **** // F'd are selected when FOUR_SHADES is TRUE
 318:lvds.c        **** //   (experimentation might show other choices are better)
 319:lvds.c        **** //
 320:lvds.c        **** // Red is connected to OC1D, Complementary output is not necessary
 321:lvds.c        **** //  OCR1D determines its brightness:
 322:lvds.c        **** //   (+OC1D => RX0+)
 323:lvds.c        **** //   *Off (0/63): OCR1D = 0  \      //
 324:lvds.c        **** //    3/63:         OCR1D = 1   > These three appear identical in glColorTest
 325:lvds.c        **** //    3/63:         OCR1D = 2  /  (G0 Active, from here down)
 326:lvds.c        **** //   *35/63:      OCR1D = 3
 327:lvds.c        **** //   F51/63:      OCR1D = 4
 328:lvds.c        **** //    59/63:      OCR1D = 5  \  These two appear identical in glColorTest
 329:lvds.c        **** //   *63/63:      OCR1D >= 6 /
 330:lvds.c        **** //    (+OC1D => RX0-)
 331:lvds.c        **** //    Not really worth pursuing, next step from 60/63 is 28/63 then 12
 332:lvds.c        **** //
 333:lvds.c        **** // Green is connected to /OC1B (the complementary channel to CLK)
 334:lvds.c        **** //  Its polarity is reversed (but that's easy since we have a single-ended
 335:lvds.c        **** //  to differential converter, and its outputs can just be swapped)
 336:lvds.c        **** //  DTL1 determines its brightness (G0 affected by Red):
 337:lvds.c        **** //   (/OC1B => RX1+)
 338:lvds.c        **** //    Off (0/63):   DTL1 = 3 (is this possible?)
 339:lvds.c        **** //    8-9/63:         DTL1 = 2
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 46


 340:lvds.c        **** //    24-25/63:      DTL1 = 1
 341:lvds.c        **** //    56-57/63:      DTL1 = 0
 342:lvds.c        **** //   (/OC1B => RX1-)            (B1,0 Active, as well as G2,1)
 343:lvds.c        **** //     *Off (6/63):   DTL1 = 0
 344:lvds.c        **** //   *38-39/63:      DTL1 = 1
 345:lvds.c        **** //   F54-55/63:      DTL1 = 2
 346:lvds.c        **** //   *62-63/63:      DTL1 = 3
 347:lvds.c        **** //
 348:lvds.c        **** // Blue, as in previous versions, is connected to OC1A, DTH=0 during DE 
 349:lvds.c        **** //  so as not to interfere with the clock
 350:lvds.c        **** //  OCR1A determines the brightness (B1,0 active, per Green->RX1-):
 351:lvds.c        **** //    (+OC1A => RX2+)               (B3,2 Active from here down)
 352:lvds.c        **** //    *Off (15/63):   OCR1A=4
 353:lvds.c        **** //    *47/63:          OCR1A=5
 354:lvds.c        **** //      *63/63:         OCR1A=6
 355:lvds.c        **** //
 356:lvds.c        **** // The clock is single-ended (complementary-mode disabled) during NON-DE
 357:lvds.c        **** //  because the DE/V/H signals (except in DE mode) require DT1H to vary.
 358:lvds.c        **** //  When DE is active the clock channel (OC1B) is switched to 
 359:lvds.c        **** //  complementary-output-mode to enable the Green PWM output
 360:lvds.c        **** //
 361:lvds.c        **** // For easier viewing:
 362:lvds.c        **** //   Red: (+OC1D => RX0+)
 363:lvds.c        **** //    Off (0/63): OCR1D = 0
 364:lvds.c        **** //    35/63:      OCR1D = 3
 365:lvds.c        **** //    51/63:      OCR1D = 4   (FOUR_SHADES only)
 366:lvds.c        **** //    63/63:      OCR1D >= 6
 367:lvds.c        **** //   Green: (/OC1B => RX1-)          (B1,0 Active, as well as G2,1)
 368:lvds.c        **** //    Off (6/63): DTL1 = 0
 369:lvds.c        **** //    38-39/63:      DTL1 = 1
 370:lvds.c        **** //    54-55/63:      DTL1 = 2   (FOUR_SHADES only)
 371:lvds.c        **** //    62-63/63:      DTL1 = 3
 372:lvds.c        **** //   Blue: (+OC1A => RX2+)               (B3,2 Active from here down)
 373:lvds.c        **** //    Off (15/63):  OCR1A=4
 374:lvds.c        **** //    47/63:        OCR1A=5
 375:lvds.c        **** //    63/63:        OCR1A=6
 376:lvds.c        **** //
 377:lvds.c        **** 
 378:lvds.c        **** // Toward creating a GIMP palette... v54.5
 379:lvds.c        **** // Probably absurd, but this was brown/orange on GIMP and it's yellow here
 380:lvds.c        **** //
 381:lvds.c        **** //   Red: (+OC1D => RX0+)
 382:lvds.c        **** //    Off (0/63): OCR1D = 0   r=0
 383:lvds.c        **** //    35/63:      OCR1D = 3   r=142
 384:lvds.c        **** //    51/63:      OCR1D = 4   r=206
 385:lvds.c        **** //    63/63:      OCR1D >= 6   r=255
 386:lvds.c        **** //   Green: (/OC1B => RX1-)          (B1,0 Active, as well as G2,1)
 387:lvds.c        **** //    Off (6/63): DTL1 = 0      g=24
 388:lvds.c        **** //    38-39/63:      DTL1 = 1 g=154
 389:lvds.c        **** //    54-55/63:      DTL1 = 2   g=218
 390:lvds.c        **** //    62-63/63:      DTL1 = 3 g=251
 391:lvds.c        **** //   Blue: (+OC1A => RX2+)               (B3,2 Active from here down)
 392:lvds.c        **** //    Off (15/63):  OCR1A=4   b=61
 393:lvds.c        **** //    47/63:        OCR1A=5   b=190
 394:lvds.c        **** //    63/63:        OCR1A=6   b=255
 395:lvds.c        **** //
 396:lvds.c        **** //  These numbers don't look entirely accurate...
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 47


 397:lvds.c        **** //    they vary depending on the other colors... and why is blue so high
 398:lvds.c        **** //    even when it's off?
 399:lvds.c        **** //  Maybe I'm looking at old notes...?
 400:lvds.c        **** //   SEE lvdsColorExperiments.c Now Here.
 401:lvds.c        **** 
 402:lvds.c        **** //  Implementations/prospects:
 403:lvds.c        **** //  * rowBuffer.c (more like row-settings-buffer)
 404:lvds.c        **** //     calculate a row's worth of pixels before drawing that row
 405:lvds.c        **** //     (uses packed color settings in a single byte per drawable pixel)
 406:lvds.c        **** //     64 drawable pixels across, regardless of LVDS speed
 407:lvds.c        **** //  * For faster pixels: these settings values could be stored 
 408:lvds.c        **** //     in individual bytes. Gives about 1/3 more pixels at 3x the memory
 409:lvds.c        **** //     (not implemented)
 410:lvds.c        **** //  * rowSegBuffer.c
 411:lvds.c        **** //     also calculates an entire row before drawing it
 412:lvds.c        **** //     instead of storing pixels, store "segments"
 413:lvds.c        **** //     i.e. each segment is defined by a color value and a length
 414:lvds.c        **** //      the color-value is stored as DT/OCR values (not RGB values)
 415:lvds.c        **** //     Number of segments is limited only by memory...
 416:lvds.c        **** //      e.g. 64 segments per row (max) is 64*3Bytes
 417:lvds.c        **** //       Three bytes for color, and *really simple* packing for seg-length
 418:lvds.c        **** //      BUT: at slow LVDS speeds, the resolution of these segments could be
 419:lvds.c        **** //       as high as one LCD pixel.
 420:lvds.c        **** //      possibly: at *really* low LVDS speeds we could be 64*2Bytes
 421:lvds.c        **** //      (with packing)
 422:lvds.c        **** //      Actually: Using GB_COMBINED gives 2Bytes per segment
 423:lvds.c        **** //      only adds two clock cycles to each "pixel", so probably worth it
 424:lvds.c        **** 
 425:lvds.c        **** //   In Any Case: There's not enough RAM for a full frame
 426:lvds.c        **** //          64 pixels across * 64 pixels down is 4096 bytes
 427:lvds.c        **** //          So whatever method, we need to precalculate each row before
 428:lvds.c        **** //          displaying it
 429:lvds.c        **** //          Could be as simple as loading direct from program memory
 430:lvds.c        **** //
 431:lvds.c        **** 
 432:lvds.c        **** // Since low-bits are barely visible, their effect is neglected.
 433:lvds.c        **** //   Thus: Green is affected only by the Compare-Match deadTimer (DT1L)
 434:lvds.c        **** //         Red is affected only by OCR1D, and could be single-ended
 435:lvds.c        **** //   OTOH:
 436:lvds.c        **** //         The Visible blue values (with DT affecting clock)
 437:lvds.c        **** //         are only the high-two values, which are affected only by OCR1A
 438:lvds.c        **** //         So counter-reset dead-time (DT1H) needn't be varied
 439:lvds.c        **** //         And, then, the clock won't be affected at all
 440:lvds.c        **** //         (assuming we set it to single-ended during DE disabled, for V/H)
 441:lvds.c        **** //
 442:lvds.c        **** // NEW CONSIDERATION: "The dead timer delays the waveform by a minimum of
 443:lvds.c        **** //    "of one count, when DT=0..."
 444:lvds.c        **** // So changing the clock from single-ended to complementary
 445:lvds.c        **** //   might actually cause the clock output to be shifted!
 446:lvds.c        **** 
 447:lvds.c        **** 
 448:lvds.c        **** // DE/V/H Timing (LCDdirectLVDS):
 449:lvds.c        **** //  
 450:lvds.c        **** //
 451:lvds.c        **** //            |  0   1    2    3    4    5    6       All: set @ 0
 452:lvds.c        **** //            |____.____.____.____                         OCR1C = 6 
 453:lvds.c        **** //  Clock:    /                   \    .    .    /         Complementary-
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 48


 454:lvds.c        **** //                                             Output Mode
 455:lvds.c        **** //                                                          required for DT
 456:lvds.c        **** //   Signal:    B3   B2   DE   /V   /H   B5   B4 | B3
 457:lvds.c        **** //             ____ ____ ____ ____ ____ ____ ____|____    
 458:lvds.c        **** //   DE:      X B3 X B2 /    .    .    \ B5 X B4 X B3 X    
 459:lvds.c        **** //   state2                      |    
 460:lvds.c        **** //   DE_BLUE: >|    DT=X, OCR=0
 461:lvds.c        **** //                         Watch the transition!! -------^
 462:lvds.c        **** //   DE_NORM: >_________/\_________|    DT=2, OCR=4
 463:lvds.c        **** //   DC_DISABLED:
 464:lvds.c        **** //   maxBlue: >\____|      DT=0, OCR=5
 465:lvds.c        **** //             See below for more blue settings...
 466:lvds.c        **** //
 467:lvds.c        **** //             ____ ____      ____      ____ ____|____ 
 468:lvds.c        **** //  H (only): X xx X xx \    /    \    / xx X xx X xx X    
 469:lvds.c        **** //   state1              | 
 470:lvds.c        **** //            >______________/\______________|    DT=3, OCR=3
 471:lvds.c        **** //  DC_DISABLED:
 472:lvds.c        **** //   Not much can be done...
 473:lvds.c        **** //
 474:lvds.c        **** //             ____ ____           ____ ____ ____|____ 
 475:lvds.c        **** //  V w/o H:  X xx X xx \    .    /    \ xx X xx X xx X
 476:lvds.c        **** //   state3              |
 477:lvds.c        **** //            >___________________/\_________|    DT=4, OCR=4 (+?)
 478:lvds.c        **** // DC_DISABLED:
 479:lvds.c        **** //            >___________________/\____|      DT=4, OCR=5
 480:lvds.c        **** 
 481:lvds.c        **** //             ____ ____                ____ ____|____ 
 482:lvds.c        **** //  V w/ H:   X xx X xx \    .    .    / xx X xx X xx X
 483:lvds.c        **** //   state4          | 
 484:lvds.c        **** //            >__________________________________|    DT=X, OCR=0
 485:lvds.c        **** //                             TransitionWatch!!! -------^
 486:lvds.c        **** //                             Shouldn't matter... DT from no-edge
 487:lvds.c        **** // DC_DISABLED:
 488:lvds.c        **** //            >\________________________|      DT=0, OCR=1
 489:lvds.c        **** 
 490:lvds.c        **** //             ____ ____      ____ ____ ____ ____|____ 
 491:lvds.c        **** //  Nada:     X xx X xx \    /    .    \ xx X xx X xx X    
 492:lvds.c        **** //   state0                  |     
 493:lvds.c        **** //            >______________/\_________|    DT=3, OCR=4 (+?)
 494:lvds.c        **** // DC_DISABLED:
 495:lvds.c        **** //            >______________/\____|      DT=3, OCR=5
 496:lvds.c        **** 
 497:lvds.c        **** // Transitions: OLD!!!!! WRONG!!!!
 498:lvds.c        **** //   (are they? There're several additional transitions, now, for one.)
 499:lvds.c        **** //  The idea is to reduce the number of instructions between each
 500:lvds.c        **** //  LVDS "state."
 501:lvds.c        **** //  These are implemented below in the case:
 502:lvds.c        **** //    "#else //NOT FULL_INIT_TESTS"
 503:lvds.c        **** //  Since each instruction takes *longer than* a single pixel
 504:lvds.c        **** //    two instructions would *at best* occur on two consecutive pixels
 505:lvds.c        **** //    Thus, there's likely to be a transition-glitch
 506:lvds.c        **** //    (e.g. old OCR value with new DT value)
 507:lvds.c        **** //  Note that the new DT values are implemented at the next corresponding
 508:lvds.c        **** //    edge after the DT-write instruction completes
 509:lvds.c        **** //    (for +OC1A/DT1H, when TCNT is reset to 0)
 510:lvds.c        **** //    (for -OC1A/DT1L, when TCNT passes OCR1A)
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 49


 511:lvds.c        **** //    New OCR values are delayed until the next TCNT reset to 0
 512:lvds.c        **** //
 513:lvds.c        **** //  Initial:
 514:lvds.c        **** //  Nada               DT=2  NADA_OCR = (3<=OCR<(=?)6)
 515:lvds.c        **** 
 516:lvds.c        **** //  Nada   ->   H         OCR=2
 517:lvds.c        **** //  H      ->   Nada      OCR=NADA_OCR
 518:lvds.c        **** //  
 519:lvds.c        **** //  Nada   ->   V         DT=3
 520:lvds.c        **** //  V      ->   V+H      OCR=0
 521:lvds.c        **** //  V+H   ->   V         OCR=NADA_OCR
 522:lvds.c        **** //  V      ->   Nada      DT=2
 523:lvds.c        **** //
 524:lvds.c        **** //  Nada   ->   DE         DT=1
 525:lvds.c        **** //  DE   ->   Nada      DT=2
 526:lvds.c        **** 
 527:lvds.c        **** 
 528:lvds.c        **** #if (defined(REMOVE_DC) && REMOVE_DC)
 529:lvds.c        **** #error "REMOVE_DC hasn't been tested since lcdStuff, or long prior"
 530:lvds.c        ****  #define Nada_init()         { DT1=(3<<4); OCR1A=5; }
 531:lvds.c        **** 
 532:lvds.c        ****  //Unused, normally...
 533:lvds.c        ****  #define Vsync_init()       { DT1=(4<<4);  OCR1A=5; }
 534:lvds.c        ****  #define VplusH_init()      { DT1=0;       OCR1A=1; }
 535:lvds.c        ****  #define Hsync_init()       { DT1=(3<<4);  OCR1A=3; }
 536:lvds.c        ****  #define DEonly_init()      { DT1=(2<<4);  OCR1A=4; }
 537:lvds.c        ****  #define DEblue_init()       { DT1=0;       OCR1A=5; }
 538:lvds.c        **** 
 539:lvds.c        **** #else //!REMOVE_DC
 540:lvds.c        **** //Nada init
 541:lvds.c        ****  #define Nada_init()         { DT1=(3<<4); OCR1A=4; }
 542:lvds.c        **** 
 543:lvds.c        **** //Unused, normally...
 544:lvds.c        ****  #define Vsync_init()         { DT1=(4<<4);   OCR1A=4; }
 545:lvds.c        ****  #define VplusH_init()      { DT1=0;         OCR1A=0; }
 546:lvds.c        ****  #define Hsync_init()         { DT1=(3<<4);   OCR1A=3; }
 547:lvds.c        **** // #define DE_init()            { DT1=(2<<4);   OCR1A=4; } //...SHOULD BE
 548:lvds.c        ****  #define DEonly_init()         { DT1=(2<<4);  OCR1A=4; }
 549:lvds.c        ****  #define DEblue_init()         { DT1=0;       OCR1A=6; }
 550:lvds.c        **** //#define DE_init()            { DT1=(1<<4);   OCR1A=2; } //Works with DE_ONLY
 551:lvds.c        ****  //#define DE_init()            { DT1=0;         OCR1A=0xff; }   //DE_BLUE
 552:lvds.c        **** #endif //REMOVE_DC
 553:lvds.c        **** 
 554:lvds.c        **** 
 555:lvds.c        **** 
 556:lvds.c        **** //Display is DE-Only (doesn't use H/Vsync)
 557:lvds.c        **** // Shouldn't be necessary to select this if it is,
 558:lvds.c        **** // since DE timing is the same either way
 559:lvds.c        **** // but I want to test whether a single-bit is being detected
 560:lvds.c        **** // (e.g. maybe the rise/fall-times of the output aren't fast enough for a
 561:lvds.c        **** //  single bit, which might explain why the other display didn't work)
 562:lvds.c        **** #if (defined(DE_ONLY_DISPLAY) && DE_ONLY_DISPLAY)
 563:lvds.c        **** #define Vsync_fromNada()      Nada_init()
 564:lvds.c        **** #define VplusH_fromVsync()    Nada_init()
 565:lvds.c        **** #define Vsync_fromVplusH()    Nada_init()
 566:lvds.c        **** #define Nada_fromVsync()      Nada_init()
 567:lvds.c        **** #define Hsync_fromNada()      Nada_init()
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 50


 568:lvds.c        **** #define Nada_fromHsync()      Nada_init()
 569:lvds.c        **** #define DEonly_fromNada()     DE_init()
 570:lvds.c        **** #define DEblue_fromDEonly()   DE_init()
 571:lvds.c        **** #define Nada_fromDEblue()      Nada_init()
 572:lvds.c        ****  #if(DE_BLUE)
 573:lvds.c        ****   #warning "DE_BLUE is true, but not implemented with DE_ONLY_DISPLAY"
 574:lvds.c        ****   #warning "...The display should be blank"
 575:lvds.c        ****  #endif
 576:lvds.c        **** //Use full initialization of each LVDS state
 577:lvds.c        **** // (might not be good during transitions, but should guarantee
 578:lvds.c        **** //  steady-state, in case my transitions aren't correct...)
 579:lvds.c        **** #elif (defined(FULL_INIT_TESTS) && FULL_INIT_TESTS)
 580:lvds.c        **** #define Vsync_fromNada()      Vsync_init()
 581:lvds.c        **** #define VplusH_fromVsync()      VplusH_init()
 582:lvds.c        **** #define Vsync_fromVplusH()      Vsync_init()
 583:lvds.c        **** #define Nada_fromVsync()      Nada_init()
 584:lvds.c        **** #define Hsync_fromNada()      Hsync_init()
 585:lvds.c        **** #define Nada_fromHsync()      Nada_init()
 586:lvds.c        **** #define DEonly_fromNada()      DEonly_init()
 587:lvds.c        **** #define DEblue_fromDEonly()   DEblue_init()
 588:lvds.c        **** #define Nada_fromDEonly()      Nada_init()
 589:lvds.c        **** #define Nada_fromDEblue()      Nada_init()
 590:lvds.c        **** 
 591:lvds.c        **** 
 592:lvds.c        **** #else   //NOT FULL_INIT_TESTS
 593:lvds.c        **** //#define Vsync_fromNada()   { DT1=(4<<4); }
 594:lvds.c        **** #define Vsync_fromNada()   { DT1=(4<<4); OCR1A=5; } //Leave two bits high
 595:lvds.c        ****                                                     //for easy-scoping
 596:lvds.c        ****                   //Three would be nicer, but I'm pretty sure OCR=TOP=ON
 597:lvds.c        **** #define VplusH_fromVsync() { OCR1A=0; }
 598:lvds.c        **** //#define Vsync_fromVplusH() { OCR1A=4; }
 599:lvds.c        **** #define Vsync_fromVplusH() { OCR1A=5; }            //Extra bits for scoping
 600:lvds.c        **** //#define Nada_fromVsync()   { DT1=(3<<4); }
 601:lvds.c        **** #define Nada_fromVsync()   { DT1=(3<<4); OCR1A=4; } //scoping...
 602:lvds.c        **** #define Hsync_fromNada()   { OCR1A=3; }
 603:lvds.c        **** #define Nada_fromHsync()   { OCR1A=4; }
 604:lvds.c        **** 
 605:lvds.c        **** #define Nada_fromDEblue()   { DT1=(3<<4); OCR1A=4; }
 606:lvds.c        **** #define Nada_fromDEonly()   { DT1=(3<<4); }
 607:lvds.c        **** #define DEonly_fromNada()   { DT1=(2<<4); }
 608:lvds.c        **** #define DEblue_fromNada()   { OCR1A=0xff; }
 609:lvds.c        **** #define DEblue_fromDEonly() { OCR1A=0xff; }
 610:lvds.c        **** 
 611:lvds.c        **** /*
 612:lvds.c        **** #if (!defined(DE_BLUE) || !DE_BLUE)
 613:lvds.c        ****  //Nada -> DE
 614:lvds.c        ****  //#define DE_fromNada()      { DT1=(1<<4); }   //DT1 = (1<<4);
 615:lvds.c        ****  #define DE_fromNada()      { DT1=(2<<4); }
 616:lvds.c        ****  //DE -> Nada
 617:lvds.c        ****  //#define Nada_fromDE()      { DT1=(2<<4); }   //DT1 = (2<<4);
 618:lvds.c        ****  #define Nada_fromDE()      { DT1=(3<<4); }
 619:lvds.c        **** #else
 620:lvds.c        ****  //Nada -> DE
 621:lvds.c        ****  //#define DE_fromNada()      { OCR1A=0xff; }   //DT1 = (1<<4);
 622:lvds.c        ****  #define DE_fromNada()      { OCR1A=0xff; }
 623:lvds.c        ****  //DE -> Nada
 624:lvds.c        ****  //#define Nada_fromDE()      { OCR1A=3; }   //DT1 = (2<<4);
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 51


 625:lvds.c        ****  #define Nada_fromDE()      { OCR1A=4; }
 626:lvds.c        **** #endif
 627:lvds.c        **** */
 628:lvds.c        **** #endif //End Of FULL_INIT_TESTS
 629:lvds.c        **** 
 630:lvds.c        **** 
 631:lvds.c        **** 
 632:lvds.c        **** // NOTES:
 633:lvds.c        **** //    DeadTimer requires
 634:lvds.c        **** //        COM1x1:0 = 01 ("Complementary Compare Output Mode" ?)
 635:lvds.c        **** //      Complementary Compare Output Mode:
 636:lvds.c        **** //        OCW1A: cleared on match, set at BOTTOM
 637:lvds.c        **** //    If PWM1X (pwm inversion) is used, OC1A = !OCW1A
 638:lvds.c        **** //        (Does not affect DT)
 639:lvds.c        **** //
 640:lvds.c        **** // CLOCK:
 641:lvds.c        **** //    Can NOT use differential mode with:
 642:lvds.c        **** //       OC1B pin is -differential input (through a resistor)
 643:lvds.c        **** //    /OC1B pin is +differential input (through a resistor)
 644:lvds.c        **** //    BECAUSE: DeadTimer affects ALL PWM channels
 645:lvds.c        **** //
 646:lvds.c        **** 
 647:lvds.c        **** //
 648:lvds.c        **** //
 649:lvds.c        **** // ISSUES:
 650:lvds.c        **** //    Using Dead-Timer does not allow for use of complementary outputs
 651:lvds.c        **** //      as complementary LVDS inputs... 
 652:lvds.c        **** //      DeadTimer affects ALL PWM channels in complementary mode
 653:lvds.c        **** //    (e.g. RXclkin+ on OC1B and RXclkin- on /OC1B is not an option)
 654:lvds.c        **** //
 655:lvds.c        **** 
 656:lvds.c        **** 
 657:lvds.c        **** // The typical patterns look like this (not at all to scale):
 658:lvds.c        **** //   ----______------------------------------------------___----- V
 659:lvds.c        **** //      --_--_--_--_--_--_--_--_--_--_--_--_--_--_ H
 660:lvds.c        **** //      __________-__-__-__-__-__-__-__-__-__-  DE
 661:lvds.c        **** //                 
 662:lvds.c        **** //             ^^^^\                                          //blah
 663:lvds.c        **** //             1234 5?
 664:lvds.c        **** // Pixels are sent during DE High (basically all the CPU will be used here)
 665:lvds.c        **** //Ideally, 
 666:lvds.c        **** //  there won't be any glitches when changing from one state to another
 667:lvds.c        **** //
 668:lvds.c        **** //  NOTES: PWM1X inversion affects all PWM channels!
 669:lvds.c        **** //
 670:lvds.c        **** //  Unchangeables:
 671:lvds.c        **** //    FastPWM
 672:lvds.c        **** //      inverted with PWM1X
 673:lvds.c        **** //
 674:lvds.c        **** //  Init (pre 1):
 675:lvds.c        **** //    DeadTimerRising=1
 676:lvds.c        **** //
 677:lvds.c        **** //  The states are:
 678:lvds.c        **** //   (Not necessarily accurate, just looking into necessary changes)
 679:lvds.c        **** //   (from Vsync L->H)
 680:lvds.c        **** //
 681:lvds.c        **** //   1  NothingActive (long, No DE, VporchFrontTimes)
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 52


 682:lvds.c        **** //      *  1<=DeadTimerRising<=5
 683:lvds.c        **** //        (OCW1A: set @ BOTTOM, cleared @ OCR1A
 684:lvds.c        **** //      *  OCR1A == 6
 685:lvds.c        **** //
 686:lvds.c        **** //   2  Hsync
 687:lvds.c        **** //      *  DeadTimer _OFF_ -> Horiz
 688:lvds.c        **** //        (OCW1A: set @ BOTTOM, cleared @ OCR1A
 689:lvds.c        **** //        (OCR1A == 6
 690:lvds.c        **** //   3  NothingActive (short)
 691:lvds.c        **** //      *  1<=DeadTimerRising<=5
 692:lvds.c        **** //        (OCW1A: set @ BOTTOM, cleared @ OCR1A
 693:lvds.c        **** //        (OCR1A == 6
 694:lvds.c        **** //   4  DE
 695:lvds.c        **** //        (1<=DeadTimerRising<(=?)5 (>1 for blue pixels?) 
 696:lvds.c        **** //            (==5 cancelled by OCR1A match?)
 697:lvds.c        **** //        (OCW1A: set @ BOTTOM, cleared @ OCR1A
 698:lvds.c        **** //      *  OCR1A = 5 (or 1<=OCR1A<5 for blue pixels?)
 699:lvds.c        **** //   5  NothingActive(?)
 700:lvds.c        **** //        (1<=DeadTimerRising<=5
 701:lvds.c        **** //        (OCW1A: set @ BOTTOM, cleared @ OCR1A
 702:lvds.c        **** //      *  OCR1A == 6
 703:lvds.c        **** //
 704:lvds.c        **** //   7  Repeat 2-5 for each row
 705:lvds.c        **** //
 706:lvds.c        **** //   8  NothingActive (long, No DE, VporchBackTimes)
 707:lvds.c        **** //      ?  1<=DeadTimerRising<=5
 708:lvds.c        **** //        (OCW1A: set @ BOTTOM, cleared @ OCR1A
 709:lvds.c        **** //        (OCR1A == 6
 710:lvds.c        **** //
 711:lvds.c        **** //   9  V w/o H
 712:lvds.c        **** //      ?  OFF <= DeadTimer <= (5 - OCR1A)
 713:lvds.c        **** //     **  OCW1A: cleared at BOTTOM, set at OCR1A
 714:lvds.c        **** //            ??? What is the effect of changing this while running?
 715:lvds.c        **** //      *  1 <= OCR1A <= 5
 716:lvds.c        **** //   10 V w/  H
 717:lvds.c        **** //      ?   DeadTimer OFF (H -> Low)
 718:lvds.c        **** //      *   OCW1A: set @ BOTTOM, cleared @ OCR1A
 719:lvds.c        **** //      *   OCR1A > (=?) OCR1C
 720:lvds.c        **** //
 721:lvds.c        **** //   11 Repeat 9-10 for Vsync time...
 722:lvds.c        **** //
 723:lvds.c        **** 
 724:lvds.c        **** // Here's how it worked pre-lvds:
 725:lvds.c        **** // HSYNC, VSYNC, and DE refer to the actual pins
 726:lvds.c        **** // In the LVDS setup, there're modes corresponding to each pin-combination
 727:lvds.c        **** //
 728:lvds.c        **** // Timer Interrupt:
 729:lvds.c        **** //  loadData:
 730:lvds.c        **** //   HSYNC active
 731:lvds.c        **** //   HSYNC Low delay
 732:lvds.c        **** //   HSYNC inactive
 733:lvds.c        **** //   if(dataEnable)
 734:lvds.c        **** //    DE active
 735:lvds.c        **** //     Send row data
 736:lvds.c        **** //    DE inactive
 737:lvds.c        **** //  //Prep for next interrupt
 738:lvds.c        **** //  switch(hsyncCount++)
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 53


 739:lvds.c        **** //    //Vsync H->L (active)
 740:lvds.c        **** //    1:
 741:lvds.c        **** //          dataEnable=FALSE
 742:lvds.c        **** //          VSYNC active
 743:lvds.c        **** //    //Vsync L->H (inactive)
 744:lvds.c        **** //    T_Vlow:
 745:lvds.c        **** //          VSYNC inactive
 746:lvds.c        **** //    //Start of frame
 747:lvds.c        **** //    T_VD +(T_Vlow):
 748:lvds.c        **** //          dataEnable=TRUE
 749:lvds.c        **** //    //All rows have been displayed
 750:lvds.c        **** //    V_COUNT +(T_VD+T_Vlow):
 751:lvds.c        **** //          dataEnable=FALSE
 752:lvds.c        **** //    //Frame Complete
 753:lvds.c        **** //    T_DV +(V_COUNT+T_VD+T_Vlow): 
 754:lvds.c        **** //          hsyncCount=0
 755:lvds.c        **** //  if(dataEnable)
 756:lvds.c        **** //    Use the remaining time to load the next row to memory
 757:lvds.c        **** 
 758:lvds.c        **** //  So:
 759:lvds.c        **** //Interrupt0       End
 760:lvds.c        **** //    |             |  Interrupt1
 761:lvds.c        **** //    v             v  v
 762:lvds.c        **** //  H |_||_||_|
 763:lvds.c        **** // DE ___________________________________________________ ...
 764:lvds.c        **** //  V |_____________________________________ ...
 765:lvds.c        **** //       |        ||
 766:lvds.c        **** // DETIME^--------^|
 767:lvds.c        **** //                 |
 768:lvds.c        **** //                 VSYNC active
 769:lvds.c        **** //                 dataEnable=FALSE (not necessary?)
 770:lvds.c        **** //
 771:lvds.c        **** //InterruptT_Vlow   End
 772:lvds.c        **** //    |             |
 773:lvds.c        **** //    v             v
 774:lvds.c        **** //  H |_||_||_|
 775:lvds.c        **** // DE ___________________________________________________ ...
 776:lvds.c        **** //  V _____________| ...
 777:lvds.c        **** //       |        ||
 778:lvds.c        **** // DETIME^--------^|
 779:lvds.c        **** //                 |
 780:lvds.c        **** //                 VSYNC inactive
 781:lvds.c        **** //
 782:lvds.c        **** //
 783:lvds.c        **** //InterruptT_VD   End  InterruptT_VD+1
 784:lvds.c        **** //    |             |  |            End
 785:lvds.c        **** //    v             v  v            v
 786:lvds.c        **** //  H |_||_||_|
 787:lvds.c        **** // DE ____________________||_______||____ ...
 788:lvds.c        **** //  V 
 789:lvds.c        **** //       |        ||      |        |
 790:lvds.c        **** // DETIME^--------^|      ^--------^
 791:lvds.c        **** //                 |
 792:lvds.c        **** //                 dataEnable=TRUE
 793:lvds.c        **** //
 794:lvds.c        **** //InterruptV_COUNT  End
 795:lvds.c        **** //    |             |
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 54


 796:lvds.c        **** //    v             v
 797:lvds.c        **** //  H |_||_||_|
 798:lvds.c        **** // DE ___||______________________________________ ...
 799:lvds.c        **** //  V 
 800:lvds.c        **** //       |        ||      |        |
 801:lvds.c        **** // DETIME^--------^|      ^--------^
 802:lvds.c        **** //                 |
 803:lvds.c        **** //                 dataEnable=FALSE
 804:lvds.c        **** //
 805:lvds.c        **** //
 806:lvds.c        **** // This isn't really a state, it's basically just:
 807:lvds.c        **** // if(hsyncCount == NUM_HYSYNCS_PER_FRAME)
 808:lvds.c        **** //    hsyncCount = 0;
 809:lvds.c        **** //                    .....................................
 810:lvds.c        **** //                    .                                   .
 811:lvds.c        **** //InterruptT_DV   End .Interrupt0                         .
 812:lvds.c        **** //    |             | .|                                  .
 813:lvds.c        **** //    v             v .v                                  .
 814:lvds.c        **** //  H |_||_||_|
 815:lvds.c        **** // DE ___________________________________________________ .
 816:lvds.c        **** //  V |____________________ .
 817:lvds.c        **** //       |        ||  .   |        |                      .
 818:lvds.c        **** // DETIME^--------^|  .   ^--------^                      .
 819:lvds.c        **** //                 |  .                                   .
 820:lvds.c        **** //                 hsyncCount=0 (repeat from Interrupt0)  .
 821:lvds.c        **** //                    .                                   .
 822:lvds.c        **** //                    .....................................
 823:lvds.c        **** //
 824:lvds.c        **** 
 825:lvds.c        **** 
 826:lvds.c        **** // NOW to compare with LVDS states:
 827:lvds.c        **** //
 828:lvds.c        **** //Interrupt0       End
 829:lvds.c        **** //    |             |  Interrupt1
 830:lvds.c        **** //    v             v  v
 831:lvds.c        **** //  H |_||_||_|
 832:lvds.c        **** // DE ___________________________________________________ ...
 833:lvds.c        **** //  V |_____________________________________ ...
 834:lvds.c        **** //    ^ ^          ^   ^ ^
 835:lvds.c        **** //    | |          |   | |
 836:lvds.c        **** //    | |          |   | +--- V w/o H  \ These two toggle until
 837:lvds.c        **** //    | |          |   +----- V w/ H   / next LCD state...
 838:lvds.c        **** //    | |          |
 839:lvds.c        **** //    | |          +--------- V w/o H > Intermediate change of state
 840:lvds.c        **** //    | |
 841:lvds.c        **** //    | +----- NothingActive  \ From Previous State (?)
 842:lvds.c        **** //    +------- H_Only         /
 843:lvds.c        **** 
 844:lvds.c        **** 
 845:lvds.c        **** //InterruptT_Vlow   End
 846:lvds.c        **** //    |             |
 847:lvds.c        **** //    v             v
 848:lvds.c        **** //  H |_||_||_|
 849:lvds.c        **** // DE ___________________________________________________ ...
 850:lvds.c        **** //  V _____________| ...
 851:lvds.c        **** //    ^ ^          ^   ^ ^
 852:lvds.c        **** //    | |          |   | |
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 55


 853:lvds.c        **** //    | |          |   | +--- NothingActive  \ These two toggle until
 854:lvds.c        **** //    | |          |   +----- H_Only         / next LCD state...
 855:lvds.c        **** //    | |          |
 856:lvds.c        **** //    | |          +--------- NothingActive > Intermediate change of state
 857:lvds.c        **** //    | |
 858:lvds.c        **** //    | +----- V w/o H   \ From previous state
 859:lvds.c        **** //    +------- V w/ H    /
 860:lvds.c        **** 
 861:lvds.c        **** 
 862:lvds.c        **** //InterruptT_VD   End  InterruptT_VD+1
 863:lvds.c        **** //    |             |  |            End
 864:lvds.c        **** //    v             v  v            v
 865:lvds.c        **** //  H |_||_||_|
 866:lvds.c        **** // DE ____________________||_______||____ ...
 867:lvds.c        **** //  V 
 868:lvds.c        **** //    ^ ^              ^ ^^        ^ 
 869:lvds.c        **** //    | |              | ||        |
 870:lvds.c        **** //    | |              | ||        +--- NothingActive  \  These four
 871:lvds.c        **** //    | |              | |+------------ DE              | cycle until
 872:lvds.c        **** //    | |              | +------------- NothingActive   | next LCD state...
 873:lvds.c        **** //    | |              +--------------- H_Only  ^      /
 874:lvds.c        **** //    | |                                       |
 875:lvds.c        **** //    | +----- NothingActive  \ From previous   |
 876:lvds.c        **** //    +------- H_Only         / state           +-This intermediate state
 877:lvds.c        **** //                                                may not be necessary
 878:lvds.c        **** //                                                (IAXG01 shows 160 dots!)
 879:lvds.c        **** 
 880:lvds.c        **** 
 881:lvds.c        **** 
 882:lvds.c        **** //InterruptV_COUNT  End
 883:lvds.c        **** //    |             |
 884:lvds.c        **** //    v             v
 885:lvds.c        **** //  H |_||_||_|
 886:lvds.c        **** // DE ___||______________________________________ ...
 887:lvds.c        **** //  V 
 888:lvds.c        **** //    ^ ^^        ^    ^ ^
 889:lvds.c        **** //    | ||        |    | |
 890:lvds.c        **** //    | ||        |    | +--- NothingActive \  These two toggle
 891:lvds.c        **** //    | ||        |    +----- H_Only        /  until next LCD state
 892:lvds.c        **** //    | ||        |
 893:lvds.c        **** //    | ||        +---- NothingActive \                         //blah
 894:lvds.c        **** //    | |+------------- DE             |  From previous state
 895:lvds.c        **** //    | +-------------- NothingActive  |
 896:lvds.c        **** //    +---------------- H_Only        /
 897:lvds.c        **** 
 898:lvds.c        **** // This isn't really a state, it's essentially just:
 899:lvds.c        **** //  if(hsyncCount == NUM_HSYNCS_PER_FRAME)
 900:lvds.c        **** //    hsyncCount = 0;
 901:lvds.c        **** //                    .....................................
 902:lvds.c        **** //                    .                                   .
 903:lvds.c        **** //InterruptT_DV   End .Interrupt0                         .
 904:lvds.c        **** //    |             | .|                                  .
 905:lvds.c        **** //    v             v .v                                  .
 906:lvds.c        **** //  H |_||_||_|
 907:lvds.c        **** // DE ___________________________________________________ .
 908:lvds.c        **** //  V |____________________ .
 909:lvds.c        **** //    ^ ^             .                                   .
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 56


 910:lvds.c        **** //    | |             .....................................
 911:lvds.c        **** //    | +--- NothingActive \                                 //blah
 912:lvds.c        **** //    +----- H_Only        / From previous state...
 913:lvds.c        **** 
 914:lvds.c        **** 
 915:lvds.c        **** 
 916:lvds.c        **** //  LVDS State transitions:
 917:lvds.c        **** //   1 H_Only
 918:lvds.c        **** //   2 NothingActive
 919:lvds.c        **** //
 920:lvds.c        **** //   3 V w/o H
 921:lvds.c        **** //   4 V w/ H
 922:lvds.c        **** //    
 923:lvds.c        **** //   (repeat 3,4)
 924:lvds.c        **** //
 925:lvds.c        **** //   5 V w/o H
 926:lvds.c        **** //
 927:lvds.c        **** //   6 NothingActive
 928:lvds.c        **** //   7 H_Only
 929:lvds.c        **** //
 930:lvds.c        **** //   (repeat 6,7)
 931:lvds.c        **** //
 932:lvds.c        **** //   8 NothingActive
 933:lvds.c        **** //
 934:lvds.c        **** //   9 H_Only
 935:lvds.c        **** //  10 NothingActive
 936:lvds.c        **** //  11 DE
 937:lvds.c        **** //  12 NothingActive
 938:lvds.c        **** //
 939:lvds.c        **** //  (repeat 9-12)
 940:lvds.c        **** //
 941:lvds.c        **** //  13 H_Only
 942:lvds.c        **** //  14 NothingActive
 943:lvds.c        **** //
 944:lvds.c        **** //  (repeat 13-14)
 945:lvds.c        **** //
 946:lvds.c        **** //   These should be reviewed to determine which changes are necessary
 947:lvds.c        **** //   between each state...
 948:lvds.c        **** //   (the fewer changes, the less likely we'll glitch...?)
 949:lvds.c        **** 
 950:lvds.c        **** 
 951:lvds.c        **** 
 952:lvds.c        **** 
 953:lvds.c        **** 
 954:lvds.c        **** 
 955:lvds.c        **** // This'll probably be better rearranged...
 956:lvds.c        **** //  For now, though, OC1A is in all the notes above, for the D/V/H signal
 957:lvds.c        **** //  so OC1B is for the clock...
 958:lvds.c        **** // CHANGING THESE does NOT change channel association.
 959:lvds.c        **** #define DVH_OCR   OCR1A
 960:lvds.c        **** #define CLOCK_OCR   OCR1B
 961:lvds.c        **** 
 962:lvds.c        **** 
 963:lvds.c        **** 
 964:lvds.c        **** 
 965:lvds.c        **** 
 966:lvds.c        **** 
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 57


 967:lvds.c        **** 
 968:lvds.c        **** void lvds_timerInit(void)
 969:lvds.c        **** {
 941               		.stabn	68,0,969,.LM75-.LFBB8
 942               	.LM75:
 943               	.LFBB8:
 944               	/* prologue: function */
 945               	/* frame size = 0 */
 970:lvds.c        ****    //Timer1 is used for LVDS (in PLL clocking mode)
 971:lvds.c        ****   
 972:lvds.c        ****      //pll_enable();   
 973:lvds.c        ****    
 974:lvds.c        ****    //We want it to count 7 bits, 0-6 and reset at 7
 975:lvds.c        ****    OCR1C = 6;
 946               		.stabn	68,0,975,.LM76-.LFBB8
 947               	.LM76:
 948 03ce 86E0      		ldi r24,lo8(6)
 949 03d0 8BBD      		out 75-0x20,r24
 976:lvds.c        **** 
 977:lvds.c        ****    //We want the clock to go low at TCNT=0 and high at TCNT=4
 978:lvds.c        ****    CLOCK_OCR = 3; //2; //3;
 950               		.stabn	68,0,978,.LM77-.LFBB8
 951               	.LM77:
 952 03d2 83E0      		ldi r24,lo8(3)
 953 03d4 8CBD      		out 76-0x20,r24
 979:lvds.c        ****    
 980:lvds.c        **** 
 981:lvds.c        **** // My 'scope is only 20MHz, and I'd rather be able to use the digital mode
 982:lvds.c        **** // which is even slower...
 983:lvds.c        **** 
 984:lvds.c        **** 
 985:lvds.c        **** //Overridden when SLOW_EVERYTHING_TEST is true...
 986:lvds.c        **** //#define TOOFAST_TEST TRUE
 987:lvds.c        **** #warning "HERE AND BELOW, doesn't OSCCAL have special write requirements?"
 988:lvds.c        **** //OSCCAL = 0x00;
 989:lvds.c        **** #if (defined(SLOW_EVERYTHING_TEST) && SLOW_EVERYTHING_TEST)
 990:lvds.c        **** //FOR TESTING. This should slow the clock...
 991:lvds.c        ****    // Gives roughly 4MHz...
 992:lvds.c        ****    OSCCAL = 0x00; //0x80; 
 993:lvds.c        **** 
 994:lvds.c        ****    // This should divide the system clock by 256
 995:lvds.c        ****    // does this affect the PLL? NO.
 996:lvds.c        ****    // The PLL is clocked only by the RC Oscillator
 997:lvds.c        ****    //   OSCCAL does affect it.
 998:lvds.c        ****    // OPTIONS FOR SIMULATING FULL FUNCTIONALITY AT LOW SPEED:
 999:lvds.c        ****    // Run PLL as normal
1000:lvds.c        ****    //  Prescale Timer1 and DeadTimer equally
1001:lvds.c        ****    //  Prescale System clock equally
1002:lvds.c        ****    CLKPR = (1<<CLKPCE);
1003:lvds.c        ****    CLKPR = (1<<CLKPS1) | (1<<CLKPS0);   //CLKDIV8
1004:lvds.c        ****    //4MHz / 8 = .5Mhz...
1005:lvds.c        ****    //PLL is 4MHz*8 = 32MHz
1006:lvds.c        ****    // then TimerClockDivisor=8 gives 4MHz
1007:lvds.c        ****    pll_enable();
1008:lvds.c        ****    #define SLOW_LVDS_TEST TRUE
1009:lvds.c        **** #elif (defined(OSCCAL_VAL))
1010:lvds.c        ****    OSCCAL = OSCCAL_VAL;
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 58


 954               		.stabn	68,0,1010,.LM78-.LFBB8
 955               	.LM78:
 956 03d6 8FEF      		ldi r24,lo8(-1)
 957 03d8 81BF      		out 81-0x20,r24
1011:lvds.c        **** #endif
1012:lvds.c        **** 
1013:lvds.c        **** 
1014:lvds.c        **** 
1015:lvds.c        **** #if (defined(SLOW_LVDS_TEST) && SLOW_LVDS_TEST)
1016:lvds.c        ****    //This case doesn't really make sense without SLOW_EVERYTHING...
1017:lvds.c        ****    //8x prescaler for Timer1
1018:lvds.c        ****    #define CSBITS (1<<CS12)
1019:lvds.c        ****    //8x prescaler for the dead-timer
1020:lvds.c        ****    #define DTPSBITS ((1<<DTPS11) | (1<<DTPS10))
1021:lvds.c        **** #elif (defined(LVDS_PRESCALER))
1022:lvds.c        ****    //Timer1 on the Tiny861 uses a strange CLKDIV scheme...
1023:lvds.c        ****    // (but it's nicer!)
1024:lvds.c        ****    // The divisor is (1<<(csbits-1))
1025:lvds.c        ****    // so a divisor of 1 = (1<<0) = (1<<(1-1)), (csbits = 0x1)
1026:lvds.c        ****    // 256 = (1<<8) = (1<<(9-1)), (csbits = 0x9)
1027:lvds.c        ****    // 512 = (1<<9) = (1<<(10-1)), (csbits = 0xA)
1028:lvds.c        ****    // ...
1029:lvds.c        ****    // (0x0 stops the timer)
1030:lvds.c        ****    /*
1031:lvds.c        ****       uint16_t divisor;
1032:lvds.c        ****       uint8_t csbits = 0;
1033:lvds.c        ****       for(divisor=CLKDIV; divisor != 0; divisor>>=1)
1034:lvds.c        ****          csbits++;
1035:lvds.c        ****          writeMasked(csbits, 0x0f, TCCR1B);
1036:lvds.c        ****    */
1037:lvds.c        **** 
1038:lvds.c        **** //#if ((LVDS_PRESCALER != 64) && (LVDS_PRESCALER != 32) && \
1039:lvds.c        **** //     (LVDS_PRESCALER != 16) && 
1040:lvds.c        **** #if ((LVDS_PRESCALER != 8) && \
1041:lvds.c        ****      (LVDS_PRESCALER != 4)  && (LVDS_PRESCALER != 2) && \
1042:lvds.c        ****      (LVDS_PRESCALER != 1))
1043:lvds.c        **** #error "LVDS_PRESCALER must be a power of 2, from 1 to 8"
1044:lvds.c        **** #endif
1045:lvds.c        **** 
1046:lvds.c        ****    //Figured this out in cTools/dePower.c...
1047:lvds.c        ****    //64 is overkill here, since the deadTimer prescaler only goes to 8...
1048:lvds.c        **** #define divToCS(div) \
1049:lvds.c        ****    ( (div == 64) ? 7 : (div == 32) ? 6 : (div == 16) ? 5 : (div == 8) ? 4 \
1050:lvds.c        ****      : (div == 4) ? 3 : (div == 2) ? 2 : (div == 1) ? 1 : 0)
1051:lvds.c        **** 
1052:lvds.c        **** 
1053:lvds.c        ****    //CSBITS (through PLL/8) (CS10 is bit 0)
1054:lvds.c        ****    //CS12:10   CS12   CS11   CS10      PLL division
1055:lvds.c        ****    //1         0      0      1         1
1056:lvds.c        ****    //2         0      1      0         2
1057:lvds.c        ****    //3         0      1      1         4
1058:lvds.c        ****    //4         1      0      0         8
1059:lvds.c        ****    #define CSBITS divToCS(LVDS_PRESCALER) //<<CS10 should be redundant
1060:lvds.c        ****    //DTPSBITS (DTPS10 is bit 4)
1061:lvds.c        ****    //DTPS11:10   DTPS11 DTPS10   PLL division
1062:lvds.c        ****    //0         0      0         1
1063:lvds.c        ****    //1         0      1         2
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 59


1064:lvds.c        ****    //2         1      0         4
1065:lvds.c        ****    //3         1      1         8
1066:lvds.c        ****    #define DTPSBITS ((CSBITS-1)<<DTPS10)
1067:lvds.c        **** 
1068:lvds.c        ****    //Whoops! Forgot this (a/o 42-som'n WTF1pix)
1069:lvds.c        ****    // so, it's promising to get single-pixel control...
1070:lvds.c        ****    //  the result was kinda ugly, though... scroll was quite slow
1071:lvds.c        ****    // Further, it was only drawing a certain number of pixels...
1072:lvds.c        ****    //  (horizontally... pre LVDS_PRESCALER affecting DOTS_TO_CYC)
1073:lvds.c        ****    //  so accessing *all* pixels in a row would make it even slower...
1074:lvds.c        ****    // Further, it didn't seem to be paying attention to the fact that
1075:lvds.c        ****    // the same pixels are drawn on multiple rows...
1076:lvds.c        ****    // WTF? (the image was scaled, proportionately! 1pix x 1pix)
1077:lvds.c        ****    pll_enable();
 958               		.stabn	68,0,1077,.LM79-.LFBB8
 959               	.LM79:
 960 03da 00D0      		rcall pll_enable
1078:lvds.c        **** 
1079:lvds.c        **** #else
1080:lvds.c        ****    //No clock divisor
1081:lvds.c        ****    #define CSBITS (1<<CS10)
1082:lvds.c        ****    //No dead-timer divisor
1083:lvds.c        ****    #define DTPSBITS 0
1084:lvds.c        ****    pll_enable();
1085:lvds.c        ****    //#warning "The PLL configuration code is not in here yet!"
1086:lvds.c        **** #endif
1087:lvds.c        **** 
1088:lvds.c        ****    //Set the Timer1 clock prescaler...
1089:lvds.c        ****    writeMasked(CSBITS, 
 961               		.stabn	68,0,1089,.LM80-.LFBB8
 962               	.LM80:
 963 03dc 8FB5      		in r24,79-0x20
 964 03de 807F      		andi r24,lo8(-16)
 965 03e0 8360      		ori r24,lo8(3)
 966 03e2 8FBD      		out 79-0x20,r24
1090:lvds.c        ****                ((1<<CS13) | (1<<CS12) | (1<<CS11) | (1<<CS10)),
1091:lvds.c        ****                TCCR1B);
1092:lvds.c        **** 
1093:lvds.c        ****    //Set the DeadTime prescaler (no prescaling, same speed as TCNT1)...
1094:lvds.c        ****    // Allegedly this is prescaled from the PCK (or CK)
1095:lvds.c        ****    //    NOT from the Timer1 prescaler...
1096:lvds.c        ****    writeMasked(DTPSBITS,
 967               		.stabn	68,0,1096,.LM81-.LFBB8
 968               	.LM81:
 969 03e4 8FB5      		in r24,79-0x20
 970 03e6 8F7C      		andi r24,lo8(-49)
 971 03e8 8062      		ori r24,lo8(32)
 972 03ea 8FBD      		out 79-0x20,r24
1097:lvds.c        ****                ((1<<DTPS11) | (1<<DTPS10)),
1098:lvds.c        ****                TCCR1B);
1099:lvds.c        **** 
1100:lvds.c        **** 
1101:lvds.c        **** 
1102:lvds.c        ****    //All LVDS modes (and signals) use FastPWM.. 
1103:lvds.c        ****  
1104:lvds.c        ****    //FastPWM
1105:lvds.c        **** //Now Handled in lvds_xxxOnCompare():
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 60


1106:lvds.c        **** 
1107:lvds.c        ****    //These are also written below (excluding PWM1D)
1108:lvds.c        ****    setbit(PWM1A, TCCR1A);  //Enable PWM on OC1A for DVH
 973               		.stabn	68,0,1108,.LM82-.LFBB8
 974               	.LM82:
 975 03ec 80B7      		in r24,80-0x20
 976 03ee 8260      		ori r24,lo8(2)
 977 03f0 80BF      		out 80-0x20,r24
1109:lvds.c        ****                            //Need to do the same for other channels
1110:lvds.c        ****   
1111:lvds.c        ****    setbit(PWM1B, TCCR1A);  //Enable PWM on OC1B for CLOCK 
 978               		.stabn	68,0,1111,.LM83-.LFBB8
 979               	.LM83:
 980 03f2 80B7      		in r24,80-0x20
 981 03f4 8160      		ori r24,lo8(1)
 982 03f6 80BF      		out 80-0x20,r24
1112:lvds.c        **** 
1113:lvds.c        ****    setbit(PWM1D, TCCR1C);
 983               		.stabn	68,0,1113,.LM84-.LFBB8
 984               	.LM84:
 985 03f8 87B5      		in r24,71-0x20
 986 03fa 8160      		ori r24,lo8(1)
 987 03fc 87BD      		out 71-0x20,r24
1114:lvds.c        **** 
1115:lvds.c        ****    //PWM1D is not in TCCR1A...
1116:lvds.c        **** 
1117:lvds.c        ****    setoutPORT(PB1, PORTB);   //+OC1A, DVH/BLUE, MISO (usually heart)
 988               		.stabn	68,0,1117,.LM85-.LFBB8
 989               	.LM85:
 990 03fe B99A      		sbi 55-0x20,1
1118:lvds.c        **** //   setoutPORT(PB0, PORTB);   //-OC1A    MOSI unused
1119:lvds.c        ****    setoutPORT(PB2, PORTB); //-OC1B, -GREEN    (INVERTED) SCK
 991               		.stabn	68,0,1119,.LM86-.LFBB8
 992               	.LM86:
 993 0400 BA9A      		sbi 55-0x20,2
1120:lvds.c        ****    setoutPORT(PB3, PORTB); //+OC1B Clock (OC1B, not inverted)
 994               		.stabn	68,0,1120,.LM87-.LFBB8
 995               	.LM87:
 996 0402 BB9A      		sbi 55-0x20,3
1121:lvds.c        ****    setoutPORT(PB5, PORTB); //+OC1D, RED
 997               		.stabn	68,0,1121,.LM88-.LFBB8
 998               	.LM88:
 999 0404 BD9A      		sbi 55-0x20,5
1122:lvds.c        **** 
1123:lvds.c        **** 
1124:lvds.c        ****    writeMasked(((0<<WGM11) | (0<<WGM10)), //FastPWM (combined with above)
 1000               		.stabn	68,0,1124,.LM89-.LFBB8
 1001               	.LM89:
 1002 0406 86B5      		in r24,70-0x20
 1003 0408 8C7F      		andi r24,lo8(-4)
 1004 040a 86BD      		out 70-0x20,r24
1125:lvds.c        ****                ((1<<WGM11) | (1<<WGM10)), // (affects all PWM channels)
1126:lvds.c        ****                TCCR1D);
1127:lvds.c        **** 
1128:lvds.c        ****    //OC1A is used, but /OC1A isn't
1129:lvds.c        **** // Not Valid (deadTime only functions if in complementary-mode):
1130:lvds.c        ****    // OTOH: dead-time is not necessary in the only case we need to switch
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 61


1131:lvds.c        ****    // Most lvds states use clear on compare-match, set at 0
1132:lvds.c        ****    // But there is one that uses the opposite
1133:lvds.c        ****    // This can be toggled by a single bit-change
1134:lvds.c        ****    //  COM1A1 = 1
1135:lvds.c        ****    //  COM1A0 value indicates what happens on Compare-Match
1136:lvds.c        ****    //                 or ! at BOTTOM
1137:lvds.c        **** //#define lvds_clrOnCompare() clrbit(COM1A0, TCCR1A)
1138:lvds.c        **** //#define lvds_setOnCompare() setbit(COM1A0, TCCR1A)
1139:lvds.c        ****    //HOWEVER: the alternative is possible:
1140:lvds.c        ****    // Use complementary (clear-on-compare)
1141:lvds.c        ****    // and single-ended with set-on-compare
1142:lvds.c        ****    // COM1A0 = 1
1143:lvds.c        ****    // COM1A1 value indicates what happens on Compare-Match
1144:lvds.c        **** 
1145:lvds.c        **** /* These are three instructions apiece!
1146:lvds.c        **** #define lvds_ComplementaryClrOnCompare() clrbit(COM1A1, TCCR1A)
1147:lvds.c        **** 
1148:lvds.c        **** #define lvds_setOnCompare() setbit(COM1A1, TCCR1A)
1149:lvds.c        **** #define lvds_clrOnCompare() lvds_ComplementaryClrOnCompare()
1150:lvds.c        **** */
1151:lvds.c        **** 
1152:lvds.c        **** //Page 99:
1153:lvds.c        **** // "In Fast PWM Mode ... when the COM1x1:0 bits are set to 01 ...
1154:lvds.c        **** //  an user programmable Dead Time delay is inserted for 
1155:lvds.c        **** //  these complementary output pairs (OC1x and OC1x)."
1156:lvds.c        **** 
1157:lvds.c        **** //Page 98:
1158:lvds.c        **** // "The counter is loaded with a 4-bit DT1H or DT1L value from DT1 
1159:lvds.c        **** //  I/O register, depending on the edge of the Waveform 
1160:lvds.c        **** //  Output (OCW1x) when the dead time insertion is started."
1161:lvds.c        **** // In other words, (as it appears from the diagram)
1162:lvds.c        **** //  the dead-time value is loaded into the counter when the corresponding
1163:lvds.c        **** //  edge in OCW1x is detected
1164:lvds.c        **** //  So changing the value of DT1 affects the *next* corresponding edge 
1165:lvds.c        **** //   (NOT if the dead timer is already running)
1166:lvds.c        **** 
1167:lvds.c        **** //Page 96:
1168:lvds.c        **** // "The OCR1x Registers are double buffered when using any of the 
1169:lvds.c        **** // Pulse Width Modulation (PWM) modes."
1170:lvds.c        **** // "The double buffering synchronizes the update of the OCR1x 
1171:lvds.c        **** // Compare Registers to either top or bottom of the counting sequence.
1172:lvds.c        **** // The synchronization prevents the occurrence of odd-length, non-sym- 
1173:lvds.c        **** // metrical PWM pulses, thereby making the output glitch-free."
1174:lvds.c        **** 
1175:lvds.c        **** //Page 100:
1176:lvds.c        **** //"A change of the COM1x1:0 bits state will have effect 
1177:lvds.c        **** // at the first Compare Match after the bits are written."
1178:lvds.c        **** //Page 97: HAH!
1179:lvds.c        **** //"Be aware that the COM1x1:0 bits are not double buffered 
1180:lvds.c        **** // together with the compare value. 
1181:lvds.c        **** // Changing the COM1x1:0 bits will take effect immediately."
1182:lvds.c        **** 
1183:lvds.c        **** 
1184:lvds.c        **** //#define lvds_setOnCompare()   
1185:lvds.c        **** //   TCCR1A = ( (1<<COM1A1) | (1<<COM1A0) 
1186:lvds.c        **** //            | (0<<COM1B1) | (1<<COM1B0) 
1187:lvds.c        **** //            | (1<<PWM1A) | (1<<PWM1B) )
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 62


1188:lvds.c        **** //#define lvds_ComplementaryClrOnCompare() \ //
1189:lvds.c        ****    //Do TCCR1C first, because it contains shadow-bits of TCCR1A that I
1190:lvds.c        ****    // don't want to have to rewrite...
1191:lvds.c        ****    TCCR1C = ( (1<<COM1D1) | (0<<COM1D0)
 1005               		.stabn	68,0,1191,.LM90-.LFBB8
 1006               	.LM90:
 1007 040c 89E0      		ldi r24,lo8(9)
 1008 040e 87BD      		out 71-0x20,r24
1192:lvds.c        ****             | (1<<PWM1D) );
1193:lvds.c        **** 
1194:lvds.c        ****    TCCR1A = ( (0<<COM1A1) | (1<<COM1A0) 
 1009               		.stabn	68,0,1194,.LM91-.LFBB8
 1010               	.LM91:
 1011 0410 83E6      		ldi r24,lo8(99)
 1012 0412 80BF      		out 80-0x20,r24
1195:lvds.c        ****             | (1<<COM1B1) | (0<<COM1B0) //Don't use complementary for CLK
1196:lvds.c        ****             | (1<<PWM1A) | (1<<PWM1B) );
1197:lvds.c        **** 
1198:lvds.c        **** //#define lvds_clrOnCompare() lvds_ComplementaryClrOnCompare()
1199:lvds.c        **** 
1200:lvds.c        ****    // Enable Complementary-Mode (and thus the dead-timer)
1201:lvds.c        ****    // This'll be changed as needed, but we need COM1A0 set prior to that
1202:lvds.c        **** 
1203:lvds.c        ****    //   lvds_clrOnCompare();
1204:lvds.c        **** //   writeMasked(((0<<COM1A1) | (1<<COM1A0)), 
1205:lvds.c        **** //               ((1<<COM1A1) | (1<<COM1A0)), 
1206:lvds.c        **** //               TCCR1A);
1207:lvds.c        **** 
1208:lvds.c        **** 
1209:lvds.c        **** 
1210:lvds.c        ****    //THIS IS NOT THOROUGHLY THOUGHT-OUT...
1211:lvds.c        ****    // as I recall, we need to use /OC1B for the clock output
1212:lvds.c        ****    //  because it won't be affected by the deadtime...
1213:lvds.c        **** //Now Handled in lvds_xxxOnCompare():
1214:lvds.c        **** //   writeMasked(((0<<COM1B1) | (1<<COM1B0)),
1215:lvds.c        **** //               ((1<<COM1B1) | (1<<COM1B0)),
1216:lvds.c        **** //               TCCR1A);
1217:lvds.c        **** 
1218:lvds.c        ****    //Since PWM inversion affects all channels, great-pains were taken
1219:lvds.c        ****    // to assure that it needn't be changed in any lvds state...
1220:lvds.c        ****    // PWM inversion must be enabled:
1221:lvds.c        **** 
1222:lvds.c        ****    //inverted with PWM1X
1223:lvds.c        **** //   setbit(PWM1X, TCCR1B);
1224:lvds.c        ****  
1225:lvds.c        ****     Nada_init();
 1013               		.stabn	68,0,1225,.LM92-.LFBB8
 1014               	.LM92:
 1015 0414 80E3      		ldi r24,lo8(48)
 1016 0416 84BD      		out 68-0x20,r24
 1017 0418 84E0      		ldi r24,lo8(4)
 1018 041a 8DBD      		out 77-0x20,r24
 1019               	/* epilogue start */
1226:lvds.c        **** }
 1020               		.stabn	68,0,1226,.LM93-.LFBB8
 1021               	.LM93:
 1022 041c 0895      		ret
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 63


 1023               		.size	lvds_timerInit, .-lvds_timerInit
 1024               	.Lscope8:
 1025               		.stabs	"",36,0,0,.Lscope8-.LFBB8
 1026               		.stabd	78,0,0
 1027               		.stabs	"lcd_Init:F(0,15)",36,0,873,lcd_Init
 1028               	.global	lcd_Init
 1029               		.type	lcd_Init, @function
 1030               	lcd_Init:
 1031               		.stabd	46,0,0
 1032               		.stabs	"_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c",132,0,0,.Ltext9
 1033               	.Ltext9:
   1:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //lcdStuff 0.52ncf
   2:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
   3:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //0.52ncf - getting rid of git in this directory...
   4:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //0.51ncf-git-1ish Adding a few notes remaining from LCDdirectLVDS:
   5:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //						"SCOPING has been removed in LVDS, revisit LCDdirect50"
   6:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //0.51ncf-git first attempt at using git for uploading to googleCode...
   7:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //        this version isn't yet used by any projects
   8:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //0.50ncf cleanup, colorOverride is unused...
   9:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //				SMILEY -> LCD_SMILEY
  10:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //0.40ncf-1 loadRow unused... removal untested...
  11:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //0.40ncf drawPix...
  12:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //0.30ncf-6 HSYNC_INACTIVE, etc. definable elsewhere
  13:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //0.30ncf-5 Adding BLUE_VERT_BAR_REVERSED
  14:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //0.30ncf-4 Adding NOTES: DON'T START WITH BLUE_DIAG_BAR
  15:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //0.30ncf-3 T_DV and T_Vlow overrideable
  16:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //0.30ncf-2 Not sure if I've modified it between... but here: 
  17:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //        FRAME_COUNT_TO_DELAY wasn't defined, giving warnings
  18:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //0.30ncf-1 updateLCD() has return-values for state-switches
  19:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          (VFP, VSync, VBP, DE)
  20:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //        ACTUALLY, that's unnecessary... state-transitions can be
  21:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //        determined by vSync and dataEnable...
  22:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //0.30ncf Haven't been keeping these backed up regularly...
  23:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //        More toward realtime adjustable timing values
  24:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //        V Front Porch now occurs at the beginning of the frame, instead
  25:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //        of at the end...
  26:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
  27:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //0.20ncf More Timing Value experiment preparation... 
  28:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //0.10ncf-3ish looking into reloading methods for e.g. experimenting with
  29:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          timing values: sdramThing2.0-7
  30:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          How to "move" timing-values around data which needn't be
  31:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          changed...
  32:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //0.10ncf-andsomemore
  33:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          Added MAKELONG to fix integer overflow warnings
  34:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          Revised it from "... + MAKELONG" to "MAKELONG(...)"
  35:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          (The +MAKELONG version is lost in the ether... if you *really*
  36:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //           want it, there's a localized version in sdramThing2.0-6)
  37:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //0.10ncf-1ish - Adding HSYNC_COUNT_FRAME_COMPLETE
  38:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //               Removal of LVDS_PRESCALER stuff...
  39:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //0.10ncf - Stolen from LCDdirectLVDS/54-moreColorStuff/main.c
  40:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          Removal of LCDdirectLVDS-specific stuff...
  41:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //				A little bit of rewriting of notes to be more generalized
  42:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          All delay_cyc references replaced with delay_Dots,
  43:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //					math changed accordingly...
  44:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
  45:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
  46:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // I hereby declare this FPD-Link simulation technique to forever be called
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 64


  47:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  PW-BANGing
  48:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
  49:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // a/o 0.10ncf-4: (sdramThing2.0v8-28)
  50:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   DON'T START WITH BLUE_DIAG_BAR
  51:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   Unless you want to be depressed
  52:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   Good Starting Point DE_BLUE
  53:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
  54:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
  55:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
  56:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //new notes a/o 0.10ncf-3ish:
  57:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // The basic idea is that timing is something that needs to be experimented
  58:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // with, often... so, for cases where LCD timing/drawing data is loaded
  59:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // beforehand (e.g. sdramThing2.0-7), it would be nice not to have to
  60:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // reload *all* the data, only to change the necessary timing data
  61:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
  62:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Neglecting the SDRAM for a second, we have essentially:
  63:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // (The exact placement is not necessarily in order... e.g. DH_DOTS could
  64:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  be at the end of a row, or at the beginning... VSYNC rows could be at
  65:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  the top, or at the bottom.....)
  66:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // (See also notes "Here's how it worked pre-lvds:", which actually are a
  67:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   bit off, e.g. I don't think VSYNC L->H was delayed by DE_TIME after
  68:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   Hsync)
  69:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
  70:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // H_LOW_DOTS + HD_DOTS + DH_DOTS = "Horizontal Blank Time"
  71:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // (This "front/back" thing always confused me...
  72:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  DH_DOTS is *in front of* Hsync as far as *time* is concerned...
  73:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  i.e. looking at a 'scope trace... But something about reading left-to-
  74:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  right causes me to feel like "front" is the furthest to the right
  75:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  which would be *later* in time... weird.
  76:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  
  77:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
  78:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //        |--|<--H_LOW_DOTS                       "Horiz Front Porch"
  79:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //        |  |--|<--HD_DOTS="Horiz Back Porch"    |<---->|<--DH_DOTS
  80:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //        |  .  .                                 .      |
  81:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //        |<............................................./
  82:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //        |  .  .                                 .    
  83:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //        v  v  .                                 .      
  84:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     /V _______________________________________________  \ VSYNC Rows
  85:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     /H |__|
  86:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     DE _______________________________________________  /  T_Vlow times)
  87:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              .                                 .
  88:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              .                                 .      "Vsync Back Porch"
  89:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     /V 
  90:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     /H |__|
  91:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     DE _______________________________________________  /  T_VD times)
  92:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              .                                 .         "Vbp should be
  93:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              v                                 v          static"
  94:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              ***********************************
  95:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              *                                 *
  96:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     /V 
  97:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     /H |__|
  98:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     DE ______||______   /
  99:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              *                                 *
 100:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              *<------ DE_ACTIVE_DOTS --------->*        (Repeat V_COUNT
 101:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              *      .                          *         =1024 times)
 102:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                     .   Displayed Pixels
 103:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              *      .                          *
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 65


 104:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              *                                 *
 105:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              *                                 *
 106:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     /V 
 107:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     /H |__|
 108:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     DE ______||______   /
 109:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              *                                 *
 110:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              ***********************************      
 111:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                                                      "Vsync Front Porch"
 112:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     /V 
 113:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     /H |__|
 114:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     DE _______________________________________________  /  T_DV times)
 115:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 116:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 117:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #warning "TODO Maybe: LCDdirectLVDS (which so far is the only version which synced with such low re
 118:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 119:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Front vs. Back porches....
 120:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   If I were to draw a car driving down a street... 
 121:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   I would draw it with its front to the right, driving to the right...
 122:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 123:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //       _____/\________     \O/
 124:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   ...|__   _________   __\     |
 125:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      ...\_/         \_/       / \							//
 126:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 127:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   The person is *in front of* the car... which means the car has not yet
 128:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   arrived at the person, but will soon... 
 129:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   (later in time, not *before* in time)
 130:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  This is my logic...
 131:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   So The "Horizontal Front Porch", to me, should be to the RIGHT of the
 132:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   Horizontal Sync Pulse...
 133:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   But that ain't how it is (unless I've confused myself into a circle
 134:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   where my logic is actually right, and I just think it's wrong?)
 135:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   
 136:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  By the logic that the front porch occurs *before* the sync pulse,
 137:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   ... I suppose we could think of a person in front of a house... it
 138:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   makes more sense, anyhow, since it's a porch in front of a house, 
 139:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   not person in front of a car.
 140:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   The person's walking into the house, crosses the *front*-porch 
 141:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   *before* enterring the doorway. If he continues walking all the way
 142:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   through the house and out the back-door, he'll be crossing the *back*
 143:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   porch later in time...
 144:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 145:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Right, so the logic makes sense... but for some reason I have to run 
 146:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  through this whole diatribe every time I see the terms.
 147:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Heh, and even after going through it, the damned thing seems backwards.
 148:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  (Probably because I drew it with the front-porch to the right side...)
 149:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  (AND THEN there's the issue that it seems to me like the front-porch
 150:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   should be to the left of the drawing-area whereas the back-porch
 151:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   should be to the right of it... rather than to the HSYNC pulse)
 152:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 153:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 154:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Anyways, all that drawing was to figure out where to position this
 155:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // in memory, such that it would be the least processing-effort to modify
 156:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // timing values for testing... (because loading the SDRAM's free-running 
 157:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // data takes ~20minutes!)
 158:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 159:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 160:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 66


 161:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //Options LTN, IDT, or TESTVALS
 162:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // IDT display *still* doesn't sync... maybe my H/V signals aren't right
 163:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #ifndef DISPLAY
 164:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define DISPLAY TESTVALS //LTN //TESTVALS //IDT //LTN
 165:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
 166:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 167:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //oldNote:
 168:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // TODO: Between OSCCAL_VAL and FRAME_UPDATE_DELAY
 169:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  it seems the speed (at least for the LTN) isn't so important after all
 170:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  This could be used to my advantage...
 171:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Maybe bump OSCCAL_VAL all the way up, but use a slower "bit-rate"
 172:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Thus, pixels could be skinnier, thus higher-resolution.
 173:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   Or more instructions could be used for the same resolution
 174:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   allowing, e.g. sprites from program-memory, without necessitating a
 175:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   large (or any?) frame-buffer...
 176:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 177:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 178:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //This would normally be 0 for the highest-speed frame-refresh possible
 179:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // However, increasing this value can slow the frame-refresh rate
 180:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   if desired
 181:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // e.g. 50000 causes it to refresh ~ every few seconds
 182:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   (durn-near the limit for how long the LCD will retain an image)
 183:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // The benefit being that it doesn't flicker at annoying rates for
 184:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  stationary images
 185:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  worth exploring...
 186:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // This may be highly dependent on the screen capabilities...
 187:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   of course, this sorta thing is undocumented
 188:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   it just has to be experimented with
 189:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   Further, it may be quite hard on the Liquid Crystals, since they'd 
 190:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   likely be driven DC... not sure what the long term effects are.
 191:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // This could be a hell of a lot more sophisticated...
 192:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // e.g. refresh after a frameBuffer change
 193:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      refresh based on a seconds-timer
 194:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      ...
 195:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // AS-IS: Does refreshes completely independent of the frame-buffer
 196:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      if it's too slow, some images may be missed completely.
 197:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      This is not true for FRAME_SYNC TRUE (below)
 198:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      (and it's not really useful anymore with FRAME_SYNC)
 199:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // a/o sdramThing2.0, this is not really relevent...
 200:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // 	if the frame needs updating, just stop free-running, right?
 201:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // 	well, doing-so might cause issues, since the LVDS clock will not be
 202:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    running... this is a TBD
 203:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define FRAME_UPDATE_DELAY 0//5000//50000 //2000 //5000 //20000 //50000
 204:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 205:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 206:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //New Idea:
 207:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Disable the Hsync timer interrupt after the frame completes
 208:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  and reenable elsewhere...
 209:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  (It seems pixels changing from one shade to another take an
 210:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   intermediate step halfway between)
 211:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  (Thus, two updates then a pause might clear that up)
 212:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  (Duh... it doesn't clear that up, because the fastest refresh rate
 213:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   is the same...)
 214:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  (but it is an interesting effect)
 215:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  (Double-Duh... I was using a slow refresh with FRAME_UPDATE_DELAY)
 216:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Reworded: Having several frame refreshes before a pause helps to
 217:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  "solidify" the color changes... especially the sharp changes 
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 67


 218:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  (e.g. yellow<->black)
 219:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  (Side Note: I saw this effect on a regular (NON-LVDS) TFT display 
 220:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   in LCDdirect that was only connected such that R, G, and B were each
 221:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   either full-off or full-on, i.e. all Red bits were connected to a
 222:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   single output pin (full on when 1, full off when 0).
 223:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   I hadn't attributed it to improper refresh synchronization
 224:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   as the refresh rate was too fast to see... That's a handy way to get
 225:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   intermediate shades/colors without refresh-flicker from pulsing them!)
 226:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  connected with each color 
 227:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  0 means no delay (except FRAME_UPDATE_DELAY) via interrupt disabling
 228:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  If you WANT this effect (for intermediate shades?) 
 229:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   set FRAME_COUNT_TO_DELAY to 1
 230:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Then, each change of color will (apparently) result in a value halfway
 231:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   between the old color and the new color
 232:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Not sure whether it's an electrical problem, but these half-shades 
 233:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   appear dithered, sometimes ugilly, sometimes it's nice. I guess it
 234:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   depends on the goal...
 235:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //#define FRAME_COUNT_TO_DELAY 2//7//1//5//2//3
 236:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 237:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 238:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //A/O v13: Using the Samsung LTN display, instead of the IDTech IAXG
 239:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // LTN appears to be content with my pseudo-LVDS scheme.
 240:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // IAXG has never unblanked
 241:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      Even though suitable timings were found with SwitchResX
 242:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      Maybe due to psuedo-LVDS
 243:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            slight timing issues // It probably doesn't work with all cases...
 244:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Definitely with drawPix/Images...(RC oscillator variances?)
 245:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            glitches when switching LVDS states 
 246:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                 (thought I had that figured out, originally)
 247:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      The fact the LTN appears to recognize the signalling suggests the
 248:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      IAXG would be worth further exploration...
 249:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //         Unfortunately, the CCFT blew out my inverter
 250:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                        And I must have put it back together incorrectly
 251:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                        (backlight filters out of order or flipped?)
 252:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                        (which actually makes for some very interesting
 253:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                         visuals, but hard to develop with)
 254:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      IAXG: uses DE, V, and H
 255:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //             At low pixel-clock DE is active for fewer pixels...
 256:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              Last Tested: 680 was full-screen
 257:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //             Nice because it increases the frame-rate!
 258:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      LTN:  uses DE only
 259:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 260:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 261:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // The idea is to use FastPWM with the PLL to implement 64-85Mbits/sec
 262:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  (the PLL on the Tiny861 supposedly maxes out at 85MHz)
 263:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  (Though I am currently running with OSCAL set to the highest frequency
 264:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   and the PLL seems to be syncing at about 128MHz)
 265:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  (New Note, a/o sdramThing2.0v5... it's kinda ironic that I was able to
 266:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   run it at 128MHz with nothing more than an AVR and some gates...
 267:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   seeing as how sdramThing has been fidgetty just running at 8MHz
 268:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   Anyways, an eventual goal is to run at 133MHz+, using basically
 269:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   nothing more than the SDRAM itself for timing and refreshes...
 270:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   would allow for full resolution and full color-depth)
 271:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 272:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 273:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 274:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 68


 275:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Wiring:
 276:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   Many iterations of AVR->Differential "LVDS" circuitry resulted in the
 277:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   simplest of all:
 278:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 279:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   Believe it or not, the XOR is a standard TTL LS-series XOR: 74LS86
 280:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     Specifically: TI SN74LS86N from 1980 (the only XOR in my collection)
 281:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   It's spec'd to run from 4.5-5.5V, and its propagation delays and slew
 282:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     rates aren't really spec'd to be good enough for 128MHz pixel clock
 283:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     yet it's working...
 284:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   Further, the output voltages are right in the LVDS range,
 285:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     IIRC (last I 'scoped) around 1.5V High and 1.0V Low
 286:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      (Don't forget the LCD has a 100ohm resistor between
 287:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //         RXinN/clk+ and RXinN/clk-)
 288:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 289:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   It's probably best to use two XORs from the same chip for a single
 290:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    LVDS channel, since different chips may have slightly different
 291:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    characteristics. 
 292:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 293:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   The entire circuit, thus, requires TWO 74LS86's 
 294:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    (four XORs apiece, two per LVDS channel, 8-total)
 295:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 296:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 297:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              VCC3V3   VCC3V3
 298:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                |        |                           ______________
 299:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                +---\ \-_                        |  LCD (1 channel
 300:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                     | |    -                      |       of 4)
 301:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                     | | XOR   >------> RXinN/clk-  | ----.
 302:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   AVR, etc.         | |    _-                      |     |
 303:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   3.3V TTL >---+---/ /___-                        |     \ 100
 304:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   output       |                                   |     /
 305:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                |                                   |     \ ohms
 306:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                |                                   |     /
 307:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                `---\ \-_                        |     |
 308:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                     | |    -                      |     |
 309:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                     | | XOR   >------> RXinN/clk+  | ----'
 310:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                     | |    _-                      |
 311:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                +---/ /___-                        |
 312:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                |        |                          |
 313:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //               GND      GND
 314:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 315:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  
 316:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Also used: The TTL 74AHC series...
 317:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    I found some one-gang 74AHC1G32 and 74AHC1G86's on an old iBook
 318:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     motherboard. (An OR and an XOR, respectively). These are spec'd for
 319:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     3.3V operation, and faster. The output voltages appear OK for LVDS
 320:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     (with a 100ohm load in the LCD)
 321:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 322:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  NOTE: Since I only had enough of these 1-gang devices for two LVDS
 323:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     channels, I had to implement Red and Green with the LS 
 324:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     before switching all channels to the LS... Using different chips
 325:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     (specifically, different TYPES of chips) for different channels
 326:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     caused timing issues: Since the AHC is faster, the clock and Blue
 327:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     signals are synchronized, but the red and green signals were shifted
 328:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     a bit or two (resulting in "Black" appearing green)
 329:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 330:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  For other circuits attempted, see oldNotes.txt
 331:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     (and boy there were many, involving voltage dividers, AC coupling,
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 69


 332:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      reference voltages, BJT differential amplifiers... I doubt I 
 333:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      documented them all, or even most. Whoda thunk the simplest, 
 334:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      especially under- AND over-spec'd--timing, supply voltage, and
 335:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      output voltage--would be the one...?)
 336:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 337:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // LVDS/FPD-Link timing:
 338:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 339:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            |<--- (LCDdirectLVDS: "pixel") --->|
 340:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Timer1:   |<-- One Timer1 Cycle (OCR1C=6) -->|
 341:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  TCNT:     |  0   1    2    3    4    5    6  |  0   1    2    3    
 342:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            |____.____.____.____               |____.____.____.____
 343:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  RXclk+:   /         |         \    .    .    /         |         \ //
 344:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            |         |            |         |
 345:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // One Pixel: |         |<--- One FPD-Link Pixel Cycle --->|
 346:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            |                                  |
 347:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // "Blue/DVH" |____ ____v____ ____ ____v____ ____|____ ____
 348:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  RXin2:    X B3 X B2 X DE X /V X /H X B5 X B4 X B3 X B2 X ...
 349:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            | ^  ^ | 
 350:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            |         |<--Not Blue-->|         |
 351:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            |                                  |
 352:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // "Green"    |____ ____v____ ____v____ ____ ____|____ ____
 353:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  RXin1:    X G2 X G1 X B1 X B0 X G5 X G4 X G3 X G2 X G1 X ...
 354:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            | ^ ^  |  
 355:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            |         |<------->|-Not Green    |
 356:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 357:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // "Red"      |____ ____v____v____ ____ ____ ____|____ ____
 358:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  RXin0:    X R1 X R0 X G0 X R5 X R4 X R3 X R2 X R1 X R0 X ...
 359:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            | ^^     
 360:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            |         |<-->|-Not Red
 361:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 362:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   Of course: The "Not Green/Red" bits above are least-significant-bits
 363:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              and basically have little/no visible effect
 364:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 365:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 366:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Implementations/prospects:
 367:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  * rowBuffer.c (more like row-settings-buffer)
 368:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     calculate a row's worth of pixels before drawing that row
 369:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     (uses packed color settings in a single byte per drawable pixel)
 370:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     64 drawable pixels across, regardless of LVDS speed
 371:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  * For faster pixels: these settings values could be stored 
 372:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     in individual bytes. Gives about 1/3 more pixels at 3x the memory
 373:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     (not implemented)
 374:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  * rowSegBuffer.c
 375:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     also calculates an entire row before drawing it
 376:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     instead of storing pixels, store "segments"
 377:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     i.e. each segment is defined by a color value and a length
 378:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     Number of segments is limited only by memory...
 379:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      e.g. 64 segments per row (max) is 64*3Bytes
 380:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //       Three bytes for color, and *really simple* packing for seg-length
 381:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      BUT: at slow LVDS speeds, the resolution of these segments could be
 382:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //       as high as one LCD pixel.
 383:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      possibly: at *really* low LVDS speeds we could be 64*2Bytes
 384:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      (with packing)
 385:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      Actually: Using GB_COMBINED gives 2Bytes per segment
 386:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      only adds two clock cycles to each "pixel", so probably worth it
 387:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 388:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   In Any Case: There's not enough RAM for a full frame
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 70


 389:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          64 pixels across * 64 pixels down is 4096 bytes
 390:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          So whatever method, we need to precalculate each row before
 391:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          displaying it
 392:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          Could be as simple as loading direct from program memory
 393:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 394:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 395:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Since low-bits are barely visible, their effect is neglected.
 396:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 397:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 398:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DE/V/H Timing (LCDdirectLVDS):
 399:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  
 400:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 401:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            |  0   1    2    3    4    5    6       All: set @ 0
 402:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            |____.____.____.____                         OCR1C = 6 
 403:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Clock:    /                   \    .    .    /         Complementary-
 404:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                                             Output Mode
 405:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                                                          required for DT
 406:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   Signal:    B3   B2   DE   /V   /H   B5   B4 | B3
 407:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //             ____ ____ ____ ____ ____ ____ ____|____    
 408:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   DE:      X B3 X B2 /    .    .    \ B5 X B4 X B3 X    
 409:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   state2                      |    
 410:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   DE_BLUE: >|    DT=X, OCR=0
 411:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                         Watch the transition!! -------^
 412:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   DE_NORM: >_________/\_________|    DT=2, OCR=4
 413:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   DC_DISABLED:
 414:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   maxBlue: >\____|		DT=0, OCR=5
 415:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //             See below for more blue settings...
 416:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 417:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //             ____ ____      ____      ____ ____|____ 
 418:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  H (only): X xx X xx \    /    \    / xx X xx X xx X    
 419:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   state1              | 
 420:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            >______________/\______________|    DT=3, OCR=3
 421:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  DC_DISABLED:
 422:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   Not much can be done...
 423:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 424:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //             ____ ____           ____ ____ ____|____ 
 425:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  V w/o H:  X xx X xx \    .    /    \ xx X xx X xx X
 426:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   state3              |
 427:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            >___________________/\_________|    DT=4, OCR=4 (+?)
 428:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DC_DISABLED:
 429:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            >___________________/\____|		DT=4, OCR=5
 430:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 431:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //             ____ ____                ____ ____|____ 
 432:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  V w/ H:   X xx X xx \    .    .    / xx X xx X xx X
 433:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   state4          | 
 434:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            >__________________________________|    DT=X, OCR=0
 435:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                             TransitionWatch!!! -------^
 436:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                             Shouldn't matter... DT from no-edge
 437:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DC_DISABLED:
 438:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            >\________________________|		DT=0, OCR=1
 439:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 440:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //             ____ ____      ____ ____ ____ ____|____ 
 441:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Nada:     X xx X xx \    /    .    \ xx X xx X xx X    
 442:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   state0                  |     
 443:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            >______________/\_________|    DT=3, OCR=4 (+?)
 444:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DC_DISABLED:
 445:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //            >______________/\____|		DT=3, OCR=5
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 71


 446:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 447:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //So far this is the only case I've seen:
 448:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // /Vsync
 449:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #ifndef VSYNC_ACTIVE
 450:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define VSYNC_ACTIVE		0
 451:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
 452:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #ifndef VSYNC_INACTIVE
 453:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define VSYNC_INACTIVE	1
 454:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
 455:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // /Hsync
 456:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #ifndef HSYNC_ACTIVE
 457:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define HSYNC_ACTIVE		0
 458:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
 459:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #ifndef HSYNC_INACTIVE
 460:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define HSYNC_INACTIVE	1
 461:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
 462:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DE (active high)
 463:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #ifndef DE_ACTIVE
 464:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define DE_ACTIVE			1
 465:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
 466:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #ifndef DE_INACTIVE
 467:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define DE_INACTIVE		0
 468:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
 469:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 470:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // HERE!
 471:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 472:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 473:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 474:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 475:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Transitions: OLD!!!!! WRONG!!!!
 476:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   (are they? There're several additional transitions, now, for one.)
 477:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  The idea is to reduce the number of instructions between each
 478:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  LVDS "state."
 479:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  These are implemented below in the case:
 480:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    "#else //NOT FULL_INIT_TESTS"
 481:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Since each instruction takes *longer than* a single pixel
 482:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    two instructions would *at best* occur on two consecutive pixels
 483:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    Thus, there's likely to be a transition-glitch
 484:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    (e.g. old OCR value with new DT value)
 485:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Note that the new DT values are implemented at the next corresponding
 486:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    edge after the DT-write instruction completes
 487:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    (for +OC1A/DT1H, when TCNT is reset to 0)
 488:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    (for -OC1A/DT1L, when TCNT passes OCR1A)
 489:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    New OCR values are delayed until the next TCNT reset to 0
 490:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 491:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Initial:
 492:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Nada					DT=2  NADA_OCR = (3<=OCR<(=?)6)
 493:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 494:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Nada	->	H			OCR=2
 495:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  H		->	Nada		OCR=NADA_OCR
 496:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  
 497:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Nada	->	V			DT=3
 498:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  V		->	V+H		OCR=0
 499:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  V+H	->	V			OCR=NADA_OCR
 500:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  V		->	Nada		DT=2
 501:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 502:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Nada	->	DE			DT=1
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 72


 503:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  DE	->	Nada		DT=2
 504:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 505:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if 0
 506:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if (defined(REMOVE_DC) && REMOVE_DC)
 507:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define Nada_init()         { DT1=(3<<4); OCR1A=5; }
 508:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 509:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  //Unused, normally...
 510:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define Vsync_init()       { DT1=(4<<4);  OCR1A=5; }
 511:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define VplusH_init()      { DT1=0;       OCR1A=1; }
 512:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define Hsync_init()       { DT1=(3<<4);  OCR1A=3; }
 513:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define DEonly_init()      { DT1=(2<<4);  OCR1A=4; }
 514:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define DEblue_init()		 { DT1=0;       OCR1A=5; }
 515:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 516:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #else //!REMOVE_DC
 517:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //Nada init
 518:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define Nada_init()         { DT1=(3<<4); OCR1A=4; }
 519:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 520:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //Unused, normally...
 521:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define Vsync_init()			{ DT1=(4<<4);	OCR1A=4; }
 522:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define VplusH_init()		{ DT1=0;			OCR1A=0; }
 523:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define Hsync_init()			{ DT1=(3<<4);	OCR1A=3; }
 524:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // #define DE_init()				{ DT1=(2<<4);	OCR1A=4; } //...SHOULD BE
 525:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define DEonly_init()			{ DT1=(2<<4);  OCR1A=4; }
 526:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define DEblue_init()			{ DT1=0;       OCR1A=6; }
 527:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //#define DE_init()				{ DT1=(1<<4);	OCR1A=2; } //Works with DE_ONLY
 528:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  //#define DE_init()				{ DT1=0;			OCR1A=0xff; }	//DE_BLUE
 529:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif //REMOVE_DC
 530:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
 531:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 532:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //#define FULL_INIT_TESTS TRUE
 533:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 534:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //Display is DE-Only (doesn't use H/Vsync)
 535:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Shouldn't be necessary to select this if it is,
 536:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // since DE timing is the same either way
 537:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // but I want to test whether a single-bit is being detected
 538:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // (e.g. maybe the rise/fall-times of the output aren't fast enough for a
 539:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  single bit, which might explain why the other display didn't work)
 540:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //These are just examples... the project should define them:
 541:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if 0
 542:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if (defined(DE_ONLY_DISPLAY) && DE_ONLY_DISPLAY)
 543:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Vsync_fromNada()      Nada_init()
 544:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define VplusH_fromVsync()    Nada_init()
 545:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Vsync_fromVplusH()    Nada_init()
 546:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Nada_fromVsync()      Nada_init()
 547:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Hsync_fromNada()      Nada_init()
 548:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Nada_fromHsync()      Nada_init()
 549:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define DEonly_fromNada()     DE_init()
 550:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define DEblue_fromDEonly()	DE_init()
 551:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Nada_fromDEblue()		Nada_init()
 552:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #if(DE_BLUE)
 553:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #warning "DE_BLUE is true, but not implemented with DE_ONLY_DISPLAY"
 554:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #warning "...The display should be blank"
 555:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #endif
 556:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //Use full initialization of each LVDS state
 557:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // (might not be good during transitions, but should guarantee
 558:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  steady-state, in case my transitions aren't correct...)
 559:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif (defined(FULL_INIT_TESTS) && FULL_INIT_TESTS)
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 73


 560:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Vsync_fromNada()		Vsync_init()
 561:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define VplusH_fromVsync()		VplusH_init()
 562:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Vsync_fromVplusH()		Vsync_init()
 563:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Nada_fromVsync()		Nada_init()
 564:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Hsync_fromNada()		Hsync_init()
 565:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Nada_fromHsync()		Nada_init()
 566:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define DEonly_fromNada()		DEonly_init()
 567:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define DEblue_fromDEonly()	DEblue_init()
 568:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Nada_fromDEonly()		Nada_init()
 569:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Nada_fromDEblue()		Nada_init()
 570:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 571:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 572:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #else	//NOT FULL_INIT_TESTS
 573:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //#define Vsync_fromNada()   { DT1=(4<<4); }
 574:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Vsync_fromNada()   { DT1=(4<<4); OCR1A=5; } //Leave two bits high
 575:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 																	 //for easy-scoping
 576:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 						//Three would be nicer, but I'm pretty sure OCR=TOP=ON
 577:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define VplusH_fromVsync() { OCR1A=0; }
 578:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //#define Vsync_fromVplusH() { OCR1A=4; }
 579:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Vsync_fromVplusH() { OCR1A=5; }				//Extra bits for scoping
 580:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //#define Nada_fromVsync()   { DT1=(3<<4); }
 581:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Nada_fromVsync()   { DT1=(3<<4); OCR1A=4; } //scoping...
 582:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Hsync_fromNada()   { OCR1A=3; }
 583:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Nada_fromHsync()   { OCR1A=4; }
 584:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 585:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Nada_fromDEblue()	{ DT1=(3<<4); OCR1A=4; }
 586:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define Nada_fromDEonly()	{ DT1=(3<<4); }
 587:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define DEonly_fromNada()	{ DT1=(2<<4); }
 588:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define DEblue_fromNada()	{ OCR1A=0xff; }
 589:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define DEblue_fromDEonly() { OCR1A=0xff; }
 590:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 591:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif //End Of FULL_INIT_TESTS
 592:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
 593:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 594:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 595:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 596:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // The typical patterns look like this (not at all to scale):
 597:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   ----______------------------------------------------______-- V
 598:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //             ....
 599:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      --_--_--_--_--_--_--_--_--_--_--_--_--_--_--_--_--_--_--_--_ H
 600:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //             ....
 601:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      __________-__-__-__-__-__-__-__-__-__-__________________  DE
 602:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                 
 603:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //             ^^^^\														//blah
 604:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //             1234 5?
 605:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Pixels are sent during DE High (basically all the CPU will be used here)
 606:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //Ideally, 
 607:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  there won't be any glitches when changing from one state to another
 608:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 609:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Init (pre 1):
 610:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    DeadTimerRising=1
 611:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 612:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  The states are:
 613:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   (Not necessarily accurate, just looking into necessary changes)
 614:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   (from Vsync L->H)
 615:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 616:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   1  NothingActive (long, No DE, VporchFrontTimes)
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 74


 617:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 618:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   2  Hsync
 619:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 620:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   3  NothingActive (short)
 621:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 622:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   4  DE
 623:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 624:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   5  NothingActive(?)
 625:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 626:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   7  Repeat 2-5 for each row
 627:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 628:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   8  NothingActive (long, No DE, VporchBackTimes)
 629:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 630:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   9  V w/o H
 631:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 632:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   10 V w/  H
 633:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 634:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   11 Repeat 9-10 for Vsync time...
 635:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 636:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 637:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Here's how it worked pre-lvds:
 638:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // HSYNC, VSYNC, and DE refer to the actual pins
 639:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // In the LVDS setup, there're modes corresponding to each pin-combination
 640:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 641:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Timer Interrupt:
 642:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  loadData:
 643:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   HSYNC active
 644:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   HSYNC Low delay
 645:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   HSYNC inactive
 646:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   if(dataEnable)
 647:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    DE active
 648:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     Send row data
 649:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    DE inactive
 650:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  //Prep for next interrupt
 651:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  switch(hsyncCount++)
 652:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    //Vsync H->L (active)
 653:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    1:
 654:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          dataEnable=FALSE
 655:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          VSYNC active
 656:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    //Vsync L->H (inactive)
 657:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    T_Vlow:
 658:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          VSYNC inactive
 659:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    //Start of frame
 660:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    T_VD +(T_Vlow):
 661:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          dataEnable=TRUE
 662:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    //All rows have been displayed
 663:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    V_COUNT +(T_VD+T_Vlow):
 664:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          dataEnable=FALSE
 665:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    //Frame Complete
 666:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    T_DV +(V_COUNT+T_VD+T_Vlow): 
 667:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          hsyncCount=0
 668:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  if(dataEnable)
 669:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    Use the remaining time to load the next row to memory
 670:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 671:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  So:
 672:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //Interrupt0       End
 673:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    |             |  Interrupt1
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 75


 674:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    v             v  v
 675:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  H |_||_||_|
 676:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DE ___________________________________________________ ...
 677:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  V |_____________________________________ ...
 678:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //       |        ||
 679:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DETIME^--------^|
 680:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                 |
 681:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                 VSYNC active
 682:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                 dataEnable=FALSE (not necessary?)
 683:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 684:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //InterruptT_Vlow   End
 685:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    |             |
 686:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    v             v
 687:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  H |_||_||_|
 688:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DE ___________________________________________________ ...
 689:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  V _____________| ...
 690:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //       |        ||
 691:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DETIME^--------^|
 692:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                 |
 693:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                 VSYNC inactive
 694:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 695:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 696:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //InterruptT_VD   End  InterruptT_VD+1
 697:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    |             |  |            End
 698:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    v             v  v            v
 699:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  H |_||_||_|
 700:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DE ____________________||_______||____ ...
 701:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  V 
 702:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //       |        ||      |        |
 703:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DETIME^--------^|      ^--------^
 704:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                 |
 705:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                 dataEnable=TRUE
 706:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 707:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //InterruptV_COUNT  End
 708:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    |             |
 709:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    v             v
 710:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  H |_||_||_|
 711:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DE ___||______________________________________ ...
 712:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  V 
 713:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //       |        ||      |        |
 714:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DETIME^--------^|      ^--------^
 715:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                 |
 716:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                 dataEnable=FALSE
 717:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 718:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 719:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // This isn't really a state, it's basically just:
 720:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // if(hsyncCount == NUM_HYSYNCS_PER_FRAME)
 721:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    hsyncCount = 0;
 722:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                    .....................................
 723:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                    .                                   .
 724:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //InterruptT_DV   End .Interrupt0                         .
 725:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    |             | .|                                  .
 726:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    v             v .v                                  .
 727:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  H |_||_||_|
 728:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DE ___________________________________________________ .
 729:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  V |____________________ .
 730:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //       |        ||  .   |        |                      .
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 76


 731:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DETIME^--------^|  .   ^--------^                      .
 732:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                 |  .                                   .
 733:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                 hsyncCount=0 (repeat from Interrupt0)  .
 734:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                    .                                   .
 735:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                    .....................................
 736:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 737:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 738:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 739:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // THESE STATES ARE NO LONGER ACCURATE
 740:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // ESPECIALLY THIS FIRST STATE.
 741:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // V Front Porch originally (and in these drawings) occurred at the end
 742:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // of the frame...
 743:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // More logically, it now starts at the beginning of the frame
 744:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // (Also removing this initial "glitch" of a single interrupt with
 745:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  NothingActive)
 746:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 747:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // THESE STATES ARE NO LONGER ACCURATE (a/o 0.30, for certain)
 748:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // NOW to compare with LVDS states:
 749:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 750:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //Interrupt0       End
 751:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    |             |  Interrupt1
 752:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    v             v  v
 753:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  H |_||_||_|
 754:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DE ___________________________________________________ ...
 755:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  V |_____________________________________ ...
 756:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    ^ ^          ^   ^ ^
 757:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |          |   | |
 758:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |          |   | +--- V w/o H  \ These two toggle until
 759:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |          |   +----- V w/ H   / next LCD state...
 760:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |          |
 761:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |          +--------- V w/o H > Intermediate change of state
 762:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |
 763:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | +----- NothingActive  \ From Previous State (?)
 764:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    +------- H_Only         /
 765:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 766:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 767:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //InterruptT_Vlow   End
 768:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    |             |
 769:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    v             v
 770:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  H |_||_||_|
 771:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DE ___________________________________________________ ...
 772:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  V _____________| ...
 773:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    ^ ^          ^   ^ ^
 774:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |          |   | |
 775:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |          |   | +--- NothingActive  \ These two toggle until
 776:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |          |   +----- H_Only         / next LCD state...
 777:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |          |
 778:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |          +--------- NothingActive > Intermediate change of state
 779:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |
 780:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | +----- V w/o H   \ From previous state
 781:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    +------- V w/ H    /
 782:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 783:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 784:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //InterruptT_VD   End  InterruptT_VD+1
 785:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    |             |  |            End
 786:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    v             v  v            v
 787:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  H |_||_||_|
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 77


 788:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DE ____________________||_______||____ ...
 789:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  V 
 790:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    ^ ^              ^ ^^        ^ 
 791:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |              | ||        |
 792:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |              | ||        +--- NothingActive  \  These four
 793:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |              | |+------------ DE              | cycle until
 794:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |              | +------------- NothingActive   | next LCD state...
 795:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |              +--------------- H_Only  ^      /
 796:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |                                       |
 797:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | +----- NothingActive  \ From previous   |
 798:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    +------- H_Only         / state           +-This intermediate state
 799:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                                                may not be necessary
 800:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                                                (IAXG01 shows 160 dots!)
 801:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 802:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 803:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 804:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //InterruptV_COUNT  End
 805:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    |             |
 806:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    v             v
 807:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  H |_||_||_|
 808:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DE ___||______________________________________ ...
 809:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  V 
 810:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    ^ ^^        ^    ^ ^
 811:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | ||        |    | |
 812:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | ||        |    | +--- NothingActive \  These two toggle
 813:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | ||        |    +----- H_Only        /  until next LCD state
 814:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | ||        |
 815:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | ||        +---- NothingActive \ 								//blah
 816:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |+------------- DE             |  From previous state
 817:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | +-------------- NothingActive  |
 818:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    +---------------- H_Only        /
 819:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 820:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // This isn't really a state, it's essentially just:
 821:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  if(hsyncCount == NUM_HSYNCS_PER_FRAME)
 822:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    hsyncCount = 0;
 823:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                    .....................................
 824:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                    .                                   .
 825:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //InterruptT_DV   End .Interrupt0                         .
 826:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    |             | .|                                  .
 827:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    v             v .v                                  .
 828:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  H |_||_||_|
 829:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DE ___________________________________________________ .
 830:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  V |____________________ .
 831:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    ^ ^             .                                   .
 832:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | |             .....................................
 833:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    | +--- NothingActive \											//blah
 834:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    +----- H_Only        / From previous state...
 835:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 836:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 837:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 838:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  LVDS State transitions:
 839:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   1 H_Only
 840:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   2 NothingActive
 841:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 842:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   3 V w/o H
 843:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   4 V w/ H
 844:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 78


 845:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   (repeat 3,4)
 846:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 847:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   5 V w/o H
 848:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 849:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   6 NothingActive
 850:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   7 H_Only
 851:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 852:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   (repeat 6,7)
 853:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 854:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   8 NothingActive
 855:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 856:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   9 H_Only
 857:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  10 NothingActive
 858:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  11 DE
 859:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  12 NothingActive
 860:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 861:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  (repeat 9-12)
 862:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 863:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  13 H_Only
 864:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  14 NothingActive
 865:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 866:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  (repeat 13-14)
 867:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 868:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   These should be reviewed to determine which changes are necessary
 869:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   between each state...
 870:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   (the fewer changes, the less likely we'll glitch...?)
 871:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 872:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 873:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** void lcd_Init(void)
 874:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** {
 1034               		.stabn	68,0,874,.LM94-.LFBB9
 1035               	.LM94:
 1036               	.LFBB9:
 1037               	/* prologue: function */
 1038               	/* frame size = 0 */
 875:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  	Nada_init();
 1039               		.stabn	68,0,875,.LM95-.LFBB9
 1040               	.LM95:
 1041 041e 80E3      		ldi r24,lo8(48)
 1042 0420 84BD      		out 68-0x20,r24
 1043 0422 84E0      		ldi r24,lo8(4)
 1044 0424 8DBD      		out 77-0x20,r24
 1045               	/* epilogue start */
 876:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** }
 1046               		.stabn	68,0,876,.LM96-.LFBB9
 1047               	.LM96:
 1048 0426 0895      		ret
 1049               		.size	lcd_Init, .-lcd_Init
 1050               	.Lscope9:
 1051               		.stabs	"",36,0,0,.Lscope9-.LFBB9
 1052               		.stabd	78,0,0
 1053               		.stabs	"segClear:F(0,15)",36,0,47,segClear
 1054               	.global	segClear
 1055               		.type	segClear, @function
 1056               	segClear:
 1057               		.stabd	46,0,0
 1058               		.stabs	"rowSegBuffer.c",132,0,0,.Ltext10
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 79


 1059               	.Ltext10:
   1:rowSegBuffer.c **** #include "rowSegBuffer.h"
   2:rowSegBuffer.c **** 
   3:rowSegBuffer.c **** // Dunno why this was originally in main() upon init...
   4:rowSegBuffer.c **** // mighta just been a quick/early test:
   5:rowSegBuffer.c **** // But it might be a good starting-point to see how to use these functions
   6:rowSegBuffer.c **** // (for now)
   7:rowSegBuffer.c **** /*
   8:rowSegBuffer.c ****    segPosition=0;
   9:rowSegBuffer.c ****    newSeg(32, 0x06, (6<<4) | 3);
  10:rowSegBuffer.c ****    newSeg(16, 0x00, (4<<4) | 0);
  11:rowSegBuffer.c ****    newSeg(8, 0x06, (4<<4) | 0);
  12:rowSegBuffer.c ****    newSeg(32, 0x00, (4<<4) | 3);
  13:rowSegBuffer.c ****    newSeg(32, 0x06, (6<<4) | 3);
  14:rowSegBuffer.c ****    segTerminate();
  15:rowSegBuffer.c **** */
  16:rowSegBuffer.c **** 
  17:rowSegBuffer.c **** 
  18:rowSegBuffer.c **** 
  19:rowSegBuffer.c **** // Was thinking about loading the last segment as black, but that doesn't
  20:rowSegBuffer.c **** // work if the last segment isn't read, due to length=0...
  21:rowSegBuffer.c **** seg_t rowSegBuffer[NUM_SEGMENTS+1];/*=
  22:rowSegBuffer.c **** {
  23:rowSegBuffer.c **** 	{(4<<SEG_LENGTH_SHIFT) | 0x06, (6<<4) | 3},  //White
  24:rowSegBuffer.c ****    {(8<<SEG_LENGTH_SHIFT) | 0x00, (4<<4) | 0},  //Black
  25:rowSegBuffer.c **** 	{(16<<SEG_LENGTH_SHIFT)| 0x06, (4<<4) | 0},  //Red
  26:rowSegBuffer.c **** 	{(32<<SEG_LENGTH_SHIFT) | 0x06, (6<<4) | 3}, //White
  27:rowSegBuffer.c **** 	{0,(4<<4)}                                   //Terminate
  28:rowSegBuffer.c **** };
  29:rowSegBuffer.c **** */
  30:rowSegBuffer.c **** /*=
  31:rowSegBuffer.c **** {
  32:rowSegBuffer.c **** 	{0x10,4,6},
  33:rowSegBuffer.c **** 	{0x32,4,8},
  34:rowSegBuffer.c **** 	{0x03,5,2},
  35:rowSegBuffer.c **** 	{0x00,0,0}
  36:rowSegBuffer.c **** };
  37:rowSegBuffer.c **** */
  38:rowSegBuffer.c **** 
  39:rowSegBuffer.c **** 
  40:rowSegBuffer.c **** //Outside of rbpix_to_seg, this corresponds with the last-written segment
  41:rowSegBuffer.c **** uint8_t segPosition = 0;
  42:rowSegBuffer.c **** 
  43:rowSegBuffer.c **** 
  44:rowSegBuffer.c **** uint8_t newSeg(uint16_t length, uint8_t red, uint8_t green_blue);
  45:rowSegBuffer.c **** uint8_t stretchSeg(uint16_t additionalLength);
  46:rowSegBuffer.c **** 
  47:rowSegBuffer.c **** void segClear(void)
  48:rowSegBuffer.c **** {
 1060               		.stabn	68,0,48,.LM97-.LFBB10
 1061               	.LM97:
 1062               	.LFBB10:
 1063               	/* prologue: function */
 1064               	/* frame size = 0 */
  49:rowSegBuffer.c **** 	segPosition = 0;
 1065               		.stabn	68,0,49,.LM98-.LFBB10
 1066               	.LM98:
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 80


 1067 0428 1092 0000 		sts segPosition,__zero_reg__
  50:rowSegBuffer.c **** 	//The important part is the null-length
  51:rowSegBuffer.c **** 	// but let's load white just in case
  52:rowSegBuffer.c **** 	rowSegBuffer[segPosition].red_length = 6;
 1068               		.stabn	68,0,52,.LM99-.LFBB10
 1069               	.LM99:
 1070 042c 86E0      		ldi r24,lo8(6)
 1071 042e 8093 0000 		sts rowSegBuffer,r24
  53:rowSegBuffer.c **** 	rowSegBuffer[segPosition].green_blue = (6<<4) | 3;
 1072               		.stabn	68,0,53,.LM100-.LFBB10
 1073               	.LM100:
 1074 0432 83E6      		ldi r24,lo8(99)
 1075 0434 8093 0000 		sts rowSegBuffer+1,r24
 1076               	/* epilogue start */
  54:rowSegBuffer.c **** }
 1077               		.stabn	68,0,54,.LM101-.LFBB10
 1078               	.LM101:
 1079 0438 0895      		ret
 1080               		.size	segClear, .-segClear
 1081               	.Lscope10:
 1082               		.stabs	"",36,0,0,.Lscope10-.LFBB10
 1083               		.stabd	78,0,0
 1084               		.stabs	"segTerminate:F(0,15)",36,0,57,segTerminate
 1085               	.global	segTerminate
 1086               		.type	segTerminate, @function
 1087               	segTerminate:
 1088               		.stabd	46,0,0
  55:rowSegBuffer.c **** 
  56:rowSegBuffer.c **** 
  57:rowSegBuffer.c **** void segTerminate(void)
  58:rowSegBuffer.c **** {
 1089               		.stabn	68,0,58,.LM102-.LFBB11
 1090               	.LM102:
 1091               	.LFBB11:
 1092               	/* prologue: function */
 1093               	/* frame size = 0 */
  59:rowSegBuffer.c **** 
  60:rowSegBuffer.c **** 	//Add a new NULL-SEGMENT
  61:rowSegBuffer.c **** 	//This might appear as a stretched last pixel/segment...
  62:rowSegBuffer.c **** 	if((segPosition < NUM_SEGMENTS-1) 
 1094               		.stabn	68,0,62,.LM103-.LFBB11
 1095               	.LM103:
 1096 043a 8091 0000 		lds r24,segPosition
 1097 043e 8F35      		cpi r24,lo8(95)
 1098 0440 00F4      		brsh .L71
 1099 0442 E82F      		mov r30,r24
 1100 0444 F0E0      		ldi r31,lo8(0)
 1101 0446 EE0F      		lsl r30
 1102 0448 FF1F      		rol r31
 1103 044a E050      		subi r30,lo8(-(rowSegBuffer))
 1104 044c F040      		sbci r31,hi8(-(rowSegBuffer))
 1105 044e 9081      		ld r25,Z
 1106 0450 987F      		andi r25,lo8(-8)
 1107 0452 01F0      		breq .L73
  63:rowSegBuffer.c **** 		&& (rowSegBuffer[segPosition].red_length & SEG_LENGTH_MASK))
  64:rowSegBuffer.c **** 	{
  65:rowSegBuffer.c **** 		segPosition++;
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 81


 1108               		.stabn	68,0,65,.LM104-.LFBB11
 1109               	.LM104:
 1110 0454 8F5F      		subi r24,lo8(-(1))
 1111 0456 8093 0000 		sts segPosition,r24
  66:rowSegBuffer.c **** 
  67:rowSegBuffer.c **** 		rowSegBuffer[segPosition].red_length 
  68:rowSegBuffer.c **** 			= rowSegBuffer[segPosition-1].red_length & RED_MASK;
 1112               		.stabn	68,0,68,.LM105-.LFBB11
 1113               	.LM105:
 1114 045a A82F      		mov r26,r24
 1115 045c B0E0      		ldi r27,lo8(0)
  67:rowSegBuffer.c **** 		rowSegBuffer[segPosition].red_length 
 1116               		.stabn	68,0,67,.LM106-.LFBB11
 1117               	.LM106:
 1118 045e FD01      		movw r30,r26
 1119 0460 EE0F      		lsl r30
 1120 0462 FF1F      		rol r31
 1121 0464 E050      		subi r30,lo8(-(rowSegBuffer))
 1122 0466 F040      		sbci r31,hi8(-(rowSegBuffer))
 1123 0468 AA0F      		lsl r26
 1124 046a BB1F      		rol r27
 1125 046c A050      		subi r26,lo8(-(rowSegBuffer-2))
 1126 046e B040      		sbci r27,hi8(-(rowSegBuffer-2))
 1127 0470 8C91      		ld r24,X
 1128 0472 8770      		andi r24,lo8(7)
 1129 0474 8083      		st Z,r24
  69:rowSegBuffer.c **** 		rowSegBuffer[segPosition].green_blue
 1130               		.stabn	68,0,69,.LM107-.LFBB11
 1131               	.LM107:
 1132 0476 1196      		adiw r26,1
 1133 0478 8C91      		ld r24,X
 1134 047a 1197      		sbiw r26,1
 1135 047c 8183      		std Z+1,r24
  62:rowSegBuffer.c **** 	if((segPosition < NUM_SEGMENTS-1) 
 1136               		.stabn	68,0,62,.LM108-.LFBB11
 1137               	.LM108:
 1138 047e 0895      		ret
 1139               	.L71:
  70:rowSegBuffer.c **** 			= rowSegBuffer[segPosition-1].green_blue;
  71:rowSegBuffer.c **** 	}
  72:rowSegBuffer.c **** 	//We're already at the last segment, so we have to nullify it
  73:rowSegBuffer.c **** 	//This might terminate the last pixel early, but is necessary.
  74:rowSegBuffer.c **** 	else if(segPosition == NUM_SEGMENTS-1)
 1140               		.stabn	68,0,74,.LM109-.LFBB11
 1141               	.LM109:
 1142 0480 8F35      		cpi r24,lo8(95)
 1143 0482 01F4      		brne .L73
  75:rowSegBuffer.c **** 	{
  76:rowSegBuffer.c **** 		//Apparently white doesn't cause sync problems... so load it white
  77:rowSegBuffer.c **** 		rowSegBuffer[segPosition].red_length = fbRed_to_seg(_W);
 1144               		.stabn	68,0,77,.LM110-.LFBB11
 1145               	.LM110:
 1146 0484 87E0      		ldi r24,lo8(7)
 1147 0486 8093 0000 		sts rowSegBuffer+190,r24
  78:rowSegBuffer.c **** 		rowSegBuffer[segPosition].green_blue = 
 1148               		.stabn	68,0,78,.LM111-.LFBB11
 1149               	.LM111:
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 82


 1150 048a 83E7      		ldi r24,lo8(115)
 1151 048c 8093 0000 		sts rowSegBuffer+191,r24
 1152               	.L73:
 1153 0490 0895      		ret
 1154               		.size	segTerminate, .-segTerminate
 1155               	.Lscope11:
 1156               		.stabs	"",36,0,0,.Lscope11-.LFBB11
 1157               		.stabd	78,0,0
 1158               		.stabs	"newSeg:F(3,2)",36,0,218,newSeg
 1159               		.stabs	"length:P(3,4)",64,0,218,24
 1160               		.stabs	"red:P(3,2)",64,0,218,22
 1161               		.stabs	"green_blue:P(3,2)",64,0,218,20
 1162               	.global	newSeg
 1163               		.type	newSeg, @function
 1164               	newSeg:
 1165               		.stabd	46,0,0
  79:rowSegBuffer.c **** 										fbBlue_to_seg(_W) | fbGreen_to_seg(_W);
  80:rowSegBuffer.c **** 	}
  81:rowSegBuffer.c **** 
  82:rowSegBuffer.c **** 	//If we got here, it's already been terminated...
  83:rowSegBuffer.c **** 	//else...
  84:rowSegBuffer.c **** }
  85:rowSegBuffer.c **** 
  86:rowSegBuffer.c **** 
  87:rowSegBuffer.c **** //This is just an intermediate test, for now...
  88:rowSegBuffer.c **** // for reloading the rowbuffer to a seg-buffer.
  89:rowSegBuffer.c **** //This could easily be revised (and generalized) to be...
  90:rowSegBuffer.c **** // addSegment or addPixel
  91:rowSegBuffer.c **** void rbpix_to_seg(uint8_t rbValue, uint8_t col, uint8_t length)
  92:rowSegBuffer.c **** {
  93:rowSegBuffer.c **** 	static uint8_t last_rbValue = 0;
  94:rowSegBuffer.c **** 	//uint8_t length = 1;
  95:rowSegBuffer.c **** 
  96:rowSegBuffer.c **** 	if(col == 0)
  97:rowSegBuffer.c **** 	{
  98:rowSegBuffer.c **** 		last_rbValue = 0;
  99:rowSegBuffer.c **** 		segClear();
 100:rowSegBuffer.c **** 	}
 101:rowSegBuffer.c **** 	//Same color as last pixel...
 102:rowSegBuffer.c **** 	else if(segPosition && (rbValue == last_rbValue))
 103:rowSegBuffer.c **** 	{
 104:rowSegBuffer.c **** 		stretchSeg(length);
 105:rowSegBuffer.c **** 		return;
 106:rowSegBuffer.c **** 	}
 107:rowSegBuffer.c **** 
 108:rowSegBuffer.c **** 	uint8_t green = rbValue & 0x03;
 109:rowSegBuffer.c **** 	uint8_t red = (rbValue & 0x1C) >> 2;
 110:rowSegBuffer.c **** 	uint8_t blue = rbValue >> 5;
 111:rowSegBuffer.c **** 
 112:rowSegBuffer.c **** 	newSeg(length, red, (blue<<4) | green);
 113:rowSegBuffer.c **** 
 114:rowSegBuffer.c **** 	last_rbValue = rbValue;
 115:rowSegBuffer.c **** }
 116:rowSegBuffer.c **** 
 117:rowSegBuffer.c **** //Call this when we already know the color in the last segment is the same
 118:rowSegBuffer.c **** // so we wish to stretch the segment by additionalLength
 119:rowSegBuffer.c **** // these values are real-lengths, not as shifted for storage...
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 83


 120:rowSegBuffer.c **** // Return TRUE if the stretch was truncated...
 121:rowSegBuffer.c **** // THIS DOES NOT TEST DISPLAY_WIDTH!
 122:rowSegBuffer.c **** // DON'T FORGET to make additionalLength square before the call
 123:rowSegBuffer.c **** // if necesary....
 124:rowSegBuffer.c **** uint8_t stretchSeg(uint16_t additionalLength)
 125:rowSegBuffer.c **** {
 126:rowSegBuffer.c **** 		uint8_t oldLength=
 127:rowSegBuffer.c **** 			(rowSegBuffer[segPosition].red_length >> SEG_LENGTH_SHIFT);
 128:rowSegBuffer.c **** 
 129:rowSegBuffer.c **** 		if(!additionalLength)
 130:rowSegBuffer.c **** 			return FALSE;
 131:rowSegBuffer.c **** 
 132:rowSegBuffer.c **** 		//We can stretch the current segment
 133:rowSegBuffer.c **** 		if(oldLength < SEG_MAXLENGTH)
 134:rowSegBuffer.c **** 		{
 135:rowSegBuffer.c **** 			uint8_t maxStretch = SEG_MAXLENGTH - oldLength;
 136:rowSegBuffer.c **** 
 137:rowSegBuffer.c **** 			// Will the entire addition fit in the previous segment?
 138:rowSegBuffer.c **** 			if(additionalLength <= maxStretch)
 139:rowSegBuffer.c **** 			{
 140:rowSegBuffer.c **** 				rowSegBuffer[segPosition].red_length += 
 141:rowSegBuffer.c **** 					(additionalLength << SEG_LENGTH_SHIFT);
 142:rowSegBuffer.c **** 
 143:rowSegBuffer.c **** 				//Then we're done.
 144:rowSegBuffer.c **** 			//	additionalLength = 0;
 145:rowSegBuffer.c **** 			//	break;
 146:rowSegBuffer.c **** 				return FALSE;
 147:rowSegBuffer.c **** 			}
 148:rowSegBuffer.c **** 			// Nope... stretch it all the way, then later we'll make another
 149:rowSegBuffer.c **** 			else
 150:rowSegBuffer.c **** 			{
 151:rowSegBuffer.c **** 				uint8_t red = 
 152:rowSegBuffer.c **** 					rowSegBuffer[segPosition].red_length & RED_MASK;
 153:rowSegBuffer.c **** 
 154:rowSegBuffer.c **** 				rowSegBuffer[segPosition].red_length =
 155:rowSegBuffer.c **** 					red | (SEG_MAXLENGTH << SEG_LENGTH_SHIFT);
 156:rowSegBuffer.c **** 
 157:rowSegBuffer.c **** 				additionalLength -= maxStretch;
 158:rowSegBuffer.c **** 			}
 159:rowSegBuffer.c **** 		}
 160:rowSegBuffer.c **** 
 161:rowSegBuffer.c **** 		//The current segment has been stretched and there's more remaining
 162:rowSegBuffer.c **** 		// or it was already maxed-out...
 163:rowSegBuffer.c **** 
 164:rowSegBuffer.c **** 		// We shouldn't ever get here if additionalLength = 0...
 165:rowSegBuffer.c **** 
 166:rowSegBuffer.c **** 		//But we should test to make sure there's still lenth after
 167:rowSegBuffer.c **** 		// the stretch...
 168:rowSegBuffer.c **** 		if(additionalLength)
 169:rowSegBuffer.c **** 		{
 170:rowSegBuffer.c **** 			uint8_t red =
 171:rowSegBuffer.c **** 				rowSegBuffer[segPosition].red_length & RED_MASK;
 172:rowSegBuffer.c **** 
 173:rowSegBuffer.c **** 			uint8_t green_blue =
 174:rowSegBuffer.c **** 				rowSegBuffer[segPosition].green_blue;
 175:rowSegBuffer.c **** 
 176:rowSegBuffer.c **** 			uint8_t retVal;
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 84


 177:rowSegBuffer.c **** 
 178:rowSegBuffer.c **** 			//Create new segment(s) with the remaining length
 179:rowSegBuffer.c **** 			retVal = newSeg(additionalLength, red, green_blue);
 180:rowSegBuffer.c **** 
 181:rowSegBuffer.c **** 			//Then we're done...
 182:rowSegBuffer.c **** 			//additionalLength = 0;
 183:rowSegBuffer.c **** 			//break;
 184:rowSegBuffer.c **** 
 185:rowSegBuffer.c **** 			return retVal;
 186:rowSegBuffer.c **** 		}	
 187:rowSegBuffer.c **** 
 188:rowSegBuffer.c **** 		//We shouldn't ever get here...
 189:rowSegBuffer.c **** 		// Well, maybe... if additionalLength == maxStretch...?
 190:rowSegBuffer.c **** 		return FALSE;
 191:rowSegBuffer.c **** }
 192:rowSegBuffer.c **** 
 193:rowSegBuffer.c **** //This should be like newSeg, but also checks whether it can stretch
 194:rowSegBuffer.c **** // the last segment...
 195:rowSegBuffer.c **** uint8_t addSeg(uint16_t length, uint8_t red, uint8_t green_blue)
 196:rowSegBuffer.c **** {
 197:rowSegBuffer.c **** 
 198:rowSegBuffer.c **** 	//Currently not smart enough to stretch the first segment...
 199:rowSegBuffer.c **** 	if(segPosition == 0)
 200:rowSegBuffer.c **** 		return newSeg(length, red, green_blue);
 201:rowSegBuffer.c **** 
 202:rowSegBuffer.c **** 	//Can we stretch?
 203:rowSegBuffer.c **** 	if(((rowSegBuffer[segPosition].red_length & RED_MASK) == red)
 204:rowSegBuffer.c **** 		&& (rowSegBuffer[segPosition].green_blue == green_blue))
 205:rowSegBuffer.c **** 			return stretchSeg(length);
 206:rowSegBuffer.c **** 	else
 207:rowSegBuffer.c **** 		return newSeg(length, red, green_blue);
 208:rowSegBuffer.c **** 
 209:rowSegBuffer.c **** }
 210:rowSegBuffer.c **** 
 211:rowSegBuffer.c **** //This assumes you intend to create a new segment
 212:rowSegBuffer.c **** // it does *not* check whether the previous segment could be stretched
 213:rowSegBuffer.c **** // (it in fact, is called by stretchSeg as necessary)
 214:rowSegBuffer.c **** // Returns TRUE if it had to be truncated
 215:rowSegBuffer.c **** //  (out of segment memory, past the display edge...)
 216:rowSegBuffer.c **** // length is the real length, not shifted for storage...
 217:rowSegBuffer.c **** // THIS DOES NOT squarify, so adjust length as necessary before calling
 218:rowSegBuffer.c **** uint8_t newSeg(uint16_t length, uint8_t red, uint8_t green_blue)
 219:rowSegBuffer.c **** {
 1166               		.stabn	68,0,219,.LM112-.LFBB12
 1167               	.LM112:
 1168               	.LFBB12:
 1169               	/* prologue: function */
 1170               	/* frame size = 0 */
 1171               		.stabn	68,0,219,.LM113-.LFBB12
 1172               	.LM113:
 1173 0492 2091 0000 		lds r18,segPosition
 220:rowSegBuffer.c **** 
 221:rowSegBuffer.c **** 	//Recursion would be simpler, but we've got a limited stack.
 222:rowSegBuffer.c **** 	while(length >= SEG_MAXLENGTH)
 223:rowSegBuffer.c **** 	{
 224:rowSegBuffer.c **** 		// No more segments available...	
 225:rowSegBuffer.c **** 		// The last segment must have a length of 0
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 85


 226:rowSegBuffer.c **** 		if(segPosition == NUM_SEGMENTS-1)
 227:rowSegBuffer.c **** 		{
 228:rowSegBuffer.c **** 			segTerminate();
 229:rowSegBuffer.c **** 			return TRUE;
 230:rowSegBuffer.c **** 		}
 231:rowSegBuffer.c **** 
 232:rowSegBuffer.c **** 		// Not yet sure how to handle display-width...
 233:rowSegBuffer.c **** 		//if(segTotal > DISPLAY_WIDTH)
 234:rowSegBuffer.c **** 		//  at least draw as much of the segment as possible...
 235:rowSegBuffer.c **** 		//  then segTerminate();
 236:rowSegBuffer.c **** 		//  and return TRUE
 237:rowSegBuffer.c **** 
 238:rowSegBuffer.c **** 		// If we've gotten this far, then we can add the segment
 239:rowSegBuffer.c **** 	
 240:rowSegBuffer.c **** 		//Check if the segment buffer is cleared...
 241:rowSegBuffer.c **** 		// then DON'T increment segPosition...
 242:rowSegBuffer.c **** 		//if(!((segPosition == 0) && 
 243:rowSegBuffer.c **** 		//  !(rowSegBuffer[segPosition].red_length & SEG_LENGTH_MASK)))
 244:rowSegBuffer.c **** 		if(segPosition || 
 245:rowSegBuffer.c **** 			((rowSegBuffer[segPosition].red_length & SEG_LENGTH_MASK) != 0))
 246:rowSegBuffer.c **** 				segPosition++;
 247:rowSegBuffer.c **** 
 248:rowSegBuffer.c **** 
 249:rowSegBuffer.c **** 		//Create a maxlength segment
 250:rowSegBuffer.c **** 		rowSegBuffer[segPosition].red_length =
 1174               		.stabn	68,0,250,.LM114-.LFBB12
 1175               	.LM114:
 1176 0496 562F      		mov r21,r22
 1177 0498 586F      		ori r21,lo8(-8)
 222:rowSegBuffer.c **** 	while(length >= SEG_MAXLENGTH)
 1178               		.stabn	68,0,222,.LM115-.LFBB12
 1179               	.LM115:
 1180 049a 00C0      		rjmp .L75
 1181               	.L80:
 226:rowSegBuffer.c **** 		if(segPosition == NUM_SEGMENTS-1)
 1182               		.stabn	68,0,226,.LM116-.LFBB12
 1183               	.LM116:
 1184 049c 2F35      		cpi r18,lo8(95)
 1185 049e 01F4      		brne .L76
 1186 04a0 2093 0000 		sts segPosition,r18
 1187 04a4 00C0      		rjmp .L86
 1188               	.L76:
 244:rowSegBuffer.c **** 		if(segPosition || 
 1189               		.stabn	68,0,244,.LM117-.LFBB12
 1190               	.LM117:
 1191 04a6 2223      		tst r18
 1192 04a8 01F4      		brne .L78
 1193 04aa 3091 0000 		lds r19,rowSegBuffer
 1194 04ae 387F      		andi r19,lo8(-8)
 1195 04b0 01F0      		breq .L79
 1196               	.L78:
 246:rowSegBuffer.c **** 				segPosition++;
 1197               		.stabn	68,0,246,.LM118-.LFBB12
 1198               	.LM118:
 1199 04b2 2F5F      		subi r18,lo8(-(1))
 1200               	.L79:
 1201               		.stabn	68,0,250,.LM119-.LFBB12
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 86


 1202               	.LM119:
 1203 04b4 E22F      		mov r30,r18
 1204 04b6 F0E0      		ldi r31,lo8(0)
 1205 04b8 EE0F      		lsl r30
 1206 04ba FF1F      		rol r31
 1207 04bc E050      		subi r30,lo8(-(rowSegBuffer))
 1208 04be F040      		sbci r31,hi8(-(rowSegBuffer))
 1209 04c0 5083      		st Z,r21
 251:rowSegBuffer.c **** 			red | (SEG_MAXLENGTH<<SEG_LENGTH_SHIFT);
 252:rowSegBuffer.c **** 
 253:rowSegBuffer.c **** 		rowSegBuffer[segPosition].green_blue = green_blue;
 1210               		.stabn	68,0,253,.LM120-.LFBB12
 1211               	.LM120:
 1212 04c2 4183      		std Z+1,r20
 254:rowSegBuffer.c **** 
 255:rowSegBuffer.c **** 		length -= SEG_MAXLENGTH;
 1213               		.stabn	68,0,255,.LM121-.LFBB12
 1214               	.LM121:
 1215 04c4 4F97      		sbiw r24,31
 1216               	.L75:
 222:rowSegBuffer.c **** 	while(length >= SEG_MAXLENGTH)
 1217               		.stabn	68,0,222,.LM122-.LFBB12
 1218               	.LM122:
 1219 04c6 8F31      		cpi r24,31
 1220 04c8 9105      		cpc r25,__zero_reg__
 1221 04ca 00F4      		brsh .L80
 1222 04cc 2093 0000 		sts segPosition,r18
 256:rowSegBuffer.c **** 
 257:rowSegBuffer.c **** 	}
 258:rowSegBuffer.c **** 
 259:rowSegBuffer.c **** 	//We can fit whatever's left (or the whole thing) into a single segment
 260:rowSegBuffer.c **** 	// Unless, of course, there's nothing left...
 261:rowSegBuffer.c **** 	if(length > 0) //< SEG_MAXLENGTH)//Guaranteed now...
 1223               		.stabn	68,0,261,.LM123-.LFBB12
 1224               	.LM123:
 1225 04d0 0097      		sbiw r24,0
 1226 04d2 01F4      		brne .L81
 1227 04d4 80E0      		ldi r24,lo8(0)
 1228 04d6 0895      		ret
 1229               	.L81:
 262:rowSegBuffer.c **** 	{
 263:rowSegBuffer.c **** 		//Make sure there's another segment to write to!
 264:rowSegBuffer.c **** 		if(segPosition == NUM_SEGMENTS-1)
 1230               		.stabn	68,0,264,.LM124-.LFBB12
 1231               	.LM124:
 1232 04d8 2F35      		cpi r18,lo8(95)
 1233 04da 01F4      		brne .L82
 1234               	.L86:
 265:rowSegBuffer.c **** 		{
 266:rowSegBuffer.c **** 			segTerminate();
 1235               		.stabn	68,0,266,.LM125-.LFBB12
 1236               	.LM125:
 1237 04dc 00D0      		rcall segTerminate
 1238 04de 81E0      		ldi r24,lo8(1)
 267:rowSegBuffer.c **** 			return TRUE;
 1239               		.stabn	68,0,267,.LM126-.LFBB12
 1240               	.LM126:
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 87


 1241 04e0 0895      		ret
 1242               	.L82:
 268:rowSegBuffer.c **** 		}
 269:rowSegBuffer.c **** 
 270:rowSegBuffer.c **** 		//if(!((segPosition == 0) &&
 271:rowSegBuffer.c **** 		//  !(rowSegBuffer[segPosition].red_length & SEG_LENGTH_MASK)))
 272:rowSegBuffer.c **** 		if(segPosition || 
 1243               		.stabn	68,0,272,.LM127-.LFBB12
 1244               	.LM127:
 1245 04e2 2223      		tst r18
 1246 04e4 01F4      		brne .L83
 1247 04e6 3091 0000 		lds r19,rowSegBuffer
 1248 04ea 387F      		andi r19,lo8(-8)
 1249 04ec 01F0      		breq .L84
 1250               	.L83:
 273:rowSegBuffer.c **** 	     ((rowSegBuffer[segPosition].red_length & SEG_LENGTH_MASK) != 0))
 274:rowSegBuffer.c ****   				segPosition++;
 1251               		.stabn	68,0,274,.LM128-.LFBB12
 1252               	.LM128:
 1253 04ee 2F5F      		subi r18,lo8(-(1))
 1254 04f0 2093 0000 		sts segPosition,r18
 1255               	.L84:
 275:rowSegBuffer.c **** 
 276:rowSegBuffer.c **** 
 277:rowSegBuffer.c **** 		rowSegBuffer[segPosition].red_length = 
 1256               		.stabn	68,0,277,.LM129-.LFBB12
 1257               	.LM129:
 1258 04f4 E091 0000 		lds r30,segPosition
 1259 04f8 F0E0      		ldi r31,lo8(0)
 1260 04fa EE0F      		lsl r30
 1261 04fc FF1F      		rol r31
 1262 04fe E050      		subi r30,lo8(-(rowSegBuffer))
 1263 0500 F040      		sbci r31,hi8(-(rowSegBuffer))
 1264 0502 880F      		lsl r24
 1265 0504 880F      		lsl r24
 1266 0506 880F      		lsl r24
 1267 0508 862B      		or r24,r22
 1268 050a 8083      		st Z,r24
 278:rowSegBuffer.c **** 			red | (length<<SEG_LENGTH_SHIFT);
 279:rowSegBuffer.c **** 
 280:rowSegBuffer.c **** 		rowSegBuffer[segPosition].green_blue = green_blue;
 1269               		.stabn	68,0,280,.LM130-.LFBB12
 1270               	.LM130:
 1271 050c 4183      		std Z+1,r20
 1272 050e 80E0      		ldi r24,lo8(0)
 281:rowSegBuffer.c **** 	}
 282:rowSegBuffer.c **** 
 283:rowSegBuffer.c **** 	return FALSE;
 284:rowSegBuffer.c **** 
 285:rowSegBuffer.c **** }
 1273               		.stabn	68,0,285,.LM131-.LFBB12
 1274               	.LM131:
 1275 0510 0895      		ret
 1276               		.size	newSeg, .-newSeg
 1277               	.Lscope12:
 1278               		.stabs	"",36,0,0,.Lscope12-.LFBB12
 1279               		.stabd	78,0,0
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 88


 1280               		.stabs	"stretchSeg:F(3,2)",36,0,124,stretchSeg
 1281               		.stabs	"additionalLength:P(3,4)",64,0,124,24
 1282               	.global	stretchSeg
 1283               		.type	stretchSeg, @function
 1284               	stretchSeg:
 1285               		.stabd	46,0,0
 125:rowSegBuffer.c **** {
 1286               		.stabn	68,0,125,.LM132-.LFBB13
 1287               	.LM132:
 1288               	.LFBB13:
 1289               	/* prologue: function */
 1290               	/* frame size = 0 */
 127:rowSegBuffer.c **** 			(rowSegBuffer[segPosition].red_length >> SEG_LENGTH_SHIFT);
 1291               		.stabn	68,0,127,.LM133-.LFBB13
 1292               	.LM133:
 1293 0512 E091 0000 		lds r30,segPosition
 1294 0516 F0E0      		ldi r31,lo8(0)
 1295 0518 DF01      		movw r26,r30
 1296 051a AA0F      		lsl r26
 1297 051c BB1F      		rol r27
 1298 051e A050      		subi r26,lo8(-(rowSegBuffer))
 1299 0520 B040      		sbci r27,hi8(-(rowSegBuffer))
 1300 0522 2C91      		ld r18,X
 129:rowSegBuffer.c **** 		if(!additionalLength)
 1301               		.stabn	68,0,129,.LM134-.LFBB13
 1302               	.LM134:
 1303 0524 0097      		sbiw r24,0
 1304 0526 01F0      		breq .L88
 127:rowSegBuffer.c **** 			(rowSegBuffer[segPosition].red_length >> SEG_LENGTH_SHIFT);
 1305               		.stabn	68,0,127,.LM135-.LFBB13
 1306               	.LM135:
 1307 0528 422F      		mov r20,r18
 1308 052a 4695      		lsr r20
 1309 052c 4695      		lsr r20
 1310 052e 4695      		lsr r20
 133:rowSegBuffer.c **** 		if(oldLength < SEG_MAXLENGTH)
 1311               		.stabn	68,0,133,.LM136-.LFBB13
 1312               	.LM136:
 1313 0530 4F31      		cpi r20,lo8(31)
 1314 0532 00F4      		brsh .L89
 1315               	.LBB119:
 138:rowSegBuffer.c **** 			if(additionalLength <= maxStretch)
 1316               		.stabn	68,0,138,.LM137-.LFBB13
 1317               	.LM137:
 1318 0534 3FE1      		ldi r19,lo8(31)
 1319 0536 341B      		sub r19,r20
 1320 0538 432F      		mov r20,r19
 1321 053a 50E0      		ldi r21,lo8(0)
 1322 053c 4817      		cp r20,r24
 1323 053e 5907      		cpc r21,r25
 1324 0540 00F0      		brlo .L90
 140:rowSegBuffer.c **** 				rowSegBuffer[segPosition].red_length += 
 1325               		.stabn	68,0,140,.LM138-.LFBB13
 1326               	.LM138:
 1327 0542 880F      		lsl r24
 1328 0544 880F      		lsl r24
 1329 0546 880F      		lsl r24
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 89


 1330 0548 820F      		add r24,r18
 1331 054a 8C93      		st X,r24
 1332 054c 80E0      		ldi r24,lo8(0)
 146:rowSegBuffer.c **** 				return FALSE;
 1333               		.stabn	68,0,146,.LM139-.LFBB13
 1334               	.LM139:
 1335 054e 0895      		ret
 1336               	.L90:
 1337               	.LBB120:
 154:rowSegBuffer.c **** 				rowSegBuffer[segPosition].red_length =
 1338               		.stabn	68,0,154,.LM140-.LFBB13
 1339               	.LM140:
 1340 0550 286F      		ori r18,lo8(-8)
 1341 0552 2C93      		st X,r18
 157:rowSegBuffer.c **** 				additionalLength -= maxStretch;
 1342               		.stabn	68,0,157,.LM141-.LFBB13
 1343               	.LM141:
 1344 0554 841B      		sub r24,r20
 1345 0556 950B      		sbc r25,r21
 1346               	.LBE120:
 1347               	.LBE119:
 168:rowSegBuffer.c **** 		if(additionalLength)
 1348               		.stabn	68,0,168,.LM142-.LFBB13
 1349               	.LM142:
 1350 0558 01F0      		breq .L88
 1351               	.L89:
 1352               	.LBB121:
 179:rowSegBuffer.c **** 			retVal = newSeg(additionalLength, red, green_blue);
 1353               		.stabn	68,0,179,.LM143-.LFBB13
 1354               	.LM143:
 1355 055a EE0F      		lsl r30
 1356 055c FF1F      		rol r31
 1357 055e E050      		subi r30,lo8(-(rowSegBuffer))
 1358 0560 F040      		sbci r31,hi8(-(rowSegBuffer))
 1359 0562 6081      		ld r22,Z
 1360 0564 6770      		andi r22,lo8(7)
 1361 0566 4181      		ldd r20,Z+1
 1362 0568 00D0      		rcall newSeg
 185:rowSegBuffer.c **** 			return retVal;
 1363               		.stabn	68,0,185,.LM144-.LFBB13
 1364               	.LM144:
 1365 056a 0895      		ret
 1366               	.L88:
 1367 056c 80E0      		ldi r24,lo8(0)
 1368               	.LBE121:
 191:rowSegBuffer.c **** }
 1369               		.stabn	68,0,191,.LM145-.LFBB13
 1370               	.LM145:
 1371 056e 0895      		ret
 1372               		.size	stretchSeg, .-stretchSeg
 1373               		.stabs	"oldLength:r(3,2)",64,0,126,20
 1374               		.stabn	192,0,0,.LFBB13-.LFBB13
 1375               		.stabs	"retVal:r(3,2)",64,0,176,24
 1376               		.stabn	192,0,0,.LBB121-.LFBB13
 1377               		.stabn	224,0,0,.LBE121-.LFBB13
 1378               		.stabn	224,0,0,.Lscope13-.LFBB13
 1379               	.Lscope13:
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 90


 1380               		.stabs	"",36,0,0,.Lscope13-.LFBB13
 1381               		.stabd	78,0,0
 1382               		.stabs	"addSeg:F(3,2)",36,0,195,addSeg
 1383               		.stabs	"length:P(3,4)",64,0,195,24
 1384               		.stabs	"red:P(3,2)",64,0,195,22
 1385               		.stabs	"green_blue:P(3,2)",64,0,195,20
 1386               	.global	addSeg
 1387               		.type	addSeg, @function
 1388               	addSeg:
 1389               		.stabd	46,0,0
 196:rowSegBuffer.c **** {
 1390               		.stabn	68,0,196,.LM146-.LFBB14
 1391               	.LM146:
 1392               	.LFBB14:
 1393               	/* prologue: function */
 1394               	/* frame size = 0 */
 199:rowSegBuffer.c **** 	if(segPosition == 0)
 1395               		.stabn	68,0,199,.LM147-.LFBB14
 1396               	.LM147:
 1397 0570 E091 0000 		lds r30,segPosition
 1398 0574 EE23      		tst r30
 1399 0576 01F4      		brne .L94
 200:rowSegBuffer.c **** 		return newSeg(length, red, green_blue);
 1400               		.stabn	68,0,200,.LM148-.LFBB14
 1401               	.LM148:
 1402 0578 00D0      		rcall newSeg
 1403 057a 0895      		ret
 1404               	.L94:
 203:rowSegBuffer.c **** 	if(((rowSegBuffer[segPosition].red_length & RED_MASK) == red)
 1405               		.stabn	68,0,203,.LM149-.LFBB14
 1406               	.LM149:
 1407 057c F0E0      		ldi r31,lo8(0)
 1408 057e EE0F      		lsl r30
 1409 0580 FF1F      		rol r31
 1410 0582 E050      		subi r30,lo8(-(rowSegBuffer))
 1411 0584 F040      		sbci r31,hi8(-(rowSegBuffer))
 1412 0586 2081      		ld r18,Z
 1413 0588 30E0      		ldi r19,lo8(0)
 1414 058a 2770      		andi r18,lo8(7)
 1415 058c 3070      		andi r19,hi8(7)
 1416 058e A62F      		mov r26,r22
 1417 0590 B0E0      		ldi r27,lo8(0)
 1418 0592 2A17      		cp r18,r26
 1419 0594 3B07      		cpc r19,r27
 1420 0596 01F4      		brne .L96
 1421 0598 2181      		ldd r18,Z+1
 1422 059a 2417      		cp r18,r20
 1423 059c 01F4      		brne .L96
 205:rowSegBuffer.c **** 			return stretchSeg(length);
 1424               		.stabn	68,0,205,.LM150-.LFBB14
 1425               	.LM150:
 1426 059e 00D0      		rcall stretchSeg
 1427 05a0 0895      		ret
 1428               	.L96:
 207:rowSegBuffer.c **** 		return newSeg(length, red, green_blue);
 1429               		.stabn	68,0,207,.LM151-.LFBB14
 1430               	.LM151:
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 91


 1431 05a2 00D0      		rcall newSeg
 209:rowSegBuffer.c **** }
 1432               		.stabn	68,0,209,.LM152-.LFBB14
 1433               	.LM152:
 1434 05a4 0895      		ret
 1435               		.size	addSeg, .-addSeg
 1436               	.Lscope14:
 1437               		.stabs	"",36,0,0,.Lscope14-.LFBB14
 1438               		.stabd	78,0,0
 1439               		.stabs	"rbpix_to_seg:F(0,15)",36,0,91,rbpix_to_seg
 1440               		.stabs	"rbValue:P(3,2)",64,0,91,17
 1441               		.stabs	"col:P(3,2)",64,0,91,22
 1442               		.stabs	"length:P(3,2)",64,0,91,24
 1443               	.global	rbpix_to_seg
 1444               		.type	rbpix_to_seg, @function
 1445               	rbpix_to_seg:
 1446               		.stabd	46,0,0
  92:rowSegBuffer.c **** {
 1447               		.stabn	68,0,92,.LM153-.LFBB15
 1448               	.LM153:
 1449               	.LFBB15:
 1450 05a6 1F93      		push r17
 1451               	/* prologue: function */
 1452               	/* frame size = 0 */
 1453 05a8 182F      		mov r17,r24
 1454 05aa 842F      		mov r24,r20
  96:rowSegBuffer.c **** 	if(col == 0)
 1455               		.stabn	68,0,96,.LM154-.LFBB15
 1456               	.LM154:
 1457 05ac 6623      		tst r22
 1458 05ae 01F4      		brne .L99
  98:rowSegBuffer.c **** 		last_rbValue = 0;
 1459               		.stabn	68,0,98,.LM155-.LFBB15
 1460               	.LM155:
 1461 05b0 1092 0000 		sts last_rbValue.2283,__zero_reg__
 1462               	.LBB122:
 1463               	.LBB123:
  49:rowSegBuffer.c **** 	segPosition = 0;
 1464               		.stabn	68,0,49,.LM156-.LFBB15
 1465               	.LM156:
 1466 05b4 1092 0000 		sts segPosition,__zero_reg__
  52:rowSegBuffer.c **** 	rowSegBuffer[segPosition].red_length = 6;
 1467               		.stabn	68,0,52,.LM157-.LFBB15
 1468               	.LM157:
 1469 05b8 96E0      		ldi r25,lo8(6)
 1470 05ba 9093 0000 		sts rowSegBuffer,r25
  53:rowSegBuffer.c **** 	rowSegBuffer[segPosition].green_blue = (6<<4) | 3;
 1471               		.stabn	68,0,53,.LM158-.LFBB15
 1472               	.LM158:
 1473 05be 93E6      		ldi r25,lo8(99)
 1474 05c0 9093 0000 		sts rowSegBuffer+1,r25
 1475 05c4 00C0      		rjmp .L100
 1476               	.L99:
 1477               	.LBE123:
 1478               	.LBE122:
 102:rowSegBuffer.c **** 	else if(segPosition && (rbValue == last_rbValue))
 1479               		.stabn	68,0,102,.LM159-.LFBB15
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 92


 1480               	.LM159:
 1481 05c6 9091 0000 		lds r25,segPosition
 1482 05ca 9923      		tst r25
 1483 05cc 01F0      		breq .L100
 1484 05ce 9091 0000 		lds r25,last_rbValue.2283
 1485 05d2 1917      		cp r17,r25
 1486 05d4 01F4      		brne .L100
 104:rowSegBuffer.c **** 		stretchSeg(length);
 1487               		.stabn	68,0,104,.LM160-.LFBB15
 1488               	.LM160:
 1489 05d6 90E0      		ldi r25,lo8(0)
 1490 05d8 00D0      		rcall stretchSeg
 105:rowSegBuffer.c **** 		return;
 1491               		.stabn	68,0,105,.LM161-.LFBB15
 1492               	.LM161:
 1493 05da 00C0      		rjmp .L102
 1494               	.L100:
 112:rowSegBuffer.c **** 	newSeg(length, red, (blue<<4) | green);
 1495               		.stabn	68,0,112,.LM162-.LFBB15
 1496               	.LM162:
 1497 05dc 612F      		mov r22,r17
 1498 05de 70E0      		ldi r23,lo8(0)
 1499 05e0 6C71      		andi r22,lo8(28)
 1500 05e2 7070      		andi r23,hi8(28)
 1501 05e4 7595      		asr r23
 1502 05e6 6795      		ror r22
 1503 05e8 7595      		asr r23
 1504 05ea 6795      		ror r22
 1505 05ec 212F      		mov r18,r17
 1506 05ee 2295      		swap r18
 1507 05f0 2695      		lsr r18
 1508 05f2 2770      		andi r18,lo8(7)
 1509 05f4 2295      		swap r18
 1510 05f6 207F      		andi r18,lo8(-16)
 1511 05f8 912F      		mov r25,r17
 1512 05fa 9370      		andi r25,lo8(3)
 1513 05fc 292B      		or r18,r25
 1514 05fe 90E0      		ldi r25,lo8(0)
 1515 0600 422F      		mov r20,r18
 1516 0602 00D0      		rcall newSeg
 114:rowSegBuffer.c **** 	last_rbValue = rbValue;
 1517               		.stabn	68,0,114,.LM163-.LFBB15
 1518               	.LM163:
 1519 0604 1093 0000 		sts last_rbValue.2283,r17
 1520               	.L102:
 1521               	/* epilogue start */
 115:rowSegBuffer.c **** }
 1522               		.stabn	68,0,115,.LM164-.LFBB15
 1523               	.LM164:
 1524 0608 1F91      		pop r17
 1525 060a 0895      		ret
 1526               		.size	rbpix_to_seg, .-rbpix_to_seg
 1527               		.stabs	"last_rbValue:V(3,2)",38,0,93,last_rbValue.2283
 1528               		.stabn	192,0,0,.LFBB15-.LFBB15
 1529               		.stabn	224,0,0,.Lscope15-.LFBB15
 1530               	.Lscope15:
 1531               		.stabs	"",36,0,0,.Lscope15-.LFBB15
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 93


 1532               		.stabd	78,0,0
 1533               		.stabs	"rsb_drawPix:F(0,15)",36,0,535,rsb_drawPix
 1534               		.stabs	"rowNum:P(3,2)",64,0,535,24
 1535               	.global	rsb_drawPix
 1536               		.type	rsb_drawPix, @function
 1537               	rsb_drawPix:
 1538               		.stabd	46,0,0
 286:rowSegBuffer.c **** 
 287:rowSegBuffer.c **** 
 288:rowSegBuffer.c **** static __inline__ \
 289:rowSegBuffer.c **** void drawSegs(void) \
 290:rowSegBuffer.c **** 	__attribute__((__always_inline__));
 291:rowSegBuffer.c **** 
 292:rowSegBuffer.c **** 
 293:rowSegBuffer.c **** void drawSegs(void)
 294:rowSegBuffer.c **** {
 295:rowSegBuffer.c **** #warning "This might need to be modified such that DE is active *with* the first pixel... and compl
 296:rowSegBuffer.c **** 	//Declared volatile *just in case* I decide to use it after the asm...
 297:rowSegBuffer.c **** 	// (as modified by the asm)
 298:rowSegBuffer.c **** 	volatile uint8_t *byteptr = &(rowSegBuffer[0].red_length);
 299:rowSegBuffer.c **** 
 300:rowSegBuffer.c **** 	//These should only be used in the asm...
 301:rowSegBuffer.c **** 	// declaring them here, instead of using specific registers in asm
 302:rowSegBuffer.c **** 	// should help assure that those registers aren't clobbered
 303:rowSegBuffer.c **** 	// if used elsewhere
 304:rowSegBuffer.c **** 	//volatile uint8_t r=0, rl=0, g=0, b=0;
 305:rowSegBuffer.c **** 
 306:rowSegBuffer.c **** 	//uint8_t r, rl, g, b;
 307:rowSegBuffer.c **** 
 308:rowSegBuffer.c **** 	//Basic idea:
 309:rowSegBuffer.c **** 
 310:rowSegBuffer.c **** 	//do{
 311:rowSegBuffer.c **** 	//  red_length = rowSegBuffer[n].red_length;
 312:rowSegBuffer.c **** 	//  green      = rowSegBuffer[n].green;
 313:rowSegBuffer.c **** 	//  blue       = rowSegBuffer[n].blue;
 314:rowSegBuffer.c **** 	//  
 315:rowSegBuffer.c **** 	//  OCR1D = red_length&0x0f;
 316:rowSegBuffer.c **** 	//  DT1   = green;
 317:rowSegBuffer.c **** 	//  OCR1A = blue;
 318:rowSegBuffer.c **** 	//
 319:rowSegBuffer.c **** 	//  red_length &= 0xf0;
 320:rowSegBuffer.c **** 	//  if(!red_length)
 321:rowSegBuffer.c **** 	//     break;
 322:rowSegBuffer.c **** 	//
 323:rowSegBuffer.c **** 	//  while(red_length)
 324:rowSegBuffer.c **** 	//		red_length -= 0x10;
 325:rowSegBuffer.c **** 	// } while(1);
 326:rowSegBuffer.c **** 
 327:rowSegBuffer.c **** 	//This looks like it should work...
 328:rowSegBuffer.c **** 	// but there are some oddities
 329:rowSegBuffer.c **** 	// in this case, registers are loaded such that andi can't be used
 330:rowSegBuffer.c **** 	// but and can... thus it's a few instructions larger...
 331:rowSegBuffer.c **** 	/*
 332:rowSegBuffer.c **** 	do
 333:rowSegBuffer.c **** 	{
 334:rowSegBuffer.c **** 		rl = *(byteptr++);
 335:rowSegBuffer.c **** 		r = rl;
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 94


 336:rowSegBuffer.c **** 		r &= 0x0f;
 337:rowSegBuffer.c **** 		g = *(byteptr++);
 338:rowSegBuffer.c **** 		b = *(byteptr++);
 339:rowSegBuffer.c **** 
 340:rowSegBuffer.c **** 		//just testing pushes and pops...
 341:rowSegBuffer.c **** 		// apparently the optimizer realizes which registers are in use
 342:rowSegBuffer.c **** 		// in the (only) call to drawSegs() and doesn't bother to push the
 343:rowSegBuffer.c **** 		// the rest...
 344:rowSegBuffer.c **** //		drawSegs();
 345:rowSegBuffer.c **** 		OCR1D = r;
 346:rowSegBuffer.c **** 		DT1 = g;
 347:rowSegBuffer.c **** 		OCR1A = b;
 348:rowSegBuffer.c **** 
 349:rowSegBuffer.c **** 		rl &= 0xf0;
 350:rowSegBuffer.c **** 
 351:rowSegBuffer.c **** 		if(!rl)
 352:rowSegBuffer.c **** 			break;
 353:rowSegBuffer.c **** 
 354:rowSegBuffer.c **** 		while(rl)
 355:rowSegBuffer.c **** 			rl -= 0x10;
 356:rowSegBuffer.c **** 	} while(1);
 357:rowSegBuffer.c **** */
 358:rowSegBuffer.c **** 
 359:rowSegBuffer.c **** 	//LoadNext:
 360:rowSegBuffer.c **** 	//  ld   Rredlength, Z+	(Red|length)								2
 361:rowSegBuffer.c **** 	//  ld   Rgreen, Z+	(Green)											2
 362:rowSegBuffer.c **** 	//  ld   Rblue, Z+	(Blue)											2
 363:rowSegBuffer.c **** 	//	 mov  Rred, Rredlength												1
 364:rowSegBuffer.c **** 	//  andi Rred, 0x0f				//Remove length from Rred		1
 365:rowSegBuffer.c **** 	//  out  OCR1D, Rred														1
 366:rowSegBuffer.c **** 	//  out  DT1, Rgreen														1
 367:rowSegBuffer.c **** 	//  out  OCR1A, Rblue													1
 368:rowSegBuffer.c **** 
 369:rowSegBuffer.c **** 	//  andi Rredlength, 0xf0		//Remove red from length		1
 370:rowSegBuffer.c **** 	//  breq Done						// if length==0, we're done	1 2
 371:rowSegBuffer.c **** 
 372:rowSegBuffer.c **** 	//Counter:
 373:rowSegBuffer.c **** 	//  subi Rlength, 0x10			//Subtract 0x10 each time...	1
 374:rowSegBuffer.c **** 	//  breq LoadNext					// if length==0, next segment	1 2
 375:rowSegBuffer.c **** 	//  rjmp Counter					// else, next counter loop    2
 376:rowSegBuffer.c **** 
 377:rowSegBuffer.c **** 	//Done:
 378:rowSegBuffer.c **** 
 379:rowSegBuffer.c **** 	// Thus, minimum inter-pixel time is 16 clock cycles
 380:rowSegBuffer.c **** 	// (14 for the last one)
 381:rowSegBuffer.c **** 	// This cannot be reuced by using a separate byte for red and length
 382:rowSegBuffer.c **** 	// because the mov and andi in LoadNext would be replaced by a ld
 383:rowSegBuffer.c **** 
 384:rowSegBuffer.c **** 	// To make the counter take longer between each count,
 385:rowSegBuffer.c **** 	// decrement it by a smaller number...
 386:rowSegBuffer.c **** 
 387:rowSegBuffer.c **** //	drawSegs();
 388:rowSegBuffer.c **** /*
 389:rowSegBuffer.c **** __asm__ __volatile__
 390:rowSegBuffer.c **** 	(
 391:rowSegBuffer.c **** 	"LoadNext_%=: \n\t"
 392:rowSegBuffer.c **** 	 	"ld %1, %a0+ ; \n\t"		//%a1 refers to XYZ whichever is selected
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 95


 393:rowSegBuffer.c **** 		"mov %2, %1 ; \n\t"		// Load R (+length)
 394:rowSegBuffer.c **** 		"andi %2, 0x0f ; \n\t"	//Remove length from Rred
 395:rowSegBuffer.c **** 		"ld %3, %a0+ ; \n\t"		//Load G	
 396:rowSegBuffer.c **** 		"ld %4, %a0+ ; \n\t"		//Load B
 397:rowSegBuffer.c **** 		"out %5, %2 ; \n\t"	// Write OCR1D (Red)
 398:rowSegBuffer.c **** 		"out %6, %3 ; \n\t"		// Write DT1 (Green)
 399:rowSegBuffer.c **** 		"out %7, %4 ; \n\t"	// Write OCR1A (Blue)
 400:rowSegBuffer.c **** 
 401:rowSegBuffer.c **** 		"andi %1, 0xf0 ; \n\t"	// Remove red from length
 402:rowSegBuffer.c **** 		"breq Done_%= ; \n\t"		// if length==0 from the start, we're done
 403:rowSegBuffer.c **** 
 404:rowSegBuffer.c **** 	"Counter_%=: \n\t"
 405:rowSegBuffer.c **** 		"subi %1, 0x10 ; \n\t"	//Decrement the counter by 0x10
 406:rowSegBuffer.c **** 		"breq LoadNext_%= ; \n\t"	// if we've decremented to 0, next segment
 407:rowSegBuffer.c **** 
 408:rowSegBuffer.c **** 	"Done_%=: \n\t"
 409:rowSegBuffer.c **** 		:								//No output register...
 410:rowSegBuffer.c **** 		: "e" (byteptr),			//byteptr: %0, r/w and assigned to X,Y,orZ
 411:rowSegBuffer.c **** 		  "d"  (rl),				//rl: %1, andi and subi will be used
 412:rowSegBuffer.c **** 		  "d"  (r),					//r: %2, andi will be used
 413:rowSegBuffer.c **** 		  "r"  (g),					//g: %3
 414:rowSegBuffer.c **** 		  "r"  (b),					//b: %4
 415:rowSegBuffer.c **** 		  "I"  (_SFR_IO_ADDR(OCR1D)), //OCR1D: %5
 416:rowSegBuffer.c **** 		  "I"  (_SFR_IO_ADDR(DT1)),	//DT1: %6
 417:rowSegBuffer.c **** 		  "I"  (_SFR_IO_ADDR(OCR1A))	//OCR1A %7
 418:rowSegBuffer.c **** 	);
 419:rowSegBuffer.c **** */
 420:rowSegBuffer.c **** 
 421:rowSegBuffer.c **** __asm__ __volatile__
 422:rowSegBuffer.c ****    (
 423:rowSegBuffer.c ****    "LoadNext_%=: \n\t"
 424:rowSegBuffer.c ****       "ld r20, %a0+ ; \n\t"    //%a0 refers to XYZ whichever is selected
 425:rowSegBuffer.c ****       "mov r21, r20 ; \n\t"     // Load R (+length)
 426:rowSegBuffer.c **** //      "andi r21, 0x0f ; \n\t"  //Remove length from Rred
 427:rowSegBuffer.c **** 		"andi r21, %5 ; \n\t"
 428:rowSegBuffer.c ****       "ld r22, %a0+ ; \n\t"    //Load G 
 429:rowSegBuffer.c **** #if (defined(GB_COMBINED) && GB_COMBINED)
 430:rowSegBuffer.c **** 		"mov r23, r22 ; \n\t"	 //copy G(+B) to B
 431:rowSegBuffer.c **** 		"andi r22, 0x0f ; \n\t"	 // strip B from G
 432:rowSegBuffer.c **** 		"swap r23 ; \n\t"			 // swap B and G nibbles in B
 433:rowSegBuffer.c **** 		"andi r23, 0x0f \n\t"	 // strip G from B
 434:rowSegBuffer.c **** #else
 435:rowSegBuffer.c **** 		"ld r23, %a0+ ; \n\t"    //Load B
 436:rowSegBuffer.c **** #endif
 437:rowSegBuffer.c **** 		"out %1, r21 ; \n\t"  // Write OCR1D (Red)
 438:rowSegBuffer.c ****       "out %2, r22 ; \n\t"     // Write DT1 (Green)
 439:rowSegBuffer.c ****       "out %3, r23 ; \n\t"  // Write OCR1A (Blue)
 440:rowSegBuffer.c **** 
 441:rowSegBuffer.c **** //      "andi r20, 0xf0 ; \n\t"  // Remove red from length
 442:rowSegBuffer.c ****       "andi r20, %4 ; \n\t"
 443:rowSegBuffer.c **** 		"breq Done_%= ; \n\t"      // if length==0 from the start, we're done
 444:rowSegBuffer.c **** #if (defined(GB_COMBINED) && GB_COMBINED)
 445:rowSegBuffer.c **** #warning "This probably isn't necessary anymore..."
 446:rowSegBuffer.c **** 		// What was it for? Maybe because I was thinking about
 447:rowSegBuffer.c **** 		// using a smaller count-increment (for non-square pixels?)
 448:rowSegBuffer.c **** 		// than the minimum count step (given shifting)?
 449:rowSegBuffer.c **** 		// e.g. if the count is stored in the upper 4 bits, then the
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 96


 450:rowSegBuffer.c **** 		//  smallest count step would be 0x10 (1 count)
 451:rowSegBuffer.c **** 		//  I think the divisible-by-four aspect, below, was due to my
 452:rowSegBuffer.c **** 		//  possibly wanting to set the counter to count by 0x04 instead of 
 453:rowSegBuffer.c **** 		//  0x10... then each count-step would result in 4 counts
 454:rowSegBuffer.c **** 		//  this could avoid all those nops below... (but now it makes less
 455:rowSegBuffer.c **** 		//  sense for non-square pixels)
 456:rowSegBuffer.c **** 		// I don't remember if the above is why I added these two nops...
 457:rowSegBuffer.c **** 
 458:rowSegBuffer.c **** 		//Bump it to a round-number for counting...
 459:rowSegBuffer.c **** 		// 18 cyc -> 20 cyc... 20 is divisible by 4
 460:rowSegBuffer.c **** 		"nop ; \n\t"
 461:rowSegBuffer.c **** 		"nop ; \n\t"
 462:rowSegBuffer.c **** #endif
 463:rowSegBuffer.c **** 
 464:rowSegBuffer.c ****    "Counter_%=: \n\t"
 465:rowSegBuffer.c ****       "subi r20, %6 ; \n\t"  //Decrement the counter by 0x10...
 466:rowSegBuffer.c ****       "breq LoadNext_%= ; \n\t"  // if we've decremented to 0, next segment
 467:rowSegBuffer.c **** #if (defined(SQUARE_SEGMENTS) && SQUARE_SEGMENTS)
 468:rowSegBuffer.c **** 		//Match a single-pixel-width...
 469:rowSegBuffer.c **** 		//(18cyc w/o GB_COMBINED)
 470:rowSegBuffer.c ****  #if (defined(GB_COMBINED) && GB_COMBINED)
 471:rowSegBuffer.c **** 		"nop ; \n\t"
 472:rowSegBuffer.c **** 		"nop ; \n\t"
 473:rowSegBuffer.c ****  #endif
 474:rowSegBuffer.c **** 		"nop ; \n\t"		// if length = 0x10 this will be avoided
 475:rowSegBuffer.c **** 		"nop ; \n\t"		// for each step of 0x10 > 0x10
 476:rowSegBuffer.c **** 		"nop ; \n\t"		//   this will match a pixel-width
 477:rowSegBuffer.c **** 		"nop ; \n\t"
 478:rowSegBuffer.c **** 		"nop ; \n\t"
 479:rowSegBuffer.c **** 		"nop ; \n\t"
 480:rowSegBuffer.c **** 		"nop ; \n\t"
 481:rowSegBuffer.c **** 		"nop ; \n\t"
 482:rowSegBuffer.c **** 		"nop ; \n\t"
 483:rowSegBuffer.c **** 		"nop ; \n\t"
 484:rowSegBuffer.c **** 		"nop ; \n\t"
 485:rowSegBuffer.c **** 		"nop ; \n\t"
 486:rowSegBuffer.c **** 		"nop ; \n\t"
 487:rowSegBuffer.c **** 		"nop ; \n\t"
 488:rowSegBuffer.c **** #endif
 489:rowSegBuffer.c **** 		"rjmp Counter_%= ; \n\t"
 490:rowSegBuffer.c **** 
 491:rowSegBuffer.c ****    "Done_%=: \n\t"
 492:rowSegBuffer.c ****       :                       //No output register...
 493:rowSegBuffer.c **** 		// Input values and registers...
 494:rowSegBuffer.c **** 		// Their values are set-up by C and the preprocessor 
 495:rowSegBuffer.c **** 		// before entering the asm function
 496:rowSegBuffer.c **** 		// Only byteptr is actually in a register, and its value is changed
 497:rowSegBuffer.c **** 		//  in this asm function (incremented with each use)
 498:rowSegBuffer.c **** 		//  I'm still not wrapping my head around the whole read/write vs.
 499:rowSegBuffer.c **** 		//  input/output options here... clearly the asm is writing to
 500:rowSegBuffer.c **** 		//  byteptr, so maybe it should be in the clobber list?
 501:rowSegBuffer.c **** 		//  or maybe by putting it here (only), it would be automatically
 502:rowSegBuffer.c **** 		//  assumed to be clobbered, if it were used after the asm function?
 503:rowSegBuffer.c **** 		//  It shouldn't matter, here anyways, since it's not used after.
 504:rowSegBuffer.c **** 		//  Though, if it were to be, we'd probably need to specify somehow
 505:rowSegBuffer.c **** 		//  whether we want to reuse the variable name "byteptr" after this
 506:rowSegBuffer.c **** 		//  to refer to the value set up before this, or to the value this
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 97


 507:rowSegBuffer.c **** 		//  will write to it... It's all very confusing.
 508:rowSegBuffer.c ****       : "e" (byteptr),        //byteptr: %0, r/w and assigned to X,Y,orZ
 509:rowSegBuffer.c ****         "I"  (_SFR_IO_ADDR(OCR1D)), //OCR1D: %1
 510:rowSegBuffer.c ****         "I"  (_SFR_IO_ADDR(DT1)),   //DT1: %2
 511:rowSegBuffer.c ****         "I"  (_SFR_IO_ADDR(OCR1A)), //OCR1A %3
 512:rowSegBuffer.c **** 		  "M"  (SEG_LENGTH_MASK),		//%4
 513:rowSegBuffer.c **** 		  "M"  (RED_MASK),				//%5 RED_MASK....
 514:rowSegBuffer.c **** 		  "M"  (SEG_COUNT_1)				//%6
 515:rowSegBuffer.c **** 		//Indicate (to C) which registers are going to be clobbered
 516:rowSegBuffer.c **** 		// these registers are only used internal to the asm function
 517:rowSegBuffer.c **** 		// their values are unused on entry and exit.
 518:rowSegBuffer.c **** 		// Having them listed here should tell C to either not use them
 519:rowSegBuffer.c **** 		// outside of here, or to push and pop them around this... right?
 520:rowSegBuffer.c **** 	  : "r20", //rl
 521:rowSegBuffer.c **** 		  "r21",	//r
 522:rowSegBuffer.c **** 		  "r22",	//g
 523:rowSegBuffer.c ****         "r23"	//b
 524:rowSegBuffer.c ****    );
 525:rowSegBuffer.c **** 
 526:rowSegBuffer.c **** 
 527:rowSegBuffer.c **** //	rl++;
 528:rowSegBuffer.c **** 
 529:rowSegBuffer.c **** }
 530:rowSegBuffer.c **** 
 531:rowSegBuffer.c **** 
 532:rowSegBuffer.c **** //Note that rowNum is not used, AND it's a uint8_t! There's some note about
 533:rowSegBuffer.c **** // this in lcdStuff.c, now. Not particularly helpful, but gives enough
 534:rowSegBuffer.c **** // history I might be able to piece this stuff together and clean it up.
 535:rowSegBuffer.c **** void rsb_drawPix(uint8_t rowNum)
 536:rowSegBuffer.c **** {
 1539               		.stabn	68,0,536,.LM165-.LFBB16
 1540               	.LM165:
 1541               	.LFBB16:
 1542               	/* prologue: function */
 1543               	/* frame size = 0 */
 537:rowSegBuffer.c ****    //a/o v59-12ish: WTF, no comment about this?!
 538:rowSegBuffer.c ****    // I believe this is to enable Green's output
 539:rowSegBuffer.c ****    // which was disabled prior because...?
 540:rowSegBuffer.c ****    TCCR1A = ( (0<<COM1A1) | (1<<COM1A0)
 1544               		.stabn	68,0,540,.LM166-.LFBB16
 1545               	.LM166:
 1546 060c 83E5      		ldi r24,lo8(83)
 1547 060e 80BF      		out 80-0x20,r24
 1548               	.LBB124:
 1549               	.LBB125:
 421:rowSegBuffer.c **** __asm__ __volatile__
 1550               		.stabn	68,0,421,.LM167-.LFBB16
 1551               	.LM167:
 1552 0610 E0E0      		ldi r30,lo8(rowSegBuffer)
 1553 0612 F0E0      		ldi r31,hi8(rowSegBuffer)
 1554               	/* #APP */
 1555               	 ;  421 "rowSegBuffer.c" 1
 1556               		LoadNext_921: 
 1557 0614 4191      		ld r20, Z+ ; 
 1558 0616 542F      		mov r21, r20 ; 
 1559 0618 5770      		andi r21, 7 ; 
 1560 061a 6191      		ld r22, Z+ ; 
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 98


 1561 061c 762F      		mov r23, r22 ; 
 1562 061e 6F70      		andi r22, 0x0f ; 
 1563 0620 7295      		swap r23 ; 
 1564 0622 7F70      		andi r23, 0x0f 
 1565 0624 5ABD      		out 42, r21 ; 
 1566 0626 64BD      		out 36, r22 ; 
 1567 0628 7DBD      		out 45, r23 ; 
 1568 062a 487F      		andi r20, 248 ; 
 1569 062c 01F0      		breq Done_921 ; 
 1570 062e 0000      		nop ; 
 1571 0630 0000      		nop ; 
 1572               		Counter_921: 
 1573 0632 4850      		subi r20, 8 ; 
 1574 0634 01F0      		breq LoadNext_921 ; 
 1575 0636 0000      		nop ; 
 1576 0638 0000      		nop ; 
 1577 063a 0000      		nop ; 
 1578 063c 0000      		nop ; 
 1579 063e 0000      		nop ; 
 1580 0640 0000      		nop ; 
 1581 0642 0000      		nop ; 
 1582 0644 0000      		nop ; 
 1583 0646 0000      		nop ; 
 1584 0648 0000      		nop ; 
 1585 064a 0000      		nop ; 
 1586 064c 0000      		nop ; 
 1587 064e 0000      		nop ; 
 1588 0650 0000      		nop ; 
 1589 0652 0000      		nop ; 
 1590 0654 0000      		nop ; 
 1591 0656 00C0      		rjmp Counter_921 ; 
 1592               		Done_921: 
 1593               		
 1594               	 ;  0 "" 2
 1595               	/* #NOAPP */
 1596               	.LBE125:
 1597               	.LBE124:
 1598               	.LBB126:
 1599               	.LBB127:
 1600               	.LBB128:
 1601               	.LBB129:
 1602               		.stabs	"/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h",132,0,0,.Ltext11
 1603               	.Ltext11:
 1604               		.stabn	68,0,105,.LM168-.LFBB16
 1605               	.LM168:
 1606 0658 80E8      		ldi r24,lo8(128)
 1607 065a 90E0      		ldi r25,hi8(128)
 1608               	/* #APP */
 1609               	 ;  105 "/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h" 1
 1610 065c 0197      		1: sbiw r24,1
 1611 065e 01F4      		brne 1b
 1612               	 ;  0 "" 2
 1613               	/* #NOAPP */
 1614               	.LBE129:
 1615               	.LBE128:
 1616               	.LBE127:
 1617               	.LBE126:
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 99


 1618               		.stabs	"rowSegBuffer.c",132,0,0,.Ltext12
 1619               	.Ltext12:
 541:rowSegBuffer.c ****             | (0<<COM1B1) | (1<<COM1B0)
 542:rowSegBuffer.c ****             | (1<<PWM1A) | (1<<PWM1B) );
 543:rowSegBuffer.c **** 
 544:rowSegBuffer.c ****       drawSegs();
 545:rowSegBuffer.c **** 
 546:rowSegBuffer.c **** #define COLORS_WRITTEN   64
 547:rowSegBuffer.c **** 
 548:rowSegBuffer.c **** 
 549:rowSegBuffer.c **** //#error "should add SEG_STRETCH here..."
 550:rowSegBuffer.c **** #if (ROW_COMPLETION_DELAY > 0)
 551:rowSegBuffer.c **** //      delay_cyc(DOTS_TO_CYC(DE_ACTIVE_DOTS) -60 // - 68)// - 60
 552:rowSegBuffer.c **** //            - WRITE_COLOR_CYCS*COLORS_WRITTEN);
 553:rowSegBuffer.c ****       delay_cyc(ROW_COMPLETION_DELAY);
 554:rowSegBuffer.c **** //      asm("nop;");
 555:rowSegBuffer.c **** //      asm("nop;");
 556:rowSegBuffer.c **** //      asm("nop;");
 557:rowSegBuffer.c **** //      asm("nop;");
 558:rowSegBuffer.c **** //      asm("nop;");
 559:rowSegBuffer.c **** //      asm("nop;");
 560:rowSegBuffer.c **** //      asm("nop;");
 561:rowSegBuffer.c **** //      asm("nop;");
 562:rowSegBuffer.c ****       
 563:rowSegBuffer.c **** #else
 564:rowSegBuffer.c **** #warning "ROW_COMPLETION_DELAY <= 0"
 565:rowSegBuffer.c **** #endif
 566:rowSegBuffer.c **** 
 567:rowSegBuffer.c ****       //Just for testing...
 568:rowSegBuffer.c ****       // Actually, it's quite handy, because it shows where drawSegs has
 569:rowSegBuffer.c ****       // completed... (I thought it stretched to the end of DE, but nope)
 570:rowSegBuffer.c ****       // The "bug" with PLL_SYSCLK's white bars now appears to be quite
 571:rowSegBuffer.c ****       // apparently due to carry-over from a previous line
 572:rowSegBuffer.c ****       // rather than an Hsync problem, as now it appears cyan.
 573:rowSegBuffer.c ****       OCR1D = 0;
 1620               		.stabn	68,0,573,.LM169-.LFBB16
 1621               	.LM169:
 1622 0660 1ABC      		out 74-0x20,__zero_reg__
 574:rowSegBuffer.c **** 
 575:rowSegBuffer.c ****       //DE->Nada transition expects fullBlue...
 576:rowSegBuffer.c ****       //Also helps to show the edge of the DE timing...
 577:rowSegBuffer.c **** 
 578:rowSegBuffer.c ****       //!!! Not sure what the state is at this point...
 579:rowSegBuffer.c ****       // could be any DE+Blue level, or could be NADA...
 580:rowSegBuffer.c ****       // Nada: DT1=3, still leaves one bit for clocking, might be OK
 581:rowSegBuffer.c ****          
 582:rowSegBuffer.c ****       //Among the things that don't make sense...
 583:rowSegBuffer.c ****       // This appears to go into affect BEFORE delay_cyc (?)
 584:rowSegBuffer.c ****       // as, without a pull-up resistor on the /OC1B output, 
 585:rowSegBuffer.c ****       // green seems to be floating between the last pixel and the
 586:rowSegBuffer.c ****       // delay_cyc (!)
 587:rowSegBuffer.c ****       //Disable complementary-output for Green 
 588:rowSegBuffer.c ****       //  (on /OC1B, where CLK is OC1B)
 589:rowSegBuffer.c ****       // Since Nada, V, and H DT's might be bad for clocking.
 590:rowSegBuffer.c ****       TCCR1A = ( (0<<COM1A1) | (1<<COM1A0)
 1623               		.stabn	68,0,590,.LM170-.LFBB16
 1624               	.LM170:
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 100


 1625 0662 83E6      		ldi r24,lo8(99)
 1626 0664 80BF      		out 80-0x20,r24
 591:rowSegBuffer.c ****          | (1<<COM1B1) | (0<<COM1B0)
 592:rowSegBuffer.c ****          | (1<<PWM1A) | (1<<PWM1B) );
 593:rowSegBuffer.c **** 
 594:rowSegBuffer.c ****       fullBlue();
 1627               		.stabn	68,0,594,.LM171-.LFBB16
 1628               	.LM171:
 1629 0666 14BC      		out 68-0x20,__zero_reg__
 1630 0668 86E0      		ldi r24,lo8(6)
 1631 066a 8DBD      		out 77-0x20,r24
 595:rowSegBuffer.c ****       Nada_fromDEonly();
 1632               		.stabn	68,0,595,.LM172-.LFBB16
 1633               	.LM172:
 1634 066c 80E3      		ldi r24,lo8(48)
 1635 066e 84BD      		out 68-0x20,r24
 1636               	/* epilogue start */
 596:rowSegBuffer.c **** }
 1637               		.stabn	68,0,596,.LM173-.LFBB16
 1638               	.LM173:
 1639 0670 0895      		ret
 1640               		.size	rsb_drawPix, .-rsb_drawPix
 1641               		.stabs	"__count:r(3,4)",64,0,36,24
 1642               		.stabn	192,0,0,.LBB128-.LFBB16
 1643               		.stabn	224,0,0,.LBE128-.LFBB16
 1644               	.Lscope16:
 1645               		.stabs	"",36,0,0,.Lscope16-.LFBB16
 1646               		.stabd	78,0,0
 1647               		.stabs	"updateLCD:F(3,2)",36,0,1168,updateLCD
 1648               	.global	updateLCD
 1649               		.type	updateLCD, @function
 1650               	updateLCD:
 1651               		.stabd	46,0,0
 1652               		.stabs	"_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c",132,0,0,.Ltext13
 1653               	.Ltext13:
 877:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 878:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 879:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define TESTVALS	0
 880:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define LTN 1
 881:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define IDT 2
 882:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 883:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 884:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //TIMING:
 885:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Measurements below (in microseconds) are referring to preLVDS
 886:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  There may be other such old-notes...
 887:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 888:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 889:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //        |<--T_Hhigh-->| |<-T_Hlow
 890:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    __   _____________   ____________  3.6V
 891:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // H    |_|             |_|           _  0V
 892:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
 893:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    Data Enable
 894:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //       Only active when there's valid pixel data
 895:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //       (For a dual-pixel 1024x768 display:
 896:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //         for 512 of the 717 clocks in HSYNC-active)
 897:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //       Low during Vsync... (~720us)
 898:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 101


 899:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 900:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //IDTech display: 136 dots
 901:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //2-136+
 902:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //IDTech, last used: 40
 903:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //LTN Last used 8
 904:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // LTN: 1072<=1344<=1500 clocks per line, 1024DE... Hsync unused
 905:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // SEE Hlow_Delay() notes if this value is large!
 906:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 907:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #ifndef H_LOW_DOTS
 908:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if (DISPLAY == LTN)
 909:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define H_LOW_DOTS	8
 910:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif (DISPLAY == IDT)
 911:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define H_LOW_DOTS   40//8//1//40 //30 //2//136
 912:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif (DISPLAY == TESTVALS)
 913:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define H_LOW_DOTS	100//0 //LTN doesn't use H_LOW (DE-only)
 914:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 							  // And having a value here increases codesize
 915:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
 916:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
 917:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 918:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //H is set low immediately upon entry of the timer interrupt
 919:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // its low-time is controlled via nops
 920:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // (so if HLow is long for a particular display, this might need revising)
 921:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 922:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if((!defined(HLOW_DELAY_OVERRIDE) || !HLOW_DELAY_OVERRIDE) \
 923:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		                                         && !defined(Hlow_Delay))
 924:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define Hlow_Delay() \
 925:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	delay_Dots(H_LOW_DOTS)
 926:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
 927:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 928:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 929:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 930:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 931:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //This was found expermentally with SwitchResX
 932:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //IDTech Last Used: 680
 933:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // (IDTech had some oddities regarding slow pixel-clocks, where pixels
 934:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  would be repeated, regardless of the pixel-clock, thus, for slow clocks
 935:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  it has the effect of *stretching* the image, thus 680 "pixels" across
 936:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  instead of its 1024 *physical* pixels)
 937:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //LTN last used 1024
 938:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Oddly: For the LTN, this doesn't seem to affect the horizontal
 939:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //        it does, however, affect the vertical(!)
 940:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // If I recall Correctly, this is used only for setting the timer interrupt
 941:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  rate...
 942:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if (DISPLAY == LTN)
 943:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define DE_ACTIVE_DOTS	1024
 944:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif (DISPLAY == IDT)
 945:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define DE_ACTIVE_DOTS	680 //1024 //800 //920 //943 //812 //472 //1024
 946:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif (DISPLAY == TESTVALS)
 947:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define DE_ACTIVE_DOTS	1024
 948:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
 949:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 950:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 951:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //Horizontal Blank Time: HD_DOTS + H_LOW + DH_DOTS
 952:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  90-320+
 953:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //Horizontal Total Time: 1206<=1344<=2047
 954:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // ... but Total = Blank + Pixels, so 90+1024 != 1206
 955:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Excess waits should be thrown in DH (since that's between interrupts)
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 102


 956:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //T_HD is the time from H inactivated to DE activated
 957:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //aka H back-porch: 1-160+
 958:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //IDTech Last Used: 50
 959:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //LTN last used 5
 960:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 961:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #ifndef HD_DOTS
 962:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if (DISPLAY == LTN)
 963:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define HD_DOTS 5
 964:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif (DISPLAY == IDT)
 965:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define HD_DOTS	50 //5 //0//20//5 //50 //30 //1 //160
 966:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif (DISPLAY == TESTVALS)
 967:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define HD_DOTS 50//5
 968:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
 969:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
 970:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 971:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #ifndef HD_Delay
 972:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define HD_Delay()	delay_Dots(HD_DOTS)
 973:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
 974:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 975:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // I think this was just a mistake. This change to delay_Dots a/o 0.10ncf
 976:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // (untested in LCDdirectLVDS)
 977:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //delay_cyc(HD_DOTS)
 978:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 979:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 980:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // This is the number of CPU cycles between DE->L and Horiz->L
 981:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // This is just used in calculating the OCR value...
 982:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // aka H Front Porch: 0-24+
 983:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // IDTech Last Used: 24
 984:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // LTN last used 46
 985:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // 1072-1024-1-1 = 46
 986:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #ifndef DH_DOTS
 987:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if (DISPLAY == LTN)
 988:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define DH_DOTS	46
 989:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif (DISPLAY == IDT)
 990:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define DH_DOTS	24 //46 //480//6//12//24 //46 //24 //122//30 //0 //24
 991:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif (DISPLAY == TESTVALS)
 992:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define DH_DOTS	0//1000//100//46
 993:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
 994:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
 995:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
 996:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //       |
 997:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //       v
 998:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      T_DH
 999:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      ||    |<-T_DE->|  |  |<--T_HD (Hsync->DE)
1000:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // H   __.  ____________  .___________
1001:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      .|_|  .        .|_|  .
1002:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     _.     .________.     .___________
1003:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DE   |_____| 512clk |_____|
1004:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //      ^              ^
1005:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //       \___________   \                        (just avoiding \ warning)
1006:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                   \  |     768 Hsyncs
1007:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                    v v
1008:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     _             _ _ _ _ _ _ _ _ _ _ 
1009:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DE   |___________| | | | | | | | | | |______
1010:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
1011:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // one Hsync = T_HD+T_DH+T_Hlow+T_DE = 19.865us
1012:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 103


1013:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //aka V-sync back porch: 7-29-63 "Vbp should be static"
1014:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // IDTech Last Used: 29
1015:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // LTN last used 3
1016:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //LTN Frame: 772<=806<=1000 lines...
1017:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1018:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #ifndef T_VD
1019:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if (DISPLAY == LTN)
1020:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define T_VD 3
1021:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif (DISPLAY == IDT)
1022:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define  T_VD 29 //3//29 //7 //29
1023:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif (DISPLAY == TESTVALS)
1024:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define T_VD 3
1025:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1026:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1027:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1028:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //aka V-sync front porch: 1-3+
1029:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // IDTech Last Used: 3
1030:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // LTN last used 3
1031:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #ifndef T_DV
1032:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if (DISPLAY == LTN)
1033:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define T_DV 3
1034:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif (DISPLAY == IDT)
1035:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define T_DV 3//3 //1 //3
1036:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif (DISPLAY == TESTVALS)
1037:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define T_DV 3
1038:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1039:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1040:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1041:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //1-6+ (1 is used by the first switch-case...)
1042:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // IDTech Last Used: 6
1043:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // LTN Last used 16
1044:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // 772 - 768 - 1 - 1 = 2
1045:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #ifndef T_Vlow
1046:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if (DISPLAY == LTN)
1047:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define T_Vlow 16
1048:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif (DISPLAY == IDT)
1049:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define T_Vlow	6 //16//6 //2 //6
1050:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif (DISPLAY == TESTVALS)
1051:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define T_Vlow 32
1052:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1053:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1054:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1055:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // IDTech Last Used: 768
1056:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #ifndef V_COUNT
1057:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if (DISPLAY == LTN)
1058:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define V_COUNT	768
1059:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif (DISPLAY == IDT)
1060:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define V_COUNT	768
1061:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif (DISPLAY == TESTVALS)
1062:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // #if (LVDS_PRESCALER == 8)
1063:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #define V_COUNT 768
1064:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // #else
1065:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  #define V_COUNT	(768*2/3)
1066:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // #endif
1067:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1068:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1069:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 104


1070:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                       
1071:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                      |           
1072:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                      V           
1073:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              |<-T_DV>|           |<-T_VD-->|
1074:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              .       .           .         .
1075:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     _____________||__.   124us   .____||___________________
1076:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  V           .   ||  |___________|    ||   .
1077:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     _ _ _ _ _ _ _|| _ _ _ _ _ _ _ _ _ ||_ _ _ _ _ _ _ _ _ _ _
1078:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  H   | | | | | | ||| | | | | | | | | ||| | | | | | | | | | |
1079:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //              .   ||                   ||   .
1080:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     _ _ _ _ _.   ||       720us       ||   ._ _ _ _ _ _ _ _ _
1081:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DE   | | | | |___||___________________||___| | | | | | | | |
1082:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                  ||                   ||
1083:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
1084:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                        1
1085:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                        |
1086:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                        v               
1087:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     _________________   ___________________   _____________
1088:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  V                   |_|                   |_|
1089:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  H  |||||||||||||||||||||||||||||||||||||||||||||||||||||||
1090:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DE  ||||||||||||||||_____|||||||||||||||||_____||||||||||||
1091:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                          ^
1092:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                          |
1093:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //                          2
1094:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1095:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1096:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1097:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define HSYNC_COUNT_FRAME_COMPLETE  \
1098:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	(T_DV +(V_COUNT+T_VD+T_Vlow) + FRAME_UPDATE_DELAY)
1099:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // T_DV = 3
1100:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // V_COUNT = 768 
1101:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // T_VD = 3
1102:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // T_Vlow = 32
1103:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // FRAME_UPDATE_DELAY = 0
1104:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // TOTAL = 806
1105:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1106:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if(FRAME_UPDATE_DELAY != 0)
1107:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #error "FRAME_UPDATE_DELAY is no longer implemented..."
1108:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1109:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1110:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1111:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //#if(HSYNC_COUNT_FRAME_COMPLETE & 0x01)
1112:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // #warning "Total vertical lines might need to be even!"
1113:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  //This should be fixed...
1114:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //#endif
1115:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1116:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1117:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define DOT_COUNT_PER_HSYNC \
1118:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	(H_LOW_DOTS + HD_DOTS + DE_ACTIVE_DOTS + DH_DOTS)
1119:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // H_LOW_DOTS = 100
1120:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // HD_DOTS = 50 
1121:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DE_ACTIVE_DOTS = 1024
1122:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DH_DOTS = 0
1123:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // TOTAL = 1174
1124:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1125:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1126:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //#define MAKELONG (0L)
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 105


1127:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1128:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define DOT_COUNT_PER_FRAME \
1129:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  ((MAKELONG(HSYNC_COUNT_FRAME_COMPLETE)) * (MAKELONG(DOT_COUNT_PER_HSYNC)))
1130:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // TOTAL = 946,244
1131:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1132:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //Hlow_Delay 		H_LOW_DOTS
1133:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //HD_Delay			HD_DOTS	
1134:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //DE_ACTIVE_DOTS
1135:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //DH_DOTS
1136:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1137:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1138:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1139:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** static __inline__ \
1140:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** void loadData(uint16_t rowNum, uint8_t dataEnable) \
1141:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	  __attribute__((__always_inline__));
1142:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1143:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1144:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** uint8_t dataEnable = 0;
1145:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** uint8_t vSync = 0;
1146:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** uint16_t hsyncCount = 0;
1147:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1148:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //frameCount=0 can be used in main to detect whether we've completed a 
1149:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  a frame AND its FRAME_UPDATE_DELAY
1150:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if (defined(FRAME_COUNT_TO_DELAY) && (FRAME_COUNT_TO_DELAY != 0))
1151:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** uint8_t frameCount = 0;
1152:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1153:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1154:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** /*
1155:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** static __inline__ \
1156:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** void loadRow(uint16_t rowNum) \
1157:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	__attribute__((__always_inline__));
1158:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** */
1159:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1160:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //Returns TRUE when the frame is complete
1161:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Should send nada (and maybe hsyncs?) thereafter(?)
1162:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // In sdramThing2.0, when this returns TRUE, the SDRAM loading is complete
1163:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // EXCEPT: the final HD_Dots' FR_READ/ACTIVATE commands will point to a
1164:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  non-existent "next" Hsync... these commands need to be rewritten to
1165:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  point to the "first" Hsync. This is handled in sdramThing2.0's code
1166:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Used to be:
1167:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //SIGNAL(TIMER0_COMPA_vect)
1168:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** uint8_t updateLCD(void)
1169:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** {
 1654               		.stabn	68,0,1169,.LM174-.LFBB17
 1655               	.LM174:
 1656               	.LFBB17:
 1657               	/* prologue: function */
 1658               	/* frame size = 0 */
1170:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	uint8_t frameComplete = FALSE;
1171:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1172:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//static uint8_t frameCount = 0;
1173:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1174:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if 0 // (defined(SLOW_EVERYTHING_TEST) && SLOW_EVERYTHING_TEST)
1175:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	while(TCNT0L != 7){};
1176:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//This won't work... who knows how many cycles interrupt-entry will be
1177:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//Above should fix that...
1178:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//I think this was just an indicator for scope triggering...
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 106


1179:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	// not relevent for 
1180:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	setpinPORT(PB2, PORTB);
1181:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	clrpinPORT(PB2, PORTB);
1182:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1183:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1184:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//Hsync and Actually draw the pixels... (when DE is active)
1185:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	// This takes a LONG time and will occupy most of the CPU...
1186:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//  ... IN THIS INTERRUPT
1187:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//loadData(((hsyncCount-T_VD-T_Vlow)>>3)&31, dataEnable,colorOverride);
1188:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	loadData(hsyncCount-T_DV-T_VD-T_Vlow, dataEnable);
 1659               		.stabn	68,0,1188,.LM175-.LFBB17
 1660               	.LM175:
 1661 0672 8091 0000 		lds r24,hsyncCount
 1662 0676 9091 0000 		lds r25,dataEnable
 1663               	.LBB130:
 1664               	.LBB131:
1189:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1190:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	hsyncCount++;
1191:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1192:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	switch(hsyncCount)
1193:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	{
1194:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//V Front Porch, begins with initLCD
1195:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1196:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//Vsync H->L (Begin V-Sync)
1197:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		case T_DV:
1198:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			dataEnable = FALSE;
1199:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			//clrpinPORT(VSYNC_PIN, VSYNC_PORT);
1200:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			vSync = TRUE;
1201:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			Vsync_fromNada();
1202:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			break;
1203:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//Vsync L->H (Begin V Back Porch)
1204:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		case T_Vlow + T_DV:
1205:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//	if(hfm_nextOutput(&modulator))
1206:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//		colorOverride = 0xff;
1207:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//	else
1208:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//		colorOverride = 7;
1209:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			//setpinPORT(VSYNC_PIN, VSYNC_PORT);
1210:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			vSync = FALSE;
1211:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			Nada_fromVsync();
1212:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			break;
1213:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//Start of frame (DE active)
1214:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		case T_VD +(T_Vlow + T_DV):
1215:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			dataEnable = TRUE;
1216:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			break;
1217:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		// All rows have been displayed
1218:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		// Return to V Front Porch
1219:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		case V_COUNT +(T_VD + T_Vlow + T_DV):
1220:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			dataEnable = FALSE;
1221:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//	break;
1222:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//Frame complete
1223:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//case HSYNC_COUNT_FRAME_COMPLETE:
1224:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			//T_DV +(V_COUNT+T_VD+T_Vlow) + FRAME_UPDATE_DELAY:
1225:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			hsyncCount = 0;
1226:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if 0 //(FRAME_COUNT_TO_DELAY != 0)
1227:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			//static uint8_t frameCount = 0;
1228:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			frameCount++;
1229:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			if(frameCount == FRAME_COUNT_TO_DELAY)
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 107


1230:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			{
1231:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 				frameCount = 0;
1232:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 				timer_compareMatchIntSetup(0, OUT_CHANNELA, FALSE);
1233:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 				//timer_compareMatchIntDisable(0, OUT_CHANNELA);
1234:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			}
1235:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1236:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			
1237:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //#warning "NewNote: WTF, are we relying on loadData to have properly set the mode?"
1238:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // Yeah, guess that makes sense... Must be Nada...
1239:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			frameComplete = TRUE;
1240:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			break;
1241:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		default:
1242:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			break;
1243:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	}
1244:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1245:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1246:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if 0 // (defined(LOADROW) && LOADROW)
1247:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//Load the next row into the row(seg)buffer
1248:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//data is enabled after T_VD+T_Vlow...
1249:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	if((hsyncCount >= T_VD+T_Vlow) && (hsyncCount < T_VD+T_Vlow+V_COUNT))
1250:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		loadRow(hsyncCount - (T_VD+T_Vlow));
1251:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1252:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1253:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//This note was written long before the above was commented-out...
1254:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//So...?
1255:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	// Here is where loadRow used to be called
1256:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	// it has been moved to oldNotes.txt, but it would make more sense
1257:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	// to look at LCDdirectLVDS <25 or LCDdirect
1258:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	// loadRow used the time between DE inactive and the next Hsync
1259:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	// to load a row to a row-buffer (as opposed to a frame-buffer)
1260:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	// thus, DE could gain more pixels because there would be fewer
1261:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	// calculations to determine the memory location to write from
1262:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	// This effect has since been minimized
1263:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	// BUT loadRow might be necessary for program-memory-based images...
1264:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1265:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	return frameComplete;
1266:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** }
1267:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1268:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1269:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //See LCDdirectLVDS for an example...
1270:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // basically it loads a single row into a buffer for the next dateEnable
1271:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  (either the row-buffer or the row-segment-buffer) 
1272:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // This has been *greatly* reduced, is not at all functional, just
1273:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // to give an idea of loadRow's purpose.
1274:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if 0 //(defined(LOADROW) && LOADROW)
1275:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** void loadRow(uint16_t rowNum)
1276:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** {
1277:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//e.g....
1278:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	tet_drawRow(rbRowNum, rowBuffer);
1279:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	
1280:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//and...	
1281:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	rowBuffer[i] = fb_to_rb(colorVal);
1282:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	
1283:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//and...
1284:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	if((rbRowNum >= SMILE_TOP_ROW) &&
1285:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			(rbRowNum < (SMILE_HEIGHT+SMILE_TOP_ROW)))
1286:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	{
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 108


1287:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			for(i=0; i<FB_WIDTH; i++)
1288:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			{
1289:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****          	temp=pgm_readImageByte(pimage, rbRowNum-SMILE_TOP_ROW, i);
1290:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 				if(!(temp & 0xC0))
1291:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 					rowBuffer[i+SMILE_SHIFT] = fb_to_rb(temp);
1292:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			}
1293:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	}
1294:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1295:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	life_drawRow(rbRowNum, &(rowBuffer[RB_WIDTH-LIFE_WIDTH]));
1296:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1297:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//HORIZONTAL_COLOR_BARS
1298:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	for(i=0; i<RB_WIDTH; i++)
1299:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		rowBuffer[i] = fb_to_rb(rowNum);
1300:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1301:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//Good for syncing to have white on both borders...
1302:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	newSeg(1, 0x06, (6<<4) | 3);
1303:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	
1304:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** }
1305:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif //LOAD_ROW
1306:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1307:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1308:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //Including inactive pixel-clocks (timing)
1309:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // DotCount per row...
1310:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  TOTAL_CYC_COUNT was used for the timer-interrupt in LCDdirectLVDS
1311:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  This was DOTS_TO_CYC(DISPLAY_DOT_COUNT) + ROW_CALCULATION_CYCS
1312:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  ROW_CALCULATION_CYCS was 50,000 (!!!)
1313:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   DOTS_TO_CYC(dots), last-used, was dots*7 (LVDS_PRESCALER nullified /8)
1314:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   So, the overall dot-count per row was... 
1315:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     DISPLAY_DOT_COUNT + ROW_CALCULATION_DOTS
1316:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     where ROW_CALCULATION_DOTS = 50,000cyc/7 = 7142 dots
1317:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //     So... the overall dot-count per row was *MUCH* longer than usual
1318:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  Pretty certain there's not nearly enough memory to simulate that
1319:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   (in sdramThing2.0)
1320:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   But It does suggest that it would be worthwhile to try to stretch
1321:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   the rows as much as possible...
1322:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   During this time, NADA is sent normally, (V=H, H=H, DE=L)
1323:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //    Or Vsync (V=L, H=H, DE=L)
1324:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   Maybe something could be simulated with PWM again, if necessary...
1325:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //   (Certainly not at full-speed)
1326:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define DISPLAY_DOT_COUNT \
1327:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	(H_LOW_DOTS + HD_DOTS + DE_ACTIVE_DOTS + DH_DOTS)
1328:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1329:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if 0
1330:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1331:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //#define T_Hlow_CYC 1//8 //(T_Halow_REAL*3)
1332:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define T_Hlow_CYC DOTS_TO_CYC(H_LOW_DOTS)
1333:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1334:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define T_DE_CYC	DOTS_TO_CYC(DE_ACTIVE_DOTS)
1335:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1336:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //#define T_HD_CYC 1//3//(T_HD_REAL*3)
1337:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define T_HD_CYC	DOTS_TO_CYC(HD_DOTS)
1338:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1339:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define T_DH_CYC	DOTS_TO_CYC(DH_DOTS)
1340:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1341:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1342:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1343:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 109


1344:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1345:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** void init_timer0Hsync(void)
1346:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** {
1347:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//T_HD + T_DH + T_low + T_DE
1348:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	// For the original system, 19.865us = 695 dot-clocks
1349:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	// We'd need to take advantage of the 16-bit timer
1350:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//  OCR1A may not be written properly (with a temporary high-byte)
1351:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//  ... not sure.
1352:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	// TIMER0 DOES NOT HAVE CTC MODE in 16-bit mode
1353:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1354:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // This is a hack, for testing syncability with long row-calculations
1355:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // before actually drawing it... e.g. loading from program memory
1356:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // This value needs to be larger than the calculation time
1357:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // otherwise, it seems, syncing isn't stable
1358:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // BUT THIS IS A HACK, has nothing to do with actual calculation time
1359:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // And for slow LVDS or whatnot, this may be unnecessarily HUGE
1360:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1361:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define DISPLAY_CYC_COUNT	(DOTS_TO_CYC(DISPLAY_DOT_COUNT))
1362:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //	(T_Hlow_CYC + T_HD_CYC + T_DE_CYC + T_DH_CYC)
1363:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1364:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //NOTE that with longer ROW_CALCULATION_CYCS, lines can be repeated...
1365:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // apparently an effect of the display, definitely not a code-thing
1366:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // in which case the vertical resolution decreases
1367:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // though, this could be used to advantage... 
1368:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // (e.g. more processing time outside the drawing interrupts?)
1369:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // NOTE that if the value is too small and calculations take longer in some
1370:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // lines than others (?), those lines may repeat, or syncing could be off
1371:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if (LVDS_PRESCALER == 8)
1372:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  //#define ROW_CALCULATION_DELAY 1//20
1373:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define ROW_CALCULATION_CYCS (50000) //0 //(70000) //(100000)
1374:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #else
1375:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  //#define ROW_CALCULATION_DELAY 9//7//5//2//1//10
1376:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define ROW_CALCULATION_CYCS	(8*DISPLAY_CYC_COUNT)
1377:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1378:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1379:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define TOTAL_CYC_COUNT \
1380:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	(ROW_CALCULATION_CYCS + DISPLAY_CYC_COUNT)
1381:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //	(ROW_CALCULATION_DELAY * (T_Hlow_CYC + T_HD_CYC + T_DE_CYC + T_DH_CYC))
1382:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //#define TOTAL_CYC_COUNT 2000
1383:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if (TOTAL_CYC_COUNT > 255)
1384:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  //Adding +7 causes it to round up (hopefully)
1385:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define TIMER0_TCNTS ((TOTAL_CYC_COUNT+7)/8)
1386:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define TIMER0_CLKDIV	CLKDIV8
1387:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #warning "TIMER0_TCNTS = (TOTAL_CYC_COUNT+7)/8: Timer0 CLKDIV8"
1388:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #if (TIMER0_TCNTS > 255)
1389:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #warning "TIMER0_TCNTS = (TOTAL_CYC_COUNT+63)/64: Timer0 CLKDIV64"
1390:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #define TIMER0_TCNTS ((TOTAL_CYC_COUNT+63)/64)
1391:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #define TIMER0_CLKDIV CLKDIV64
1392:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #if (TIMER0_TCNTS > 255)
1393:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	 #warning "TIMER0_TCNTS = (TOTAL_CYC_COUNT+255)/256: Timer0 CLKDIV256"
1394:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	 #define TIMER0_TCNTS ((TOTAL_CYC_COUNT+255)/256)
1395:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	 #define TIMER0_CLKDIV CLKDIV256
1396:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	 #if (TIMER0_TCNTS > 255)
1397:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		#warning "TIMER0_TCNTS = (TOTAL_CYC_COUNT+1023)/1024: Timer0 CLKDIV1024"
1398:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		#define TIMER0_TCNTS ((TOTAL_CYC_COUNT+1023)/1024)
1399:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		#define TIMER0_CLKDIV	CLKDIV1024
1400:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	 #endif
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 110


1401:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #endif
1402:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #endif
1403:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #if (TIMER0_TCNTS == 0)
1404:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #error "TIMER0_OCRVAL == 0"
1405:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #endif
1406:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #else
1407:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define TIMER0_TCNTS TOTAL_CYC_COUNT
1408:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define TIMER0_CLKDIV CLKDIV1
1409:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1410:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1411:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if (defined(SLOW_EVERYTHING_TEST) && SLOW_EVERYTHING_TEST)
1412:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  //For testing, I want to see the pulses with the 'scope
1413:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  // Unless the timer is divisible by 7 the pulses will not align with the
1414:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  // timer overflow...
1415:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  //but shit... it's running at clkdiv8 so each TCNT is 64 bits!
1416:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  // but this shouldn't matter for visualizing, that's only ~10 pixel clocks
1417:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  // and we'll only start visualizing *after* the extra TCNTs...
1418:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  //Since the timer counts from 0 to (and including) OCR1A
1419:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  // Add one to this test...
1420:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #if (((TIMER0_TCNTS + 1) % 7) == 0)
1421:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #warning "(TIMER0_TCNTS + 1) % 7 == 0"
1422:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #warning "   so... TIMER0_OCRVAL = TIMER0_TCNTS"
1423:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #define TIMER0_OCRVAL (TIMER0_TCNTS)
1424:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1425:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #elif (((TIMER0_TCNTS + 2) % 7) == 0)
1426:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #warning "(TIMER0_TCNTS + 2) % 7 == 0"
1427:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #warning "   so... TIMER0_OCRVAL = TIMER0_TCNTS + 1"
1428:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #define TIMER0_OCRVAL (TIMER0_TCNTS + 1)
1429:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1430:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #elif (((TIMER0_TCNTS + 3) % 7) == 0)
1431:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #warning "(TIMER0_TCNTS + 3) % 7 == 0"
1432:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #warning "   so... TIMER0_OCRVAL = TIMER0_TCNTS + 2"
1433:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #define TIMER0_OCRVAL (TIMER0_TCNTS + 2)
1434:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1435:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #elif (((TIMER0_TCNTS + 4) % 7) == 0)
1436:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #warning "(TIMER0_TCNTS + 4) % 7 == 0"
1437:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #warning "   so... TIMER0_OCRVAL = TIMER0_TCNTS + 3"
1438:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #define TIMER0_OCRVAL (TIMER0_TCNTS + 3)
1439:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1440:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #elif (((TIMER0_TCNTS + 5) % 7) == 0)
1441:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #warning "(TIMER0_TCNTS + 5) % 7 == 0"
1442:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #warning "   so... TIMER0_OCRVAL = TIMER0_TCNTS + 4"
1443:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #define TIMER0_OCRVAL (TIMER0_TCNTS + 4)
1444:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1445:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #elif (((TIMER0_TCNTS + 6) % 7) == 0)
1446:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #warning "(TIMER0_TCNTS + 6) % 7 == 0"
1447:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #warning "   so... TIMER0_OCRVAL = TIMER0_TCNTS + 5"
1448:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #define TIMER0_OCRVAL (TIMER0_TCNTS + 5)
1449:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1450:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #elif (((TIMER0_TCNTS) % 7) == 0)
1451:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #warning "(TIMER0_TCNTS) % 7 == 0"
1452:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #warning "   so... TIMER0_OCRVAL = TIMER0_TCNTS - 1"
1453:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #define TIMER0_OCRVAL (TIMER0_TCNTS - 1)
1454:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1455:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #else
1456:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****   #error "WTF?"
1457:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #endif
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 111


1458:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #else
1459:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #define TIMER0_OCRVAL (TIMER0_TCNTS-1)
1460:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1461:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1462:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if (TIMER0_OCRVAL > 255)
1463:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #error "Despite all my efforts, TIMER0_OCRVAL is *still* > 255!"
1464:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1465:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1466:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****    OCR0A = TIMER0_OCRVAL; //T_Hlow_CYC + T_HD_CYC + T_DE_CYC + T_DH_CYC;
1467:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	timer_setWGM(0, WGM_CLR_ON_COMPARE);
1468:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****    timer_selectDivisor(0, TIMER0_CLKDIV); //CLKDIV1);
1469:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****    timer_compareMatchIntEnable(0, OUT_CHANNELA);
1470:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** }
1471:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1472:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #define fullBlue()	DEblue_init()
1473:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1474:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1475:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1476:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //Either use one of the ones here, or define your own...
1477:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // rowNum is the drawable row number on the LCD...
1478:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //static __inline__ void drawPix(uint16_t rowNum);
1479:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1480:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // This should have a uint16 rowNum!
1481:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // But, so far, the only cases which use all 768 rows are LCDdirectLVDS
1482:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // with RowSegBuffer, and sdramThing (how did this uint8_t thing not cause
1483:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // trouble there?!)
1484:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // RowSegBuffer doesn't pay attention to rowNum in drawPix...
1485:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1486:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1487:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** static __inline__ \
1488:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** void drawPix(uint8_t rowNum) \
1489:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	  __attribute__((__always_inline__));
1490:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if 0
1491:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if (!defined(ROW_SEG_BUFFER) || !ROW_SEG_BUFFER)
1492:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //drawPix loads each pixel individually... It doesn't use a for-loop
1493:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // since that would take away from actual pixel-drawing time...
1494:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // I think it's been removed... but here's a (non-functional) example...
1495:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** void drawPix(uint8_t rowNum)
1496:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** {
1497:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	writeColor(*(color+1));	 
1498:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	writeColor(*(color+2));	 
1499:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	writeColor(*(color+3)); 
1500:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	...
1501:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	writeColor(*(color+61));
1502:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	writeColor(*(color+62));
1503:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	writeColor(*(color+63));
1504:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	// WriteColor writes the pixel *after* the calculations...
1505:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	// thus the pixel appears basically after writeColor completes
1506:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	// These nops assure the 64th pixel is fully-displayed before exitting
1507:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	asm("nop");
1508:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	...
1509:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	asm("nop");
1510:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1511:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** /*		reg[17] = colorBuffer[rowNum][17];                         
1512:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		writeColor(reg[17]);                         
1513:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		...
1514:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		reg[20] = colorBuffer[rowNum][20];                         
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 112


1515:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		writeColor(reg[20]);  
1516:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		
1517:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//REPEATING to fill screen... (delayDots = 342 worked prior to this)
1518:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		reg[0] = colorBuffer[rowNum][0];
1519:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		writeColor(reg[0]);
1520:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		...
1521:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		reg[10] = colorBuffer[rowNum][10];
1522:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		writeColor(reg[10]);
1523:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** */
1524:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//Display the rest as black...
1525:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		writeColor(0);
1526:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** }
1527:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #else		//ROW_SEG_BUFFER
1528:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** void drawPix(uint8_t rowNum)
1529:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** {
1530:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	TCCR1A = ( (0<<COM1A1) | (1<<COM1A0)
1531:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	         | (0<<COM1B1) | (1<<COM1B0)
1532:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	         | (1<<PWM1A) | (1<<PWM1B) );
1533:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1534:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** /* This bit was in loadData, just some notes, now...
1535:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1536:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  WTF, how did this work?! Am I not using drawPix?!
1537:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****    Yes, but drawPix calls drawSegs, which doesn't have an argument
1538:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****    because loadRow takes the row argument elsewhere, drawSegs just
1539:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****    draws 'em
1540:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       //#warning "see 'shouldBe' here..."
1541:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       //Should be:
1542:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       rowNum = rowNum*FB_HEIGHT/V_COUNT;
1543:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       //rowNum = rowNum / (768/FB_HEIGHT);
1544:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1545:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	So, rowNum change left-over from the ol' FrameBuffer days had no effect
1546:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	on drawSegs.
1547:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** */
1548:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1549:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1550:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1551:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		drawSegs();
1552:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1553:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1554:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//DE->Nada transition expects fullBlue...
1555:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//Also helps to show the edge of the DE timing...
1556:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1557:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//!!! Not sure what the state is at this point...
1558:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		// could be any DE+Blue level, or could be NADA...
1559:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		// Nada: DT1=3, still leaves one bit for clocking, might be OK
1560:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****          
1561:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//Among the things that don't make sense...
1562:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		// This appears to go into affect BEFORE delay_cyc (?)
1563:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		// as, without a pull-up resistor on the /OC1B output, 
1564:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		// green seems to be floating between the last pixel and the
1565:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		// delay_cyc (!)
1566:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//Disable complementary-output for Green 
1567:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//  (on /OC1B, where CLK is OC1B)
1568:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		// Since Nada, V, and H DT's might be bad for clocking.
1569:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		TCCR1A = ( (0<<COM1A1) | (1<<COM1A0)
1570:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****          | (1<<COM1B1) | (0<<COM1B0)
1571:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****          | (1<<PWM1A) | (1<<PWM1B) );
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 113


1572:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1573:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		fullBlue();
1574:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** }
1575:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif //0
1576:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1577:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1578:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
1579:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //          G) groovy little spiral...
1580:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //
1581:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1582:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if 0 //(defined(CLOCK_INSENSITIVITY_TESTING) && CLOCK_INSENSITIVITY_TESTING)
1583:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DEonly_fromNada();
1584:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//Enable complementary-output for Green (on /OC1B, where CLK is OC1B)
1585:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		TCCR1A = ( (0<<COM1A1) | (1<<COM1A0)
1586:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 				   | (0<<COM1B1) | (1<<COM1B0)
1587:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 					| (1<<PWM1A) | (1<<PWM1B) );
1588:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1589:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1590:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1591:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1592:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1593:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1594:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1595:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1596:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1597:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1598:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** /* These are old tests from above, under if(dataEnable)
1599:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****    They should all be implemented in lcdStuff.c, but have not been
1600:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****    retested since...
1601:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if(defined(BLUE_DIAG_BAR) && BLUE_DIAG_BAR)
1602:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       uint16_t blueCyc = DOTS_TO_CYC(rowNum);
1603:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       uint16_t notBlueCyc = DOTS_TO_CYC(DE_ACTIVE_DOTS)-blueCyc;
1604:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       
1605:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       DEonly_fromNada();
1606:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       delay_cyc(notBlueCyc);
1607:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       DEblue_fromDEonly();
1608:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       delay_cyc(blueCyc);
1609:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1610:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       Nada_fromDEblue();
1611:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif(defined(BLUE_VERT_BAR) && BLUE_VERT_BAR)
1612:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       DEonly_fromNada();
1613:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       delay_cyc(DOTS_TO_CYC(DE_ACTIVE_DOTS)/3);
1614:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       DEblue_fromDEonly();
1615:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       delay_cyc(DOTS_TO_CYC(DE_ACTIVE_DOTS)*2/3);
1616:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       Nada_fromDEblue();
1617:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #elif(defined(DE_BLUE) && DE_BLUE)
1618:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       DEblue_fromNada();
1619:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       delay_cyc(DOTS_TO_CYC(DE_ACTIVE_DOTS));
1620:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       Nada_fromDEblue();
1621:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #else  //NOT BLUE_DIAG_BAR, BLUE_VERT_BAR, NOR DE_BLUE
1622:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #if ( defined(COLOR_BAR_SCROLL) && COLOR_BAR_SCROLL)
1623:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       if(rowNum <= 256)
1624:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****          rowNum=0;
1625:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       else
1626:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****          rowNum=1;
1627:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #else //NOT COLOR_BAR_SCROLL... drawPix...
1628:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** */
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 114


1629:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1630:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1631:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1632:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1633:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //a/o sdramThing2.0v8 early... appears to be syncing on Blue signal
1634:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // thus we get diagonal data including Hsync (colored in red) along the
1635:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // as a diagonal stripe at the right
1636:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if(defined(BLUE_DIAG_BAR) && BLUE_DIAG_BAR)
1637:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** static __inline__ void drawPix(uint16_t rowNum)
1638:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** {
1639:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//uint16_t blueCyc = DOTS_TO_CYC(rowNum);
1640:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//uint16_t notBlueCyc = DOTS_TO_CYC(DE_ACTIVE_DOTS)-blueCyc;
1641:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		uint16_t blueDots = rowNum;
1642:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		uint16_t notBlueDots = DE_ACTIVE_DOTS - blueDots;
1643:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1644:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DEonly_fromNada();
1645:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//delay_cyc(notBlueCyc);
1646:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//delay_Dots(notBlueDots);
1647:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DE_DotDelay(notBlueDots);
1648:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DEblue_fromDEonly();
1649:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//delay_cyc(blueCyc);
1650:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//delay_Dots(blueDots);
1651:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DE_DotDelay(blueDots);
1652:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		Nada_fromDEblue();
1653:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** }
1654:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1655:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1656:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //a/o sdramThing2.0v8-31ish: LooksPromising, but delayed
1657:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // also LVDS bit-shifts causing vertical striping
1658:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if(defined(BLUE_VERT_BAR) && BLUE_VERT_BAR)
1659:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** static __inline__ void drawPix(uint16_t rowNum)
1660:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** {
1661:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DEonly_fromNada();
1662:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//delay_cyc(DOTS_TO_CYC(DE_ACTIVE_DOTS)/3);
1663:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//delay_Dots(DE_ACTIVE_DOTS/3);
1664:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DE_DotDelay(DE_ACTIVE_DOTS/3);
1665:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DEblue_fromDEonly();
1666:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//delay_cyc(DOTS_TO_CYC(DE_ACTIVE_DOTS)*2/3);
1667:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//delay_Dots(DE_ACTIVE_DOTS - DE_ACTIVE_DOTS/3);
1668:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DE_DotDelay(DE_ACTIVE_DOTS - DE_ACTIVE_DOTS/3);
1669:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		Nada_fromDEblue();
1670:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** }
1671:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1672:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1673:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //a/o sdramThing2.0v8-32 nogo... syncs at end of blue instead of Hsync
1674:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if(defined(BLUE_VERT_BAR_REVERSED) && BLUE_VERT_BAR_REVERSED)
1675:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** static __inline__ void drawPix(uint16_t rowNum)
1676:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** {
1677:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DEblue_fromNada();
1678:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//delay_cyc(DOTS_TO_CYC(DE_ACTIVE_DOTS)/3);
1679:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//delay_Dots(DE_ACTIVE_DOTS/3);
1680:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DE_DotDelay(DE_ACTIVE_DOTS/3);
1681:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DEonly_fromDEblue();
1682:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//delay_cyc(DOTS_TO_CYC(DE_ACTIVE_DOTS)*2/3);
1683:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//delay_Dots(DE_ACTIVE_DOTS - DE_ACTIVE_DOTS/3);
1684:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DE_DotDelay(DE_ACTIVE_DOTS - DE_ACTIVE_DOTS/3);
1685:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		Nada_fromDEonly();
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 115


1686:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** }
1687:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1688:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1689:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1690:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if(defined(DE_BLUE) && DE_BLUE)
1691:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** static __inline__ void drawPix(uint16_t rowNum)
1692:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** {
1693:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DEblue_fromNada();
1694:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//delay_cyc(DOTS_TO_CYC(DE_ACTIVE_DOTS));
1695:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//delay_Dots(DE_ACTIVE_DOTS);
1696:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DE_DotDelay(DE_ACTIVE_DOTS);
1697:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		Nada_fromDEblue();
1698:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** }
1699:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1700:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1701:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if(defined(BLUE_BORDER) && (BLUE_BORDER!=0))
1702:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** static __inline__ void drawPix(uint16_t rowNum)
1703:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** {
1704:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DEblue_fromNada();
1705:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DE_DotDelay(BLUE_BORDER);
1706:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DEonly_fromDEblue();
1707:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DE_DotDelay(DE_ACTIVE_DOTS - BLUE_BORDER*2);
1708:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DEblue_fromDEonly();
1709:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		DE_DotDelay(BLUE_BORDER);
1710:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		Nada_fromDEblue();
1711:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** }
1712:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1713:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1714:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if 0
1715:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //NOT BLUE_DIAG_BAR, BLUE_VERT_BAR, NOR DE_BLUE
1716:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #if ( defined(COLOR_BAR_SCROLL) && COLOR_BAR_SCROLL)
1717:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		if(rowNum <= 256)
1718:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			rowNum=0;
1719:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		else
1720:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			rowNum=1;
1721:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #else //NOT COLOR_BAR_SCROLL... drawPix...
1722:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//#warning "see 'shouldBe' here..."
1723:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//Should be:
1724:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		rowNum = rowNum*FB_HEIGHT/V_COUNT;
1725:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//rowNum = rowNum / (768/FB_HEIGHT);
1726:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #endif
1727:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1728:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//DEonly_fromNada();
1729:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       drawPix(rowNum);
1730:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//Nada_init();
1731:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****  #warning "THIS ISN'T SAFE"
1732:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		Nada_fromDEonly();
1733:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//Drawing Methods...
1734:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1735:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #if 0 //(defined(CLOCK_INSENSITIVITY_TESTING) && CLOCK_INSENSITIVITY_TESTING)
1736:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//!!! Not sure what the state is at this point...
1737:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		// could be any DE+Blue level, or could be NADA...
1738:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		// Nada: DT1=3, still leaves one bit for clocking, might be OK
1739:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1740:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       //Disable complementary-output for Green 
1741:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//  (on /OC1B, where CLK is OC1B)
1742:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		// Since Nada, V, and H DT's might be bad for clocking.
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 116


1743:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       TCCR1A = ( (0<<COM1A1) | (1<<COM1A0)
1744:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****                | (1<<COM1B1) | (0<<COM1B0)
1745:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****                | (1<<PWM1A) | (1<<PWM1B) );
1746:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1747:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1748:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//colorOverride removed in LVDS, revisit LCDdirect50
1749:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** #endif
1750:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1751:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1752:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1753:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // AND HERE!!!
1754:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1755:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** // rowNum is only used when DE is active...
1756:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** //  and should be 0 at *drawn row* 0
1757:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** void loadData(uint16_t rowNum, uint8_t dataEnable)
1758:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** {
1759:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	//H Active pulse...
1760:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****    if(vSync)
 1665               		.stabn	68,0,1760,.LM176-.LFBB17
 1666               	.LM176:
 1667 067a 2091 0000 		lds r18,vSync
 1668 067e 2223      		tst r18
 1669 0680 01F0      		breq .L106
1761:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****    {
1762:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 		//Vsync_fromNada() is called at the end of the last interupt
1763:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       VplusH_fromVsync();
 1670               		.stabn	68,0,1763,.LM177-.LFBB17
 1671               	.LM177:
 1672 0682 1DBC      		out 77-0x20,__zero_reg__
 1673               	.LBB132:
 1674               	.LBB133:
 1675               	.LBB134:
 1676               	.LBB135:
 1677               		.stabs	"/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h",132,0,0,.Ltext14
 1678               	.Ltext14:
 1679               		.stabn	68,0,105,.LM178-.LFBB17
 1680               	.LM178:
 1681 0684 EFEA      		ldi r30,lo8(175)
 1682 0686 F0E0      		ldi r31,hi8(175)
 1683               	/* #APP */
 1684               	 ;  105 "/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h" 1
 1685 0688 3197      		1: sbiw r30,1
 1686 068a 01F4      		brne 1b
 1687               	 ;  0 "" 2
 1688               	/* #NOAPP */
 1689               	.LBE135:
 1690               	.LBE134:
 1691               	.LBE133:
 1692               	.LBE132:
 1693               		.stabs	"_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c",132,0,0,.Ltext15
 1694               	.Ltext15:
1764:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       Hlow_Delay();
1765:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       Vsync_fromVplusH();
 1695               		.stabn	68,0,1765,.LM179-.LFBB17
 1696               	.LM179:
 1697 068c 25E0      		ldi r18,lo8(5)
 1698 068e 00C0      		rjmp .L117
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 117


 1699               	.L106:
1766:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       HD_Delay();
1767:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****    }
1768:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****    else
1769:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****    {
1770:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       Hsync_fromNada();
 1700               		.stabn	68,0,1770,.LM180-.LFBB17
 1701               	.LM180:
 1702 0690 23E0      		ldi r18,lo8(3)
 1703 0692 2DBD      		out 77-0x20,r18
 1704               	.LBB136:
 1705               	.LBB137:
 1706               	.LBB138:
 1707               	.LBB139:
 1708               		.stabs	"/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h",132,0,0,.Ltext16
 1709               	.Ltext16:
 1710               		.stabn	68,0,105,.LM181-.LFBB17
 1711               	.LM181:
 1712 0694 EFEA      		ldi r30,lo8(175)
 1713 0696 F0E0      		ldi r31,hi8(175)
 1714               	/* #APP */
 1715               	 ;  105 "/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h" 1
 1716 0698 3197      		1: sbiw r30,1
 1717 069a 01F4      		brne 1b
 1718               	 ;  0 "" 2
 1719               	/* #NOAPP */
 1720               	.LBE139:
 1721               	.LBE138:
 1722               	.LBE137:
 1723               	.LBE136:
 1724               		.stabs	"_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c",132,0,0,.Ltext17
 1725               	.Ltext17:
1771:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       Hlow_Delay();
1772:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       Nada_fromHsync();
 1726               		.stabn	68,0,1772,.LM182-.LFBB17
 1727               	.LM182:
 1728 069c 24E0      		ldi r18,lo8(4)
 1729               	.L117:
 1730 069e 2DBD      		out 77-0x20,r18
 1731               	.LBB140:
 1732               	.LBB141:
 1733               	.LBB142:
 1734               	.LBB143:
 1735               		.stabs	"/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h",132,0,0,.Ltext18
 1736               	.Ltext18:
 1737               		.stabn	68,0,105,.LM183-.LFBB17
 1738               	.LM183:
 1739 06a0 E8E5      		ldi r30,lo8(88)
 1740 06a2 F0E0      		ldi r31,hi8(88)
 1741               	/* #APP */
 1742               	 ;  105 "/usr/local/lib/gcc/avr/4.4.5/../../../../avr/include/util/delay_basic.h" 1
 1743 06a4 3197      		1: sbiw r30,1
 1744 06a6 01F4      		brne 1b
 1745               	 ;  0 "" 2
 1746               	/* #NOAPP */
 1747               	.LBE143:
 1748               	.LBE142:
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 118


 1749               	.LBE141:
 1750               	.LBE140:
 1751               		.stabs	"_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c",132,0,0,.Ltext19
 1752               	.Ltext19:
1773:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****       HD_Delay();
1774:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****    }
1775:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 
1776:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c ****    if(dataEnable)
 1753               		.stabn	68,0,1776,.LM184-.LFBB17
 1754               	.LM184:
 1755 06a8 9923      		tst r25
 1756 06aa 01F0      		breq .L108
 1757               	.LBB144:
 1758               	.LBB145:
 1759               		.stabs	"main.c",132,0,0,.Ltext20
 1760               	.Ltext20:
 464:main.c        **** 	rsb_drawPix(rowNum);
 1761               		.stabn	68,0,464,.LM185-.LFBB17
 1762               	.LM185:
 1763 06ac 8652      		subi r24,lo8(-(-38))
 1764 06ae 00D0      		rcall rsb_drawPix
 1765               	.L108:
 1766               	.LBE145:
 1767               	.LBE144:
 1768               	.LBE131:
 1769               	.LBE130:
 1770               		.stabs	"_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c",132,0,0,.Ltext21
 1771               	.Ltext21:
1190:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	hsyncCount++;
 1772               		.stabn	68,0,1190,.LM186-.LFBB17
 1773               	.LM186:
 1774 06b0 8091 0000 		lds r24,hsyncCount
 1775 06b4 9091 0000 		lds r25,(hsyncCount)+1
 1776 06b8 0196      		adiw r24,1
 1777 06ba 9093 0000 		sts (hsyncCount)+1,r25
 1778 06be 8093 0000 		sts hsyncCount,r24
1192:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 	switch(hsyncCount)
 1779               		.stabn	68,0,1192,.LM187-.LFBB17
 1780               	.LM187:
 1781 06c2 8332      		cpi r24,35
 1782 06c4 9105      		cpc r25,__zero_reg__
 1783 06c6 01F0      		breq .L111
 1784 06c8 8432      		cpi r24,36
 1785 06ca 9105      		cpc r25,__zero_reg__
 1786 06cc 00F4      		brsh .L114
 1787 06ce 8330      		cpi r24,3
 1788 06d0 9105      		cpc r25,__zero_reg__
 1789 06d2 01F4      		brne .L118
 1790 06d4 00C0      		rjmp .L121
 1791               	.L114:
 1792 06d6 8632      		cpi r24,38
 1793 06d8 9105      		cpc r25,__zero_reg__
 1794 06da 01F0      		breq .L112
 1795 06dc 23E0      		ldi r18,hi8(806)
 1796 06de 8632      		cpi r24,lo8(806)
 1797 06e0 9207      		cpc r25,r18
 1798 06e2 01F4      		brne .L118
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 119


 1799 06e4 00C0      		rjmp .L122
 1800               	.L121:
1198:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			dataEnable = FALSE;
 1801               		.stabn	68,0,1198,.LM188-.LFBB17
 1802               	.LM188:
 1803 06e6 1092 0000 		sts dataEnable,__zero_reg__
1200:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			vSync = TRUE;
 1804               		.stabn	68,0,1200,.LM189-.LFBB17
 1805               	.LM189:
 1806 06ea 81E0      		ldi r24,lo8(1)
 1807 06ec 8093 0000 		sts vSync,r24
1201:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			Vsync_fromNada();
 1808               		.stabn	68,0,1201,.LM190-.LFBB17
 1809               	.LM190:
 1810 06f0 80E4      		ldi r24,lo8(64)
 1811 06f2 84BD      		out 68-0x20,r24
 1812 06f4 85E0      		ldi r24,lo8(5)
 1813 06f6 00C0      		rjmp .L119
 1814               	.L111:
1210:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			vSync = FALSE;
 1815               		.stabn	68,0,1210,.LM191-.LFBB17
 1816               	.LM191:
 1817 06f8 1092 0000 		sts vSync,__zero_reg__
1211:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			Nada_fromVsync();
 1818               		.stabn	68,0,1211,.LM192-.LFBB17
 1819               	.LM192:
 1820 06fc 80E3      		ldi r24,lo8(48)
 1821 06fe 84BD      		out 68-0x20,r24
 1822 0700 84E0      		ldi r24,lo8(4)
 1823               	.L119:
 1824 0702 8DBD      		out 77-0x20,r24
 1825 0704 00C0      		rjmp .L118
 1826               	.L112:
1215:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			dataEnable = TRUE;
 1827               		.stabn	68,0,1215,.LM193-.LFBB17
 1828               	.LM193:
 1829 0706 81E0      		ldi r24,lo8(1)
 1830 0708 8093 0000 		sts dataEnable,r24
 1831               	.L118:
 1832 070c 80E0      		ldi r24,lo8(0)
1216:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			break;
 1833               		.stabn	68,0,1216,.LM194-.LFBB17
 1834               	.LM194:
 1835 070e 0895      		ret
 1836               	.L122:
1220:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			dataEnable = FALSE;
 1837               		.stabn	68,0,1220,.LM195-.LFBB17
 1838               	.LM195:
 1839 0710 1092 0000 		sts dataEnable,__zero_reg__
1225:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** 			hsyncCount = 0;
 1840               		.stabn	68,0,1225,.LM196-.LFBB17
 1841               	.LM196:
 1842 0714 1092 0000 		sts (hsyncCount)+1,__zero_reg__
 1843 0718 1092 0000 		sts hsyncCount,__zero_reg__
 1844 071c 81E0      		ldi r24,lo8(1)
1266:_commonCode_localized/lcdStuff/0.52ncf/lcdStuff.c **** }
 1845               		.stabn	68,0,1266,.LM197-.LFBB17
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 120


 1846               	.LM197:
 1847 071e 0895      		ret
 1848               		.size	updateLCD, .-updateLCD
 1849               		.stabs	"frameComplete:r(3,2)",64,0,1170,24
 1850               		.stabn	192,0,0,.LFBB17-.LFBB17
 1851               		.stabs	"__count:r(3,4)",64,0,36,30
 1852               		.stabn	192,0,0,.LBB134-.LFBB17
 1853               		.stabn	224,0,0,.LBE134-.LFBB17
 1854               		.stabs	"__count:r(3,4)",64,0,36,30
 1855               		.stabn	192,0,0,.LBB138-.LFBB17
 1856               		.stabn	224,0,0,.LBE138-.LFBB17
 1857               		.stabs	"__count:r(3,4)",64,0,36,30
 1858               		.stabn	192,0,0,.LBB142-.LFBB17
 1859               		.stabn	224,0,0,.LBE142-.LFBB17
 1860               		.stabn	224,0,0,.Lscope17-.LFBB17
 1861               	.Lscope17:
 1862               		.stabs	"",36,0,0,.Lscope17-.LFBB17
 1863               		.stabd	78,0,0
 1864               		.stabs	"init_timer0Hsync:F(0,15)",36,0,6,init_timer0Hsync
 1865               	.global	init_timer0Hsync
 1866               		.type	init_timer0Hsync, @function
 1867               	init_timer0Hsync:
 1868               		.stabd	46,0,0
 1869               		.stabs	"timer0Stuff.c",132,0,0,.Ltext22
 1870               	.Ltext22:
   1:timer0Stuff.c **** #include "timer0Stuff.h"
   2:timer0Stuff.c **** 
   3:timer0Stuff.c **** //Testing with values returned by timer0Calculator
   4:timer0Stuff.c **** //#define TIMER0_OCRVAL	65
   5:timer0Stuff.c **** 
   6:timer0Stuff.c **** void init_timer0Hsync(void)
   7:timer0Stuff.c **** {
 1871               		.stabn	68,0,7,.LM198-.LFBB18
 1872               	.LM198:
 1873               	.LFBB18:
 1874               	/* prologue: function */
 1875               	/* frame size = 0 */
   8:timer0Stuff.c ****    OCR0A = TIMER0_OCRVAL; //T_Hlow_CYC + T_HD_CYC + T_DE_CYC + T_DH_CYC;
 1876               		.stabn	68,0,8,.LM199-.LFBB18
 1877               	.LM199:
 1878 0720 84E8      		ldi r24,lo8(-124)
 1879 0722 83BB      		out 51-0x20,r24
   9:timer0Stuff.c ****    timer_setWGM(0, WGM_CLR_ON_COMPARE);
 1880               		.stabn	68,0,9,.LM200-.LFBB18
 1881               	.LM200:
 1882 0724 80E0      		ldi r24,lo8(0)
 1883 0726 62E0      		ldi r22,lo8(2)
 1884 0728 00D0      		rcall timer_setWGM
  10:timer0Stuff.c ****    timer_selectDivisor(0, TIMER0_CLKDIV); //CLKDIV1);
 1885               		.stabn	68,0,10,.LM201-.LFBB18
 1886               	.LM201:
 1887 072a 80E0      		ldi r24,lo8(0)
 1888 072c 66E0      		ldi r22,lo8(6)
 1889 072e 00D0      		rcall timer_selectDivisor
  11:timer0Stuff.c ****    timer_compareMatchIntEnable(0, OUT_CHANNELA);
 1890               		.stabn	68,0,11,.LM202-.LFBB18
 1891               	.LM202:
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 121


 1892 0730 80E0      		ldi r24,lo8(0)
 1893 0732 60E0      		ldi r22,lo8(0)
 1894 0734 41E0      		ldi r20,lo8(1)
 1895 0736 00D0      		rcall timer_compareMatchIntSetup
 1896               	/* epilogue start */
  12:timer0Stuff.c **** }
 1897               		.stabn	68,0,12,.LM203-.LFBB18
 1898               	.LM203:
 1899 0738 0895      		ret
 1900               		.size	init_timer0Hsync, .-init_timer0Hsync
 1901               	.Lscope18:
 1902               		.stabs	"",36,0,0,.Lscope18-.LFBB18
 1903               		.stabd	78,0,0
 1904               		.stabs	"main:F(0,1)",36,0,478,main
 1905               	.global	main
 1906               		.type	main, @function
 1907               	main:
 1908               		.stabd	46,0,0
 1909               		.stabs	"main.c",132,0,0,.Ltext23
 1910               	.Ltext23:
 479:main.c        **** {
 1911               		.stabn	68,0,479,.LM204-.LFBB19
 1912               	.LM204:
 1913               	.LFBB19:
 1914               	/* prologue: function */
 1915               	/* frame size = 0 */
 486:main.c        **** 	tetInit(3);
 1916               		.stabn	68,0,486,.LM205-.LFBB19
 1917               	.LM205:
 1918 073a 83E0      		ldi r24,lo8(3)
 1919 073c 00D0      		rcall tetInit
 488:main.c        **** 	init_timer0Hsync();
 1920               		.stabn	68,0,488,.LM206-.LFBB19
 1921               	.LM206:
 1922 073e 00D0      		rcall init_timer0Hsync
 495:main.c        **** 	lvds_timerInit();
 1923               		.stabn	68,0,495,.LM207-.LFBB19
 1924               	.LM207:
 1925 0740 00D0      		rcall lvds_timerInit
 1926               	.L126:
 1927 0742 00C0      		rjmp .L126
 1928               		.size	main, .-main
 1929               	.Lscope19:
 1930               		.stabs	"",36,0,0,.Lscope19-.LFBB19
 1931               		.stabd	78,0,0
 1932               		.stabs	"__vector_14:F(0,15)",36,0,201,__vector_14
 1933               	.global	__vector_14
 1934               		.type	__vector_14, @function
 1935               	__vector_14:
 1936               		.stabd	46,0,0
 202:main.c        **** {
 1937               		.stabn	68,0,202,.LM208-.LFBB20
 1938               	.LM208:
 1939               	.LFBB20:
 1940 0744 1F92      		push __zero_reg__
 1941 0746 0F92      		push r0
 1942 0748 0FB6      		in r0,__SREG__
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 122


 1943 074a 0F92      		push r0
 1944 074c 1124      		clr __zero_reg__
 1945 074e 6F92      		push r6
 1946 0750 7F92      		push r7
 1947 0752 8F92      		push r8
 1948 0754 9F92      		push r9
 1949 0756 AF92      		push r10
 1950 0758 BF92      		push r11
 1951 075a DF92      		push r13
 1952 075c EF92      		push r14
 1953 075e FF92      		push r15
 1954 0760 0F93      		push r16
 1955 0762 1F93      		push r17
 1956 0764 2F93      		push r18
 1957 0766 3F93      		push r19
 1958 0768 4F93      		push r20
 1959 076a 5F93      		push r21
 1960 076c 6F93      		push r22
 1961 076e 7F93      		push r23
 1962 0770 8F93      		push r24
 1963 0772 9F93      		push r25
 1964 0774 AF93      		push r26
 1965 0776 BF93      		push r27
 1966 0778 CF93      		push r28
 1967 077a DF93      		push r29
 1968 077c EF93      		push r30
 1969 077e FF93      		push r31
 1970               	/* prologue: Signal */
 1971               	/* frame size = 0 */
 211:main.c        **** 	if(updateLCD())
 1972               		.stabn	68,0,211,.LM209-.LFBB20
 1973               	.LM209:
 1974 0780 00D0      		rcall updateLCD
 1975 0782 8823      		tst r24
 1976 0784 01F0      		breq .L129
 213:main.c        **** 		frameCount++;
 1977               		.stabn	68,0,213,.LM210-.LFBB20
 1978               	.LM210:
 1979 0786 8091 0000 		lds r24,frameCount.2159
 1980 078a 8F5F      		subi r24,lo8(-(1))
 1981 078c 8093 0000 		sts frameCount.2159,r24
 1982               	.L129:
 225:main.c        **** 	if((hsyncCount >= T_VD+T_Vlow) && (hsyncCount < T_VD+T_Vlow+V_COUNT))
 1983               		.stabn	68,0,225,.LM211-.LFBB20
 1984               	.LM211:
 1985 0790 C091 0000 		lds r28,hsyncCount
 1986 0794 D091 0000 		lds r29,(hsyncCount)+1
 1987 0798 A397      		sbiw r28,35
 1988 079a 23E0      		ldi r18,hi8(768)
 1989 079c C030      		cpi r28,lo8(768)
 1990 079e D207      		cpc r29,r18
 1991 07a0 00F0      		brlo .+2
 1992 07a2 00C0      		rjmp .L170
 1993               	.LBB166:
 1994               	.LBB167:
 302:main.c        **** 	if(rowNum == 0)
 1995               		.stabn	68,0,302,.LM212-.LFBB20
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 123


 1996               	.LM212:
 1997 07a4 2097      		sbiw r28,0
 1998 07a6 01F4      		brne .L131
 307:main.c        **** 		tetUpdate();
 1999               		.stabn	68,0,307,.LM213-.LFBB20
 2000               	.LM213:
 2001 07a8 00D0      		rcall tetUpdate
 2002               	.L131:
 309:main.c        **** 	if(rowNum % TET_VSTRETCH == 0)
 2003               		.stabn	68,0,309,.LM214-.LFBB20
 2004               	.LM214:
 2005 07aa CE01      		movw r24,r28
 2006 07ac 8F70      		andi r24,lo8(15)
 2007 07ae 9070      		andi r25,hi8(15)
 2008 07b0 0097      		sbiw r24,0
 2009 07b2 01F0      		breq .+2
 2010 07b4 00C0      		rjmp .L132
 2011               	.LBB168:
 313:main.c        **** 			rowBuffer[i] = fb_to_rb(_K);
 2012               		.stabn	68,0,313,.LM215-.LFBB20
 2013               	.LM215:
 2014 07b6 80E0      		ldi r24,lo8(0)
 2015 07b8 00D0      		rcall fb_to_rb
 2016 07ba D82E      		mov r13,r24
 2017 07bc E0E0      		ldi r30,lo8(rowBuffer)
 2018 07be F0E0      		ldi r31,hi8(rowBuffer)
 201:main.c        **** SIGNAL(TIMER0_COMPA_vect)
 2019               		.stabn	68,0,201,.LM216-.LFBB20
 2020               	.LM216:
 2021 07c0 7F01      		movw r14,r30
 2022               	.L133:
 313:main.c        **** 			rowBuffer[i] = fb_to_rb(_K);
 2023               		.stabn	68,0,313,.LM217-.LFBB20
 2024               	.LM217:
 2025 07c2 D192      		st Z+,r13
 312:main.c        **** 		for(i=0; i<RB_WIDTH; i++)
 2026               		.stabn	68,0,312,.LM218-.LFBB20
 2027               	.LM218:
 2028 07c4 30E0      		ldi r19,hi8(rowBuffer+64)
 2029 07c6 E030      		cpi r30,lo8(rowBuffer+64)
 2030 07c8 F307      		cpc r31,r19
 2031 07ca 01F4      		brne .L133
 316:main.c        **** 		tet_drawRow(rowNum/TET_VSTRETCH, rowBuffer);
 2032               		.stabn	68,0,316,.LM219-.LFBB20
 2033               	.LM219:
 2034 07cc CE01      		movw r24,r28
 2035 07ce 64E0      		ldi r22,4
 2036 07d0 9695      	1:	lsr r25
 2037 07d2 8795      		ror r24
 2038 07d4 6A95      		dec r22
 2039 07d6 01F4      		brne 1b
 2040 07d8 182F      		mov r17,r24
 2041               	.LBB169:
 2042               	.LBB170:
 2043               		.stabs	"tetStuff.c",132,0,0,.Ltext24
 2044               	.Ltext24:
 118:tetStuff.c    **** 	if( (rowNum >= TET_TOP_ROW) &&
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 124


 2045               		.stabn	68,0,118,.LM220-.LFBB20
 2046               	.LM220:
 2047 07da 8231      		cpi r24,lo8(18)
 2048 07dc 00F4      		brsh .L134
 122:tetStuff.c    **** 		rowBuffer[0]=fb_to_rb(_W);
 2049               		.stabn	68,0,122,.LM221-.LFBB20
 2050               	.LM221:
 2051 07de 8FE3      		ldi r24,lo8(63)
 2052 07e0 00D0      		rcall fb_to_rb
 2053 07e2 082F      		mov r16,r24
 2054 07e4 8093 0000 		sts rowBuffer,r24
 2055 07e8 50E0      		ldi r21,lo8(rowBuffer)
 2056 07ea 652E      		mov r6,r21
 2057 07ec 50E0      		ldi r21,hi8(rowBuffer)
 2058 07ee 752E      		mov r7,r21
 2059 07f0 8824      		clr r8
 2060 07f2 9924      		clr r9
 128:tetStuff.c    **** 				fb_to_rb(tetBrick_to_fb(
 2061               		.stabn	68,0,128,.LM222-.LFBB20
 2062               	.LM222:
 2063 07f4 A12E      		mov r10,r17
 2064 07f6 BB24      		clr r11
 2065 07f8 AA0C      		lsl r10
 2066 07fa BB1C      		rol r11
 2067 07fc AA0C      		lsl r10
 2068 07fe BB1C      		rol r11
 2069 0800 80E0      		ldi r24,lo8(tetRow)
 2070 0802 90E0      		ldi r25,hi8(tetRow)
 2071 0804 A80E      		add r10,r24
 2072 0806 B91E      		adc r11,r25
 2073               	.L135:
 2074 0808 F501      		movw r30,r10
 2075 080a 8081      		ld r24,Z
 2076 080c 9181      		ldd r25,Z+1
 2077 080e A281      		ldd r26,Z+2
 2078 0810 B381      		ldd r27,Z+3
 2079 0812 082C      		mov r0,r8
 2080 0814 00C0      		rjmp 2f
 2081 0816 B695      	1:	lsr r27
 2082 0818 A795      		ror r26
 2083 081a 9795      		ror r25
 2084 081c 8795      		ror r24
 2085 081e 0A94      	2:	dec r0
 2086 0820 02F4      		brpl 1b
 2087 0822 8770      		andi r24,lo8(7)
 2088 0824 00D0      		rcall tetBrick_to_fb
 2089 0826 00D0      		rcall fb_to_rb
 127:tetStuff.c    **** 			rowBuffer[i]=
 2090               		.stabn	68,0,127,.LM223-.LFBB20
 2091               	.LM223:
 2092 0828 F301      		movw r30,r6
 2093 082a 8183      		std Z+1,r24
 2094 082c 23E0      		ldi r18,lo8(3)
 2095 082e 30E0      		ldi r19,hi8(3)
 2096 0830 820E      		add r8,r18
 2097 0832 931E      		adc r9,r19
 2098 0834 0894      		sec
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 125


 2099 0836 611C      		adc r6,__zero_reg__
 2100 0838 711C      		adc r7,__zero_reg__
 125:tetStuff.c    **** 		for(i=1; i<=TET_WIDTH; i++)
 2101               		.stabn	68,0,125,.LM224-.LFBB20
 2102               	.LM224:
 2103 083a 3EE1      		ldi r19,lo8(30)
 2104 083c 8316      		cp r8,r19
 2105 083e 9104      		cpc r9,__zero_reg__
 2106 0840 01F4      		brne .L135
 133:tetStuff.c    **** 		rowBuffer[i]=fb_to_rb(_W);
 2107               		.stabn	68,0,133,.LM225-.LFBB20
 2108               	.LM225:
 2109 0842 0093 0000 		sts rowBuffer+11,r16
 2110 0846 00C0      		rjmp .L136
 2111               	.L134:
 138:tetStuff.c    **** 	else if(rowNum == TET_TOP_ROW+TET_HEIGHT)
 2112               		.stabn	68,0,138,.LM226-.LFBB20
 2113               	.LM226:
 2114 0848 8231      		cpi r24,lo8(18)
 2115 084a 01F4      		brne .L136
 140:tetStuff.c    **** 			rowBuffer[i]=fb_to_rb(_W);
 2116               		.stabn	68,0,140,.LM227-.LFBB20
 2117               	.LM227:
 2118 084c 8FE3      		ldi r24,lo8(63)
 2119 084e 00D0      		rcall fb_to_rb
 2120               		.stabs	"main.c",132,0,0,.Ltext25
 2121               	.Ltext25:
 201:main.c        **** SIGNAL(TIMER0_COMPA_vect)
 2122               		.stabn	68,0,201,.LM228-.LFBB20
 2123               	.LM228:
 2124 0850 E0E0      		ldi r30,lo8(rowBuffer)
 2125 0852 F0E0      		ldi r31,hi8(rowBuffer)
 2126               	.L137:
 2127               		.stabs	"tetStuff.c",132,0,0,.Ltext26
 2128               	.Ltext26:
 140:tetStuff.c    **** 			rowBuffer[i]=fb_to_rb(_W);
 2129               		.stabn	68,0,140,.LM229-.LFBB20
 2130               	.LM229:
 2131 0854 8193      		st Z+,r24
 139:tetStuff.c    **** 		for(i=0; i<=TET_WIDTH+1; i++)
 2132               		.stabn	68,0,139,.LM230-.LFBB20
 2133               	.LM230:
 2134 0856 90E0      		ldi r25,hi8(rowBuffer+12)
 2135 0858 E030      		cpi r30,lo8(rowBuffer+12)
 2136 085a F907      		cpc r31,r25
 2137 085c 01F4      		brne .L137
 2138               	.L136:
 147:tetStuff.c    **** 	if((rowNum >= pieceTopRow) &&
 2139               		.stabn	68,0,147,.LM231-.LFBB20
 2140               	.LM231:
 2141 085e 8090 0000 		lds r8,pieceTopRow
 2142 0862 1815      		cp r17,r8
 2143 0864 00F4      		brsh .+2
 2144 0866 00C0      		rjmp .L138
 2145 0868 882D      		mov r24,r8
 2146 086a 90E0      		ldi r25,lo8(0)
 2147 086c 0396      		adiw r24,3
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 126


 2148 086e 212F      		mov r18,r17
 2149 0870 30E0      		ldi r19,lo8(0)
 2150 0872 8217      		cp r24,r18
 2151 0874 9307      		cpc r25,r19
 2152 0876 04F0      		brlt .L138
 2153               	.LBB171:
 2154               	.LBB172:
 155:tetStuff.c    **** 					getTetPieceBrick(pieceNum, pieceOrientation, 
 2155               		.stabn	68,0,155,.LM232-.LFBB20
 2156               	.LM232:
 2157 0878 E12F      		mov r30,r17
 2158 087a E819      		sub r30,r8
 2159 087c 8E2E      		mov r8,r30
 2160 087e 9924      		clr r9
 2161 0880 880C      		lsl r8
 2162 0882 991C      		rol r9
 2163 0884 880C      		lsl r8
 2164 0886 991C      		rol r9
 2165 0888 AA24      		clr r10
 2166 088a BB24      		clr r11
 2167               	.L140:
 2168               	.LBB173:
 2169 088c 8091 0000 		lds r24,pieceNum
 2170 0890 E82F      		mov r30,r24
 2171 0892 F0E0      		ldi r31,lo8(0)
 2172 0894 EE0F      		lsl r30
 2173 0896 FF1F      		rol r31
 2174 0898 EE0F      		lsl r30
 2175 089a FF1F      		rol r31
 2176 089c 9091 0000 		lds r25,pieceOrientation
 2177 08a0 E90F      		add r30,r25
 2178 08a2 F11D      		adc r31,__zero_reg__
 2179 08a4 EE0F      		lsl r30
 2180 08a6 FF1F      		rol r31
 2181 08a8 E050      		subi r30,lo8(-(pgm_tetPiece))
 2182 08aa F040      		sbci r31,hi8(-(pgm_tetPiece))
 2183               	/* #APP */
 2184               	 ;  155 "tetStuff.c" 1
 2185 08ac 2591      		lpm r18, Z+
 2186 08ae 3491      		lpm r19, Z
 2187               		
 2188               	 ;  0 "" 2
 2189               	/* #NOAPP */
 2190               	.LBE173:
 160:tetStuff.c    **** 			if(pieceBrick)
 2191               		.stabn	68,0,160,.LM233-.LFBB20
 2192               	.LM233:
 2193 08b0 A501      		movw r20,r10
 2194 08b2 480D      		add r20,r8
 2195 08b4 591D      		adc r21,r9
 2196 08b6 00C0      		rjmp 2f
 2197 08b8 3695      	1:	lsr r19
 2198 08ba 2795      		ror r18
 2199 08bc 4A95      	2:	dec r20
 2200 08be 02F4      		brpl 1b
 2201 08c0 20FF      		sbrs r18,0
 2202 08c2 00C0      		rjmp .L139
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 127


 163:tetStuff.c    **** 						fb_to_rb(tetBrick_to_fb(pieceNum+1));
 2203               		.stabn	68,0,163,.LM234-.LFBB20
 2204               	.LM234:
 2205 08c4 8F5F      		subi r24,lo8(-(1))
 2206 08c6 00D0      		rcall tetBrick_to_fb
 2207 08c8 00D0      		rcall fb_to_rb
 162:tetStuff.c    **** 				rowBuffer[i+1+pieceLeftCol] =
 2208               		.stabn	68,0,162,.LM235-.LFBB20
 2209               	.LM235:
 2210 08ca E091 0000 		lds r30,pieceLeftCol
 2211 08ce 9501      		movw r18,r10
 2212 08d0 2E0F      		add r18,r30
 2213 08d2 311D      		adc r19,__zero_reg__
 2214 08d4 F901      		movw r30,r18
 2215 08d6 E050      		subi r30,lo8(-(rowBuffer+1))
 2216 08d8 F040      		sbci r31,hi8(-(rowBuffer+1))
 2217 08da 8083      		st Z,r24
 2218               	.L139:
 2219 08dc 0894      		sec
 2220 08de A11C      		adc r10,__zero_reg__
 2221 08e0 B11C      		adc r11,__zero_reg__
 2222               	.LBE172:
 152:tetStuff.c    **** 		for(i=0; i<PIECE_WIDTH; i++)
 2223               		.stabn	68,0,152,.LM236-.LFBB20
 2224               	.LM236:
 2225 08e2 34E0      		ldi r19,lo8(4)
 2226 08e4 A316      		cp r10,r19
 2227 08e6 B104      		cpc r11,__zero_reg__
 2228 08e8 01F4      		brne .L140
 2229               	.L138:
 2230               	.LBE171:
 178:tetStuff.c    ****    switch(rowNum/8)
 2231               		.stabn	68,0,178,.LM237-.LFBB20
 2232               	.LM237:
 2233 08ea 812F      		mov r24,r17
 2234 08ec 8695      		lsr r24
 2235 08ee 8695      		lsr r24
 2236 08f0 8695      		lsr r24
 2237 08f2 8330      		cpi r24,lo8(3)
 2238 08f4 01F0      		breq .L144
 2239 08f6 8430      		cpi r24,lo8(4)
 2240 08f8 00F4      		brsh .L147
 2241 08fa 8130      		cpi r24,lo8(1)
 2242 08fc 01F0      		breq .L142
 2243 08fe 8230      		cpi r24,lo8(2)
 2244 0900 01F4      		brne .L141
 2245 0902 00C0      		rjmp .L190
 2246               	.L147:
 2247 0904 8430      		cpi r24,lo8(4)
 2248 0906 01F4      		brne .+2
 2249 0908 00C0      		rjmp .L145
 2250 090a 8530      		cpi r24,lo8(5)
 2251 090c 01F4      		brne .L141
 2252 090e 00C0      		rjmp .L191
 2253               	.L142:
 2254 0910 25E4      		ldi r18,lo8(69)
 2255 0912 07E0      		ldi r16,lo8(7)
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 128


 2256 0914 00C0      		rjmp .L180
 2257               	.L141:
 2258 0916 24E5      		ldi r18,lo8(84)
 2259 0918 03E0      		ldi r16,lo8(3)
 2260 091a 00C0      		rjmp .L180
 2261               	.L190:
 2262 091c 24E5      		ldi r18,lo8(84)
 2263 091e 0FE0      		ldi r16,lo8(15)
 2264 0920 00C0      		rjmp .L180
 2265               	.L144:
 2266               	.LBB174:
 2267               	.LBB175:
 201:tetStuff.c    ****                temp = getCharRow('R', rowNum%8);
 2268               		.stabn	68,0,201,.LM238-.LFBB20
 2269               	.LM238:
 2270 0922 812F      		mov r24,r17
 2271 0924 90E0      		ldi r25,lo8(0)
 2272 0926 8770      		andi r24,lo8(7)
 2273 0928 9070      		andi r25,hi8(7)
 2274 092a 60E6      		ldi r22,lo8(96)
 2275 092c 70E0      		ldi r23,hi8(96)
 2276 092e 00D0      		rcall __mulhi3
 2277 0930 FC01      		movw r30,r24
 2278 0932 E050      		subi r30,lo8(-(characters+50))
 2279 0934 F040      		sbci r31,hi8(-(characters+50))
 2280               	/* #APP */
 2281               	 ;  201 "tetStuff.c" 1
 2282 0936 E491      		lpm r30, Z
 2283               		
 2284               	 ;  0 "" 2
 2285               	/* #NOAPP */
 2286 0938 27E0      		ldi r18,lo8(7)
 2287 093a 30E0      		ldi r19,hi8(7)
 2288 093c 80E0      		ldi r24,lo8(0)
 2289               	.LBE175:
 205:tetStuff.c    ****                   writebit(7-z, charRow, getbit(z,temp));
 2290               		.stabn	68,0,205,.LM239-.LFBB20
 2291               	.LM239:
 2292 093e F0E0      		ldi r31,lo8(0)
 2293 0940 67E0      		ldi r22,lo8(7)
 2294 0942 70E0      		ldi r23,hi8(7)
 2295 0944 41E0      		ldi r20,lo8(1)
 2296 0946 50E0      		ldi r21,hi8(1)
 2297               	.L151:
 2298 0948 DB01      		movw r26,r22
 2299 094a A21B      		sub r26,r18
 2300 094c B30B      		sbc r27,r19
 2301 094e 5F01      		movw r10,r30
 2302 0950 00C0      		rjmp 2f
 2303 0952 B594      	1:	asr r11
 2304 0954 A794      		ror r10
 2305 0956 AA95      	2:	dec r26
 2306 0958 02F4      		brpl 1b
 2307 095a A0FE      		sbrs r10,0
 2308 095c 00C0      		rjmp .L149
 2309 095e DA01      		movw r26,r20
 2310 0960 022E      		mov r0,r18
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 129


 2311 0962 00C0      		rjmp 2f
 2312 0964 AA0F      	1:	lsl r26
 2313 0966 BB1F      		rol r27
 2314 0968 0A94      	2:	dec r0
 2315 096a 02F4      		brpl 1b
 2316 096c 8A2B      		or r24,r26
 2317 096e 00C0      		rjmp .L150
 2318               	.L149:
 2319 0970 DA01      		movw r26,r20
 2320 0972 022E      		mov r0,r18
 2321 0974 00C0      		rjmp 2f
 2322 0976 AA0F      	1:	lsl r26
 2323 0978 BB1F      		rol r27
 2324 097a 0A94      	2:	dec r0
 2325 097c 02F4      		brpl 1b
 2326 097e 9A2F      		mov r25,r26
 2327 0980 9095      		com r25
 2328 0982 8923      		and r24,r25
 2329               	.L150:
 2330 0984 2150      		subi r18,lo8(-(-1))
 2331 0986 3040      		sbci r19,hi8(-(-1))
 203:tetStuff.c    ****                for(z=0; z<8; z++)
 2332               		.stabn	68,0,203,.LM240-.LFBB20
 2333               	.LM240:
 2334 0988 9FEF      		ldi r25,hi8(-1)
 2335 098a 2F3F      		cpi r18,lo8(-1)
 2336 098c 3907      		cpc r19,r25
 2337 098e 01F4      		brne .L151
 210:tetStuff.c    ****                charRow >>= 1;
 2338               		.stabn	68,0,210,.LM241-.LFBB20
 2339               	.LM241:
 2340 0990 8695      		lsr r24
 2341 0992 20E0      		ldi r18,lo8(0)
 2342 0994 0CE0      		ldi r16,lo8(12)
 2343 0996 00C0      		rjmp .L148
 2344               	.L145:
 2345 0998 29E4      		ldi r18,lo8(73)
 2346 099a 0CE3      		ldi r16,lo8(60)
 2347 099c 00C0      		rjmp .L180
 2348               	.L191:
 2349 099e 23E5      		ldi r18,lo8(83)
 2350 09a0 00E3      		ldi r16,lo8(48)
 2351               	.L180:
 2352 09a2 80E0      		ldi r24,lo8(0)
 2353               	.L148:
 2354               	.LBE174:
 232:tetStuff.c    ****    if(rowNum/8 != 3)
 2355               		.stabn	68,0,232,.LM242-.LFBB20
 2356               	.LM242:
 2357 09a4 912F      		mov r25,r17
 2358 09a6 9851      		subi r25,lo8(-(-24))
 2359 09a8 9830      		cpi r25,lo8(8)
 2360 09aa 00F0      		brlo .L152
 2361               	.LBB176:
 233:tetStuff.c    ****          charRow = getCharRow(character, rowNum%8);
 2362               		.stabn	68,0,233,.LM243-.LFBB20
 2363               	.LM243:
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 130


 2364 09ac 812F      		mov r24,r17
 2365 09ae 90E0      		ldi r25,lo8(0)
 2366 09b0 8770      		andi r24,lo8(7)
 2367 09b2 9070      		andi r25,hi8(7)
 2368 09b4 63E0      		ldi r22,lo8(3)
 2369 09b6 70E0      		ldi r23,hi8(3)
 2370 09b8 00D0      		rcall __mulhi3
 2371 09ba FC01      		movw r30,r24
 2372 09bc 3197      		sbiw r30,1
 2373 09be 85E0      		ldi r24,5
 2374 09c0 EE0F      	1:	lsl r30
 2375 09c2 FF1F      		rol r31
 2376 09c4 8A95      		dec r24
 2377 09c6 01F4      		brne 1b
 2378 09c8 E20F      		add r30,r18
 2379 09ca F11D      		adc r31,__zero_reg__
 2380 09cc E050      		subi r30,lo8(-(characters))
 2381 09ce F040      		sbci r31,hi8(-(characters))
 2382               	/* #APP */
 2383               	 ;  233 "tetStuff.c" 1
 2384 09d0 8491      		lpm r24, Z
 2385               		
 2386               	 ;  0 "" 2
 2387               	/* #NOAPP */
 2388               	.L152:
 2389 09d2 AA24      		clr r10
 2390 09d4 BB24      		clr r11
 2391               	.LBE176:
 239:tetStuff.c    ****          if(getbit(j, charRow))
 2392               		.stabn	68,0,239,.LM244-.LFBB20
 2393               	.LM244:
 2394 09d6 882E      		mov r8,r24
 2395 09d8 9924      		clr r9
 2396               	.L155:
 2397 09da C401      		movw r24,r8
 2398 09dc 0A2C      		mov r0,r10
 2399 09de 00C0      		rjmp 2f
 2400 09e0 9595      	1:	asr r25
 2401 09e2 8795      		ror r24
 2402 09e4 0A94      	2:	dec r0
 2403 09e6 02F4      		brpl 1b
 2404 09e8 80FF      		sbrs r24,0
 2405 09ea 00C0      		rjmp .L153
 241:tetStuff.c    ****             rowBuffer[j+i] = fb_to_rb(color); //0x25);
 2406               		.stabn	68,0,241,.LM245-.LFBB20
 2407               	.LM245:
 2408 09ec 802F      		mov r24,r16
 2409 09ee 00D0      		rcall fb_to_rb
 2410 09f0 F701      		movw r30,r14
 2411 09f2 8787      		std Z+15,r24
 2412 09f4 00C0      		rjmp .L154
 2413               	.L153:
 244:tetStuff.c    ****             rowBuffer[j+i] = fb_to_rb(0x00);
 2414               		.stabn	68,0,244,.LM246-.LFBB20
 2415               	.LM246:
 2416 09f6 F701      		movw r30,r14
 2417 09f8 D786      		std Z+15,r13
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 131


 2418               	.L154:
 2419 09fa 0894      		sec
 2420 09fc A11C      		adc r10,__zero_reg__
 2421 09fe B11C      		adc r11,__zero_reg__
 2422 0a00 0894      		sec
 2423 0a02 E11C      		adc r14,__zero_reg__
 2424 0a04 F11C      		adc r15,__zero_reg__
 238:tetStuff.c    ****    for(j=0; j<8; j++)
 2425               		.stabn	68,0,238,.LM247-.LFBB20
 2426               	.LM247:
 2427 0a06 F8E0      		ldi r31,lo8(8)
 2428 0a08 AF16      		cp r10,r31
 2429 0a0a B104      		cpc r11,__zero_reg__
 2430 0a0c 01F4      		brne .L155
 2431               	.L132:
 2432               	.LBE170:
 2433               	.LBE169:
 2434               	.LBE168:
 2435               	.LBB177:
 2436               	.LBB178:
 2437               		.stabs	"rowSegBuffer.c",132,0,0,.Ltext27
 2438               	.Ltext27:
  49:rowSegBuffer.c **** 	segPosition = 0;
 2439               		.stabn	68,0,49,.LM248-.LFBB20
 2440               	.LM248:
 2441 0a0e 1092 0000 		sts segPosition,__zero_reg__
  52:rowSegBuffer.c **** 	rowSegBuffer[segPosition].red_length = 6;
 2442               		.stabn	68,0,52,.LM249-.LFBB20
 2443               	.LM249:
 2444 0a12 86E0      		ldi r24,lo8(6)
 2445 0a14 8093 0000 		sts rowSegBuffer,r24
  53:rowSegBuffer.c **** 	rowSegBuffer[segPosition].green_blue = (6<<4) | 3;
 2446               		.stabn	68,0,53,.LM250-.LFBB20
 2447               	.LM250:
 2448 0a18 83E6      		ldi r24,lo8(99)
 2449 0a1a 8093 0000 		sts rowSegBuffer+1,r24
 2450               	.LBE178:
 2451               	.LBE177:
 2452               		.stabs	"main.c",132,0,0,.Ltext28
 2453               	.Ltext28:
 321:main.c        **** 	newSeg(3, 0x06, (6<<4) | 3);
 2454               		.stabn	68,0,321,.LM251-.LFBB20
 2455               	.LM251:
 2456 0a1e 83E0      		ldi r24,lo8(3)
 2457 0a20 90E0      		ldi r25,hi8(3)
 2458 0a22 66E0      		ldi r22,lo8(6)
 2459 0a24 43E6      		ldi r20,lo8(99)
 2460 0a26 00D0      		rcall newSeg
 347:main.c        **** 	if(rowNum & 0x01)
 2461               		.stabn	68,0,347,.LM252-.LFBB20
 2462               	.LM252:
 2463 0a28 C0FF      		sbrs r28,0
 2464 0a2a 00C0      		rjmp .L156
 2465 0a2c C1E0      		ldi r28,lo8(1)
 2466 0a2e D0E0      		ldi r29,hi8(1)
 2467               	.L157:
 353:main.c        **** 		rbpix_to_seg(rowBuffer[i], i+1, SEG_STRETCH);
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 132


 2468               		.stabn	68,0,353,.LM253-.LFBB20
 2469               	.LM253:
 2470 0a30 FE01      		movw r30,r28
 2471 0a32 E050      		subi r30,lo8(-(rowBuffer-1))
 2472 0a34 F040      		sbci r31,hi8(-(rowBuffer-1))
 2473 0a36 8081      		ld r24,Z
 2474 0a38 6C2F      		mov r22,r28
 2475 0a3a 45E0      		ldi r20,lo8(5)
 2476 0a3c 00D0      		rcall rbpix_to_seg
 2477 0a3e 2196      		adiw r28,1
 350:main.c        **** 	for(i=0; i<RB_WIDTH; i++)
 2478               		.stabn	68,0,350,.LM254-.LFBB20
 2479               	.LM254:
 2480 0a40 C134      		cpi r28,65
 2481 0a42 D105      		cpc r29,__zero_reg__
 2482 0a44 01F4      		brne .L157
 2483 0a46 00C0      		rjmp .L158
 2484               	.L156:
 2485               	.LBB179:
 366:main.c        **** 		if(rowNum%ROWS_PER == 0)
 2486               		.stabn	68,0,366,.LM255-.LFBB20
 2487               	.LM255:
 2488 0a48 CE01      		movw r24,r28
 2489 0a4a 8F73      		andi r24,lo8(63)
 2490 0a4c 9070      		andi r25,hi8(63)
 2491 0a4e 0097      		sbiw r24,0
 2492 0a50 01F4      		brne .L159
 367:main.c        **** 			hfm_setup(&hfmGradient, 0, ROWS_PER/2-4);
 2493               		.stabn	68,0,367,.LM256-.LFBB20
 2494               	.LM256:
 2495 0a52 80E0      		ldi r24,lo8(hfmGradient.2181)
 2496 0a54 90E0      		ldi r25,hi8(hfmGradient.2181)
 2497 0a56 60E0      		ldi r22,lo8(0)
 2498 0a58 4CE1      		ldi r20,lo8(28)
 2499 0a5a 00D0      		rcall hfm_setup
 2500               	.L159:
 377:main.c        **** 		hfm_setPower(&hfmGradient, (rowNum/2)%(ROWS_PER/2)+4);
 2501               		.stabn	68,0,377,.LM257-.LFBB20
 2502               	.LM257:
 2503 0a5c BE01      		movw r22,r28
 2504 0a5e 7695      		lsr r23
 2505 0a60 6795      		ror r22
 2506 0a62 6F71      		andi r22,lo8(31)
 2507 0a64 6C5F      		subi r22,lo8(-(4))
 2508 0a66 80E0      		ldi r24,lo8(hfmGradient.2181)
 2509 0a68 90E0      		ldi r25,hi8(hfmGradient.2181)
 2510 0a6a 00D0      		rcall hfm_setPower
 379:main.c        **** 		if(hfm_nextOutput(&hfmGradient))
 2511               		.stabn	68,0,379,.LM258-.LFBB20
 2512               	.LM258:
 2513 0a6c 80E0      		ldi r24,lo8(hfmGradient.2181)
 2514 0a6e 90E0      		ldi r25,hi8(hfmGradient.2181)
 2515 0a70 00D0      		rcall hfm_nextOutput
 2516 0a72 B6E0      		ldi r27,6
 2517 0a74 D695      	1:	lsr r29
 2518 0a76 C795      		ror r28
 2519 0a78 BA95      		dec r27
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 133


 2520 0a7a 01F4      		brne 1b
 2521 0a7c 8823      		tst r24
 2522 0a7e 01F0      		breq .L160
 380:main.c        **** 			fbColor = rgbGradient(ROWS_PER-1 - rowNum/(ROWS_PER)+16-1);
 2523               		.stabn	68,0,380,.LM259-.LFBB20
 2524               	.LM259:
 2525 0a80 8EE4      		ldi r24,lo8(78)
 2526 0a82 8C1B      		sub r24,r28
 2527               	.L161:
 2528               	.LBB180:
 2529               	.LBB181:
 2530               		.stabs	"fbColors.h",132,0,0,.Ltext29
 2531               	.Ltext29:
   1:fbColors.h    **** // 7 6 5 4 3 2 1 0
   2:fbColors.h    **** // a a b b g g r r
   3:fbColors.h    **** //             0 0 = 0x00
   4:fbColors.h    **** //             0 1 = 0x01
   5:fbColors.h    **** //             1 0 = 0x02
   6:fbColors.h    **** //             1 1 = 0x03
   7:fbColors.h    **** //         0 0     = 0x00
   8:fbColors.h    **** //         0 1     = 0x04
   9:fbColors.h    **** //         1 0     = 0x08
  10:fbColors.h    **** //         1 1     = 0x0C
  11:fbColors.h    **** //     0 0         = 0x00
  12:fbColors.h    **** //     0 1         = 0x10
  13:fbColors.h    **** //     1 0         = 0x20
  14:fbColors.h    **** //     1 1         = 0x30
  15:fbColors.h    **** 
  16:fbColors.h    **** 
  17:fbColors.h    **** //Takes three values, from 0-3 each...
  18:fbColors.h    **** #define rgb(r,g,b) (((r)&0x03) | (((g)&0x03)<<2) | (((b)&0x03)<<4))
  19:fbColors.h    **** 
  20:fbColors.h    **** 
  21:fbColors.h    **** #define _R  0x03	//0x03						00 00 11
  22:fbColors.h    **** #define _O  0x07	//0x03 | 0x10				00 01 11
  23:fbColors.h    **** #define _Y  0x0F  //0x03 | 0x0C           00 11 11
  24:fbColors.h    **** #define _G 0x0C	//       0x0C				00 11 00
  25:fbColors.h    **** #define _C 0x3C   //       0x0C | 0x30    11 11 00
  26:fbColors.h    **** #define _B 0x30	//              0x30		11 00 00
  27:fbColors.h    **** #define _V 0x13   //0x03 |        0x10		01 00 11
  28:fbColors.h    **** #define _M  0x33	//0x03 |			 0x30		11 00 11
  29:fbColors.h    **** #define _K  0x00	//								00 00 00
  30:fbColors.h    **** #define _W 0x3F	//0x03 | 0x0C | 0x30		11 11 11
  31:fbColors.h    **** #define _r 0x01	//0x01						00 00 01
  32:fbColors.h    **** #define _g 0x04	//			0x04				00 01 00
  33:fbColors.h    **** #define _b 0x10	//					 0x10		01 00 00
  34:fbColors.h    **** #define _c 0x14	//			0x04	 0x10		01 01 00
  35:fbColors.h    **** #define _m 0x11	//0x01 |			 0x10		01 00 01
  36:fbColors.h    **** #define _y 0x05	//0x01 | 0x04				00 01 01
  37:fbColors.h    **** #define _k 0x15	//0x01 | 0x04 | 0x10		01 01 01
  38:fbColors.h    **** #define Tr 0xC0   //Transparent
  39:fbColors.h    **** 
  40:fbColors.h    **** 
  41:fbColors.h    **** //Creates a "gradient" effect, where no color-change is greater than 1
  42:fbColors.h    **** // for each change in value
  43:fbColors.h    **** // except at the crossover from full-blue back to 0... (0x30)
  44:fbColors.h    **** static __inline__ \
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 134


  45:fbColors.h    **** uint8_t rgbGradient(uint8_t value) \
  46:fbColors.h    **** 	__attribute__((__always_inline__));
  47:fbColors.h    **** 
  48:fbColors.h    **** uint8_t rgbGradient(uint8_t value)
  49:fbColors.h    **** {
  50:fbColors.h    **** 	while(value > 0x2f)
  51:fbColors.h    **** 		value -= 0x30;
 2532               		.stabn	68,0,51,.LM260-.LFBB20
 2533               	.LM260:
 2534 0a84 8053      		subi r24,lo8(-(-48))
  50:fbColors.h    **** 	while(value > 0x2f)
 2535               		.stabn	68,0,50,.LM261-.LFBB20
 2536               	.LM261:
 2537 0a86 8033      		cpi r24,lo8(48)
 2538 0a88 00F4      		brsh .L161
 2539 0a8a 00C0      		rjmp .L187
 2540               	.L160:
 2541               	.LBE181:
 2542               	.LBE180:
 2543               		.stabs	"main.c",132,0,0,.Ltext30
 2544               	.Ltext30:
 383:main.c        **** 			fbColor = rgbGradient(ROWS_PER-1 - rowNum/(ROWS_PER)+16);
 2545               		.stabn	68,0,383,.LM262-.LFBB20
 2546               	.LM262:
 2547 0a8c 8FE4      		ldi r24,lo8(79)
 2548 0a8e 8C1B      		sub r24,r28
 2549               	.L166:
 2550               	.LBB182:
 2551               	.LBB183:
 2552               		.stabs	"fbColors.h",132,0,0,.Ltext31
 2553               	.Ltext31:
 2554               		.stabn	68,0,51,.LM263-.LFBB20
 2555               	.LM263:
 2556 0a90 8053      		subi r24,lo8(-(-48))
  50:fbColors.h    **** 	while(value > 0x2f)
 2557               		.stabn	68,0,50,.LM264-.LFBB20
 2558               	.LM264:
 2559 0a92 8033      		cpi r24,lo8(48)
 2560 0a94 00F4      		brsh .L166
 2561               	.L187:
  52:fbColors.h    **** 
  53:fbColors.h    **** 	uint8_t R = ((value)&0x03); 
 2562               		.stabn	68,0,53,.LM265-.LFBB20
 2563               	.LM265:
 2564 0a96 482F      		mov r20,r24
 2565 0a98 4370      		andi r20,lo8(3)
  54:fbColors.h    **** 	uint8_t r = ((value)&0x04) ? (3-R) : R ; 
 2566               		.stabn	68,0,54,.LM266-.LFBB20
 2567               	.LM266:
 2568 0a9a 682F      		mov r22,r24
 2569 0a9c 70E0      		ldi r23,lo8(0)
 2570 0a9e 82FF      		sbrs r24,2
 2571 0aa0 00C0      		rjmp .L167
 2572 0aa2 83E0      		ldi r24,lo8(3)
 2573 0aa4 841B      		sub r24,r20
 2574 0aa6 482F      		mov r20,r24
 2575               	.L167:
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 135


  55:fbColors.h    **** 	uint8_t G = ((value)&0x0C)>>2; 
 2576               		.stabn	68,0,55,.LM267-.LFBB20
 2577               	.LM267:
 2578 0aa8 9B01      		movw r18,r22
 2579 0aaa 2C70      		andi r18,lo8(12)
 2580 0aac 3070      		andi r19,hi8(12)
 2581 0aae 3595      		asr r19
 2582 0ab0 2795      		ror r18
 2583 0ab2 3595      		asr r19
 2584 0ab4 2795      		ror r18
  56:fbColors.h    **** 	uint8_t g = ((value)&0x10) ? (3-G) : G ; 
 2585               		.stabn	68,0,56,.LM268-.LFBB20
 2586               	.LM268:
 2587 0ab6 64FF      		sbrs r22,4
 2588 0ab8 00C0      		rjmp .L168
 2589 0aba 83E0      		ldi r24,lo8(3)
 2590 0abc 821B      		sub r24,r18
 2591 0abe 282F      		mov r18,r24
 2592               	.L168:
  57:fbColors.h    **** 	uint8_t B = ((value)&0x30) >> 4; 
 2593               		.stabn	68,0,57,.LM269-.LFBB20
 2594               	.LM269:
 2595 0ac0 CB01      		movw r24,r22
 2596 0ac2 8073      		andi r24,lo8(48)
 2597 0ac4 9070      		andi r25,hi8(48)
 2598 0ac6 F4E0      		ldi r31,4
 2599 0ac8 9595      	1:	asr r25
 2600 0aca 8795      		ror r24
 2601 0acc FA95      		dec r31
 2602 0ace 01F4      		brne 1b
  58:fbColors.h    **** 	uint8_t b = ((value)&0x40) ? (3-B) : B ;
 2603               		.stabn	68,0,58,.LM270-.LFBB20
 2604               	.LM270:
 2605 0ad0 66FF      		sbrs r22,6
 2606 0ad2 00C0      		rjmp .L169
 2607 0ad4 93E0      		ldi r25,lo8(3)
 2608 0ad6 981B      		sub r25,r24
 2609 0ad8 892F      		mov r24,r25
 2610               	.L169:
  59:fbColors.h    **** 
  60:fbColors.h    **** 	return rgb(r,g,b);
 2611               		.stabn	68,0,60,.LM271-.LFBB20
 2612               	.LM271:
 2613 0ada 30E0      		ldi r19,lo8(0)
 2614 0adc 2370      		andi r18,lo8(3)
 2615 0ade 3070      		andi r19,hi8(3)
 2616 0ae0 220F      		lsl r18
 2617 0ae2 331F      		rol r19
 2618 0ae4 220F      		lsl r18
 2619 0ae6 331F      		rol r19
 2620 0ae8 4370      		andi r20,lo8(3)
 2621 0aea 422B      		or r20,r18
 2622 0aec 90E0      		ldi r25,lo8(0)
 2623 0aee 8370      		andi r24,lo8(3)
 2624 0af0 9070      		andi r25,hi8(3)
 2625 0af2 74E0      		ldi r23,4
 2626 0af4 880F      	1:	lsl r24
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 136


 2627 0af6 991F      		rol r25
 2628 0af8 7A95      		dec r23
 2629 0afa 01F4      		brne 1b
 2630 0afc 482B      		or r20,r24
 2631               	.LBE183:
 2632               	.LBE182:
 2633               		.stabs	"main.c",132,0,0,.Ltext32
 2634               	.Ltext32:
 385:main.c        **** 		addSegfb(RB_WIDTH*SEG_STRETCH, (fbColor));
 2635               		.stabn	68,0,385,.LM272-.LFBB20
 2636               	.LM272:
 2637 0afe 842F      		mov r24,r20
 2638 0b00 90E0      		ldi r25,lo8(0)
 2639 0b02 9C01      		movw r18,r24
 2640 0b04 2370      		andi r18,lo8(3)
 2641 0b06 3070      		andi r19,hi8(3)
 2642 0b08 220F      		lsl r18
 2643 0b0a 331F      		rol r19
 2644 0b0c 642F      		mov r22,r20
 2645 0b0e 6170      		andi r22,lo8(1)
 2646 0b10 622B      		or r22,r18
 2647 0b12 4073      		andi r20,lo8(48)
 2648 0b14 4064      		ori r20,lo8(64)
 2649 0b16 8C70      		andi r24,lo8(12)
 2650 0b18 9070      		andi r25,hi8(12)
 2651 0b1a 9595      		asr r25
 2652 0b1c 8795      		ror r24
 2653 0b1e 9595      		asr r25
 2654 0b20 8795      		ror r24
 2655 0b22 482B      		or r20,r24
 2656 0b24 80E4      		ldi r24,lo8(320)
 2657 0b26 91E0      		ldi r25,hi8(320)
 2658 0b28 00D0      		rcall addSeg
 2659               	.L158:
 2660               	.LBE179:
 391:main.c        **** 	newSeg(3, 0x06, (6<<4) | 3);
 2661               		.stabn	68,0,391,.LM273-.LFBB20
 2662               	.LM273:
 2663 0b2a 83E0      		ldi r24,lo8(3)
 2664 0b2c 90E0      		ldi r25,hi8(3)
 2665 0b2e 66E0      		ldi r22,lo8(6)
 2666 0b30 43E6      		ldi r20,lo8(99)
 2667 0b32 00D0      		rcall newSeg
 392:main.c        **** 	segTerminate();
 2668               		.stabn	68,0,392,.LM274-.LFBB20
 2669               	.LM274:
 2670 0b34 00D0      		rcall segTerminate
 2671               	.L170:
 2672               	/* epilogue start */
 2673               	.LBE167:
 2674               	.LBE166:
 239:main.c        **** }
 2675               		.stabn	68,0,239,.LM275-.LFBB20
 2676               	.LM275:
 2677 0b36 FF91      		pop r31
 2678 0b38 EF91      		pop r30
 2679 0b3a DF91      		pop r29
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 137


 2680 0b3c CF91      		pop r28
 2681 0b3e BF91      		pop r27
 2682 0b40 AF91      		pop r26
 2683 0b42 9F91      		pop r25
 2684 0b44 8F91      		pop r24
 2685 0b46 7F91      		pop r23
 2686 0b48 6F91      		pop r22
 2687 0b4a 5F91      		pop r21
 2688 0b4c 4F91      		pop r20
 2689 0b4e 3F91      		pop r19
 2690 0b50 2F91      		pop r18
 2691 0b52 1F91      		pop r17
 2692 0b54 0F91      		pop r16
 2693 0b56 FF90      		pop r15
 2694 0b58 EF90      		pop r14
 2695 0b5a DF90      		pop r13
 2696 0b5c BF90      		pop r11
 2697 0b5e AF90      		pop r10
 2698 0b60 9F90      		pop r9
 2699 0b62 8F90      		pop r8
 2700 0b64 7F90      		pop r7
 2701 0b66 6F90      		pop r6
 2702 0b68 0F90      		pop r0
 2703 0b6a 0FBE      		out __SREG__,r0
 2704 0b6c 0F90      		pop r0
 2705 0b6e 1F90      		pop __zero_reg__
 2706 0b70 1895      		reti
 2707               		.size	__vector_14, .-__vector_14
 2708               		.stabs	"frameCount:V(3,2)",38,0,203,frameCount.2159
 2709               		.stabn	192,0,0,.LFBB20-.LFBB20
 2710               		.stabs	"charRow:r(3,2)",64,0,175,24
 2711               		.stabs	"color:r(3,2)",64,0,176,16
 2712               		.stabs	"character:r(0,2)",64,0,177,18
 2713               		.stabn	192,0,0,.LBB170-.LFBB20
 2714               		.stabs	"__addr16:r(3,4)",64,0,155,30
 2715               		.stabn	192,0,0,.LBB173-.LFBB20
 2716               		.stabn	224,0,0,.LBE173-.LFBB20
 2717               		.stabs	"__result:r(3,2)",64,0,201,30
 2718               		.stabn	192,0,0,.LBB175-.LFBB20
 2719               		.stabn	224,0,0,.LBE175-.LFBB20
 2720               		.stabn	224,0,0,.LBE170-.LFBB20
 2721               		.stabs	"fbColor:r(3,2)",64,0,362,20
 2722               		.stabn	192,0,0,.LBB179-.LFBB20
 2723               		.stabs	"value:r(3,2)",64,0,380,24
 2724               		.stabn	192,0,0,.LBB180-.LFBB20
 2725               		.stabs	"r:r(3,2)",64,0,54,20
 2726               		.stabs	"g:r(3,2)",64,0,56,18
 2727               		.stabs	"b:r(3,2)",64,0,58,24
 2728               		.stabn	192,0,0,.LBB181-.LFBB20
 2729               		.stabn	224,0,0,.LBE181-.LFBB20
 2730               		.stabn	224,0,0,.LBE180-.LFBB20
 2731               		.stabs	"value:r(3,2)",64,0,383,24
 2732               		.stabn	192,0,0,.LBB182-.LFBB20
 2733               		.stabs	"r:r(3,2)",64,0,54,20
 2734               		.stabs	"g:r(3,2)",64,0,56,18
 2735               		.stabs	"b:r(3,2)",64,0,58,24
 2736               		.stabn	192,0,0,.LBB183-.LFBB20
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 138


 2737               		.stabn	224,0,0,.LBE183-.LFBB20
 2738               		.stabn	224,0,0,.LBE182-.LFBB20
 2739               		.stabn	224,0,0,.LBE179-.LFBB20
 2740               		.stabn	224,0,0,.Lscope20-.LFBB20
 2741               	.Lscope20:
 2742               		.stabs	"",36,0,0,.Lscope20-.LFBB20
 2743               		.stabd	78,0,0
 2744               	.global	header
 2745               		.section	.progmem.data,"a",@progbits
 2746               		.type	header, @object
 2747               		.size	header, 36
 2748               	header:
 2749 0000 4C43 4464 		.string	"LCDdirectLVDS61 2013-12-16 23:49:44"
 2749      6972 6563 
 2749      744C 5644 
 2749      5336 3120 
 2749      3230 3133 
 2750               	.global	characters
 2751               		.type	characters, @object
 2752               		.size	characters, 768
 2753               	characters:
 2754 0024 00        		.byte	0
 2755 0025 0C        		.byte	12
 2756 0026 36        		.byte	54
 2757 0027 36        		.byte	54
 2758 0028 0C        		.byte	12
 2759 0029 00        		.byte	0
 2760 002a 1C        		.byte	28
 2761 002b 06        		.byte	6
 2762 002c 18        		.byte	24
 2763 002d 06        		.byte	6
 2764 002e 00        		.byte	0
 2765 002f 00        		.byte	0
 2766 0030 00        		.byte	0
 2767 0031 00        		.byte	0
 2768 0032 00        		.byte	0
 2769 0033 60        		.byte	96
 2770 0034 1E        		.byte	30
 2771 0035 0C        		.byte	12
 2772 0036 1E        		.byte	30
 2773 0037 1E        		.byte	30
 2774 0038 38        		.byte	56
 2775 0039 3F        		.byte	63
 2776 003a 1C        		.byte	28
 2777 003b 3F        		.byte	63
 2778 003c 1E        		.byte	30
 2779 003d 1E        		.byte	30
 2780 003e 00        		.byte	0
 2781 003f 00        		.byte	0
 2782 0040 18        		.byte	24
 2783 0041 00        		.byte	0
 2784 0042 06        		.byte	6
 2785 0043 1E        		.byte	30
 2786 0044 3E        		.byte	62
 2787 0045 0C        		.byte	12
 2788 0046 3F        		.byte	63
 2789 0047 3C        		.byte	60
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 139


 2790 0048 3F        		.byte	63
 2791 0049 7F        		.byte	127
 2792 004a 7F        		.byte	127
 2793 004b 3C        		.byte	60
 2794 004c 33        		.byte	51
 2795 004d 1E        		.byte	30
 2796 004e 78        		.byte	120
 2797 004f 67        		.byte	103
 2798 0050 0F        		.byte	15
 2799 0051 63        		.byte	99
 2800 0052 63        		.byte	99
 2801 0053 1C        		.byte	28
 2802 0054 3F        		.byte	63
 2803 0055 1E        		.byte	30
 2804 0056 3F        		.byte	63
 2805 0057 1E        		.byte	30
 2806 0058 3F        		.byte	63
 2807 0059 33        		.byte	51
 2808 005a 33        		.byte	51
 2809 005b 63        		.byte	99
 2810 005c 63        		.byte	99
 2811 005d 33        		.byte	51
 2812 005e 7F        		.byte	127
 2813 005f 1E        		.byte	30
 2814 0060 03        		.byte	3
 2815 0061 1E        		.byte	30
 2816 0062 08        		.byte	8
 2817 0063 00        		.byte	0
 2818 0064 0C        		.byte	12
 2819 0065 00        		.byte	0
 2820 0066 07        		.byte	7
 2821 0067 00        		.byte	0
 2822 0068 38        		.byte	56
 2823 0069 00        		.byte	0
 2824 006a 1C        		.byte	28
 2825 006b 00        		.byte	0
 2826 006c 07        		.byte	7
 2827 006d 0C        		.byte	12
 2828 006e 18        		.byte	24
 2829 006f 07        		.byte	7
 2830 0070 0E        		.byte	14
 2831 0071 00        		.byte	0
 2832 0072 00        		.byte	0
 2833 0073 00        		.byte	0
 2834 0074 00        		.byte	0
 2835 0075 00        		.byte	0
 2836 0076 00        		.byte	0
 2837 0077 00        		.byte	0
 2838 0078 08        		.byte	8
 2839 0079 00        		.byte	0
 2840 007a 00        		.byte	0
 2841 007b 00        		.byte	0
 2842 007c 00        		.byte	0
 2843 007d 00        		.byte	0
 2844 007e 00        		.byte	0
 2845 007f 38        		.byte	56
 2846 0080 18        		.byte	24
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 140


 2847 0081 07        		.byte	7
 2848 0082 6E        		.byte	110
 2849 0083 0E        		.byte	14
 2850 0084 00        		.byte	0
 2851 0085 1E        		.byte	30
 2852 0086 36        		.byte	54
 2853 0087 36        		.byte	54
 2854 0088 3E        		.byte	62
 2855 0089 63        		.byte	99
 2856 008a 36        		.byte	54
 2857 008b 06        		.byte	6
 2858 008c 0C        		.byte	12
 2859 008d 0C        		.byte	12
 2860 008e 66        		.byte	102
 2861 008f 0C        		.byte	12
 2862 0090 00        		.byte	0
 2863 0091 00        		.byte	0
 2864 0092 00        		.byte	0
 2865 0093 30        		.byte	48
 2866 0094 33        		.byte	51
 2867 0095 0F        		.byte	15
 2868 0096 33        		.byte	51
 2869 0097 33        		.byte	51
 2870 0098 3C        		.byte	60
 2871 0099 03        		.byte	3
 2872 009a 06        		.byte	6
 2873 009b 33        		.byte	51
 2874 009c 33        		.byte	51
 2875 009d 33        		.byte	51
 2876 009e 00        		.byte	0
 2877 009f 00        		.byte	0
 2878 00a0 0C        		.byte	12
 2879 00a1 00        		.byte	0
 2880 00a2 0C        		.byte	12
 2881 00a3 33        		.byte	51
 2882 00a4 63        		.byte	99
 2883 00a5 1E        		.byte	30
 2884 00a6 66        		.byte	102
 2885 00a7 66        		.byte	102
 2886 00a8 36        		.byte	54
 2887 00a9 46        		.byte	70
 2888 00aa 46        		.byte	70
 2889 00ab 66        		.byte	102
 2890 00ac 33        		.byte	51
 2891 00ad 0C        		.byte	12
 2892 00ae 30        		.byte	48
 2893 00af 66        		.byte	102
 2894 00b0 06        		.byte	6
 2895 00b1 77        		.byte	119
 2896 00b2 67        		.byte	103
 2897 00b3 36        		.byte	54
 2898 00b4 66        		.byte	102
 2899 00b5 33        		.byte	51
 2900 00b6 66        		.byte	102
 2901 00b7 33        		.byte	51
 2902 00b8 2D        		.byte	45
 2903 00b9 33        		.byte	51
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 141


 2904 00ba 33        		.byte	51
 2905 00bb 63        		.byte	99
 2906 00bc 63        		.byte	99
 2907 00bd 33        		.byte	51
 2908 00be 33        		.byte	51
 2909 00bf 06        		.byte	6
 2910 00c0 06        		.byte	6
 2911 00c1 18        		.byte	24
 2912 00c2 1C        		.byte	28
 2913 00c3 00        		.byte	0
 2914 00c4 0C        		.byte	12
 2915 00c5 00        		.byte	0
 2916 00c6 06        		.byte	6
 2917 00c7 00        		.byte	0
 2918 00c8 30        		.byte	48
 2919 00c9 00        		.byte	0
 2920 00ca 36        		.byte	54
 2921 00cb 00        		.byte	0
 2922 00cc 06        		.byte	6
 2923 00cd 00        		.byte	0
 2924 00ce 00        		.byte	0
 2925 00cf 06        		.byte	6
 2926 00d0 0C        		.byte	12
 2927 00d1 00        		.byte	0
 2928 00d2 00        		.byte	0
 2929 00d3 00        		.byte	0
 2930 00d4 00        		.byte	0
 2931 00d5 00        		.byte	0
 2932 00d6 00        		.byte	0
 2933 00d7 00        		.byte	0
 2934 00d8 0C        		.byte	12
 2935 00d9 00        		.byte	0
 2936 00da 00        		.byte	0
 2937 00db 00        		.byte	0
 2938 00dc 00        		.byte	0
 2939 00dd 00        		.byte	0
 2940 00de 00        		.byte	0
 2941 00df 0C        		.byte	12
 2942 00e0 18        		.byte	24
 2943 00e1 0C        		.byte	12
 2944 00e2 3B        		.byte	59
 2945 00e3 13        		.byte	19
 2946 00e4 00        		.byte	0
 2947 00e5 1E        		.byte	30
 2948 00e6 36        		.byte	54
 2949 00e7 7F        		.byte	127
 2950 00e8 03        		.byte	3
 2951 00e9 33        		.byte	51
 2952 00ea 1C        		.byte	28
 2953 00eb 03        		.byte	3
 2954 00ec 06        		.byte	6
 2955 00ed 18        		.byte	24
 2956 00ee 3C        		.byte	60
 2957 00ef 0C        		.byte	12
 2958 00f0 00        		.byte	0
 2959 00f1 00        		.byte	0
 2960 00f2 00        		.byte	0
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 142


 2961 00f3 18        		.byte	24
 2962 00f4 3B        		.byte	59
 2963 00f5 0C        		.byte	12
 2964 00f6 30        		.byte	48
 2965 00f7 30        		.byte	48
 2966 00f8 36        		.byte	54
 2967 00f9 1F        		.byte	31
 2968 00fa 03        		.byte	3
 2969 00fb 30        		.byte	48
 2970 00fc 33        		.byte	51
 2971 00fd 33        		.byte	51
 2972 00fe 0C        		.byte	12
 2973 00ff 0C        		.byte	12
 2974 0100 06        		.byte	6
 2975 0101 3F        		.byte	63
 2976 0102 18        		.byte	24
 2977 0103 30        		.byte	48
 2978 0104 7B        		.byte	123
 2979 0105 33        		.byte	51
 2980 0106 66        		.byte	102
 2981 0107 03        		.byte	3
 2982 0108 66        		.byte	102
 2983 0109 16        		.byte	22
 2984 010a 16        		.byte	22
 2985 010b 03        		.byte	3
 2986 010c 33        		.byte	51
 2987 010d 0C        		.byte	12
 2988 010e 30        		.byte	48
 2989 010f 36        		.byte	54
 2990 0110 06        		.byte	6
 2991 0111 7F        		.byte	127
 2992 0112 6F        		.byte	111
 2993 0113 63        		.byte	99
 2994 0114 66        		.byte	102
 2995 0115 33        		.byte	51
 2996 0116 66        		.byte	102
 2997 0117 07        		.byte	7
 2998 0118 0C        		.byte	12
 2999 0119 33        		.byte	51
 3000 011a 33        		.byte	51
 3001 011b 63        		.byte	99
 3002 011c 36        		.byte	54
 3003 011d 33        		.byte	51
 3004 011e 19        		.byte	25
 3005 011f 06        		.byte	6
 3006 0120 0C        		.byte	12
 3007 0121 18        		.byte	24
 3008 0122 36        		.byte	54
 3009 0123 00        		.byte	0
 3010 0124 18        		.byte	24
 3011 0125 1E        		.byte	30
 3012 0126 3E        		.byte	62
 3013 0127 1E        		.byte	30
 3014 0128 30        		.byte	48
 3015 0129 1E        		.byte	30
 3016 012a 06        		.byte	6
 3017 012b 6E        		.byte	110
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 143


 3018 012c 36        		.byte	54
 3019 012d 0E        		.byte	14
 3020 012e 1E        		.byte	30
 3021 012f 66        		.byte	102
 3022 0130 0C        		.byte	12
 3023 0131 37        		.byte	55
 3024 0132 1F        		.byte	31
 3025 0133 1E        		.byte	30
 3026 0134 3B        		.byte	59
 3027 0135 6E        		.byte	110
 3028 0136 1B        		.byte	27
 3029 0137 3E        		.byte	62
 3030 0138 3E        		.byte	62
 3031 0139 33        		.byte	51
 3032 013a 33        		.byte	51
 3033 013b 63        		.byte	99
 3034 013c 63        		.byte	99
 3035 013d 33        		.byte	51
 3036 013e 3F        		.byte	63
 3037 013f 0C        		.byte	12
 3038 0140 18        		.byte	24
 3039 0141 0C        		.byte	12
 3040 0142 00        		.byte	0
 3041 0143 39        		.byte	57
 3042 0144 00        		.byte	0
 3043 0145 0C        		.byte	12
 3044 0146 00        		.byte	0
 3045 0147 36        		.byte	54
 3046 0148 1E        		.byte	30
 3047 0149 18        		.byte	24
 3048 014a 6E        		.byte	110
 3049 014b 00        		.byte	0
 3050 014c 06        		.byte	6
 3051 014d 18        		.byte	24
 3052 014e FF        		.byte	-1
 3053 014f 3F        		.byte	63
 3054 0150 00        		.byte	0
 3055 0151 3F        		.byte	63
 3056 0152 00        		.byte	0
 3057 0153 0C        		.byte	12
 3058 0154 3F        		.byte	63
 3059 0155 0C        		.byte	12
 3060 0156 1C        		.byte	28
 3061 0157 1C        		.byte	28
 3062 0158 33        		.byte	51
 3063 0159 30        		.byte	48
 3064 015a 1F        		.byte	31
 3065 015b 18        		.byte	24
 3066 015c 1E        		.byte	30
 3067 015d 3E        		.byte	62
 3068 015e 0C        		.byte	12
 3069 015f 0C        		.byte	12
 3070 0160 03        		.byte	3
 3071 0161 00        		.byte	0
 3072 0162 30        		.byte	48
 3073 0163 18        		.byte	24
 3074 0164 7B        		.byte	123
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 144


 3075 0165 33        		.byte	51
 3076 0166 3E        		.byte	62
 3077 0167 03        		.byte	3
 3078 0168 66        		.byte	102
 3079 0169 1E        		.byte	30
 3080 016a 1E        		.byte	30
 3081 016b 03        		.byte	3
 3082 016c 3F        		.byte	63
 3083 016d 0C        		.byte	12
 3084 016e 30        		.byte	48
 3085 016f 1E        		.byte	30
 3086 0170 06        		.byte	6
 3087 0171 6B        		.byte	107
 3088 0172 7B        		.byte	123
 3089 0173 63        		.byte	99
 3090 0174 3E        		.byte	62
 3091 0175 33        		.byte	51
 3092 0176 3E        		.byte	62
 3093 0177 1C        		.byte	28
 3094 0178 0C        		.byte	12
 3095 0179 33        		.byte	51
 3096 017a 33        		.byte	51
 3097 017b 6B        		.byte	107
 3098 017c 1C        		.byte	28
 3099 017d 1E        		.byte	30
 3100 017e 0C        		.byte	12
 3101 017f 06        		.byte	6
 3102 0180 18        		.byte	24
 3103 0181 18        		.byte	24
 3104 0182 63        		.byte	99
 3105 0183 00        		.byte	0
 3106 0184 00        		.byte	0
 3107 0185 30        		.byte	48
 3108 0186 66        		.byte	102
 3109 0187 33        		.byte	51
 3110 0188 3E        		.byte	62
 3111 0189 33        		.byte	51
 3112 018a 0F        		.byte	15
 3113 018b 33        		.byte	51
 3114 018c 6E        		.byte	110
 3115 018d 0C        		.byte	12
 3116 018e 18        		.byte	24
 3117 018f 36        		.byte	54
 3118 0190 0C        		.byte	12
 3119 0191 7F        		.byte	127
 3120 0192 33        		.byte	51
 3121 0193 33        		.byte	51
 3122 0194 66        		.byte	102
 3123 0195 33        		.byte	51
 3124 0196 36        		.byte	54
 3125 0197 03        		.byte	3
 3126 0198 0C        		.byte	12
 3127 0199 33        		.byte	51
 3128 019a 33        		.byte	51
 3129 019b 63        		.byte	99
 3130 019c 36        		.byte	54
 3131 019d 33        		.byte	51
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 145


 3132 019e 19        		.byte	25
 3133 019f 07        		.byte	7
 3134 01a0 00        		.byte	0
 3135 01a1 38        		.byte	56
 3136 01a2 00        		.byte	0
 3137 01a3 69        		.byte	105
 3138 01a4 00        		.byte	0
 3139 01a5 0C        		.byte	12
 3140 01a6 00        		.byte	0
 3141 01a7 7F        		.byte	127
 3142 01a8 30        		.byte	48
 3143 01a9 0C        		.byte	12
 3144 01aa 3B        		.byte	59
 3145 01ab 00        		.byte	0
 3146 01ac 06        		.byte	6
 3147 01ad 18        		.byte	24
 3148 01ae 3C        		.byte	60
 3149 01af 0C        		.byte	12
 3150 01b0 00        		.byte	0
 3151 01b1 00        		.byte	0
 3152 01b2 00        		.byte	0
 3153 01b3 06        		.byte	6
 3154 01b4 37        		.byte	55
 3155 01b5 0C        		.byte	12
 3156 01b6 06        		.byte	6
 3157 01b7 30        		.byte	48
 3158 01b8 7F        		.byte	127
 3159 01b9 30        		.byte	48
 3160 01ba 33        		.byte	51
 3161 01bb 0C        		.byte	12
 3162 01bc 33        		.byte	51
 3163 01bd 30        		.byte	48
 3164 01be 00        		.byte	0
 3165 01bf 00        		.byte	0
 3166 01c0 06        		.byte	6
 3167 01c1 3F        		.byte	63
 3168 01c2 18        		.byte	24
 3169 01c3 0C        		.byte	12
 3170 01c4 7B        		.byte	123
 3171 01c5 3F        		.byte	63
 3172 01c6 66        		.byte	102
 3173 01c7 03        		.byte	3
 3174 01c8 66        		.byte	102
 3175 01c9 16        		.byte	22
 3176 01ca 16        		.byte	22
 3177 01cb 73        		.byte	115
 3178 01cc 33        		.byte	51
 3179 01cd 0C        		.byte	12
 3180 01ce 33        		.byte	51
 3181 01cf 36        		.byte	54
 3182 01d0 46        		.byte	70
 3183 01d1 63        		.byte	99
 3184 01d2 73        		.byte	115
 3185 01d3 63        		.byte	99
 3186 01d4 06        		.byte	6
 3187 01d5 3B        		.byte	59
 3188 01d6 1E        		.byte	30
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 146


 3189 01d7 38        		.byte	56
 3190 01d8 0C        		.byte	12
 3191 01d9 33        		.byte	51
 3192 01da 33        		.byte	51
 3193 01db 7F        		.byte	127
 3194 01dc 36        		.byte	54
 3195 01dd 0C        		.byte	12
 3196 01de 46        		.byte	70
 3197 01df 06        		.byte	6
 3198 01e0 30        		.byte	48
 3199 01e1 18        		.byte	24
 3200 01e2 00        		.byte	0
 3201 01e3 00        		.byte	0
 3202 01e4 00        		.byte	0
 3203 01e5 3E        		.byte	62
 3204 01e6 66        		.byte	102
 3205 01e7 03        		.byte	3
 3206 01e8 33        		.byte	51
 3207 01e9 3F        		.byte	63
 3208 01ea 06        		.byte	6
 3209 01eb 33        		.byte	51
 3210 01ec 66        		.byte	102
 3211 01ed 0C        		.byte	12
 3212 01ee 18        		.byte	24
 3213 01ef 1E        		.byte	30
 3214 01f0 0C        		.byte	12
 3215 01f1 6B        		.byte	107
 3216 01f2 33        		.byte	51
 3217 01f3 33        		.byte	51
 3218 01f4 66        		.byte	102
 3219 01f5 33        		.byte	51
 3220 01f6 36        		.byte	54
 3221 01f7 1E        		.byte	30
 3222 01f8 0C        		.byte	12
 3223 01f9 33        		.byte	51
 3224 01fa 33        		.byte	51
 3225 01fb 6B        		.byte	107
 3226 01fc 1C        		.byte	28
 3227 01fd 33        		.byte	51
 3228 01fe 0C        		.byte	12
 3229 01ff 0C        		.byte	12
 3230 0200 18        		.byte	24
 3231 0201 0C        		.byte	12
 3232 0202 00        		.byte	0
 3233 0203 0E        		.byte	14
 3234 0204 00        		.byte	0
 3235 0205 00        		.byte	0
 3236 0206 00        		.byte	0
 3237 0207 36        		.byte	54
 3238 0208 1F        		.byte	31
 3239 0209 66        		.byte	102
 3240 020a 33        		.byte	51
 3241 020b 00        		.byte	0
 3242 020c 0C        		.byte	12
 3243 020d 0C        		.byte	12
 3244 020e 66        		.byte	102
 3245 020f 0C        		.byte	12
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 147


 3246 0210 0E        		.byte	14
 3247 0211 00        		.byte	0
 3248 0212 0C        		.byte	12
 3249 0213 03        		.byte	3
 3250 0214 33        		.byte	51
 3251 0215 0C        		.byte	12
 3252 0216 33        		.byte	51
 3253 0217 33        		.byte	51
 3254 0218 30        		.byte	48
 3255 0219 33        		.byte	51
 3256 021a 33        		.byte	51
 3257 021b 06        		.byte	6
 3258 021c 33        		.byte	51
 3259 021d 18        		.byte	24
 3260 021e 0C        		.byte	12
 3261 021f 0E        		.byte	14
 3262 0220 0C        		.byte	12
 3263 0221 00        		.byte	0
 3264 0222 0C        		.byte	12
 3265 0223 00        		.byte	0
 3266 0224 03        		.byte	3
 3267 0225 33        		.byte	51
 3268 0226 66        		.byte	102
 3269 0227 66        		.byte	102
 3270 0228 36        		.byte	54
 3271 0229 46        		.byte	70
 3272 022a 06        		.byte	6
 3273 022b 66        		.byte	102
 3274 022c 33        		.byte	51
 3275 022d 0C        		.byte	12
 3276 022e 33        		.byte	51
 3277 022f 66        		.byte	102
 3278 0230 66        		.byte	102
 3279 0231 63        		.byte	99
 3280 0232 63        		.byte	99
 3281 0233 36        		.byte	54
 3282 0234 06        		.byte	6
 3283 0235 1E        		.byte	30
 3284 0236 36        		.byte	54
 3285 0237 33        		.byte	51
 3286 0238 0C        		.byte	12
 3287 0239 33        		.byte	51
 3288 023a 1E        		.byte	30
 3289 023b 77        		.byte	119
 3290 023c 63        		.byte	99
 3291 023d 0C        		.byte	12
 3292 023e 63        		.byte	99
 3293 023f 06        		.byte	6
 3294 0240 60        		.byte	96
 3295 0241 18        		.byte	24
 3296 0242 00        		.byte	0
 3297 0243 00        		.byte	0
 3298 0244 00        		.byte	0
 3299 0245 33        		.byte	51
 3300 0246 66        		.byte	102
 3301 0247 33        		.byte	51
 3302 0248 33        		.byte	51
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 148


 3303 0249 03        		.byte	3
 3304 024a 06        		.byte	6
 3305 024b 3E        		.byte	62
 3306 024c 66        		.byte	102
 3307 024d 0C        		.byte	12
 3308 024e 18        		.byte	24
 3309 024f 36        		.byte	54
 3310 0250 0C        		.byte	12
 3311 0251 63        		.byte	99
 3312 0252 33        		.byte	51
 3313 0253 33        		.byte	51
 3314 0254 3E        		.byte	62
 3315 0255 3E        		.byte	62
 3316 0256 06        		.byte	6
 3317 0257 30        		.byte	48
 3318 0258 2C        		.byte	44
 3319 0259 33        		.byte	51
 3320 025a 1E        		.byte	30
 3321 025b 7F        		.byte	127
 3322 025c 36        		.byte	54
 3323 025d 3E        		.byte	62
 3324 025e 26        		.byte	38
 3325 025f 0C        		.byte	12
 3326 0260 18        		.byte	24
 3327 0261 0C        		.byte	12
 3328 0262 00        		.byte	0
 3329 0263 F3        		.byte	-13
 3330 0264 00        		.byte	0
 3331 0265 0C        		.byte	12
 3332 0266 00        		.byte	0
 3333 0267 36        		.byte	54
 3334 0268 0C        		.byte	12
 3335 0269 63        		.byte	99
 3336 026a 6E        		.byte	110
 3337 026b 00        		.byte	0
 3338 026c 18        		.byte	24
 3339 026d 06        		.byte	6
 3340 026e 00        		.byte	0
 3341 026f 00        		.byte	0
 3342 0270 0C        		.byte	12
 3343 0271 00        		.byte	0
 3344 0272 0C        		.byte	12
 3345 0273 01        		.byte	1
 3346 0274 1E        		.byte	30
 3347 0275 3F        		.byte	63
 3348 0276 3F        		.byte	63
 3349 0277 1E        		.byte	30
 3350 0278 30        		.byte	48
 3351 0279 1E        		.byte	30
 3352 027a 1E        		.byte	30
 3353 027b 06        		.byte	6
 3354 027c 1E        		.byte	30
 3355 027d 0E        		.byte	14
 3356 027e 0C        		.byte	12
 3357 027f 0C        		.byte	12
 3358 0280 18        		.byte	24
 3359 0281 00        		.byte	0
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 149


 3360 0282 06        		.byte	6
 3361 0283 0C        		.byte	12
 3362 0284 1E        		.byte	30
 3363 0285 33        		.byte	51
 3364 0286 3F        		.byte	63
 3365 0287 3C        		.byte	60
 3366 0288 3F        		.byte	63
 3367 0289 7F        		.byte	127
 3368 028a 0F        		.byte	15
 3369 028b 7C        		.byte	124
 3370 028c 33        		.byte	51
 3371 028d 1E        		.byte	30
 3372 028e 1E        		.byte	30
 3373 028f 67        		.byte	103
 3374 0290 7F        		.byte	127
 3375 0291 63        		.byte	99
 3376 0292 63        		.byte	99
 3377 0293 1C        		.byte	28
 3378 0294 0F        		.byte	15
 3379 0295 38        		.byte	56
 3380 0296 67        		.byte	103
 3381 0297 1E        		.byte	30
 3382 0298 1E        		.byte	30
 3383 0299 3F        		.byte	63
 3384 029a 0C        		.byte	12
 3385 029b 63        		.byte	99
 3386 029c 63        		.byte	99
 3387 029d 1E        		.byte	30
 3388 029e 7F        		.byte	127
 3389 029f 1E        		.byte	30
 3390 02a0 40        		.byte	64
 3391 02a1 1E        		.byte	30
 3392 02a2 00        		.byte	0
 3393 02a3 00        		.byte	0
 3394 02a4 00        		.byte	0
 3395 02a5 6E        		.byte	110
 3396 02a6 3D        		.byte	61
 3397 02a7 1E        		.byte	30
 3398 02a8 6E        		.byte	110
 3399 02a9 1E        		.byte	30
 3400 02aa 0F        		.byte	15
 3401 02ab 30        		.byte	48
 3402 02ac 67        		.byte	103
 3403 02ad 1E        		.byte	30
 3404 02ae 1B        		.byte	27
 3405 02af 67        		.byte	103
 3406 02b0 1E        		.byte	30
 3407 02b1 63        		.byte	99
 3408 02b2 33        		.byte	51
 3409 02b3 1E        		.byte	30
 3410 02b4 06        		.byte	6
 3411 02b5 30        		.byte	48
 3412 02b6 0F        		.byte	15
 3413 02b7 1F        		.byte	31
 3414 02b8 18        		.byte	24
 3415 02b9 6E        		.byte	110
 3416 02ba 0C        		.byte	12
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 150


 3417 02bb 36        		.byte	54
 3418 02bc 63        		.byte	99
 3419 02bd 30        		.byte	48
 3420 02be 3F        		.byte	63
 3421 02bf 38        		.byte	56
 3422 02c0 18        		.byte	24
 3423 02c1 07        		.byte	7
 3424 02c2 00        		.byte	0
 3425 02c3 46        		.byte	70
 3426 02c4 00        		.byte	0
 3427 02c5 00        		.byte	0
 3428 02c6 00        		.byte	0
 3429 02c7 00        		.byte	0
 3430 02c8 00        		.byte	0
 3431 02c9 00        		.byte	0
 3432 02ca 00        		.byte	0
 3433 02cb 00        		.byte	0
 3434 02cc 00        		.byte	0
 3435 02cd 00        		.byte	0
 3436 02ce 00        		.byte	0
 3437 02cf 00        		.byte	0
 3438 02d0 06        		.byte	6
 3439 02d1 00        		.byte	0
 3440 02d2 00        		.byte	0
 3441 02d3 00        		.byte	0
 3442 02d4 00        		.byte	0
 3443 02d5 00        		.byte	0
 3444 02d6 00        		.byte	0
 3445 02d7 00        		.byte	0
 3446 02d8 00        		.byte	0
 3447 02d9 00        		.byte	0
 3448 02da 00        		.byte	0
 3449 02db 00        		.byte	0
 3450 02dc 00        		.byte	0
 3451 02dd 00        		.byte	0
 3452 02de 00        		.byte	0
 3453 02df 06        		.byte	6
 3454 02e0 00        		.byte	0
 3455 02e1 00        		.byte	0
 3456 02e2 00        		.byte	0
 3457 02e3 00        		.byte	0
 3458 02e4 00        		.byte	0
 3459 02e5 00        		.byte	0
 3460 02e6 00        		.byte	0
 3461 02e7 00        		.byte	0
 3462 02e8 00        		.byte	0
 3463 02e9 00        		.byte	0
 3464 02ea 00        		.byte	0
 3465 02eb 00        		.byte	0
 3466 02ec 00        		.byte	0
 3467 02ed 00        		.byte	0
 3468 02ee 00        		.byte	0
 3469 02ef 00        		.byte	0
 3470 02f0 00        		.byte	0
 3471 02f1 00        		.byte	0
 3472 02f2 00        		.byte	0
 3473 02f3 00        		.byte	0
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 151


 3474 02f4 00        		.byte	0
 3475 02f5 00        		.byte	0
 3476 02f6 00        		.byte	0
 3477 02f7 00        		.byte	0
 3478 02f8 00        		.byte	0
 3479 02f9 00        		.byte	0
 3480 02fa 00        		.byte	0
 3481 02fb 00        		.byte	0
 3482 02fc 00        		.byte	0
 3483 02fd 00        		.byte	0
 3484 02fe 00        		.byte	0
 3485 02ff 00        		.byte	0
 3486 0300 00        		.byte	0
 3487 0301 00        		.byte	0
 3488 0302 00        		.byte	0
 3489 0303 FF        		.byte	-1
 3490 0304 00        		.byte	0
 3491 0305 00        		.byte	0
 3492 0306 00        		.byte	0
 3493 0307 00        		.byte	0
 3494 0308 00        		.byte	0
 3495 0309 00        		.byte	0
 3496 030a 00        		.byte	0
 3497 030b 1F        		.byte	31
 3498 030c 00        		.byte	0
 3499 030d 00        		.byte	0
 3500 030e 0E        		.byte	14
 3501 030f 00        		.byte	0
 3502 0310 00        		.byte	0
 3503 0311 00        		.byte	0
 3504 0312 00        		.byte	0
 3505 0313 00        		.byte	0
 3506 0314 0F        		.byte	15
 3507 0315 78        		.byte	120
 3508 0316 00        		.byte	0
 3509 0317 00        		.byte	0
 3510 0318 00        		.byte	0
 3511 0319 00        		.byte	0
 3512 031a 00        		.byte	0
 3513 031b 00        		.byte	0
 3514 031c 00        		.byte	0
 3515 031d 1F        		.byte	31
 3516 031e 00        		.byte	0
 3517 031f 00        		.byte	0
 3518 0320 00        		.byte	0
 3519 0321 00        		.byte	0
 3520 0322 00        		.byte	0
 3521 0323 F4        		.byte	-12
 3522               	.global	pieceNum
 3523               	.global	pieceNum
 3524               		.section .bss
 3525               		.type	pieceNum, @object
 3526               		.size	pieceNum, 1
 3527               	pieceNum:
 3528 0000 00        		.skip 1,0
 3529               	.global	pieceOrientation
 3530               	.global	pieceOrientation
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 152


 3531               		.type	pieceOrientation, @object
 3532               		.size	pieceOrientation, 1
 3533               	pieceOrientation:
 3534 0001 00        		.skip 1,0
 3535               	.global	pieceTopRow
 3536               	.global	pieceTopRow
 3537               		.type	pieceTopRow, @object
 3538               		.size	pieceTopRow, 1
 3539               	pieceTopRow:
 3540 0002 00        		.skip 1,0
 3541               	.global	pieceLeftCol
 3542               	.global	pieceLeftCol
 3543               		.type	pieceLeftCol, @object
 3544               		.size	pieceLeftCol, 1
 3545               	pieceLeftCol:
 3546 0003 00        		.skip 1,0
 3547               	.global	tetColorScheme
 3548               	.global	tetColorScheme
 3549               		.type	tetColorScheme, @object
 3550               		.size	tetColorScheme, 1
 3551               	tetColorScheme:
 3552 0004 00        		.skip 1,0
 3553               	.global	pgm_tetPiece
 3554               		.section	.progmem.data
 3555               		.type	pgm_tetPiece, @object
 3556               		.size	pgm_tetPiece, 56
 3557               	pgm_tetPiece:
 3558 0324 F000      		.word	240
 3559 0326 2222      		.word	8738
 3560 0328 F000      		.word	240
 3561 032a 2222      		.word	8738
 3562 032c 600C      		.word	3168
 3563 032e 6402      		.word	612
 3564 0330 600C      		.word	3168
 3565 0332 6402      		.word	612
 3566 0334 C006      		.word	1728
 3567 0336 408C      		.word	-29632
 3568 0338 C006      		.word	1728
 3569 033a 408C      		.word	-29632
 3570 033c E004      		.word	1248
 3571 033e C404      		.word	1220
 3572 0340 E400      		.word	228
 3573 0342 6404      		.word	1124
 3574 0344 E008      		.word	2272
 3575 0346 4C04      		.word	1100
 3576 0348 E200      		.word	226
 3577 034a 4406      		.word	1604
 3578 034c E002      		.word	736
 3579 034e 440C      		.word	3140
 3580 0350 E800      		.word	232
 3581 0352 4604      		.word	1094
 3582 0354 6006      		.word	1632
 3583 0356 6006      		.word	1632
 3584 0358 6006      		.word	1632
 3585 035a 6006      		.word	1632
 3586               	.global	dataEnable
 3587               	.global	dataEnable
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 153


 3588               		.section .bss
 3589               		.type	dataEnable, @object
 3590               		.size	dataEnable, 1
 3591               	dataEnable:
 3592 0005 00        		.skip 1,0
 3593               	.global	vSync
 3594               	.global	vSync
 3595               		.type	vSync, @object
 3596               		.size	vSync, 1
 3597               	vSync:
 3598 0006 00        		.skip 1,0
 3599               	.global	hsyncCount
 3600               	.global	hsyncCount
 3601               		.type	hsyncCount, @object
 3602               		.size	hsyncCount, 2
 3603               	hsyncCount:
 3604 0007 0000      		.skip 2,0
 3605               	.global	segPosition
 3606               	.global	segPosition
 3607               		.type	segPosition, @object
 3608               		.size	segPosition, 1
 3609               	segPosition:
 3610 0009 00        		.skip 1,0
 3611               		.lcomm last_rbValue.2283,1
 3612               		.lcomm frameCount.2159,1
 3613               		.lcomm hfmGradient.2181,4
 3614               		.lcomm newPieceHitCount.1888,1
 3615               		.lcomm callCount.1887,1
 3616               		.comm rowSegBuffer,194,1
 3617               		.comm rowBuffer,64,1
 3618               		.comm tetRow,72,1
 3619               		.data
 3620               		.type	CSWTCH.52, @object
 3621               		.size	CSWTCH.52, 7
 3622               	CSWTCH.52:
 3623 0000 03        		.byte	3
 3624 0001 07        		.byte	7
 3625 0002 0F        		.byte	15
 3626 0003 0C        		.byte	12
 3627 0004 3C        		.byte	60
 3628 0005 30        		.byte	48
 3629 0006 33        		.byte	51
 3630               		.type	CSWTCH.55, @object
 3631               		.size	CSWTCH.55, 7
 3632               	CSWTCH.55:
 3633 0007 01        		.byte	1
 3634 0008 04        		.byte	4
 3635 0009 10        		.byte	16
 3636 000a 14        		.byte	20
 3637 000b 11        		.byte	17
 3638 000c 05        		.byte	5
 3639 000d 15        		.byte	21
 3640               		.stabs	"header:G(0,16)=ar(0,17)=r(0,17);0;0177777;;0;35;(3,2)",32,0,16,0
 3641               		.stabs	"characters:G(0,18)=ar(0,17);0;7;(0,19)=ar(0,17);0;95;(3,2)",32,0,30,0
 3642               		.stabs	"rowSegBuffer:G(0,20)=ar(0,17);0;96;(13,2)",32,0,21,0
 3643               		.stabs	"segPosition:G(3,2)",32,0,41,0
 3644               		.stabs	"rowBuffer:G(0,21)=ar(0,17);0;63;(3,2)",32,0,81,0
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 154


 3645               		.stabs	"pgm_tetPiece:G(0,22)=ar(0,17);0;6;(0,23)=ar(0,17);0;3;(3,4)",32,0,490,0
 3646               		.stabs	"tetRow:G(0,24)=ar(0,17);0;17;(3,6)",32,0,54,0
 3647               		.stabs	"pieceNum:G(3,2)",32,0,93,0
 3648               		.stabs	"pieceOrientation:G(3,2)",32,0,94,0
 3649               		.stabs	"pieceTopRow:G(3,2)",32,0,96,0
 3650               		.stabs	"pieceLeftCol:G(3,2)",32,0,97,0
 3651               		.stabs	"tetColorScheme:G(3,2)",32,0,416,0
 3652               		.stabs	"dataEnable:G(3,2)",32,0,1144,0
 3653               		.stabs	"vSync:G(3,2)",32,0,1145,0
 3654               		.stabs	"hsyncCount:G(3,4)",32,0,1146,0
 3655               		.text
 3656               		.stabs	"",100,0,0,.Letext0
 3657               	.Letext0:
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 155


DEFINED SYMBOLS
                            *ABS*:00000000 main.c
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:2      *ABS*:0000003f __SREG__
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:3      *ABS*:0000003e __SP_H__
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:4      *ABS*:0000003d __SP_L__
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:5      *ABS*:00000000 __tmp_reg__
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:6      *ABS*:00000001 __zero_reg__
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:113    .text:00000000 fb_to_rb
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:172    .text:0000003e getTetBrick
                            *COM*:00000048 tetRow
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:223    .text:00000074 setTetBrick
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:307    .text:000000f0 tetInit
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:377    .text:0000012e tetUpdate
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:3613   .bss:00000010 newPieceHitCount.1888
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:3533   .bss:00000001 pieceOrientation
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:3545   .bss:00000003 pieceLeftCol
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:3539   .bss:00000002 pieceTopRow
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:3614   .bss:00000011 callCount.1887
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:3527   .bss:00000000 pieceNum
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:3557   .progmem.data:00000324 pgm_tetPiece
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:810    .text:0000037e tetBrick_to_fb
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:3551   .bss:00000004 tetColorScheme
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:3622   .data:00000000 CSWTCH.52
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:3632   .data:00000007 CSWTCH.55
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:863    .text:000003ae pll_enable
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:937    .text:000003ce lvds_timerInit
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:1030   .text:0000041e lcd_Init
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:1056   .text:00000428 segClear
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:3609   .bss:00000009 segPosition
                            *COM*:000000c2 rowSegBuffer
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:1087   .text:0000043a segTerminate
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:1164   .text:00000492 newSeg
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:1284   .text:00000512 stretchSeg
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:1388   .text:00000570 addSeg
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:1445   .text:000005a6 rbpix_to_seg
                             .bss:0000000a last_rbValue.2283
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:1537   .text:0000060c rsb_drawPix
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:1556   .text:00000614 LoadNext_921
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:1592   .text:00000658 Done_921
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:1572   .text:00000632 Counter_921
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:1650   .text:00000672 updateLCD
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:3603   .bss:00000007 hsyncCount
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:3591   .bss:00000005 dataEnable
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:3597   .bss:00000006 vSync
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:1867   .text:00000720 init_timer0Hsync
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:1907   .text:0000073a main
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:1935   .text:00000744 __vector_14
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:3611   .bss:0000000b frameCount.2159
                            *COM*:00000040 rowBuffer
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:2753   .progmem.data:00000024 characters
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:3612   .bss:0000000c hfmGradient.2181
/var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s:2748   .progmem.data:00000000 header

UNDEFINED SYMBOLS
__do_copy_data
__do_clear_bss
__mulhi3
GAS LISTING /var/folders/yG/yGnXnnFGGj4hKA71DL26EU+++TI/-Tmp-//ccgfI8BS.s 			page 156


timer_setWGM
timer_selectDivisor
timer_compareMatchIntSetup
hfm_setup
hfm_setPower
hfm_nextOutput
